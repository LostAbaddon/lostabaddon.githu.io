(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d7dbb"],{7936:function(e,t,r){"use strict";r.r(t);var a=r("79c4");const i={ref:"ToolBar",class:"markup-editor toolbar"},o=Object(a["h"])("div",{class:"wordcount-hint"},[Object(a["h"])("span",null,"字数："),Object(a["h"])("span",{class:"count"})],-1),n={class:"markup-editor container"},l={class:"scroller editorContainer"},s={ref:"Editor",class:"inputter",contenteditable:"true"},d=Object(a["h"])("div",{class:"sepBar"},null,-1),c={class:"scroller previewContainer"},u={ref:"Previewer",class:"previewer"};function h(e,t,r,h,p,w){return Object(a["q"])(),Object(a["d"])(a["a"],null,[Object(a["h"])("div",i,[o],512),Object(a["h"])("div",n,[Object(a["h"])("div",l,[Object(a["h"])("div",s,null,512)]),d,Object(a["h"])("div",c,[Object(a["h"])("div",u,null,512)])]),Object(a["h"])("input",{ref:"FileLoader",type:"file",onChange:t[1]||(t[1]=e=>w.readFile())},null,544)],64)}var p=!1;(async()=>{await Promise.all([loadCSS("/css/editor.css"),loadJS("/js/editor.js")]),p=!0;for(let e of w)e()})();const w=new Set,f=()=>new Promise(e=>{if(p)return e();w.add(e)});PageBroadcast.on("route-updated",({data:e})=>{location.hash.indexOf("tools/markupEditor")>0?document.body.setAttribute("mode","editor"):document.body.removeAttribute("mode")});var b=null,m={name:"MarkupEditor",data(){return{}},components:{},async mounted(){b=this;var e={id:"",title:"",category:[],author:"",description:"",content:"",publish:0};await f();var t=initMarkUpEditor(this.$refs.Editor,this.$refs.ToolBar,this.$refs.Previewer,this.$refs.ToolBar.querySelector("div.wordcount-hint span.count"),{init:t=>{var r=this.$route.query;return r&&(r=r.action),r||(r="newfile"),"newfile"===r?(e.id=BookShelf.newLongID(),t.newFile(this.SiteOwner)):BookShelf.getArticle(r).then(r=>{e.id=r.id,t.read((r.title||"untitled")+".mu",r.content)}),!0},close:()=>(this.$router.push({path:"/tools/localLibrary"}),!0),help:()=>{var e=window.open("/#/markup");return e.focus(),!0},"download-file":e=>{var t=e.getContent(),r=e.filename;return r||(r=e.title?e.title+".mu":"untitled.mu"),this.download(r,t),!0},"upload-file":e=>(this.$refs.FileLoader.accept=".mu",this.$refs.FileLoader.click(),!0),"save-article":async t=>{var r=t.getContent(),a=await MarkUp.fullParse(r);return e.title=a.title||"无标题文章",e.author=a.meta.author||this.SiteOwner,e.description=a.meta.description||this.generateDesc(a.content),e.content=r,e.category=this.generateCate(a.meta.keywords),e.publish=Date.now(),BookShelf.saveArticle(e),!0}});b.markupEditor=t,callPageLoaded()},unmounted(){b=null},methods:{download(e,t){var r=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(r),i=newEle("a");i.setAttribute("href",a),e?i.setAttribute("download",e):i.setAttribute("download","untitled.mu"),i.click()},readFile(){var e=b.$refs.FileLoader.files[0];if(e){var t=new FileReader;t.onload=()=>{b.markupEditor.read(e.name,t.result)},t.readAsText(e),b.$refs.FileLoader.value=""}},generateDesc(e){return e=e.replace(/<.*?>/gi,""),e.length>150&&(e=e.substring(0,148)+"……"),e},generateCate(e){return e=e.filter(e=>!!e&&!["unsorted","未分类"].includes(e)),0===e.length?[]:e.map(e=>CateNameMap[e]||e)}}};m.render=h;t["default"]=m}}]);
//# sourceMappingURL=chunk-2d0d7dbb.js.map