(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d7dbb"],{7936:function(e,t,r){"use strict";r.r(t);var i=r("79c4");const a={ref:"ToolBar",class:"markup-editor toolbar"},n=Object(i["h"])("div",{class:"wordcount-hint"},[Object(i["h"])("span",null,"字数："),Object(i["h"])("span",{class:"count"})],-1),o={class:"markup-editor container"},l={class:"scroller editorContainer"},s={ref:"Editor",class:"inputter",contenteditable:"true"},d=Object(i["h"])("div",{class:"sepBar"},null,-1),c={class:"scroller previewContainer"},u={ref:"Previewer",class:"previewer"};function h(e,t,r,h,p,f){return Object(i["q"])(),Object(i["d"])(i["a"],null,[Object(i["h"])("div",a,[n],512),Object(i["h"])("div",o,[Object(i["h"])("div",l,[Object(i["h"])("div",s,null,512)]),d,Object(i["h"])("div",c,[Object(i["h"])("div",u,null,512)])]),Object(i["h"])("input",{ref:"FileLoader",type:"file",onChange:t[1]||(t[1]=e=>f.readFile())},null,544)],64)}var p=!1;(async()=>{await Promise.all([loadCSS("/css/editor.css"),loadJS("/js/editor.js")]),p=!0;for(let e of f)e()})();const f=new Set,w=()=>new Promise(e=>{if(p)return e();f.add(e)});PageBroadcast.on("route-updated",({data:e})=>{location.hash.indexOf("tools/markupEditor")>0?document.body.setAttribute("mode","editor"):document.body.removeAttribute("mode")});var b=null,m={};const v=(e,t,r="")=>{for(let i in t){if(!i)continue;if(["tools","entertain","library"].includes(i))continue;let a=t[i],n=r+"/"+i;e[a.name]=n;let o=a.subs;o&&v(e,o,n)}};v(m,SiteMap);var k={name:"MarkupEditor",data(){return{}},components:{},async mounted(){b=this;var e={id:"",title:"",category:[],author:"",description:"",content:"",publish:0};await w();var t=initMarkUpEditor(this.$refs.Editor,this.$refs.ToolBar,this.$refs.Previewer,this.$refs.ToolBar.querySelector("div.wordcount-hint span.count"),{init:t=>{var r=this.$route.query;return r&&(r=r.action),r||(r="newfile"),"newfile"===r?(e.id=BookShelf.newLongID(),t.newFile(this.SiteOwner)):BookShelf.getArticle(r).then(r=>{e.id=r.id,t.read((r.title||"untitled")+".mu",r.content)}),!0},close:()=>(this.$router.push({path:"/tools/localLibrary"}),!0),help:()=>{var e=window.open("/#/markup");return e.focus(),!0},"download-file":e=>{var t=e.getContent(),r=e.filename;return r||(r=e.title?e.title+".mu":"untitled.mu"),this.download(r,t),!0},"upload-file":e=>(this.$refs.FileLoader.accept=".mu",this.$refs.FileLoader.click(),!0),"save-article":async t=>{var r=t.getContent(),i=await MarkUp.fullParse(r);return e.title=i.title||"无标题文章",e.author=i.meta.author||this.SiteOwner,e.description=i.meta.description||this.generateDesc(i.content),e.content=r,e.category=this.generateCate(i.meta.keywords),e.publish=Date.now(),BookShelf.saveArticle(e),!0}});b.markupEditor=t,callPageLoaded()},unmounted(){b=null},methods:{download(e,t){var r=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(r),a=newEle("a");a.setAttribute("href",i),e?a.setAttribute("download",e):a.setAttribute("download","untitled.mu"),a.click()},readFile(){var e=b.$refs.FileLoader.files[0];if(e){var t=new FileReader;t.onload=()=>{b.markupEditor.read(e.name,t.result)},t.readAsText(e),b.$refs.FileLoader.value=""}},generateDesc(e){return e=e.replace(/<.*?>/gi,""),e.length>150&&(e=e.substring(0,148)+"……"),e},generateCate(e){return e=e.filter(e=>!!e&&!["unsorted","未分类"].includes(e)),0===e.length?[]:e.map(e=>m[e]||e)}}};k.render=h;t["default"]=k}}]);
//# sourceMappingURL=chunk-2d0d7dbb.js.map