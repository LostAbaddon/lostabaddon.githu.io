(()=>{const N=RushGo.Win,w=window.RushGo.State,P=window.RushGo.HalfLine,_=window.RushGo.SingleLine,I=window.RushGo.CrossPoint,x=window.RushGo.ValueField;class C extends RushGo.AIOne{deepRange=2;decayPower=2;decayRate=.5;constructor(d,E,k,p,v,e,g,n,s,W){super(d,E,k,p,v,e,g);isNaN(n)||(this.deepRange=n),isNaN(s)||(this.decayPower=s),isNaN(W)||(this.decayRate=W)}go(){if(!window.RushGo.finished){window.RushGo.pause=!0,window.RushGo.timeStart[this.id]=Date.now();var d=window.RushGo.copyRushGo(),E,k;if(window.RushGo.loopCount<window.RushGo.GameModeOption.startWithInits)E=this.placeInits(d),k=[];else{let[p,v,e]=this.valueMe(d),[g,n,s]=this.valueEnemy(d);if(this.attitude<=0)this.attacktive=this.center;else{let W=v-n+e.scoreW-s.scoreW,r=W*this.incress/(Math.abs(W)+this.attitude);r>=0?this.attacktive=this.center+this.up*r:this.attacktive=this.center+this.down*r}[E,k]=this.makeDecision(d,v,e,n,s,...this.combineStrategy(p,g))}if(window.RushGo.timeUsed[this.id]+=Date.now()-window.RushGo.timeStart[this.id],setTimeout(()=>{window.RushGo.pause=!1},0),!E){window.RushGo.finished=!0;for(let p=0;p<2;p++){let v=aiList[p];!!v&&!!v.clear&&v.clear()}ResultHint.innerHTML="\u5C45\u7136\u6253\u6210\u4E86\u5E73\u624B\uFF01<br>\u8981\u4E0D\u518D\u6765\u4E00\u5C40\uFF1F",ResultPad.classList.add("show");return}window.RushGo.posGo(...E,k)}}combineStrategy(d,E){var k=[],p=[],v=[],e=[],g=new x;for(let s=0;s<=window.RushGo.Grid;s++){let W=[];for(let r=0;r<=window.RushGo.Grid;r++){let R=d[s][r],l=E[s][r],a=new w,G=[s,r],t=s+"-"+r;!R||!l?a.state=w.Alone:R.state.state===w.Forbidden?g.state=w.Alone:R.state.state===w.MustWin?(g.mustWins.push(G),a.state=w.MustWin):l.state.state===w.MustWin?(g.mustLoses.push(G),a.state=w.MustLose):R.state.state===w.WillWin?(g.willWins.push(G),a.state=w.WillWin):l.state.state===w.WillWin?(g.willLoses.push(G),a.state=w.WillLose):R.state.state===w.MayWin?(g.mayWins.push(G),a.state=w.MayWin):l.state.state===w.MayWin?(g.mayLoses.push(G),a.state=w.MayLose):R.state.state<=w.Alone?l.state.state<=w.Alone?a.state=w.Alone:(g.normals.push(G),a.state=w.Normal,a.score=l.state.score*(1-this.attacktive),e.push([G,a.score])):(g.normals.push(G),a.state=w.Normal,l.state.state<=w.Alone?a.score=R.state.score*this.attacktive:a.score=R.state.score*this.attacktive+l.state.score*(1-this.attacktive),e.push([G,a.score])),a.update(),W[r]=a}k[s]=W}e=e.filter(s=>s[1]>0),e.sort((s,W)=>W[1]-s[1]);var n=0;return e.forEach(s=>n+=s[1]),e.forEach(s=>s[1]/=n),[e,k,g]}makeDecision(d,E,k,p,v,e,g,n){window.RushGo.DrawStrategy&&(console.log("====> Make Decision <==== ["+(window.RushGo.loopCount+1)+"]    "+this.id+"("+this.level+")"),n.mustWins.length>0&&console.log("    MustWins : ("+n.mustWins.join("), (")+")"),n.mustLoses.length>0&&console.log("    MustLoses: ("+n.mustLoses.join("), (")+")"),n.willWins.length>0&&console.log("    WillWins : ("+n.willWins.join("), (")+")"),n.willLoses.length>0&&console.log("    WillLoses: ("+n.willLoses.join("), (")+")"),n.mayWins.length>0&&console.log("    MayWins  : ("+n.mayWins.join("), (")+")"),n.mayLoses.length>0&&console.log("    MayLoses : ("+n.mayLoses.join("), (")+")"));var s=[],W=[];if(n.mustWins.length>0?s=n.mustWins.map(t=>[t,1]):n.mustLoses.length>0?s=n.mustLoses.map(t=>[t,1]):n.willWins.length>0?s=n.willWins.map(t=>[t,1]):n.willLoses.length>0?s=n.willLoses.map(t=>[t,1]):n.mayWins.length>0?s=n.mayWins.map(t=>[t,1]):n.mayLoses.length>0&&(s=n.mayLoses.map(t=>[t,1])),s.length===1)return[s[0][0],[]];if(s.length>0){let t=0;s.forEach(o=>t+=o[1]),e=s.map(o=>[o[0],o[1]/t])}else if(e.length>this.range){let t=e[this.range-1][1],o=e.filter(f=>f[1]>t),m=e.filter(f=>f[1]===t);t=this.range-o.length;for(let f=0;f<t;f++){let i=m.length;i=Math.floor(i*Math.random()),i=m.splice(i,1)[0],o.push(i)}e=o}s=[];var r=[];if(E+=k.scoreW/N,p+=v.scoreW/N,window.RushGo.DrawStrategy&&console.log("    Branch Count: "+e.length),e.forEach(t=>{var[o,m]=t,f=this.goDeep(d,...o);if(!f&&window.RushGo.DrawStrategy&&console.log("    .... ("+o+") "+m+" >> null"),!!f){if(f[0]===-1){let c=f[1]-E,u=p-f[2],h=c*this.attacktive+u*(1-this.attacktive);h=(N+h)/N,t[1]*=h,window.RushGo.DrawStrategy&&console.log("    .... ("+o+") "+m+" >> null ("+h+")");return}var i={};f.forEach(c=>{var[u,h,L,S,y]=c,M=i[u];M||(M=[0,0,0,!1],i[u]=M),y===M[3]?(M[0]+=h*m,M[1]+=L*m):y&&!M[3]&&(M[0]+=h*m*this.decayRate,M[1]+=L*m*this.decayRate),S>M[2]&&(M[2]=S),M[3]=M[3]||y});var A=0;for(let c in i){let[u,h,L,S]=i[c];c*=1;let y=0;c===this.id?y=u*this.attacktive-h*(1-this.attacktive):y-=u*(1-this.attacktive)-h*this.attacktive,A+=y,window.RushGo.DrawStrategy&&console.log("    :::: ("+o+") "+m+" : "+c+" >> "+u+" / "+h+" ("+L+") >> "+y+"    M: "+S)}if(A>0){let c=!0,u=-1;r.some((h,L)=>{if(h[0]!==o)return!1;h[1]+A<1?c=!1:u=L}),c?s.push([o,A]):u>=0&&r.splice(u,1)}else if(A<0){let c=!0,u=-1;s.some((h,L)=>{if(h[0]!==o)return!1;h[1]+A>0?c=!1:u=L}),c?r.push([o,1+A]):u>=0&&s.splice(u,1)}}}),s.length>0){let t=0;s.forEach(o=>t+=o[1]),s.forEach(o=>o[1]/=t),e=s}if(r.length>0){let t=[];e.forEach(o=>{var m=!1;r.some(f=>o[0]!==f[0]?!1:(m=!0,o[1]=f[1],!0)),m?window.RushGo.DrawStrategy&&console.log("  REMOVE ~~> ("+o[0]+") : "+o[1]):t.push(o)}),t.length>0?e=t:window.RushGo.DrawStrategy&&console.log("  >>>> No Choise Available Now!!! <<<<")}if(e.length===0)return[null,[]];if(e.sort((t,o)=>o[1]-t[1]),e.length>this.range){let t=e[this.range][1],o=e.filter(m=>m[1]>t);if(o.length<this.range){let m=e.filter(f=>f[1]===t);t=this.range-o.length;for(let f=0;f<t;f++){let i=m.length;i=Math.floor(i*Math.random()),i=m.splice(i,1)[0],o.push(i)}}e=o}var R=0;e.forEach(t=>R+=t[1]),R===0?(R=e.length,e.forEach(t=>{t[1]=1/R,W.push([...t,0]),window.RushGo.DrawStrategy&&console.log("  --> ("+t[0]+") : "+t[1])})):e.forEach(t=>{t[1]/=R,W.push([...t,0]),window.RushGo.DrawStrategy&&console.log("  --> ("+t[0]+") : "+t[1])});var l=0,a=e[0][1];e.forEach(t=>{t[1]>l&&(l=t[1]),t[1]<a&&(a=t[1])}),l===a?(l=e.length,e.forEach((t,o)=>t[1]=(o+1)/l)):(a=l-(l-a)*.1,e=e.filter(t=>t[1]>=a),l=0,e.forEach(t=>{t[1]-=a,t[1]=t[1]**window.RushGo.ScorePower,l+=t[1]}),a=0,e.forEach(t=>{t[1]/=l,a+=t[1],t[1]=a})),a=Math.random();var G=null;return e.some((t,o)=>(G=t[0],a>=t[1])),[G,W]}goDeep(d,E,k,p=this.id,v=this.level){if(v<=0)return null;d=window.RushGo.copyRushGo(d),d[E][k]=p;var e=window.RushGo.checkFinish(d,p,E,k);if(e>0)return[[p,1,0,1,!0]];if(e<0)return[[p,0,1,1,!0]];var g=p+1;g===2&&(g=0);var n=window.RushGo.analyzeRush(d,g,!1,this.rangeMind),s=[];for(let i=0;i<2;i++)i!==g&&s.push(window.RushGo.analyzeRush(d,i,!0,this.rangeMind));s=window.RushGo.combineEnemy(s);var[W,r]=window.RushGo.valueStatus(n),[R,l]=window.RushGo.valueStatus(s),a=[];r.mustWins.length>0?a=r.mustWins.map(i=>[i,1]):l.mustWins.length>0?a=l.mustWins.map(i=>[i,1]):r.willWins.length>0?a=r.willWins.map(i=>[i,1]):l.willWins.length>0?a=l.willWins.map(i=>[i,1]):r.mayWins.length>0?a=r.mayWins.map(i=>[i,1]):l.mayWins.length>0&&(a=l.mayWins.map(i=>[i,1]));var G=!0,t=0;if(a.length===0){G=!1;let[i,A,c]=this.combineStrategy(n,s);if(i.length===0)return[-1,W+r.scoreW/N,R+l.scoreW/N];let u=Math.ceil(this.deepRange*(v/this.level)**this.decayPower);if(i.forEach(h=>t+=h[1]),i.length>u){let h=i[u-1][1];a=i.filter(S=>S[1]>h);let L=i.filter(S=>S[1]===h);h=u-a.length;for(let S=0;S<h;S++){let y=L.length;y=Math.floor(y*Math.random()),y=L.splice(y,1)[0],a.push(y)}}}else a.forEach(i=>t+=i[1]);var o={};G||v--;var m=!1;if(a.forEach(i=>{var[A,c]=i;c/=t;var u=this.goDeep(d,...A,g,v);!u||u[0]===-1||(m=!0,u.forEach(h=>{var[L,S,y,M,j]=h,D=o[L];D||(D=[0,0,0,!1],o[L]=D),j?(D[0]+=S*c,D[1]+=y*c):(D[0]+=S*c*this.decayRate,D[1]+=y*c*this.decayRate),M++,M>D[2]&&(D[2]=M),D[3]=D[3]||j&&G}))}),!m)return[-1,W+r.scoreW/N,R+l.scoreW/N];var f=[];for(let i in o)f.push([i*1,...o[i]]);return f}}window.RushGo=window.RushGo||{},window.RushGo.AIThree=C})();
