(()=>{const L=RushGo.Win,t=window.RushGo.State,P=window.RushGo.HalfLine,z=window.RushGo.SingleLine,O=window.RushGo.CrossPoint,k=window.RushGo.ValueField;class b{constructor(m,w,g,d,M,s,W){this.id=m,this.attacktive=w,g>=0?this.incress=1:this.incress=-1,this.attitude=g*this.incress,this.center=w,w>=.5?(this.up=.5-w/2,this.down=w-this.up):(this.down=w/2,this.up=1-this.down-w),this.level=d,this.range=M,this.useOracle=!!W,isNaN(s)?this.rangeMind=0:this.rangeMind=s}go(){if(!window.RushGo.finished){window.RushGo.pause=!0,window.RushGo.timeStart[this.id]=Date.now();var m=window.RushGo.copyRushGo(),w,g;if(window.RushGo.loopCount<window.RushGo.GameModeOption.startWithInits)w=this.placeInits(m),g=[];else{let[d,M,s]=this.valueMe(m),[W,a,u]=this.valueEnemy(m);if(this.attitude<=0)this.attacktive=this.center;else{let o=M-a+s.scoreW-u.scoreW,n=o*this.incress/(Math.abs(o)+this.attitude);n>=0?this.attacktive=this.center+this.up*n:this.attacktive=this.center+this.down*n}[w,g]=this.makeDecision(m,M,s,a,u,...this.combineStrategy(d,W))}if(window.RushGo.timeUsed[this.id]+=Date.now()-window.RushGo.timeStart[this.id],setTimeout(()=>{window.RushGo.pause=!1},0),!w){window.RushGo.finished=!0;for(let d=0;d<2;d++){let M=aiList[d];!!M&&!!M.clear&&M.clear()}ResultHint.innerHTML="\u5C45\u7136\u6253\u6210\u4E86\u5E73\u624B\uFF01<br>\u8981\u4E0D\u518D\u6765\u4E00\u5C40\uFF1F",ResultPad.classList.add("show");return}window.RushGo.posGo(...w,g)}}valueMe(m){var w=window.RushGo.analyzeRush(m,this.id,!1,this.rangeMind);return[w,...window.RushGo.valueStatus(w)]}valueEnemy(m){var w=[];for(let g=0;g<2;g++)g!==this.id&&w.push(window.RushGo.analyzeRush(m,g,!1,this.rangeMind));return w=window.RushGo.combineEnemy(w),[w,...window.RushGo.valueStatus(w)]}combineStrategy(m,w){var g=[],d=[],M=[],s=[],W=new k;for(let n=0;n<=window.RushGo.Grid;n++){let i=[];for(let h=0;h<=window.RushGo.Grid;h++){let e=m[n][h],r=w[n][h],l=new t,f=[n,h],c=n+"-"+h;!e||!r?l.state=t.Alone:e.state.state===t.Forbidden?W.state=t.Alone:e.state.state===t.MustWin?(W.mustWins.push(f),l.state=t.MustWin):r.state.state===t.MustWin?(W.mustLoses.push(f),l.state=t.MustLose):e.state.state===t.WillWin?(W.willWins.push(f),l.state=t.WillWin):r.state.state===t.WillWin?(W.willLoses.push(f),l.state=t.WillLose):e.state.state===t.MayWin?(W.mayWins.push(f),l.state=t.MayWin):r.state.state===t.MayWin?(W.mayLoses.push(f),l.state=t.MayLose):e.state.state<=t.Alone?r.state.state<=t.Alone?l.state=t.Alone:(W.normals.push(f),l.state=t.Normal,l.score=r.state.score*(1-this.attacktive),s.push([f,l.score])):(W.normals.push(f),l.state=t.Normal,r.state.state<=t.Alone?l.score=e.state.score*this.attacktive:l.score=e.state.score*this.attacktive+r.state.score*(1-this.attacktive),s.push([f,l.score])),l.update(),i[h]=l}g[n]=i}if(s.sort((n,i)=>i[1]-n[1]),s.length>this.range){let n=s[this.range-1];n=n[1];let i=s.filter(e=>e[1]>n),h=i.length;if(h<this.range){let e=s.filter(r=>r[1]===n);h=e.length+h-this.range;for(let r=0;r<h;r++){let l=Math.floor(e.length*Math.random());e.splice(l,1)}i.push(...e)}s=i}var a={};s.forEach(n=>{var[i,h]=n[0],e=g[i][h];a[i+"-"+h]=[n[0],e.score]});var u=0,o=[];for(let n in a)n=a[n],u+=n[1],o.push(n);return o.forEach(n=>n[1]/=u),[o,g,W]}makeDecision(m,w,g,d,M,s,W,a){var u=[],o=[];if(a.mustWins.length>0?u=a.mustWins:a.mustLoses.length>0?u=a.mustLoses:a.willWins.length>0?u=a.willWins:a.willLoses.length>0?u=a.willLoses:a.mayWins.length>0?u=a.mayWins:a.mayLoses.length>0&&(u=a.mayLoses),u.length===1)return[u[0],[]];if(u.length>0){let e=u.length;e=1/e,s=u.map(r=>[r,e])}else{let e;if([u,e]=this.thinkAsEnemy(m),u.length>0)s=u;else{let r={};s.forEach(f=>{let c="("+f[0]+")";r[c]=f});let l=0;e.forEach(f=>l+=f[1]),e.forEach(f=>{f[1]/=l,f[1]*=Math.sqrt(Math.max(0,1-this.attacktive));let c="("+f[0]+")";var v=r[c];v?v[1]<f[1]&&(v[1]=f[1]):r[c]=f}),s=Object.values(r).filter(f=>f[1]>0)}}if(s.length===0)return[null,[]];{let e=0;s.forEach(r=>e+=r[1]),s.forEach(r=>{o.push([r[0],r[1]/e,0])})}if(this.level>0){let e=!1,r=null,l=[],f=[],c=[];if(s.some(v=>{var[G,R]=v,[y,x]=this.oracle(m,w,g,d,M,G,this.level,this.id,e);if(y===t.MustWin)return r=G,!0;if(y===t.WillWin)return e=!0,l.push(G),!1;if(y===t.MayWin)return e=!0,f.push(G),!1;if(y<=t.Alone)return!1;R*=x**window.RushGo.ScorePower,v[1]=R,c.push(v)}),r)return[r,[]];if(r=!1,l.length>0){let v=1/l.length;c=l.map(G=>[G,v]),r=!0}else if(f.length>0){let v=1/f.length;c=f.map(G=>[G,v]),r=!0}r||([l,f]=this.thinkAsEnemy(m),l.length>0?c=l:c.length===0&&(c=f)),c.length>0&&(s=c)}s.sort((e,r)=>r[1]-e[1]);var n=0;s.forEach(e=>n+=e[1]),n===0?(n=s.length,s.forEach(e=>{e[1]=1/n,o.push([...e,1])})):s.forEach(e=>{e[1]/=n,o.push([...e,1])}),n=0;var i=s[0][1];s.forEach(e=>{e[1]>n&&(n=e[1]),e[1]<i&&(i=e[1])}),n===i?(n=s.length,s.forEach((e,r)=>e[1]=(r+1)/n)):(i=n-(n-i)*.1,s=s.filter(e=>e[1]>=i),n=0,s.forEach(e=>{e[1]-=i,e[1]=e[1]**window.RushGo.ScorePower,n+=e[1]}),i=0,s.forEach(e=>{e[1]/=n,i+=e[1],e[1]=i})),i=Math.random();var h=null;return s.some((e,r)=>(h=e[0],i>=e[1])),[h,o]}oracle(m,w,g,d,M,s,W,a,u=!1){if(W<=0)return[t.Normal,1];var o=Math.ceil(DistrCount/2);W>o&&(W=o),m=window.RushGo.copyRushGo(m),m[s[0]][s[1]]=a;var n=window.RushGo.checkFinish(m,a,...s);if(n>0)return[t.MustWin,1];if(n<0)return[t.MustLose,0];var i=window.RushGo.analyzeRush(m,a,!1,this.rangeMind),h=[];for(let R=0;R<2;R++)R!==a&&h.push(window.RushGo.analyzeRush(m,R,!1,this.rangeMind));h=window.RushGo.combineEnemy(h);var[e,r]=window.RushGo.valueStatus(i),[l,f]=window.RushGo.valueStatus(h);if(r.mustWins.length>0)return[t.MustWin,1];if(f.mustWins.length>0)return[t.MustLose,0];if(r.willWins.length>0)return[t.WillWin,1];if(f.willWins.length>0)return[t.WillLose,0];if(r.mayWins.length>0)return[t.MayWin,1];if(f.mayWins.length>0)return[t.MayLose,0];if(W===1){let R=e-w+r.scoreW-g.scoreW,y=d-l+M.scoreW-f.scoreW,x=R*this.attacktive+y*(1-this.attacktive);return[t.Normal,Math.max(0,x)]}else if(u)return[t.Normal,1];W--;var c=a+1;c===2&&(c=0);var[v,G]=this.forcast(c,m,W);return v===t.MustWin?[t.MustLose,0]:v===t.WillWin?[t.WillLose,0]:v===t.MayWin?[t.MayLose,0]:v===t.MayLose?[t.MayWin,1]:v===t.WillLose?[t.WillWin,1]:v===t.MustLose?[t.MustWin,1]:[t.Normal,G]}forcast(m,w,g){w=window.RushGo.copyRushGo(w);var d,M=[];for(let S=0;S<2;S++){let p=S!==m,A=window.RushGo.analyzeRush(w,S,!1,this.rangeMind);p?M.push(A):d=A}M=window.RushGo.combineEnemy(M);var[s,W]=window.RushGo.valueStatus(d),[a,u]=window.RushGo.valueStatus(M),[o,n,i]=this.combineStrategy(d,M);if(i.mustWins.length>0)return[t.MustWin,1];if(i.mustLoses.length>0)return[t.MustLose,0];if(i.willWins.length>0)return[t.WillWin,1];if(i.willLoses.length>0)return[t.WillLose,0];if(i.mayWins.length>0)return[t.MayWin,1];if(i.mayLoses.length>0)return[t.MayLose,0];var[h,e]=this.thinkAsEnemy(w,m);if(h.length>0?o=h:o.length===0&&(o=e),o.length===0)return[t.WillLose,0];var r=!1,l=null,f=null,c=null,v=null,G=null,R=null,y=0,x=0;if(o.some(S=>{var[p,A]=S,[E,N]=this.oracle(w,s,W,a,u,p,g,m,r);if(E===t.MustWin)return l=p,!0;if(E===t.WillWin)return c=p,!0;if(E===t.MayWin)return G=p,!0;if(E===t.MustLose)return r=!0,f=p,!1;if(E===t.WillLose)return r=!0,v=p,!1;if(E===t.MayLose)return r=!0,R=p,!1;if(E===t.Alone)return!1;y+=A,A*=N**window.RushGo.ScorePower,x+=A}),l)return[t.MustWin,1];if(c)return[t.WillWin,1];if(G)return[t.MayWin,1];if(y===0){if(f)return[t.MustLose,0];if(v)return[t.WillLose,0];if(R)return[t.MayLose,0]}return[t.Normal,x/y]}thinkAsEnemy(m,w=this.id){if(!this.useOracle)return[[],[]];var g=w+1;g===2&&(g=0),m=window.RushGo.copyRushGo(m);var d=window.RushGo.analyzeRush(m,g,!1,this.rangeMind),[M,s]=window.RushGo.valueStatus(d);if(s.mustWins.length>0)return[s.mustWins.map(i=>[i,1/s.mustWins.length]),[]];if(s.willWins.length>0)return[s.willWins.map(i=>[i,1/s.willWins.length]),[]];if(s.mayWins.length>0)return[s.mayWins.map(i=>[i,1/s.mayWins.length]),[]];if(s.normals.length===0)return[[],[]];M+=s.scoreW;var W=s.normals;W.sort((i,h)=>h[1]-i[1]);var a=W[Math.floor(W.length/2)][1];W=W.filter(i=>i[1]>=a);var u=[],o=[],n=L;return W.forEach(i=>{var h=i[0],e=window.RushGo.copyRushGo(m);e[h[0]][h[1]]=g;var r=window.RushGo.analyzeRush(e,g,!1,this.rangeMind),[l,f]=window.RushGo.valueStatus(r);l+=f.scoreW,l-=M,l<0&&(l=0),l*=i[1],f.mustWins.length>0?(l+=L*L,o.push([h,l])):u.push([h,l]),l>n&&(n=l)}),o.length>0&&o.forEach(i=>{i[1]=n,u.push(i)}),u.sort((i,h)=>h[1]-i[1]),u.length>this.range&&(u=u.splice(0,this.range)),[[],u]}placeInits(m){var w=[],g=[];for(let a=0;a<=window.RushGo.Grid;a++){let u=m[a];for(let o=0;o<=window.RushGo.Grid;o++){let n=u[o];n===this.id?w.push([a,o]):n>=0&&g.push([a,o])}}var d=L-1,M=[],s=Math.round(window.RushGo.Grid/2);if(w.length===0){if(g.length===0)return[s,s];for(let a=0;a<=window.RushGo.Grid;a++){let u=m[a];for(let o=0;o<=window.RushGo.Grid;o++){if(u[o]>=0)continue;let i=!1;g.some(h=>{var[e,r]=h,l=Math.max(Math.abs(a-e),Math.abs(o-r));if(l===d)return i=!0,!0}),!!i&&M.push([[a,o],Math.max(Math.abs(a-s),Math.abs(o-s))])}}}else for(let a=0;a<=window.RushGo.Grid;a++){let u=m[a];for(let o=0;o<=window.RushGo.Grid;o++){if(u[o]>=0)continue;let i=!1;i=!1,w.some(h=>{var[e,r]=h,l=Math.max(Math.abs(a-e),Math.abs(o-r));if(l<d)return i=!0,!0}),!i&&(g.some(h=>{var[e,r]=h,l=Math.max(Math.abs(a-e),Math.abs(o-r));if(l<d)return i=!0,!0}),!i&&M.push([[a,o],Math.max(Math.abs(a-s),Math.abs(o-s))]))}}if(M.length===0)return[s,s];if(M.length===1)return M[0][0];M.forEach(a=>{var u=a[0][0],o=a[0][1],n=Math.max(0,1-a[1]/L),i=0,h=0;w.forEach(e=>{var r=Math.max(Math.abs(e[0]-u),Math.abs(e[1]-o));i+=Math.max(0,1-r/L)}),g.forEach(e=>{var r=Math.max(Math.abs(e[0]-u),Math.abs(e[1]-o));h+=Math.max(0,1-r/L)}),a[1]=n/2+i*this.center+h*(1-this.center)}),M.sort((a,u)=>u[1]-a[1]);var W=M[0][1];return M=M.filter(a=>a[1]>=W),W=Math.floor(M.length*Math.random()),M[W][0]}}window.RushGo=window.RushGo||{},window.RushGo.AIOne=b})();
