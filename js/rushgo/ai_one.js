(()=>{const L=RushGo.Win,t=window.RushGo.State,O=window.RushGo.HalfLine,P=window.RushGo.SingleLine,z=window.RushGo.CrossPoint,A=window.RushGo.ValueField;class b{id=-1;attacktive=.5;attitude=0;incress=0;center=0;down=0;up=0;level=1;range=3;rangeMind=0;useOracle=!1;constructor(m,w,W,d,M,s,g){this.id=m,this.attacktive=w,W>=0?this.incress=1:this.incress=-1,this.attitude=W*this.incress,this.center=w,w>=.5?(this.up=.5-w/2,this.down=w-this.up):(this.down=w/2,this.up=1-this.down-w),this.level=d,this.range=M,this.useOracle=!!g,isNaN(s)||(this.rangeMind=s)}go(){if(!window.RushGo.finished){window.RushGo.pause=!0,window.RushGo.timeStart[this.id]=Date.now();var m=window.RushGo.copyRushGo(),w,W;if(window.RushGo.loopCount<window.RushGo.GameModeOption.startWithInits)w=this.placeInits(m),W=[];else{let[d,M,s]=this.valueMe(m),[g,r,h]=this.valueEnemy(m);if(this.attitude<=0)this.attacktive=this.center;else{let o=M-r+s.scoreW-h.scoreW,n=o*this.incress/(Math.abs(o)+this.attitude);n>=0?this.attacktive=this.center+this.up*n:this.attacktive=this.center+this.down*n}[w,W]=this.makeDecision(m,M,s,r,h,...this.combineStrategy(d,g))}if(window.RushGo.timeUsed[this.id]+=Date.now()-window.RushGo.timeStart[this.id],setTimeout(()=>{window.RushGo.pause=!1},0),!w){window.RushGo.finished=!0;for(let d=0;d<2;d++){let M=aiList[d];!!M&&!!M.clear&&M.clear()}ResultHint.innerHTML="\u5C45\u7136\u6253\u6210\u4E86\u5E73\u624B\uFF01<br>\u8981\u4E0D\u518D\u6765\u4E00\u5C40\uFF1F",ResultPad.classList.add("show");return}window.RushGo.posGo(...w,W)}}valueMe(m){var w=window.RushGo.analyzeRush(m,this.id,!1,this.rangeMind);return[w,...window.RushGo.valueStatus(w)]}valueEnemy(m){var w=[];for(let W=0;W<2;W++)W!==this.id&&w.push(window.RushGo.analyzeRush(m,W,!1,this.rangeMind));return w=window.RushGo.combineEnemy(w),[w,...window.RushGo.valueStatus(w)]}combineStrategy(m,w){var W=[],d=[],M=[],s=[],g=new A;for(let n=0;n<=window.RushGo.Grid;n++){let i=[];for(let u=0;u<=window.RushGo.Grid;u++){let e=m[n][u],a=w[n][u],l=new t,f=[n,u],c=n+"-"+u;!e||!a?l.state=t.Alone:e.state.state===t.Forbidden?g.state=t.Alone:e.state.state===t.MustWin?(g.mustWins.push(f),l.state=t.MustWin):a.state.state===t.MustWin?(g.mustLoses.push(f),l.state=t.MustLose):e.state.state===t.WillWin?(g.willWins.push(f),l.state=t.WillWin):a.state.state===t.WillWin?(g.willLoses.push(f),l.state=t.WillLose):e.state.state===t.MayWin?(g.mayWins.push(f),l.state=t.MayWin):a.state.state===t.MayWin?(g.mayLoses.push(f),l.state=t.MayLose):e.state.state<=t.Alone?a.state.state<=t.Alone?l.state=t.Alone:(g.normals.push(f),l.state=t.Normal,l.score=a.state.score*(1-this.attacktive),s.push([f,l.score])):(g.normals.push(f),l.state=t.Normal,a.state.state<=t.Alone?l.score=e.state.score*this.attacktive:l.score=e.state.score*this.attacktive+a.state.score*(1-this.attacktive),s.push([f,l.score])),l.update(),i[u]=l}W[n]=i}if(s.sort((n,i)=>i[1]-n[1]),s.length>this.range){let n=s[this.range-1];n=n[1];let i=s.filter(e=>e[1]>n),u=i.length;if(u<this.range){let e=s.filter(a=>a[1]===n);u=e.length+u-this.range;for(let a=0;a<u;a++){let l=Math.floor(e.length*Math.random());e.splice(l,1)}i.push(...e)}s=i}var r={};s.forEach(n=>{var[i,u]=n[0],e=W[i][u];r[i+"-"+u]=[n[0],e.score]});var h=0,o=[];for(let n in r)n=r[n],h+=n[1],o.push(n);return o.forEach(n=>n[1]/=h),[o,W,g]}makeDecision(m,w,W,d,M,s,g,r){var h=[],o=[];if(r.mustWins.length>0?h=r.mustWins:r.mustLoses.length>0?h=r.mustLoses:r.willWins.length>0?h=r.willWins:r.willLoses.length>0?h=r.willLoses:r.mayWins.length>0?h=r.mayWins:r.mayLoses.length>0&&(h=r.mayLoses),h.length===1)return[h[0],[]];if(h.length>0){let e=h.length;e=1/e,s=h.map(a=>[a,e])}else{let e;if([h,e]=this.thinkAsEnemy(m),h.length>0)s=h;else{let a={};s.forEach(f=>{let c="("+f[0]+")";a[c]=f});let l=0;e.forEach(f=>l+=f[1]),e.forEach(f=>{f[1]/=l,f[1]*=Math.sqrt(Math.max(0,1-this.attacktive));let c="("+f[0]+")";var v=a[c];v?v[1]<f[1]&&(v[1]=f[1]):a[c]=f}),s=Object.values(a).filter(f=>f[1]>0)}}if(s.length===0)return[null,[]];{let e=0;s.forEach(a=>e+=a[1]),s.forEach(a=>{o.push([a[0],a[1]/e,0])})}if(this.level>0){let e=!1,a=null,l=[],f=[],c=[];if(s.some(v=>{var[G,R]=v,[y,x]=this.oracle(m,w,W,d,M,G,this.level,this.id,e);if(y===t.MustWin)return a=G,!0;if(y===t.WillWin)return e=!0,l.push(G),!1;if(y===t.MayWin)return e=!0,f.push(G),!1;if(y<=t.Alone)return!1;R*=x**window.RushGo.ScorePower,v[1]=R,c.push(v)}),a)return[a,[]];if(a=!1,l.length>0){let v=1/l.length;c=l.map(G=>[G,v]),a=!0}else if(f.length>0){let v=1/f.length;c=f.map(G=>[G,v]),a=!0}a||([l,f]=this.thinkAsEnemy(m),l.length>0?c=l:c.length===0&&(c=f)),c.length>0&&(s=c)}s.sort((e,a)=>a[1]-e[1]);var n=0;s.forEach(e=>n+=e[1]),n===0?(n=s.length,s.forEach(e=>{e[1]=1/n,o.push([...e,1])})):s.forEach(e=>{e[1]/=n,o.push([...e,1])}),n=0;var i=s[0][1];s.forEach(e=>{e[1]>n&&(n=e[1]),e[1]<i&&(i=e[1])}),n===i?(n=s.length,s.forEach((e,a)=>e[1]=(a+1)/n)):(i=n-(n-i)*.1,s=s.filter(e=>e[1]>=i),n=0,s.forEach(e=>{e[1]-=i,e[1]=e[1]**window.RushGo.ScorePower,n+=e[1]}),i=0,s.forEach(e=>{e[1]/=n,i+=e[1],e[1]=i})),i=Math.random();var u=null;return s.some((e,a)=>(u=e[0],i>=e[1])),[u,o]}oracle(m,w,W,d,M,s,g,r,h=!1){if(g<=0)return[t.Normal,1];var o=Math.ceil(DistrCount/2);g>o&&(g=o),m=window.RushGo.copyRushGo(m),m[s[0]][s[1]]=r;var n=window.RushGo.checkFinish(m,r,...s);if(n>0)return[t.MustWin,1];if(n<0)return[t.MustLose,0];var i=window.RushGo.analyzeRush(m,r,!1,this.rangeMind),u=[];for(let R=0;R<2;R++)R!==r&&u.push(window.RushGo.analyzeRush(m,R,!1,this.rangeMind));u=window.RushGo.combineEnemy(u);var[e,a]=window.RushGo.valueStatus(i),[l,f]=window.RushGo.valueStatus(u);if(a.mustWins.length>0)return[t.MustWin,1];if(f.mustWins.length>0)return[t.MustLose,0];if(a.willWins.length>0)return[t.WillWin,1];if(f.willWins.length>0)return[t.WillLose,0];if(a.mayWins.length>0)return[t.MayWin,1];if(f.mayWins.length>0)return[t.MayLose,0];if(g===1){let R=e-w+a.scoreW-W.scoreW,y=d-l+M.scoreW-f.scoreW,x=R*this.attacktive+y*(1-this.attacktive);return[t.Normal,Math.max(0,x)]}else if(h)return[t.Normal,1];g--;var c=r+1;c===2&&(c=0);var[v,G]=this.forcast(c,m,g);return v===t.MustWin?[t.MustLose,0]:v===t.WillWin?[t.WillLose,0]:v===t.MayWin?[t.MayLose,0]:v===t.MayLose?[t.MayWin,1]:v===t.WillLose?[t.WillWin,1]:v===t.MustLose?[t.MustWin,1]:[t.Normal,G]}forcast(m,w,W){w=window.RushGo.copyRushGo(w);var d,M=[];for(let S=0;S<2;S++){let p=S!==m,k=window.RushGo.analyzeRush(w,S,!1,this.rangeMind);p?M.push(k):d=k}M=window.RushGo.combineEnemy(M);var[s,g]=window.RushGo.valueStatus(d),[r,h]=window.RushGo.valueStatus(M),[o,n,i]=this.combineStrategy(d,M);if(i.mustWins.length>0)return[t.MustWin,1];if(i.mustLoses.length>0)return[t.MustLose,0];if(i.willWins.length>0)return[t.WillWin,1];if(i.willLoses.length>0)return[t.WillLose,0];if(i.mayWins.length>0)return[t.MayWin,1];if(i.mayLoses.length>0)return[t.MayLose,0];var[u,e]=this.thinkAsEnemy(w,m);if(u.length>0?o=u:o.length===0&&(o=e),o.length===0)return[t.WillLose,0];var a=!1,l=null,f=null,c=null,v=null,G=null,R=null,y=0,x=0;if(o.some(S=>{var[p,k]=S,[E,N]=this.oracle(w,s,g,r,h,p,W,m,a);if(E===t.MustWin)return l=p,!0;if(E===t.WillWin)return c=p,!0;if(E===t.MayWin)return G=p,!0;if(E===t.MustLose)return a=!0,f=p,!1;if(E===t.WillLose)return a=!0,v=p,!1;if(E===t.MayLose)return a=!0,R=p,!1;if(E===t.Alone)return!1;y+=k,k*=N**window.RushGo.ScorePower,x+=k}),l)return[t.MustWin,1];if(c)return[t.WillWin,1];if(G)return[t.MayWin,1];if(y===0){if(f)return[t.MustLose,0];if(v)return[t.WillLose,0];if(R)return[t.MayLose,0]}return[t.Normal,x/y]}thinkAsEnemy(m,w=this.id){if(!this.useOracle)return[[],[]];var W=w+1;W===2&&(W=0),m=window.RushGo.copyRushGo(m);var d=window.RushGo.analyzeRush(m,W,!1,this.rangeMind),[M,s]=window.RushGo.valueStatus(d);if(s.mustWins.length>0)return[s.mustWins.map(i=>[i,1/s.mustWins.length]),[]];if(s.willWins.length>0)return[s.willWins.map(i=>[i,1/s.willWins.length]),[]];if(s.mayWins.length>0)return[s.mayWins.map(i=>[i,1/s.mayWins.length]),[]];if(s.normals.length===0)return[[],[]];M+=s.scoreW;var g=s.normals;g.sort((i,u)=>u[1]-i[1]);var r=g[Math.floor(g.length/2)][1];g=g.filter(i=>i[1]>=r);var h=[],o=[],n=L;return g.forEach(i=>{var u=i[0],e=window.RushGo.copyRushGo(m);e[u[0]][u[1]]=W;var a=window.RushGo.analyzeRush(e,W,!1,this.rangeMind),[l,f]=window.RushGo.valueStatus(a);l+=f.scoreW,l-=M,l<0&&(l=0),l*=i[1],f.mustWins.length>0?(l+=L*L,o.push([u,l])):h.push([u,l]),l>n&&(n=l)}),o.length>0&&o.forEach(i=>{i[1]=n,h.push(i)}),h.sort((i,u)=>u[1]-i[1]),h.length>this.range&&(h=h.splice(0,this.range)),[[],h]}placeInits(m){var w=[],W=[];for(let r=0;r<=window.RushGo.Grid;r++){let h=m[r];for(let o=0;o<=window.RushGo.Grid;o++){let n=h[o];n===this.id?w.push([r,o]):n>=0&&W.push([r,o])}}var d=L-1,M=[],s=Math.round(window.RushGo.Grid/2);if(w.length===0){if(W.length===0)return[s,s];for(let r=0;r<=window.RushGo.Grid;r++){let h=m[r];for(let o=0;o<=window.RushGo.Grid;o++){if(h[o]>=0)continue;let i=!1;W.some(u=>{var[e,a]=u,l=Math.max(Math.abs(r-e),Math.abs(o-a));if(l===d)return i=!0,!0}),!!i&&M.push([[r,o],Math.max(Math.abs(r-s),Math.abs(o-s))])}}}else for(let r=0;r<=window.RushGo.Grid;r++){let h=m[r];for(let o=0;o<=window.RushGo.Grid;o++){if(h[o]>=0)continue;let i=!1;i=!1,w.some(u=>{var[e,a]=u,l=Math.max(Math.abs(r-e),Math.abs(o-a));if(l<d)return i=!0,!0}),!i&&(W.some(u=>{var[e,a]=u,l=Math.max(Math.abs(r-e),Math.abs(o-a));if(l<d)return i=!0,!0}),!i&&M.push([[r,o],Math.max(Math.abs(r-s),Math.abs(o-s))]))}}if(M.length===0)return[s,s];if(M.length===1)return M[0][0];M.forEach(r=>{var h=r[0][0],o=r[0][1],n=Math.max(0,1-r[1]/L),i=0,u=0;w.forEach(e=>{var a=Math.max(Math.abs(e[0]-h),Math.abs(e[1]-o));i+=Math.max(0,1-a/L)}),W.forEach(e=>{var a=Math.max(Math.abs(e[0]-h),Math.abs(e[1]-o));u+=Math.max(0,1-a/L)}),r[1]=n/2+i*this.center+u*(1-this.center)}),M.sort((r,h)=>h[1]-r[1]);var g=M[0][1];return M=M.filter(r=>r[1]>=g),g=Math.floor(M.length*Math.random()),M[g][0]}}window.RushGo=window.RushGo||{},window.RushGo.AIOne=b})();
