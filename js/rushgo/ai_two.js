(()=>{const p=RushGo.Win,s=window.RushGo.State,D=window.RushGo.HalfLine,x=window.RushGo.SingleLine,A=window.RushGo.CrossPoint,j=window.RushGo.ValueField;class k extends RushGo.AIOne{go(){if(!window.RushGo.finished){window.RushGo.pause=!0,window.RushGo.timeStart[this.id]=Date.now();var m=window.RushGo.copyRushGo(),R,v;if(window.RushGo.loopCount<window.RushGo.GameModeOption.startWithInits)R=this.placeInits(m),v=[];else{let[L,M,e]=this.valueMe(m),[E,i,c]=this.valueEnemy(m);if(this.attitude<=0)this.attacktive=this.center;else{let W=M-i+e.scoreW-c.scoreW,w=W*this.incress/(Math.abs(W)+this.attitude);w>=0?this.attacktive=this.center+this.up*w:this.attacktive=this.center+this.down*w}[R,v]=this.makeDecision(m,M,e,i,c,...this.combineStrategy(L,E))}if(window.RushGo.timeUsed[this.id]+=Date.now()-window.RushGo.timeStart[this.id],setTimeout(()=>{window.RushGo.pause=!1},0),!R){window.RushGo.finished=!0;for(let L=0;L<2;L++){let M=aiList[L];!!M&&!!M.clear&&M.clear()}ResultHint.innerHTML="\u5C45\u7136\u6253\u6210\u4E86\u5E73\u624B\uFF01<br>\u8981\u4E0D\u518D\u6765\u4E00\u5C40\uFF1F",ResultPad.classList.add("show");return}window.RushGo.posGo(...R,v)}}makeDecision(m,R,v,L,M,e,E,i){var c=window.RushGo.loopCount/Math.max(window.RushGo.loopCount,DistrCount);c=Math.ceil(c*c*this.level);var W=this.level;W>c&&(W=c),window.RushGo.DrawStrategy&&(console.log("====> Make Decision <==== ["+(window.RushGo.loopCount+1)+"]    "+this.id+"("+W+"|"+this.level+")"),i.mustWins.length>0&&console.log("    MustWins : ("+i.mustWins.join("), (")+")"),i.mustLoses.length>0&&console.log("    MustLoses: ("+i.mustLoses.join("), (")+")"),i.willWins.length>0&&console.log("    WillWins : ("+i.willWins.join("), (")+")"),i.willLoses.length>0&&console.log("    WillLoses: ("+i.willLoses.join("), (")+")"),i.mayWins.length>0&&console.log("    MayWins  : ("+i.mayWins.join("), (")+")"),i.mayLoses.length>0&&console.log("    MayLoses : ("+i.mayLoses.join("), (")+")"));var w=[],f=[];if(i.mustWins.length>0?w=i.mustWins:i.mustLoses.length>0?w=i.mustLoses:i.willWins.length>0?w=i.willWins:i.willLoses.length>0?w=i.willLoses:i.mayWins.length>0?w=i.mayWins:i.mayLoses.length>0&&(w=i.mayLoses),w.length===1)return[w[0],[]];if(w.length>0){let t=w.length;t=1/t,e=w.map(a=>[a,t])}else{let t;if([w,t]=this.thinkAsEnemy(m),w.length>0)e=w;else{let a={};e.forEach(o=>{let l="("+o[0]+")";a[l]=o});let G=0;t.forEach(o=>G+=o[1]),t.forEach(o=>{o[1]/=G,o[1]*=Math.sqrt(Math.max(0,1-this.attacktive));let l="("+o[0]+")";var u=a[l];u?u[1]<o[1]&&(u[1]=o[1]):a[l]=o}),e=Object.values(a).filter(o=>o[1]>0)}}if(e.length===0)return[null,[]];{let t=0;e.forEach(a=>t+=a[1]),e.forEach(a=>{f.push([a[0],a[1]/t,0]),window.RushGo.DrawStrategy&&console.log("  --> ("+a[0]+") : "+a[1])})}if(this.level>0){let t=!1,a=0;e.forEach(l=>{var[u,h]=l,[g,y,S]=this.oracle(m,R,v,L,M,u,W,this.id,t);console.log("      ::> ("+u+") : "+h+" / "+y+" ["+g+"] "+S),g>s.Normal?(t=!0,y=1):g<s.Alone?(t=!0,y=0):g===s.Alone?(y=0,h=0):y=S,l[1]=h,l[2]=y,y<.5&&a++});let G=a===e.length,o=e;e=e.filter(l=>l[2]>0&&l[1]>0),e.length===0&&(e=o),G?e.forEach(l=>l[1]*=1-l[2]):e.forEach(l=>l[1]*=l[2])}e.sort((t,a)=>a[1]-t[1]);var n=0;e.forEach(t=>n+=t[1]),n===0?(n=e.length,e.forEach(t=>{t[1]=1/n,f.push([...t,1]),window.RushGo.DrawStrategy&&console.log("    ~~> ("+t[0]+") : "+t[1])})):e.forEach(t=>{t[1]/=n,f.push([...t,1]),window.RushGo.DrawStrategy&&console.log("    ~~> ("+t[0]+") : "+t[1])}),n=0;var r=e[0][1];e.forEach(t=>{t[1]>n&&(n=t[1]),t[1]<r&&(r=t[1])}),n===r?(n=e.length,e.forEach((t,a)=>t[1]=(a+1)/n)):(r=n-(n-r)*.1,e=e.filter(t=>t[1]>=r),n=0,e.forEach(t=>{t[1]-=r,t[1]=t[1]**window.RushGo.ScorePower,n+=t[1]}),r=0,e.forEach(t=>{t[1]/=n,r+=t[1],t[1]=r})),r=Math.random();var d=null;return e.some((t,a)=>(d=t[0],r>=t[1])),[d,f]}oracle(m,R,v,L,M,e,E,i,c=!1){if(E<=0)return[s.Normal,1,.5];m=window.RushGo.copyRushGo(m),m[e[0]][e[1]]=i;var W=window.RushGo.checkFinish(m,i,...e);if(W>0)return[s.MustWin,1,1];if(W<0)return[s.MustLose,0,0];var w=window.RushGo.analyzeRush(m,i,!1,this.rangeMind),f=[];for(let u=0;u<2;u++)u!==i&&f.push(window.RushGo.analyzeRush(m,u,!1,this.rangeMind));f=window.RushGo.combineEnemy(f);var[n,r]=window.RushGo.valueStatus(w),[d,t]=window.RushGo.valueStatus(f);if(r.mustWins.length>0)return[s.MustWin,1,1];if(t.mustWins.length>0)return[s.MustLose,0,0];if(r.willWins.length>0)return[s.WillWin,1,1];if(t.willWins.length>0)return[s.WillLose,0,0];if(E===1||c){if(r.mayWins.length>0)return[s.MayWin,1,1];if(t.mayWins.length>0)return[s.MayLose,0,0];{let u=(R+v.scoreW)*this.attacktive+(L+M.scoreW)*(1-this.attacktive),h=(n+r.scoreW)*this.attacktive+(d+t.scoreW)*(1-this.attacktive),g=h-u;return g=Math.exp(g/p/p),[s.Normal,h,g/(1+g)]}}E--;var a=i+1;a===2&&(a=0);var[G,o,l]=this.forcast(a,m,E);return G===s.MustWin?[s.MustLose,0,0]:G===s.WillWin?[s.WillLose,0,0]:G===s.MayWin?[s.MayLose,0,0]:G===s.MayLose?[s.MayWin,1,1]:G===s.WillLose?[s.WillWin,1,1]:G===s.MustLose?[s.MustWin,1,1]:[s.Normal,o,1-l]}forcast(m,R,v){R=window.RushGo.copyRushGo(R);var L,M=[];for(let o=0;o<2;o++){let l=o!==m,u=window.RushGo.analyzeRush(R,o,!1,this.rangeMind);l?M.push(u):L=u}M=window.RushGo.combineEnemy(M);var[e,E]=window.RushGo.valueStatus(L),[i,c]=window.RushGo.valueStatus(M),[W,w,f]=this.combineStrategy(L,M),n=[],r=s.Normal;if(f.mustWins.length>0?(n=f.mustWins,r=s.MustWin):f.mustLoses.length>0?(n=f.mustLoses,r=s.MustLose):f.willWins.length>0?(n=f.willWins,r=s.WillWin):f.willLoses.length>0?(n=f.willLoses,r=s.WillLose):f.mayWins.length>0?(n=f.mayWins,r=s.MayWin):f.mayLoses.length>0&&(n=f.mayLoses,r=s.MayLose),n.length===1)return r>s.Normal?[r,1,1]:[r,0,0];if(n.length>0){let o=1/n.length;W=n.map(l=>[l,o])}else{let o;if([n,o]=this.thinkAsEnemy(R,m),n.length>0)W=n;else if(o.length>0)if(W.length===0)W=o;else{let l={};W.forEach(h=>{let g="("+h[0]+")";l[g]=h});let u=0;o.forEach(h=>u+=h[1]),o.forEach(h=>{h[1]/=u,h[1]*=Math.sqrt(Math.max(0,1-this.attacktive));let g="("+h[0]+")";var y=l[g];y?y[1]<h[1]&&(y[1]=h[1]):l[g]=h}),W=Object.values(l).filter(h=>h[1]>0)}}if(W.length===0)return[s.WillLose,0,0];var d=!1,t=0,a=0,G=0;return W.forEach(o=>{var[l,u]=o,[h,g,y]=this.oracle(R,e,E,i,c,l,v,m,d);h>s.Normal?(d=!0,g=1):h<s.Alone?(d=!0,g=0):h===s.Alone?(g=0,u=0):g=y,t+=u,G+=g,a+=g*u}),[s.Normal,a/G,a/t]}}window.RushGo=window.RushGo||{},window.RushGo.AITwo=k})();
