(()=>{const Operators=["+","-","+","-","\xD7","/"];var ModuleActived=!1,Container,Pages=[],ScorePad,scoreList=[],pageIndex=0,level=0,timer,countdown=0,next=0,mode=0,answerList=[];const getTypedScore=e=>{if(!scoreList[e]||scoreList[e].length===0)return-1;var t=0,n=0;return scoreList[e].forEach((r,s)=>{var i=1-(s/scoreList[e].length)**2;t+=r*i,n+=i}),t/=n,t},getTotalScore=()=>{var e=[];for(let r=0;r<scoreList.length;r++){let s=getTypedScore(r);s>0&&e.push(s)}if(e.length===0)return 0;e.sort((r,s)=>r-s);var t=0,n=0;return e.forEach((r,s)=>{var i=s+e.length;n+=i,t+=r*i}),Math.round(t/n)},newCalQuest=(index,len)=>{var ele=newEle("div","questItem calculate"),items=[];for(let e=0;e<len;e++)items[e*2]=Math.ceil(Math.range(100));for(let e=1;e<len;e++){let t=Math.floor(Math.range(6));items[e*2-1]=Operators[t],t>=4&&(items[e*2]=Math.ceil(Math.range(10)))}items=items.join(" ");var answer=Math.round(eval(items.replace(/×/g,"*")));return items='<span class="question">'+items+" = </span>",ele.innerHTML=items+'<input index="'+index+'">',[ele,answer]},submitCalQuest=()=>{timer&&(clearTimeout(timer),timer=null);var e=[],t=0,n=0;if([].forEach.call(Pages[1-pageIndex].querySelectorAll("input[index]"),r=>{var s=r.getAttribute("index")*1;if(!isNaN(s)){var i=r.value?r.value*1:void 0;isNaN(i)||(e[s]=i,n++)}}),n===0){NewQuest();return}answerList.forEach((r,s)=>{r===e[s]&&(t+=1)}),t=Math.ceil(t/answerList.length*100+countdown*(n/answerList.length)**2),scoreList[0]=scoreList[0]||[],scoreList[0].unshift(t),ScorePad._score.innerText=getTotalScore()+" / "+t+" ["+level+"]",t>60&&level++,NewQuest()},timerCalQuest=()=>{!ModuleActived||(countdown--,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+countdown,timer=null,countdown>0?timer=setTimeout(timerCalQuest,1e3):submitCalQuest())},newMemQuest=e=>{var t=newEle("div","questItem memory");t.setAttribute("index",e);var n=Math.ceil(Math.range(100));return t.innerText=n,[t,n]},refreshMemQuest=()=>{[].forEach.call(Pages[1-pageIndex].querySelectorAll("div.questItem.memory[index]"),e=>{var t=e.getAttribute("index")*1;isNaN(t)||(e.innerHTML="<input>")}),countdown=next,next=-1,timer=setTimeout(timerMemQuest,1e3)},submitMemQuest=()=>{timer&&(clearTimeout(timer),timer=null);var e=[],t=0,n=0;if([].forEach.call(Pages[1-pageIndex].querySelectorAll("div.questItem.memory[index]"),r=>{var s=r.getAttribute("index")*1;if(!isNaN(s)){var i=r.querySelector("input");!i||(i=i.value?i.value*1:void 0,!isNaN(i)&&(e[s]=i,n++))}}),n===0){NewQuest();return}answerList.forEach((r,s)=>{r===e[s]&&(t+=1)}),t=Math.ceil(t/answerList.length*100+countdown*(n/answerList.length)**2),scoreList[1]=scoreList[1]||[],scoreList[1].unshift(t),ScorePad._score.innerText=getTotalScore()+" / "+t+" ["+level+"]",t>60&&level++,NewQuest()},timerMemQuest=()=>{!ModuleActived||(countdown--,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+countdown,timer=null,countdown>0?timer=setTimeout(timerMemQuest,1e3):next>0?refreshMemQuest():submitMemQuest())},newCAMQuest=(index,len)=>{var ele=newEle("div","questItem calandmem");ele.setAttribute("index",index);var items=[];for(let e=0;e<len;e++)items[e*2]=Math.ceil(Math.range(100));for(let e=1;e<len;e++){let t=Math.floor(Math.range(6));items[e*2-1]=Operators[t],t>=4&&(items[e*2]=Math.ceil(Math.range(10)))}items=items.join(" ");var answer=Math.round(eval(items.replace(/×/g,"*")));return items+=" =",ele.innerHTML=items,[ele,answer]},refreshCAMQuest=()=>{[].forEach.call(Pages[1-pageIndex].querySelectorAll("div.questItem.calandmem[index]"),e=>{var t=e.getAttribute("index")*1;isNaN(t)||(e.innerHTML="<input>")}),countdown=next,next=-1,timer=setTimeout(timerCAMQuest,1e3)},submitCAMQuest=()=>{timer&&(clearTimeout(timer),timer=null);var e=[],t=0,n=0;if([].forEach.call(Pages[1-pageIndex].querySelectorAll("div.questItem.calandmem[index]"),r=>{var s=r.getAttribute("index")*1;if(!isNaN(s)){var i=r.querySelector("input");!i||(i=i.value?i.value*1:void 0,!isNaN(i)&&(e[s]=i,n++))}}),n===0){NewQuest();return}answerList.forEach((r,s)=>{r===e[s]&&(t+=1)}),t=Math.ceil(t/answerList.length*100+countdown*(n/answerList.length)**2),scoreList[1]=scoreList[1]||[],scoreList[1].unshift(t),ScorePad._score.innerText=getTotalScore()+" / "+t+" ["+level+"]",t>60&&level++,NewQuest()},timerCAMQuest=()=>{!ModuleActived||(countdown--,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+countdown,timer=null,countdown>0?timer=setTimeout(timerCAMQuest,1e3):next>0?refreshCAMQuest():submitCAMQuest())},NewCalculateQuest=(e,t,n)=>{var r=Pages[pageIndex],s=Array.generate(e,i=>newCalQuest(i,t));answerList.clear(),s.forEach(([i,a],o)=>{r.appendChild(i),answerList[o]=a}),countdown=n,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+n,timer=setTimeout(timerCalQuest,1e3)},NewMemoryQuest=(e,t,n)=>{var r=Pages[pageIndex],s=Array.generate(e,i=>newMemQuest(i));answerList.clear(),s.forEach(([i,a],o)=>{r.appendChild(i),answerList[o]=a}),countdown=t,next=n,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+t,timer=setTimeout(timerMemQuest,1e3)},NewCalMemQuest=(e,t,n,r)=>{var s=Pages[pageIndex],i=Array.generate(e,a=>newCAMQuest(a,t));answerList.clear(),i.forEach(([a,o],l)=>{s.appendChild(a),answerList[l]=o}),countdown=n,next=r,ScorePad._countdown.innerText="\u5012\u8BA1\u65F6\uFF1A"+n,timer=setTimeout(timerCAMQuest,1e3)},NewQuest=()=>{if(!!ModuleActived){Pages[pageIndex].innerHTML="";var e=Math.floor(Math.range(3));if(e===0){let t=10+Math.floor(level**.9/1.9),n=3+Math.floor(level**.6/1.8),r=Math.floor((t/10)**.95*50);NewCalculateQuest(t,n,r)}else if(e===1){let t=10+Math.floor(level**.9/1.9),n=Math.floor((t/10)**.95*30),r=Math.ceil(n**1.05/1.5);NewMemoryQuest(t,n,r)}else if(e===2){let t=5+Math.floor(level**.9/2.9),n=2+Math.floor(level**.5/2),r=Math.floor((t/5)**.95*50),s=Math.ceil(r**1.05/1.5);NewCalMemQuest(t,n,r,s)}else return;mode=e,Pages[pageIndex].setAttribute("show","true"),Pages[1-pageIndex].setAttribute("show","false"),pageIndex=1-pageIndex}},onClick=({target:e})=>{!e.classList.contains("submitter")||(mode===0?submitCalQuest():mode===1?next>0?countdown=0:submitMemQuest():mode===2&&(next>0?countdown=0:submitCAMQuest()))};window.TrainingQuest={onLoad(e,t,n,r){ModuleActived||(timer&&clearTimeout(timer),Container=e,Container.addEventListener("click",onClick),Pages[0]=n,Pages[1]=r,ScorePad=t,pageIndex=0,level=0,ScorePad.innerHTML='<span class="hint">\u5F53\u524D\u8111\u529B\u503C\uFF1A</span><span class="score">0 / 0 [0]</span><span class="countdown">0</span>',ScorePad._score=ScorePad.querySelector("span.score"),ScorePad._countdown=ScorePad.querySelector("span.countdown"),ModuleActived=!0,NewQuest())},onLeave(){!ModuleActived||location.hash!=="#/entertain/training"&&(Container.removeEventListener("click",onClick),Container=null,Pages[0].innerHTML="",Pages[1].innerHTML="",ScorePad.innerHTML="",Pages.clear(),ScorePad=null,delete ScorePad._hint,delete ScorePad._countdown,ModuleActived=!1)}}})();
