(()=>{class j{name="";icon="";key="";shortcut="";ui;container;constructor(v,s,b,C){C=C?C.trim():"",C&&(v=v+"\uFF08"+C+"\uFF09"),this.key=b||s,this.name=v,this.icon=s,this.shortcut=C,this.ui=newEle("div","menu-item"),this.ui.innerHTML='<i class="fa fas far fab fa-'+s+'"></i><span class="menu-item-hint">'+v+"</span>",this.ui.addEventListener("click",()=>{!this.container||this.container.onClick(this.key,this)})}update(v,s,b){var C=this.ui.querySelector("i.fa");C.className="fa fas far fab fa-"+s,this.ui.querySelector("span.menu-item-hint").innerHTML=v,this.key=b,this.name=v,this.icon=s}getShortcuts(){var v={};return this.shortcut&&(v[this.shortcut]=this.key),v}}class T extends j{constructor(){super();this.ui=newEle("div","menu-break-line")}}class L{items=[];name="";icon="";key="";btn;group;ui;container;constructor(){this.btn=new j("","",""),this.btn.container=this,this.group=newEle("div","menu-group-area"),this.ui=newEle("div","menu-group"),this.ui.appendChild(this.btn.ui),this.ui.appendChild(this.group)}add(v,s,b,C){if(v instanceof j)v.container=this,this.items.push(v),this.group.appendChild(v.ui);else if(v instanceof L)v.ui.classList.add("menu-subgroup"),v.container=this,this.items.push(v),this.group.appendChild(v.ui);else{let p=new j(v,s,b,C);p.container=this,this.items.push(p),this.group.appendChild(p.ui)}if(this.items.length===1){let p=this.items[0];this.btn.update(p.name,p.icon,p.key),this.name=p.name,this.icon=p.icon,this.key=p.key}}onClick(v,s){this.btn.update(s.name,s.icon,s.key),this.name=s.name,this.icon=s.icon,this.key=s.key,!!this.container&&this.container.onClick(v,s)}getShortcuts(){var v={};return this.items.forEach(s=>{s=s.getShortcuts(),Object.keys(s).forEach(b=>{b&&(v[b]=s[b])})}),v}}class le{items=[];ui;hooker;constructor(v){this.ui=newEle("div","menu-bar"),this.hooker=v}add(v,s,b,C){if(v instanceof j)v.ui.classList.add("top-level"),this.items.push(v),this.ui.appendChild(v.ui),v.container=this;else if(v instanceof L)this.items.push(v),this.ui.appendChild(v.ui),v.container=this;else{let p=new j(v,s,b,C);p.ui.classList.add("top-level"),this.items.push(p),this.ui.appendChild(p.ui),p.container=this}}onClick(v,s){!this.hooker||this.hooker(v)}getShortcuts(){var v={};return this.items.forEach(s=>{s=s.getShortcuts(),Object.keys(s).forEach(b=>{b&&(v[b]=s[b])})}),v}}class se{content="";startNode=0;startOffset=0;endNode=0;endOffset=0}const w={history:[],index:-1,editor:null,append(O,v,s,b,C){var p=new se;p.content=O,p.startNode=v,p.startOffset=s,p.endNode=b,p.endOffset=C,w.index++,w.history.splice(w.index,w.history.length),w.history.push(p)},restore(){w.index<=0||(w.index--,w.recall())},redo(){w.index!==w.history.length-1&&(w.index++,w.recall())},recall(O){var O=w.history[w.index];if(!!O){w.editor.innerText=O.content;var v=[].map.call(w.editor.childNodes,E=>E),s=v[O.startNode<0?0:O.startNode],b=v[O.endNode>=v.length?v.length-1:O.endNode],C=document.getSelection(),p=C.getRangeAt(0);p.setStart(s,O.startOffset),p.setEnd(b,O.endOffset),C.removeAllRanges(),C.addRange(p),s.tagName==="BR"?s.scrollIntoViewIfNeeded():s.nextElementSibling?s.nextElementSibling.scrollIntoViewIfNeeded():s.previousElementSibling&&s.previousElementSibling.scrollIntoViewIfNeeded()}},clear(){w.index=-1,w.history.splice(0,w.history.length)}},Te=50,Ae=.15,Le=["glass","music","search","envelope","heart","star","star-empty","user","film","th-large","th","th-list","ok","remove","zoom-in","zoom-out","off","signal","cog","trash","home","file","time","road","download-alt","download","upload","inbox","play-circle","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","indent-left","indent-right","facetime-video","picture","pencil","map-marker","adjust","tint","edit","share","check","move","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-sign","minus-sign","remove-sign","ok-sign","question-sign","info-sign","screenshot","remove-circle","ok-circle","ban-circle","arrow-left","arrow-right","arrow-up","arrow-down","share-alt","resize-full","resize-small","plus","minus","asterisk","exclamation-sign","gift","leaf","fire","eye-open","eye-close","warning-sign","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder-close","folder-open","resize-vertical","resize-horizontal","bar-chart","twitter-sign","facebook-sign","camera-retro","key","cogs","comments","thumbs-up","thumbs-down","star-half","heart-empty","signout","linkedin-sign","pushpin","external-link","signin","trophy","github-sign","upload-alt","lemon","phone","check-empty","bookmark-empty","phone-sign","twitter","facebook","github","unlock","credit-card","rss","hdd","bullhorn","bell","certificate","hand-right","hand-left","hand-up","hand-down","circle-arrow-left","circle-arrow-right","circle-arrow-up","circle-arrow-down","globe","wrench","tasks","filter","briefcase","fullscreen","group","link","cloud","beaker","cut","copy","paper-clip","save","sign-blank","reorder","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-sign","google-plus-sign","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-down","sort-up","envelope-alt","linkedin","undo","legal","dashboard","comment-alt","comments-alt","bolt","sitemap","umbrella","paste","lightbulb","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-alt","coffee","food","file-alt","building","hospital","ambulance","medkit","fighter-jet","beer","h-sign","plus-sign-alt","double-angle-left","double-angle-right","double-angle-up","double-angle-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile-phone","circle-blank","quote-left","quote-right","spinner","circle","reply"],I={};I.Tab="TabIndent",I["shift+Tab"]="TabOutdent",I["ctrl+Tab"]="TabOutdent",I["ctrl+alt+Up"]="blockUp",I["ctrl+alt+Down"]="blockDown",I["ctrl+shift+Up"]="blockUp",I["ctrl+shift+Down"]="blockDown",I["ctrl+D"]="deleteLine",I["ctrl+Z"]="restoreManipulation",I["ctrl+Y"]="redoManipulation";var G="",W="";window.initMarkUpEditor||(window.initMarkUpEditor=(O,v,s,b,C)=>{var p="",E=!1;const l={selection:null,range:null,content:"",texts:[],nodes:[],startNode:null,startOffset:0,endNode:null,endOffset:0,saveRange(){l.selection=document.getSelection(),l.range=l.selection.getRangeAt(0)},restoreRange(){!l.range||(l.selection=document.getSelection(),l.selection.removeAllRanges(),l.selection.addRange(l.range))},update(){l.content=s.innerText,l.nodes=[].map.call(s.childNodes,n=>n),l.texts=l.nodes.filter(n=>n.nodeName==="#text");var e=document.getSelection(),t;if(s!==e.focusNode&&!l.nodes.includes(e.focusNode)?(l.restoreRange(),t=l.range):(l.selection=e,t=e.getRangeAt(0),l.range=t),!!t){if(t.startContainer===s){let n=l.nodes[t.startOffset];if(!n)return;let a=n.nodeName;if(a==="#text")l.startNode=l.nodes[t.startOffset],l.startOffset=0;else if(a==="BR"){let r=l.nodes[t.startOffset+1];if(r)l.startOffset=0;else{if(r=l.nodes[t.startOffset-1],!r)return;l.startOffset=r.textContent.length}l.startNode=r}}else l.startNode=t.startContainer,l.startOffset=t.startOffset;if(t.endContainer===s){let n=l.nodes[t.endOffset];if(!n)return;let a=n.nodeName;if(a==="#text")l.endNode=n,l.endOffset=n.textContent.length;else if(a==="BR"){let r=l.nodes[t.endOffset-1];if(r)l.endOffset=r.textContent.length;else{if(r=l.nodes[t.endOffset+1],!r)return;l.endOffset=0}l.endNode=r}}else l.endNode=t.endContainer,l.endOffset=t.endOffset}},getSurrounding(e="",t=""){t=t||e;var n=l.startNode.textContent;n=n.substring(0,l.startOffset+e.length);var a=n.lastIndexOf(e);if(a>=0&&a<l.startOffset-e.length&&(a=-1),a<0)return[!1,l.startOffset,l.endOffset];n=l.endNode.textContent;var r=Math.max(0,l.endOffset-t.length);n=n.substring(r,n.length);var o=n.indexOf(t);return o>=0&&o>t.length&&(o=-1),o<0?[!1,l.startOffset,l.endOffset]:[!0,a,r+o+t.length]},addPair(e,t,n,a){var r=document.createRange();r.setStart(l.endNode,a),r.setEnd(l.endNode,a),l.selection.removeAllRanges(),l.selection.addRange(r),document.execCommand("insertHTML",!1,t),r=document.createRange(),r.setStart(l.startNode,n),r.setEnd(l.startNode,n),l.selection.removeAllRanges(),l.selection.addRange(r),document.execCommand("insertHTML",!1,e),r=document.createRange(),r.setStart(l.startNode,n),l.startNode===l.endNode?r.setEnd(l.endNode,a+e.length+t.length):r.setEnd(l.endNode,a+t.length),l.selection.removeAllRanges(),l.selection.addRange(r)},removePair(e,t,n,a){var r=l.endNode.textContent,o=r.substring(0,a-t.length),i=r.substring(a,r.length);l.endNode.textContent=o+i,r=l.startNode.textContent,o=r.substring(0,n),i=r.substring(n+e.length,r.length),l.startNode.textContent=o+i;var c=document.createRange();c.setStart(l.startNode,n),l.startNode===l.endNode?c.setEnd(l.endNode,a-e.length-t.length):c.setEnd(l.endNode,a-t.length),l.selection.removeAllRanges(),l.selection.addRange(c)},getSelStruction(){var e=[].map.call(s.childNodes,d=>d),t=e.indexOf(l.startNode),n=e.indexOf(l.endNode),a=t,r=n,o=l.startOffset,i=l.endNode.textContent.length-l.endOffset;for(let d=t;d>=0&&e[d].tagName!=="BR";d--)t=d;for(let d=n;d<e.length&&e[d].tagName!=="BR";d++)n=d;for(let d=t;d<a;d++){let f=e[d];f=f.textContent,o+=f.length}for(let d=r+1;d<=n;d++){let f=e[d];f=f.textContent,i+=f.length}var c=[],g=[];for(let d=t;d<=n;d++){let f=e[d];f.tagName==="BR"?(c.unshift(g),g=[]):g.push([f,d])}return c.unshift(g),c.forEach(d=>{if(!(d.length<2)){var f="";d.forEach(u=>{f+=u[0].textContent}),d[0][0].textContent=f;for(let u=d.length-1;u>0;u--)s.removeChild(d[u][0]);e.splice(d[0][1]+1,d.length-1)}}),c=c.filter(d=>d.length>0),c=c.map(d=>d[0][0]),c.reverse(),i=c.last.textContent.length-i,{nodes:e,selection:{lines:c,start:{node:t,offset:o},end:{node:n,offset:i}}}},rearrangeAll(){var e=[].map.call(s.childNodes,h=>h),t=document.getSelection(),n=t.getRangeAt(0),a=n.startContainer,r=n.endContainer,o=n.startOffset,i=n.endOffset;if(a===s){if(a=e[o],!a)return;o=0}if(r===s){if(r=e[i],!r)return;i=0}var c=[],g=[];for(let h=0;h<e.length;h++){let m=e[h];m.tagName==="BR"?(c.push(g),g=[]):g.push(m)}g.length>0&&c.push(g),c=c.filter(h=>h.length>0);var d=!1;if(c.forEach(h=>{if(h.length!==1){d=!0;var m=h[0],N=!1,H=!1,A=-1;if(A=h.indexOf(a),A>=0){N=!0,a=m;for(let x=0;x<A;x++)o+=h[x].textContent?.length||0}if(A=h.indexOf(r),A>=0){H=!0,r=m;for(let x=0;x<A;x++)i+=h[x].textContent?.length||0}m.textContent=m.wholeText;for(let x=1;x<h.length;x++)s.removeChild(h[x])}}),!e.last.tagName){let h=document.createElement("br");s.appendChild(h),d=!0}d&&(e=[].map.call(s.childNodes,h=>h));var f=e.indexOf(a),u=e.indexOf(r);if(f>u&&([f,u]=[u,f],[a,r]=[r,a],[o,i]=[i,o]),a.tagName==="BR"){let h=e[f-1];!!h&&!h.tagName&&(a=h,f--)}if(r.tagName!=="BR"){let h=e[u+1];!!h&&h.tagName==="BR"&&(r=h,u++)}return{all:e,startNode:a,startIndex:f,startOffset:o,endNode:r,endIndex:u,endOffset:i}}},R=(e="",t)=>{if(t=t||e,!l.texts.includes(l.startNode)||!l.texts.includes(l.endNode))return!1;var n=l.getSurrounding(e,t);if(!n)return!1;var[a,r,o]=n;return a?l.removePair(e,t,r,o):l.addPair(e,t,r,o),!0},ie=()=>{if(l.selection.isCollapsed||!l.texts.includes(l.startNode)||!l.texts.includes(l.endNode))return!1;var e=5;for(let t=5;t>=2;t--){let n=String.blank(t,"^"),a=l.getSurrounding(n);if(!a)continue;let[r,o,i]=a;if(!!r)return t===5?!1:(l.addPair("^","^",o,i),!0)}return l.addPair("^^","^^",l.startOffset,l.endOffset),!0},oe=()=>{if(l.selection.isCollapsed||!l.texts.includes(l.startNode)||!l.texts.includes(l.endNode))return!1;var e=5;for(let t=5;t>=2;t--){let n=String.blank(t,"^"),a=l.getSurrounding(n);if(!a)continue;let[r,o,i]=a;if(!!r)return t>2?l.removePair("^","^",o,i):l.removePair("^^","^^",o,i),!0}return!1},J=(e,t,n)=>{var a=n[t].textContent;a=String.blank(e,"#")+" "+a,n[t].textContent=a},Q=(e,t,n)=>{if(e)s.removeChild(n[t+1]),s.removeChild(n[t+2]),n.splice(t+1,2);else{let a=n[t].textContent;a=a.replace(/^\#+[ 　\t]*/,""),n[t].textContent=a}},P=(e,t=!1)=>{var n=l.getSelStruction(),a=n.nodes,r=n.selection.start.node,o=n.selection.end.node;if(r!==o)return!1;var i=a[r].textContent.match(/[ 　]*(#+)/),c=!1;if(i?i=i[1].length||0:i=0,i===0){let u=r+2,h=u,m="";for(let N=u;N<a.length;N++){let H=a[N];if(H.tagName==="BR")break;h=N,m=m+H.textContent}if(h>u){a[u].textContent=m;for(let N=u+1;N<=h;N++)s.removeChild(a[N]);a.splice(u+1,h-u)}m.match(/^={3,}$/)?(i=2,c=!0):m.match(/^\-{3,}$/)?(i=1,c=!0):i=0}i===0?J(e,r,a):i===e?Q(c,r,a):(Q(c,r,a),J(e,r,a));var g=a[r],d=document.getSelection(),f=document.createRange();return f.setStart(g,0),f.setEnd(g,g.textContent.length),d.removeAllRanges(),d.addRange(f),!0},_=(e,t=!1)=>{var n=l.getSelStruction(),a=n.selection.lines,r=n.selection.start.offset,o=n.selection.end.offset,i=a.first,c=a.last,g=document.getSelection(),d=document.createRange();return e?i===c&&r===o&&t?(d.setStart(i,r),d.setEnd(i,r),g.removeAllRanges(),g.addRange(d),document.execCommand("insertHTML",!1,"	")):(a.forEach(f=>{f.textContent="	"+f.textContent}),d.setStart(i,0),d.setEnd(c,c.textContent.length),g.removeAllRanges(),g.addRange(d)):(a.forEach(f=>{f.textContent=f.textContent.replace(/^\t/,"")}),d.setStart(i,0),d.setEnd(c,c.textContent.length),g.removeAllRanges(),g.addRange(d)),!0},X=(e=!0)=>{var{all:t,startNode:n,startIndex:a,startOffset:r,endNode:o,endIndex:i,endOffset:c}=l.rearrangeAll();if(e){if(a===0)return changed;let g=!1,d=-1;for(let u=a-1;u>=0;u--)if(t[u].tagName==="BR")if(g){d=u+1;break}else g=!0;let f=t[i+1];for(let u=a-1;u>=d;u--){let h=t[u];s.insertBefore(h,f),f=h}changed=!0}else{if(i===t.length-1)return changed;let g=-1;for(let f=i+1;f<t.length;f++)if(t[f].tagName==="BR"){g=f;break}let d=t[a];for(let f=i+1;f<=g;f++){let u=t[f];s.insertBefore(u,d)}changed=!0}return changed},D=(e,t)=>{var n=l.getSelStruction(),a=n.nodes,r=n.selection.lines,o=e+"	",i=o;t&&(i=i+"["+t+"] ");for(let u=0;u<r.length;u++){let h=u===0?i:o;r[u].textContent=h+r[u].textContent}var c=r.first,g=r.last,d=document.getSelection(),f=document.createRange();return f.setStart(c,0),f.setEnd(g,g.textContent.length),d.removeAllRanges(),d.addRange(f),!0},de=()=>{var{all:e,startNode:t,startIndex:n,startOffset:a,endNode:r,endIndex:o,endOffset:i}=l.rearrangeAll();for(let c=n;c<=o;c++){let g=e[c];s.removeChild(g)}return!0},fe=()=>{var e='<div class="table-generator" style="text-align:center;">';return e+='<div class="table-line">\u884C\uFF1A<input class="number-inputter row-count" type="number" value=2></div>',e+='<div class="table-line">\u5217\uFF1A<input class="number-inputter col-count" type="number" value=2></div>',e+="</div>",showInfobox({title:"\u63D2\u5165\u8868\u683C",mode:"html",content:e,input:!1,action:"oc",callback:(t,n,a)=>{if(l.restoreRange(),t==="ok"){var r=a.$refs.content,o=r.querySelector("input.row-count"),i=r.querySelector("input.col-count");ce(o.value||2,i.value||2)}}}),!1},ce=(e,t)=>{if(!(e<=0||t<=0)){var n=[],a=[];for(let r=1;r<=t;r++)a.push("\u6807\u9898"+r);n.push("|"+a.join("|")+"|"),a=[];for(let r=0;r<t;r++)a.push("-");n.push("|"+a.join("|")+"|");for(let r=0;r<e;r++){a=[];for(let o=0;o<t;o++)a.push("    ");n.push("|"+a.join("|")+"|")}n="<br>"+n.join("<br>")+"<br>",document.execCommand("insertHTML",!1,n),q(!0)}},y=(e,t)=>{l.startNode!==l.endNode&&(l.endNode=l.startNode,l.endOffset=l.startNode.textContent.length),showInfobox({title:"\u63D2\u5165"+e,input:!0,action:"oc",callback:(n,a,r)=>{l.restoreRange(),!(n==="cancel"||!a)&&ue(t,a)}})},ue=(e,t)=>{if(!!t){var n=l.startNode.textContent.substring(l.startOffset,l.endOffset),a="";if(!!n&&n.length>0&&(a="["+n+"]"),e==="footnote"?a+="[:"+t+"]":e==="endnote"?a+="[^"+t+"]":a+="{"+t+"}",document.execCommand("insertHTML",!1,a),e==="anchor")return q(!0);var r="["+t+"]: ",o=newEle("br"),i=document.createTextNode(r);r=r.length,l.startNode.nextSibling?s.insertBefore(i,l.startNode.nextSibling):s.appendChild(i),s.insertBefore(o,i);var c=document.createRange();c.setStart(i,r),c.setEnd(i,r),l.selection.removeAllRanges(),l.selection.addRange(c),q(!0)}},ge=()=>{l.startNode!==l.endNode&&(l.endNode=l.startNode,l.endOffset=l.startNode.textContent.length),showInfobox({title:"\u63D2\u5165 FontAwesome \u56FE\u6807",input:!0,action:"oc",callback:(e,t,n)=>{l.restoreRange(),!(e==="cancel"||!t)&&(document.execCommand("insertHTML",!1," :"+t+": "),q(!0))}})},V=(e,t)=>{var n=l.getSelStruction(),a=n.nodes,r=n.selection.lines,o=n.selection.start.node,i=n.selection.end.node,c=n.selection.start.offset,g=n.selection.end.offset;i!==o&&(i=o,g=r.first.textContent.length,n.selection.end.node=i,n.selection.end.offset=g);var d=r.first.textContent.substring(c,g),f='<div class="link-generator" style="text-align:center;">';return f+='<div class="link-line">\u6807\u9898\uFF1A<input class="number-inputter link-title" value="'+d+'"></div>',f+='<div class="link-line">\u5730\u5740\uFF1A<input class="number-inputter link-address" value=""></div>',t!=="link"&&(f+='<div class="link-line button-line" style="margin-top:10px;font-size:14px;">',f+='<input type="radio" name="position" value="nextline" checked><span class="name">\u72EC\u7ACB\u4E00\u884C</span><br>',f+='<input type="radio" name="position" value="floatleft"><span class="name">\u5DE6\u4FA7\u6DF7\u6392</span><br>',f+='<input type="radio" name="position" value="floatright"><span class="name">\u53F3\u4FA7\u6DF7\u6392</span>',f+="</div>"),f+="</div>",showInfobox({title:"\u63D2\u5165"+e,mode:"html",content:f,input:!1,action:"oc",callback:(u,h,m)=>{if(l.restoreRange(),u==="ok"){var N=m.$refs.content,H=N.querySelector("input.link-title").value,A=N.querySelector("input.link-address").value,x="nextline";N.querySelectorAll('input[type="radio"][name="position"]').forEach(B=>{B.checked&&(x=B.value)}),he(t,H,A,x)}}}),!1},he=(e,t,n,a)=>{if(!(!n||n.length===0)){var r,o=!1;e==="image"?(r="<br>![",o=!0):e==="video"?(r="<br>@[",o=!0):e==="audio"?(r="<br>#[",o=!0):r="[",r+=t+"]("+n,a==="floatleft"?r+=' "left")':a==="floatright"?r+=' "right")':r+=")",o&&(r=r+"<br>");var i=document.getSelection(),c=i.getRangeAt(0),g=c.startContainer,d=c.startOffset;document.execCommand("insertHTML",!1,r);var f=[].map.call(s.childNodes,u=>u);if(o){let u=g.previousSibling?.previousSibling;!!u&&!u.tagName&&(c.setStart(u,0),c.setEnd(u,u.textContent.length),i.removeAllRanges(),i.addRange(c))}else c.setStart(g,d),c.setEnd(g,d+r.length),i.removeAllRanges(),i.addRange(c);q(!0)}},ve=()=>{var e='<div class="table-generator" style="text-align:center;">';return e+='<div class="table-line">\u540D\u79F0\uFF1A<input class="number-inputter block-name" value=""></div>',e+="</div>",showInfobox({title:"\u63D2\u5165\u5F15\u7528\u5757",mode:"html",content:e,input:!1,action:"oc",callback:(t,n,a)=>{if(l.restoreRange(),t==="ok"){var r=a.$refs.content,o=r.querySelector("input.block-name").value;pe(o)}}}),!1},pe=e=>{if(!(!e||e.length===0)){var t="["+e+"]";document.execCommand("insertHTML",!1,t);var n=document.getSelection(),a=n.getRangeAt(0),r=a.startContainer,o=r.textContent.length;a.setStart(r,o),a.setEnd(r,o),n.removeAllRanges(),n.addRange(a),document.execCommand("insertHTML",!1,"<br>[:"+e+":]ref("+e+")[:"+e+":]"),r=r.nextSibling?.nextSibling,!!r&&!r.tagName&&(o=4+e.length,a.setStart(r,o),a.setEnd(r,o+5+e.length),n.removeAllRanges(),n.addRange(a)),q(!0)}},M=e=>{var t=l.getSelStruction(),n=t.nodes,a=t.selection.lines,r=a.first,o=a.last,i=document.getSelection(),c=document.createRange(),g=o.textContent.length;return c.setStart(o,g),c.setEnd(o,g),i.removeAllRanges(),i.addRange(c),document.execCommand("insertHTML",!1,"<br>"+e),c=document.createRange(),c.setStart(r,0),c.setEnd(r,0),i.removeAllRanges(),i.addRange(c),document.execCommand("insertHTML",!1,e+"<br>"),c.setStart(r.previousSibling?.previousSibling,0),c.setEnd(o.nextSibling?.nextSibling,e.length),i.removeAllRanges(),i.addRange(c),!0},U=e=>{var t=l.getSelStruction(),n=t.nodes,a=t.selection.lines,r=t.selection.start.node,o=t.selection.end.node,i=[],c=0,g=[];for(let u=r;u<=o;u++){let h=n[u];h.tagName==="BR"?c++:h.textContent.length>0&&(c>1&&(i.push(g),g=[]),c=0,g.push(h))}g.length>0&&i.push(g),i.forEach(u=>{var h=u.first;h.textContent=h.textContent.replace(/^(( |　|\t|\-|\+|>|\*|~|\d+\.)*(\{[<\|>]\}([ 　\t]*))*)(:*)/,(m,N,H,A,x,B)=>{var F=B.length;return e?B+=":":F>0&&(B=B.substring(1,B.length)),N+B})}),r=a.first,o=a.last;var d=document.getSelection(),f=document.createRange();return f.setStart(r,0),f.setEnd(o,o.textContent.length),d.removeAllRanges(),d.addRange(f),!1},K=e=>{var t=l.getSelStruction(),n=t.nodes,a=t.selection.lines,r=t.selection.start.node,o=t.selection.end.node,i=[],c=0,g=[];for(let u=r;u<=o;u++){let h=n[u];h.tagName==="BR"?c++:h.textContent.length>0&&(c>1&&(i.push(g),g=[]),c=0,g.push(h))}g.length>0&&i.push(g),i.forEach(u=>{var h=u.first;h.textContent=h.textContent.replace(/^(( |　|\t|\-|\+|>|\*|:|~|\d+\.)*)(\{[<\|>]\}([ 　\t]*))+/,(N,H)=>H),h=u.last;var m="";e===0?m=" {<}":e===1?m=" {|}":e===2&&(m=" {>}"),h.textContent=h.textContent.replace(/([ 　\t]*)(\{[<\|>]\}([ 　\t]*))+$/,"")+m}),r=a.first,o=a.last;var d=document.getSelection(),f=document.createRange();return f.setStart(r,0),f.setEnd(o,o.textContent.length),d.removeAllRanges(),d.addRange(f),!1},$=e=>{var t=document.getSelection(),n=t.getRangeAt(0),a=n.startContainer,r=n.startOffset;document.execCommand("insertHTML",!1,"<br><br>"+e+"<br><br>");var o=a.previousSibling?.previousSibling?.previousSibling;return!!o&&!o.tagName&&(n.setStart(o,0),n.setEnd(o,o.textContent.length),t.removeAllRanges(),t.addRange(n)),!0},me=(e,t)=>{var n=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(n),r=document.createElement("a");r.setAttribute("href",a),e?r.setAttribute("download",e):r.setAttribute("download","untitled"),r.click()},be=()=>{var e=l.content,t=G;t||(W?t=W+".mu":t="untitled.mu"),me(t,e)},ee=e=>{G=e.name;var t=new FileReader;t.onload=()=>{s.innerText=t.result,w.clear(),p="",articleConfig={title:e.name,update:e.lastModifiedDate.getTime(),content:t.result,usage:[]},q(!0)},t.readAsText(e)},xe=()=>{var e=C.files[0];!e||ee(e)},te=(e,t=!1)=>{var n=!1;l.update();var a=s.value;if(p!==a&&(E=!0),e==="restoreManipulation")return E=!1,w.restore(),!0;if(e==="redoManipulation")return E=!1,w.redo(),!0;if(e==="TabIndent")n=_(!0,t);else if(e==="TabOutdent")n=_(!1,t);else if(e==="bold")n=R("**");else if(e==="italic")n=R("*");else if(e==="underline")n=R("__");else if(e==="wavy")n=R("~");else if(e==="delete")n=R("~~");else if(e==="sup")n=R("^");else if(e==="sub")n=R("_");else if(e==="sizeUp")n=ie();else if(e==="sizeDown")n=oe();else if(e==="red")n=R("[red]","[/]");else if(e==="green")n=R("[green]","[/]");else if(e==="blue")n=R("[blue]","[/]");else if(e==="yellow")n=R("[yellow]","[/]");else if(e==="gold")n=R("[gold]","[/]");else if(e==="white")n=R("[white]","[/]");else if(e==="silver")n=R("[silver]","[/]");else if(e==="gray")n=R("[gray]","[/]");else if(e==="dark")n=R("[dark]","[/]");else if(e==="black")n=R("[black]","[/]");else{if(e==="insert-icon")return ge(),!1;if(e==="heading-1")n=P(1,t);else if(e==="heading-2")n=P(2,t);else if(e==="heading-3")n=P(3,t);else if(e==="heading-4")n=P(4,t);else if(e==="heading-5")n=P(5,t);else if(e==="heading-6")n=P(6,t);else if(e==="quote-quote")n=D(">");else if(e==="quote-info")n=D(">","info");else if(e==="quote-success")n=D(">","success");else if(e==="quote-warning")n=D(">","warning");else if(e==="quote-danger")n=D(">","danger");else if(e==="list-ol")n=D("1.");else if(e==="list-ul")n=D("-");else if(e==="insert-table")fe(),n=!1;else if(e==="insert-code")n=M("```");else if(e==="insert-latex")n=M("$$");else if(e==="convert-code")n=R("`");else if(e==="convert-latex")n=R("$");else if(e==="footnote")y("\u811A\u6CE8","footnote"),n=!1;else if(e==="endnote")y("\u5C3E\u6CE8","endnote"),n=!1;else if(e==="term")y("\u672F\u8BED","term"),n=!1;else if(e==="anchor")y("\u951A\u70B9","anchor"),n=!1;else if(e==="levelOut")n=_(!1,t);else if(e==="levelIn")n=_(!0,t);else if(e==="blockUp")n=X(!0);else if(e==="blockDown")n=X(!1);else if(e==="indent")n=U(!0);else if(e==="outdent")n=U(!1);else if(e==="align-left")n=K(0);else if(e==="align-center")n=K(1);else if(e==="align-right")n=K(2);else if(e==="insert-link")V("\u8D85\u94FE\u63A5","link"),n=!1;else if(e==="insert-image")V("\u56FE\u7247","image"),n=!1;else if(e==="insert-video")V("\u89C6\u9891","video"),n=!1;else if(e==="insert-audio")V("\u97F3\u9891","audio"),n=!1;else if(e==="headline-normal")n=$("---");else if(e==="headline-double")n=$("===");else if(e==="headline-dotted")n=$("...");else if(e==="headline-dashed")n=$("___");else if(e==="headline-gradient")n=$("+++");else if(e==="headline-wavy")n=$("~~~");else if(e==="headline-star")n=$("***");else if(e==="insert-block")ve(),n=!1;else{if(e==="help")return window.open("/#/markup").focus(),!0;if(e==="close")return O.$router.push({path:"/"}),!0;if(e==="save-article")return be(),!0;if(e==="open-local-article")return C.accept=".mu",C.click(),!0;if(e==="new-article")return G="",W="",s.innerText="",b.innerHTML="",s.focus(),w.clear(),w.append("",0,0,0,0),!0;e==="deleteLine"&&(n=de())}}return n&&q(E),n},S=new le(te);(()=>{var e,t;e=new L,e.add("\u4FDD\u5B58","save","save-article","ctrl+S"),e.add("\u6253\u5F00\u672C\u5730\u6587\u6863","file-word","open-local-article","ctrl+O"),e.add("\u65B0\u5EFA\u7A7A\u6587\u6863","file","new-article","ctrl+N"),S.add(e),S.add(new T),e=new L,e.add("\u52A0\u7C97","bold","bold","ctrl+B"),e.add("\u659C\u4F53","italic","italic","ctrl+I"),e.add("\u4E0B\u5212\u7EBF","underline","underline","alt+U"),e.add("\u6CE2\u6D6A\u7EBF","water","wavy","alt+W"),e.add("\u5220\u9664\u7EBF","strikethrough","delete","alt+D"),e.add(new T),t=new L,t.add("\u7EA2\u8272","color red","red"),t.add("\u7EFF\u8272","color green","green"),t.add("\u84DD\u8272","color blue","blue"),t.add("\u9EC4\u8272","color yellow","yellow"),t.add("\u91D1\u8272","color gold","gold"),t.add("\u767D\u8272","color white","white"),t.add("\u94F6\u8272","color silver","silver"),t.add("\u7070\u8272","color gray","gray"),t.add("\u6DF1\u8272","color dark","dark"),t.add("\u9ED1\u8272","color black","black"),e.add(t),e.add(new T),e.add("\u4E0A\u6807","superscript","sup","alt+P"),e.add("\u4E0B\u6807","subscript","sub","alt+B"),e.add(new T),e.add("\u5927\u4E00\u53F7","sort-amount-up","sizeUp","ctrl+Up"),e.add("\u5C0F\u4E00\u53F7","sort-amount-down","sizeDown","ctrl+Down"),S.add(e),e=new L,e.add("\u811A\u6CE8","paragraph","footnote","alt+F"),e.add("\u5C3E\u6CE8","scroll","endnote","alt+E"),e.add("\u672F\u8BED","pen-nib","term","alt+T"),e.add("\u951A\u70B9","map-pin","anchor","alt+A"),e.add(new T),e.add("\u4EE3\u7801","code","convert-code","alt+C"),e.add("\u516C\u5F0F","square-root-alt","convert-latex","alt+L"),e.add(new T),e.add("\u63D2\u5165\u56FE\u6807","flag","insert-icon"),S.add(e),S.add(new T),e=new L,t=new L,t.add("\u4E00\u7EA7\u6807\u9898","heading one","heading-1","alt+H"),t.add("\u4E8C\u7EA7\u6807\u9898","heading two","heading-2"),t.add("\u4E09\u7EA7\u6807\u9898","heading three","heading-3"),t.add("\u56DB\u7EA7\u6807\u9898","heading four","heading-4"),t.add("\u4E94\u7EA7\u6807\u9898","heading five","heading-5"),t.add("\u516D\u7EA7\u6807\u9898","heading six","heading-6"),e.add(t),e.add(new T),t=new L,t.add("\u666E\u901A\u5F15\u7528","quote-right","quote-quote"),t.add("\u4FE1\u606F\u5F15\u7528","quote-left","quote-info"),t.add("\u63D0\u9192\u5F15\u7528","angle-double-right font green","quote-success"),t.add("\u8B66\u544A\u5F15\u7528","angle-right","quote-warning"),t.add("\u62A5\u9519\u5F15\u7528","angle-double-right font red","quote-danger"),e.add(t),t=new L,t.add("\u65E0\u5E8F\u5217\u8868","list-ul"),t.add("\u6709\u5E8F\u5217\u8868","list-ol"),e.add(t),e.add("\u8868\u683C","table","insert-table"),e.add(new T),e.add("\u4EE3\u7801","code","insert-code"),e.add("\u516C\u5F0F","square-root-alt","insert-latex"),S.add(e),e=new L,e.add("\u5C42\u8FDB","indent","levelIn","ctrl+alt+Right"),e.add("\u5C42\u51FA","outdent","levelOut","ctrl+alt+Left"),e.add(new T),e.add("\u5DE6\u5BF9\u9F50","align-left"),e.add("\u5C45\u4E2D","align-center"),e.add("\u53F3\u5BF9\u9F50","align-right"),e.add(new T),e.add("\u7F29\u8FDB","indent font blue","indent"),e.add("\u9000\u51FA","outdent font blue","outdent"),S.add(e),S.add(new T),e=new L,e.add("\u63D2\u5165\u8D85\u94FE\u63A5","link","insert-link","alt+K"),e.add("\u63D2\u5165\u56FE\u7247","image","insert-image"),e.add("\u63D2\u5165\u89C6\u9891","video","insert-video"),e.add("\u63D2\u5165\u97F3\u9891","music","insert-audio"),S.add(e),e=new L,e.add("\u666E\u901A\u5206\u9694\u7EBF","minus","headline-normal"),e.add("\u53CC\u5C42\u5206\u9694\u7EBF","grip-lines","headline-double"),e.add("\u865A\u7EBF","ellipsis-h","headline-dotted"),e.add("\u70B9\u5212\u7EBF","window-minimize","headline-dashed"),e.add("\u6E10\u53D8\u7EBF","icicles","headline-gradient"),e.add("\u4EA4\u53C9\u7EBF","grip-horizontal","headline-wavy"),e.add("\u5708\u9694\u7EBF","genderless","headline-star"),S.add(e),S.add(new T),S.add("\u63D2\u5165\u5F15\u7528\u5757","vector-square","insert-block"),S.add(new T),S.add("\u5E2E\u52A9\u6587\u6863","info-circle","help","ctrl+H"),S.add(new T),S.add("\u5173\u95ED\u672C\u6587\u6863","times-circle","close");var n=S.getShortcuts();Object.keys(n).forEach(a=>I[a]=n[a]),v.appendChild(S.ui)})();var k,z,Y=[];const we=(e,t=!1,n="")=>{if(e.length===0||!!e.match(/^ *$/))return[!0,!1,n];if(t)return[!0,!0,n];if(e.match(/^\[.+\][:：][ 　\t]*/))return[!0,!0,n];if(n){if(n==="$")return e.match(/^\$\$/)&&(n=""),[!0,t,n];if(n==="`")return e.match(/^```/)&&(n=""),[!0,t,n];if(n==="~")return e.match(/^~~~/)&&(n=""),[!0,t,n]}else{if(e.match(/^\$\$/))return[!0,t,"$"];if(e.match(/^```/))return[!0,t,"`"];if(e.match(/^(~~~$|~~~[ 　\t\w]+)/))return[!0,t,"~"]}return e.match(/^(标题|作者|简介|关键词|更新|GOD|THEONE|TITLE|AUTHOR|EMAIL|DESCRIPTION|STYLE|SCRIPT|DATE|KEYWORD|GLOSSARY|TOC|REF|LINK|IMAGES|VIDEOS|AUDIOS|ARCHOR|SHOWTITLE|SHOWAUTHOR|RESOURCES)[:：]/i)?[!0,t,n]:e.match(/[ 　\t\w\u4e00-\u9fa5]/)?e.match(/[!@#]\[.*\]\(.+\)/)?[!0,t,n]:e.match(/^[ 　\t]*\[.+\][ 　\t]*$/)?[!0,t,n]:e.match(/^\|>.*<\|$/)?[!0,t,n]:[!1,t,n]:[!0,t,n]},Z=e=>{if(!(e>=0))return null;var t=b.querySelectorAll('span.linenumbermarker[linenumber="'+e+'"]');if(t=[].map.call(t,r=>r),t=t.filter(r=>!r.parentElement.classList.contains("content-link")),t.length===0)return null;var n=b.parentElement,a=n.getBoundingClientRect().top;return t=t.map(r=>[Math.abs(r.getBoundingClientRect().top-a),r]),t.sort((r,o)=>r[0]-o[0]),t[0][1]},Ne=e=>{if(e.which===13){let n=document.getSelection(),a=n.getRangeAt(0),r="<br>",o=!0;if(a.collapsed){let f=a.startContainer.wholeText;if(f){let u=f.match(/^([ 　\t>\+\-\*]|\d+\.)*/)||[];u=u[0]||"",u.length>0&&(o=!1),r+=u}}r=r+'<span class="placeholder"></span>',document.execCommand("insertHTML",!1,r);let i=s.querySelector("span.placeholder");i.scrollIntoViewIfNeeded();let c=document.createTextNode("test");s.insertBefore(c,i),s.removeChild(i);let g=[].map.call(s.childNodes,f=>f);g.reverse();let d=[];return g.some((f,u)=>{if(f.tagName)return!0;if(f.textContent.length===0){s.removeChild(f),d.push(u);return}return!0}),d.reverse().forEach(f=>g.splice(f,1)),g.reverse(),a=n.getRangeAt(0),n.removeAllRanges(),a=document.createRange(),a.selectNode(c),n.addRange(a),c.textContent="",a.collapse(),g.last===c&&o&&document.execCommand("insertHTML",!1,"<br><br>"),e.preventDefault(),!1}if(![16,17,18,91].includes(e.which)){E=!0;let n=[];e.ctrlKey&&n.push("ctrl"),e.altKey&&n.push("alt"),e.shiftKey&&n.push("shift"),e.winKey&&n.push("win"),e.metaKey&&n.push("meta");let a=e.key;a.indexOf("Arrow")>=0?a=a.replace("Arrow",""):e.which===27?a="Esc":e.which===8?a="Back":e.which===9?a="Tab":a=a.toUpperCase(),n.push(a),n=n.join("+");var t=I[n];if(!t)return;te(t,!0)&&e.preventDefault()}},ne=e=>{var t=e.dataTransfer;!t||(t=t.files,!!t&&(t=t[0],!!t&&(ee(t),e.preventDefault())))},Ce=e=>{var t=e.clipboardData.getData("text/html"),n=e.clipboardData.files;if(!(t.length===0&&n.length===0)){if(n.length>0&&!!Socket){[].forEach.call(n,d=>{if(!(d.type.indexOf("image")<0)){var f=generateRandomKey(16),u=s.value,h=s.selectionStart,m=s.selectionEnd,N=u.substr(0,h),H=u.substr(m,u.length),A="[\u56FE\u7247("+f+")\u4E0A\u4F20\u4E2D\u2026\u2026]";u=N+`
`+A+`
`+H,h++,m=A.length,s.value=u,s.selectionStart=h,s.selectionEnd=h+m;var x=new FileReader;x.onload=B=>{var F=B.target.result;sendToServer("saveResource",{data:F,id:f,name:d.name,type:d.type})},x.readAsArrayBuffer(d)}}),e.preventDefault();return}var a=newEle("div");a.innerHTML=t;var r=MarkUp.reverse(a);a.innerHTML="",a=null;var t=s.value,o=s.selectionStart,i=s.selectionEnd;r.indexOf(`
`)>=0&&(r=r.replace(/^\n+|\n+$/g,""),o>0&&(r=`

`+r),i<t.length&&(r=r+`

`));var c=t.substr(0,o),g=t.substr(i,t.length);t=c+r+g,o+=r.length,s.value=t,s.selectionStart=o,s.selectionEnd=o,e.preventDefault()}},q=(e=!1)=>{z&&(clearTimeout(z),z=null);var t=s.innerText;if(t=t.replace(/\n*$/gi,""),p!==t){p=t;var n=t;t=t.split(`
`);var a=!1,r="";if(Y.splice(0,Y.length),t=t.map((N,H)=>{var A=!1;if([A,a,r]=we(N,a,r),A)return N;var x=N.match(/^([ 　`~!@#%^&\*\-_\+=\\\|:;\/\?\.,<>\d\r\t]|(\[\w*\][ 　\t]*(\(.*\))*)|\{[\|<>]*\})*/);x?x=x[0]:x="";var B=N.substring(0,x.length),F=N.substring(x.length,N.length);return x="%LINENUMBER-"+H+"%",Y.push(H),B+x+F}),t=t.join(`
`),Oe(t),!!e){var o=document.getSelection(),i=o.getRangeAt(0),{all:c,startNode:g,startIndex:d,startOffset:f,endNode:u,endIndex:h,endOffset:m}=l.rearrangeAll();w.append(n,d,f,h-1,m),u.tagName==="BR"&&(u=u.previousSibling),!(!g||!u)&&(i.setStart(g,f),i.setEnd(u,m),o.removeAllRanges(),o.addRange(i))}}},Re=()=>{l.saveRange(),re()},re=()=>{var e=s.innerText;e.length===0&&(s.innerHTML="<br/>",s.focus()),z&&(clearTimeout(z),z=null),z=setTimeout(()=>q(E),1e3)},Se=()=>{if(k&&(clearTimeout(k),k=null),!(s.parentNode.scrollHeight<=s.parentNode.offsetHeight)){var e=s.parentNode.scrollTop/(s.parentNode.scrollHeight-s.parentNode.offsetHeight),t=s.parentNode.getBoundingClientRect();t=t.top+t.height*e;var n=[].map.call(s.childNodes,d=>d),a=-1,r=!0,o=!1;n.some((d,f)=>{if(!d.getBoundingClientRect)return r&&a++,r=!1,o=!0,!1;r?a++:r=!0,o=!1;var u=d.getBoundingClientRect();return u.top>=t}),o||a--;var i,c,g;if(Y.some(d=>{if(d<a&&(i=d),d===a&&(c=d),d>a)return g=d,!0}),c>=0){if(c=Z(c),!c)return;c=c.getBoundingClientRect();let d=c.top-b.getBoundingClientRect().top,f=s.parentElement;if(f.scrollHeight>f.offsetHeight){let u=f.scrollTop/(f.scrollHeight-f.offsetHeight);d-=(f.getBoundingClientRect().height-c.height)*u}b.parentElement.scrollTo({top:d,left:0,behavior:"smooth"})}else{if(!(i>=0)||!(g>=0))return;{let d=(a-i)/(g-i);if(i=Z(i),!i||(g=Z(g),!g))return;i=i.getBoundingClientRect(),g=g.getBoundingClientRect();let f=g.top+g.height-i.top,u=i.top+f*d-b.getBoundingClientRect().top,h=s.parentElement,m=h.scrollHeight>h.offsetHeight?h.scrollTop/(h.scrollHeight-h.offsetHeight):0;u-=h.getBoundingClientRect().height*m,b.parentElement.scrollTo({top:u,left:0,behavior:"smooth"})}}}},ae=()=>{k&&(clearTimeout(k),k=null),k=setTimeout(Se,100)},Oe=async e=>{var t=await MarkUp.fullParse(e,{showtitle:!0,classname:"markup-content"});b.innerHTML=t.content,v.uiWordCount.innerText=t.wordCount,W=t.title,await afterMarkUp()};w.editor=s,s.addEventListener("keydown",Ne),s.addEventListener("keyup",re),s.addEventListener("paste",Ce),s.addEventListener("blur",Re),s.parentNode.addEventListener("mousewheel",ae),s.parentNode.addEventListener("scroll",ae),s.addEventListener("drop",ne),b.addEventListener("drop",ne),C.addEventListener("change",xe),document.execCommand("defaultParagraphSeparator",!1,"br"),document.execCommand("insertbronreturn",!1,!0),v.uiWordCount=v.querySelector("div.wordcount-hint span.count")})})();
