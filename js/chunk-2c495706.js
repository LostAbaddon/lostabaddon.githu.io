(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c495706"],{"0638":function(e,n,t){"use strict";t("932b")},2268:function(module,exports){(()=>{const OmniOS={info:{name:"OmniOS",version:"0.0.1",author:"LostAbaddon"}},Handlers=new Map,Variables=new Map,Functions=new Map,History=[];History._index=0,History._available=!0;var consoleHistory=[];const initUI=e=>{e._input=newEle("div","inputbox"),e._input._hint=prepareHint(!0),e._input._input=newEle("span","inputter"),e._input._input.contentEditable=!0,e._input._input.addEventListener("keydown",async n=>{if("Enter"!==n.key||n.shiftKey){if("ArrowUp"===n.key){let t=History.length;if(History._index++,t>=History._index){let n=History[t-History._index];e._input._input.innerText=n;let i=document.getSelection(),s=i.getRangeAt(0),a=e._input._input.childNodes[0];s.setStart(a,a.textContent.length),s.setEnd(a,a.textContent.length),i.addRange(s)}else History._index=t;n.preventDefault()}else if("ArrowDown"===n.key){let t=History.length;if(History._index--,History._index>0){let n=History[t-History._index];e._input._input.innerText=n;let i=document.getSelection(),s=i.getRangeAt(0),a=e._input._input.childNodes[0];s.setStart(a,a.textContent.length),s.setEnd(a,a.textContent.length),i.addRange(s)}else History._index=0,e._input._input.innerText="";n.preventDefault()}else if("Tab"===n.key){n.preventDefault();let t=Handlers.get("ontab"),i=document.getSelection(),s=i.getRangeAt(0);if(t){let n=e._input._input.innerText,i=n.substring(0,s.endOffset),a=n.substring(s.endOffset),r=i.split(/[ 　\t]+/),o=r[0];r=r[r.length-1];let l=await t(o,r);if(l){i=i.substring(0,i.length-r.length)+l,r=a.match(/[ 　\t]+/),!!r&&!!r[0]&&(r=a.substring(0,r.index),a=a.replace(r,"")),e._input._input.innerText=i+a;let n=e._input._input.childNodes[0];s.setStart(n,i.length),s.setEnd(n,i.length)}}i.addRange(s)}}else{let t=e._input._input.innerText;t=t.replace(/(^[ 　\t\r\n\u00A0]+|[ 　\t\r\n\u00A0]+$)/gi,""),OmniOS.run(t),e._input._input.innerHTML="",e._input._input.focus(),n.preventDefault()}}),e._input.appendChild(e._input._hint),e._input.appendChild(e._input._input),e.appendChild(e._input),e.addEventListener("mouseup",({target:n})=>{n===e&&e._input._input.focus()})},prepareHint=e=>{var n=newEle("span","hint"),t=":>";if(e)if(t=">:",OmniOS.status.length>0){let e=document.createTextNode(OmniOS.location);n.appendChild(e),e=newEle("span","status"),e.innerText=" ("+OmniOS.status.join("/")+") ",n.appendChild(e),e=document.createTextNode(t),n.appendChild(e)}else n.innerText=OmniOS.location+" "+t;else n.innerText="--"+t;return n},showMessage=(e,n="text")=>{History._available&&consoleHistory.push([e,n,OmniOS.location,[...OmniOS.status]]);var t=newEle("div",["message",n]),i=prepareHint("command"===n);t._hint=i,t.appendChild(i);var s=newEle("span","content");return 0===e.indexOf("<")?s.innerHTML=e:s.innerText=e,t._content=s,t.appendChild(s),OmniOS.ui.insertBefore(t,OmniOS.ui._input),OmniOS.ui._input.scrollIntoViewIfNeeded(),t},analyzeParams=e=>{if(e.match(/^"(.|[\r\n])*"$/)){let n;try{n=JSON.parse(e)}catch(t){return console.error(t),null}let i=new Date(n);return"Invalid Date"!==i.toString()?i:n}var n=1*e;return n+""===e?n:(n=e.toLowerCase(),!!["true","ok"].includes(n)||!["false","cancel"].includes(n)&&(n=new Date(e),"Invalid Date"!==n.toString()?n:e))},decomposeCmd=e=>{var n=0,t=!1,i={},s=1,a="";e.replace(/(\\*)"/g,(r,o,l)=>{var u=o.length;if(u>>1<<1===u){l+=u;var p=e.substring(n,l+(t?1:0));if(n=l+(t?1:0),t=!t,p)if(t)a+=p;else{let n="%"+s+"%";for(;e.indexOf(n)>=0;)s++,n="%"+s+"%";s++,i[n]=p,a+=n}}}),n<e.length&&(a+=e.substring(n)),a=a.split(/[ 　\u00A0\t=]+/),a=a.map(e=>i[e]||e),i=[];var r={},o=null;e=a.shift(),a.forEach(e=>{var n=e.replace(/^\-+/,"");if(e===n){let n=o?r[o]:i,t=analyzeParams(e);null!==t&&n.push(t)}else o=n,r[n]=[]});for(let l in r){let e=r[l];0===e.length?r[l]=!0:1===e.length&&(r[l]=e[0])}return{command:e,params:i,options:r}},runCommand=async e=>{if(History._index=0,e){History.push(e),showMessage(e,"command");var n,t=e;if(e=decomposeCmd(e),OmniOS.status.forEach(t=>{var i=Handlers.get(t);if(i){var s=i.get(e.command);!s||(n=s)}}),!n)return void showMessage("无效指令: "+e.command,"error");await n(e.params,e.options,t);var i=prepareHint(!0);OmniOS.ui._input._hint.innerHTML=i.innerHTML}},mountOS=async()=>{OmniOS.onCommand("omni","enter",e=>{if(0!==e.length){if(e=e[0],"/"===e.substring(0,1)&&(OmniOS.location=""),e=e.split(/[\/\\]+/),e=e.filter(e=>!!e),0!==e.length){var n=OmniOS.location.replace(/^\/+|\/+$/g,"").split("/").filter(e=>!!e);e.forEach(e=>{".."===e?n.pop():"."!==e&&n.push(e)}),0===n.length?OmniOS.location="/":OmniOS.location="/"+n.join("/")+"/"}}else showMessage("未指定目标路径","error")}),OmniOS.onCommand("omni","set",async(e,n,t)=>{var i=e.shift();if(i){var s=e.shift();if(t=t.replace("set ",""),t=t.replace(i+" ",""),t=t.replace(s+" ",""),"is"===s){let s=e.shift();if(!i)return void showMessage("指令名为空","error");let a=Handlers.get(s);if(!a)return void showMessage("无效指令: "+s,"error");let r=await a(e,n,t);Variables.set(i,r)}else{if("as"!==s)return void showMessage("指令错误","error");{let s=e.shift();if(!i)return void showMessage("指令名为空","error");Functions.set(i,[s,e,n,t])}}}else showMessage("变量名为空","error")}),OmniOS.onCommand("omni","echo",e=>{var n=e.shift();if(n){if(!Variables.has(n))return showMessage("EMPTY","error"),"EMPTY";var t=Variables.get(n);return showMessage(JSON.stringify(t)),t}showMessage("变量名为空","error")}),OmniOS.onCommand("omni","exec",async e=>{var n=e.shift();if(n){if(!Functions.has(n))return showMessage("EMPTY","error"),"EMPTY";var[t,e,i,s]=Functions.get(n),a=Handlers.get(t);if(a){var r=await a(e,i,s);return r}showMessage("无效指令: "+t,"error")}else showMessage("变量名为空","error")}),OmniOS.onCommand("omni","eval",async(params,options,raw)=>{raw=raw.replace(/eval[ 　\t\u00A0]*/,"");try{for(let[e,n]of Variables){let n=new RegExp("\\$("+e+")(\\b|$)","g");raw=raw.replace(n,(e,n,t)=>{if(!Variables.has(n))return e;var i=Variables.get(n);return JSON.stringify(i)})}let result=eval(raw);return void 0===result?(showMessage("EMPTY"),result):(showMessage(JSON.stringify(result)),result)}catch(e){console.error(e),showMessage("输入式有错","error")}}),OmniOS.onCommand("omni","clear",async()=>{consoleHistory.splice(0,consoleHistory.length),[].forEach.call(OmniOS.ui.querySelectorAll("div.message"),e=>{OmniOS.ui.removeChild(e)})}),OmniOS.onCommand("omni","commands",async()=>{var e=['<div class="caption">可用命令列表</div>'];OmniOS.status.forEach(n=>{var t=Handlers.get(n);if(t){e.push('<div class="caption">'+n+"</div>"),e.push('<div class="content">');for(let[n,i]of t)e.push('<span class="item">'+n+"</span>");e.push("</div>")}}),OmniOS.show(e.join("\n"))})},restoreHistory=()=>{History._available=!1;var e=OmniOS.status,n=OmniOS.location;consoleHistory.forEach(([e,n,t,i])=>{OmniOS.location=t,OmniOS.status=i,showMessage(e,n)}),OmniOS.status=e,OmniOS.location=n,History._available=!0};OmniOS.init=(e,n,t)=>{OmniOS.location=n||"/",OmniOS.status=t||["omni"],OmniOS.ui=e,initUI(e),mountOS(),restoreHistory(),History._available=!1,showMessage("Welcome To Omniverse!","welcome"),History._available=!0,e._input._input.focus()},OmniOS.run=e=>{runCommand(e)},OmniOS.show=(e,n)=>{showMessage(e,n)},OmniOS.onTab=e=>{Handlers.set("ontab",e)},OmniOS.onCommand=(e,n,t,i=!0)=>{var s=Handlers.get(e);s||(s=new Map,Handlers.set(e,s));var a=s.get(n);(!a||i)&&s.set(n,t)},OmniOS.offCommand=(e,n)=>{if(n){let t=Handlers.get(e);if(!t)return;t.delete(n)}else for(let t of Handlers)t[1].delete(e)},OmniOS.turnOn=(...e)=>{e.forEach(e=>{!e||(e=e.replace(/^[ 　\t]+|[ 　\t]+$/g,""),e&&(OmniOS.status.includes(e)||OmniOS.status.push(e)))});var n=prepareHint(!0);OmniOS.ui._input._hint.innerHTML=n.innerHTML},OmniOS.turnOff=(...e)=>{e.forEach(e=>{if(e&&(e=e.replace(/^[ 　\t]+|[ 　\t]+$/g,""),e)){var n=OmniOS.status.indexOf(e);n<0||OmniOS.status.splice(n,1)}});var n=prepareHint(!0);OmniOS.ui._input._hint.innerHTML=n.innerHTML},window.OmniOS=OmniOS})()},3257:function(e,n,t){},"522d":function(e,n,t){"use strict";t.r(n);var i=t("79c4");const s={class:"console-panel",ref:"console"};function a(e,n,t,a,r,o){return Object(i["q"])(),Object(i["d"])("div",s,null,512)}t("2268"),t("3257");const r=(e,n)=>{if(0===e.length)return n;if(1===e.length)return e[0];var t=1/0,i=e.length;e.forEach(e=>{var n=e.length;n<t&&(t=n)});var s=n;for(let a=n.length;a<=t;a++){let n=e[0].substring(0,a),t=!0;for(let s=1;s<i;s++)if(0!==e[s].indexOf(n)){t=!1;break}if(!t)break;s=n}return s},o=(e,n)=>{"/"===n.substring(0,1)&&(e=""),n=n.split(/[\\\/]+/);var t=n.pop();return"."!==t&&".."!==t||(t=""),n=n.filter(e=>!!e),e=e.split(/[\\\/]+/),e=e.filter(e=>!!e),n.forEach(n=>{"."!==n&&(".."===n?e.pop():e.push(n))}),0===e.length?["/",t]:["/"+e.join("/")+"/",t]},l=(e,n)=>{var t="/"===e.substring(0,1);return e=e.split(/[\\\/]+/),e.pop(),e=e.filter(e=>!!e),e.push(n),e=e.join("/"),t?"/"+e:e};var u;const p={omni:{exit:()=>{u?u.leave():OmniOS.show("系统加载失败！","error")},quit:()=>{p.omni.exit()},leave:()=>{p.omni.exit()},list:async()=>{var e=await Barn.getList(OmniOS.location);if(e){var n=['<div class="caption">目录：</div>','<div class="hint"><span class="foldername">文件夹名</span><span class="filecount">文件数</span></div>'];if(e.folders.length>0?e.folders.forEach(e=>{n.push(`<div class="content"><span class="foldername">${e[0]}</span><span class="filecount">${e[1]}</span></div>`)}):n.push('<div class="content">(无)</div>'),n.push('<div class="caption">文件：</div>'),n.push('<div class="hint"><span class="filename">文件名</span><span class="filetitle">标题</span><span class="author">作者</span><span class="date">更新日期</span><span class="status">状态</span></div>'),e.files.length>0)for(let a of e.files){var t,i,s=timeNormalize(new Date(a.publish));if(a.isLocal)t="本地",i="local";else{let e=await Barn.hasCache(Barn.DataGranary+"/"+a.sort+"/"+a.filename);e?(t="已缓存",i="cached"):(t="未缓存",i="nocache")}n.push(`<div class="content"><span class="filename">${a.filename}</span><span class="filetitle">${a.title}</span><span class="author">${a.author}</span><span class="date">${s}</span><span class="status ${i}">${t}</span></div>`)}else n.push('<div class="content">(无)</div>');OmniOS.show(n.join("\n"))}else OmniOS.show("EMPTY","warning")},open:async e=>{var n=e[0],[t,i]=o(OmniOS.location,n),s=await Barn.getList(t);if(s){var a=!0,r=!1;if(n=null,s.files.length>0&&s.files.some(e=>{if(e.filename===i)return e.isLocal?(r=!0,n=i):(n=t+i,n=n.replace(/^[\/\\]+/,"")),!0}),!n&&s.folders.length>0&&s.folders.some(e=>{if(e[0]===i)return n=t+i,a=!1,!0}),n)if(a)if(OmniOS.show("正在打开文件……","welcome"),await wait(300),u){u.saveOmni();let e={path:"/view",query:{}};r?e.query.l=n:e.query.f=n,console.log(e),u.$router.push(e)}else OmniOS.show("文件系统出错！","error");else OmniOS.show("正在打开文件夹……","welcome"),await wait(300),u?(u.saveOmni(),u.$router.push({path:"/category",query:{c:n}})):OmniOS.show("文件系统出错！","error");else OmniOS.show("路径指向对象为空","warning")}else OmniOS.show("EMPTY","warning")},find:async(e,n,t)=>{t=t.replace(/^find /,""),window.gtag&&gtag("event","search",{send_to:gaid,search_term:t});var i=await DataCenter.searchArticle(t);if(i instanceof Error)return console.error(i),void OmniOS.show(i.message,"error");if(i&&i.match)if(i.match.length){var s=['<div class="caption">搜索完成【用时'+(i.timeused||0)+"ms】：</div>"];i.match.forEach(e=>{console.log(e),s.push('<div class="content">'),s.push('<span class="filetitle">'+e.title+"</span>"),s.push('<span class="url">'+e.url+"</span>"),s.push('<span class="date">'+e.score+"</span>"),s.push("</div>")}),OmniOS.show(s.join("\n"))}else OmniOS.show("【用时"+(i.timeused||0)+"ms】无符合条件内容","warning");else OmniOS.show("无符合条件内容","warning")}}};var c={name:"OmniOS",data(){return{}},mounted(){u=this,callPageLoaded(),document.title=OmniOS.info.name+" ("+OmniOS.info.version+")",OmniOS.onTab(async(e,n)=>{if("enter"===e){let[e,t]=o(OmniOS.location,n),i=await Barn.getList(e);if(!i)return null;if(i=i.folders,!i)return null;let s=i.filter(e=>0===e[0].indexOf(t));return s=r(s.map(e=>e[0]),t),l(n,s)}if(["open","view"].includes(e)){let[e,t]=o(OmniOS.location,n),i=await Barn.getList(e);if(!i)return null;let s,a=i.folders;return i=i.files,i&&(s=i.filter(e=>0===e.filename.indexOf(t)),s=r(s.map(e=>e.filename),t),s!==t)?l(n,s):(s=a.filter(e=>0===e[0].indexOf(t)),s=r(s.map(e=>e[0]),t),l(n,s))}return n});for(let e in p){let n=p[e];for(let t in n)OmniOS.onCommand(e,t,n[t])}OmniOS.init(this.$refs.console,sessionStorage.get("omniLocation",null),sessionStorage.get("omniStatus",null))},unmounted(){u=null},methods:{saveOmni:()=>{sessionStorage.set("omniLocation",OmniOS.location),sessionStorage.set("omniStatus",OmniOS.status)},leave:async function(){this.saveOmni(),OmniOS.show("后会有期"),await wait(300),this.$router.push({path:"/"})}}};t("0638");c.render=a;n["default"]=c},"932b":function(e,n,t){}}]);
//# sourceMappingURL=chunk-2c495706.js.map