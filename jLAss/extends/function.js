Function.is=t=>t instanceof Function,global.AsyncFunction=(async()=>{}).constructor,AsyncFunction.is=t=>t instanceof AsyncFunction;const promisify=t=>{if(!(t instanceof Function))return null;if(t._promised)return t;var i=(...e)=>new Promise((u,n)=>{try{t(...e,u,n)}catch(r){n(r)}});return i._promised=!0,i._original=t,i};promisify.withTimeout=t=>{if(!(t instanceof Function))return null;if(t._promised)return t;var i=(...e)=>{var u,n=null,r=-1,a=null,c,o=new Promise((l,s)=>{c=s;var m=(...f)=>{a&&clearTimeout(a),a=null,l(...f)};try{u=new Date().getTime(),t(...e,m,c)}catch(f){c(f)}});return o.timeout=(...l)=>{if(l[0]instanceof Number&&(l[0]=l[0]*1),isNaN(l[0]))l[0]instanceof Function&&(n=l[0]);else if(l[1]instanceof Function&&(n=l[1]),r=l[0]>=0?l[0]:-1,r<0&&!!a)clearTimeout(a),a=null;else if(r>=0){a&&clearTimeout(a);let s=new Date().getTime();a=setTimeout(()=>{n&&n(),c(new Error("Timeout!"))},r-(s-u))}return o},o};return i._promised=!0,i._original=t,i};const fun_prep=(t,...i)=>{var e,u,n;return i[0]instanceof Array?(e=i[0],u=i[1],n=i[2],n||(n=u,u=null)):(n=i.pop(),i[i.length-1]instanceof Function?u=null:u=i.pop(),e=i),t?e=e.map(r=>promisify(r)):e=e.map(r=>r._original||r),[e,u,n]};promisify.s=promisify.serial=promisify(async(...t)=>{var[i,e,u]=fun_prep(!0,...t);for(let n of i){let r;e==null?r=await n():r=await n(e),r!==void 0&&(e=r)}u(e)}),promisify.p=promisify.parallel=promisify(async(...t)=>{var[i,e,u]=fun_prep(!0,...t),n=i.length,r=[];i.forEach(async(a,c)=>{var o;e==null?o=await a():o=await a(e),r[c]=o,n--,!(n>0)&&u(r)})}),promisify.a=promisify.any=promisify(async(...t)=>{var[i,e,u]=fun_prep(!0,...t);i.forEach(async(n,r)=>{var a;e==null?a=await n():a=await n(e),u(a)})}),global.promisify=Function.promisify=promisify,global.oncilize=Function.oncilize=t=>{var i=!1,e,u;return t._promised?u=(...n)=>new Promise(async(r,a)=>{if(i){await waitLoop(),r(e);return}i=!0,e=await t(...n),r(e)}):u=(...n)=>(i||(i=!0,e=t(...n)),e),u.refresh=()=>i=!1,u},global.pumplize=Function.pumplize=(t,i,e=!0)=>{var u=[],n=null,r=100,a=null,c=()=>{n=null;var l=u;u=[],i(e?t(...l):t(l))},o=(...l)=>{n===null&&(n=Date.now(),a&&clearTimeout(a),a=setTimeout(c,r));var s=Date.now();s-n>=r?c():e?u=l:u.push(l)};return o.dump=()=>{a&&clearTimeout(a),a=null,c()},o.timeout=l=>{if(isNaN(l)||(r=l,n===null))return o;var s=Date.now();return a&&clearTimeout(a),a=setTimeout(c,r+n-s),o},o};
