const CacheName="schwarzschild",CacheUrl=["/","/index.html","/404.png","/favicon.ico","/webapp.json"],channel=new BroadcastChannel("service-messages"),cacheResource=async(e,t)=>{var a=await caches.open(CacheName);await a.put(e,t)};self.addEventListener("install",e=>{console.log("[:>  SW Installed <:]"),e.waitUntil(async()=>{await caches.delete(CacheName);var t=await caches.open(CacheName);await t.addAll(CacheUrl)})}),self.addEventListener("fetch",e=>{if(e.request.method==="GET"&&!!e.request.url.match(/^https?:\/\//i)&&!(e.request.url.indexOf(self.location.origin)<0)){var t=e.request.url.replace(self.location.origin,""),a=t.split("/"),c=a[a.length-1];a.pop(),a=a.join("/"),c!=="priory.js"&&(c.match(/(mp3|mp4)$/i)||!!a.match(/^[\/\\]*api[\/\\]/i)||!!a.match(/^[\/\\]*api$/i)||(caches.open(CacheName).then(r=>r.add(t)),e.respondWith(caches.match(e.request).then(r=>{if(r)return r;var s=fetch(e.request).then(n=>(cacheResource(e.request,n.clone()).then(()=>{channel.postMessage({event:"cacheUpdated",url:e.request.url,timestamp:Date.now()})}),n)).catch(n=>{console.error("Fetch Failed: "+e.request.url),console.error(n)});return s}))))}});
