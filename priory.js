const CacheName="schwarzschild",CacheUrl=["/","/index.html","/404.png","/favicon.ico","/webapp.json"];var CacheAfterLoad=!0;const prepare=async()=>{var e=await caches.keys();e.length>0&&e.forEach(async r=>{var a=await caches.open(r),t=await a.keys();t.forEach(c=>{var n=c.url;CacheUrl.includes(n)||CacheUrl.push(n)})})};CacheAfterLoad||prepare();const cacheResource=async(e,r)=>{var a=await caches.open(CacheName);await a.put(e,r)};self.addEventListener("install",e=>{console.log("[:>  SW Installed <:]"),e.waitUntil(async()=>{await caches.delete(CacheName),console.log("[:>  SW removed cache ("+CacheName+") <:]");var r=await caches.open(CacheName);await r.addAll(CacheUrl)})}),self.addEventListener("fetch",e=>{if(e.request.method==="GET"&&!!e.request.url.match(/^https?:\/\//i)&&!(e.request.url.indexOf(self.location.origin)<0)){var r=e.request.url.replace(self.location.origin,""),a=r.split("/"),t=a[a.length-1];a.pop(),a=a.join("/"),t!=="priory.js"&&(a.match(/\bapi\b/i)&&t.match(/\.(json|mu|md)/i)||t.match(/(mp3|mp4|wav|avi|rm|rmvb)$/i)||t.match(/hot-update\.js/i)||!!a.match(/^[\/\\]*api[\/\\]/i)||!!a.match(/^[\/\\]*api$/i)||(CacheAfterLoad?caches.open(CacheName).then(c=>{c.add(r)}):CacheUrl.includes(r)||caches.open(CacheName).then(c=>{c.add(r),CacheUrl.push(r)}),e.respondWith(caches.match(e.request).then(c=>{if(c)return c;var n=fetch(e.request).then(i=>(cacheResource(e.request,i.clone()).then(()=>{console.log("CacheUpaded: "+e.request.url)}),i)).catch(i=>{console.error("Fetch Failed: "+e.request.url),console.error(i)});return n}))))}});
