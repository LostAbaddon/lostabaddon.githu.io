const CacheName="schwarzschild",CacheUrl=["/","/index.html","/404.png","/favicon.ico","/webapp.json"];var CacheAfterLoad=!0;const prepare=async()=>{var e=await caches.keys();e.length>0&&e.forEach(async a=>{var t=await caches.open(a),r=await t.keys();r.forEach(c=>{var s=c.url;CacheUrl.includes(s)||CacheUrl.push(s)})})};CacheAfterLoad||prepare();const cacheResource=async(e,a)=>{var t=await caches.open(CacheName);await t.put(e,a)};self.addEventListener("install",e=>{console.log("[:>  SW Installed <:]"),e.waitUntil(async()=>{await caches.delete(CacheName),console.log("[:>  SW removed cache ("+CacheName+") <:]");var a=await caches.open(CacheName);await a.addAll(CacheUrl)})}),self.addEventListener("fetch",e=>{if(e.request.method==="GET"){var a=e.request.url.replace(self.location.origin,""),t=a.split("/"),r=t[t.length-1];if(t.pop(),t=t.join("/"),filetype=r.match(/\.([^\\\/\?]+)(\?[^\\\/]+)?$/),filetype&&(filetype=filetype[1].toLowerCase()),!!t.match(/^(\/|\\|https?|ftps?)/i)&&!r.match(/hot-update\.js/i)&&!r.match(/priory\.js/i)&&!["mp3","mp4","wav","avi","rm","rmvb","ogg"].includes(filetype)){if(t.match(/^(ht|f)tps?/i)){if(!filetype||!["md","mu","txt","doc","docx","xls","xlsx","ppt","pptx","pdf","ps","jpg","jpeg","gif","png","webp","ico"].includes(filetype))return}else if(["json","mu","md"].includes(filetype))return;a.match(/^\/*#\/+|^\/*#$/)||caches.open(CacheName).then(c=>c.add(a)),CacheAfterLoad?caches.open(CacheName).then(c=>{c.add(a)}):CacheUrl.includes(a)||caches.open(CacheName).then(c=>{c.add(a),CacheUrl.push(a)}),e.respondWith(caches.match(e.request).then(c=>{if(c)return c;var s=fetch(e.request).then(i=>(cacheResource(e.request,i.clone()).then(()=>{console.log("CacheUpaded: "+e.request.url)}),i)).catch(i=>{console.error("Fetch Failed: "+e.request.url),console.error(i)});return s}))}}});
