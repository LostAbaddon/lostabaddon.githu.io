const CacheName="schwarzschild",CacheUrl=["/","/index.html","/404.png","/favicon.ico","/webapp.json"],prepare=async()=>{var e=await caches.keys();e.length>0&&e.forEach(async r=>{var a=await caches.open(r),c=await a.keys();c.forEach(t=>{var n=t.url;CacheUrl.includes(n)||CacheUrl.push(n)})})},cacheResource=async(e,r)=>{var a=await caches.open(CacheName);await a.put(e,r)};self.addEventListener("install",e=>{console.log("[:>  SW Installed <:]"),e.waitUntil(async()=>{await caches.delete(CacheName);var r=await caches.open(CacheName);await r.addAll(CacheUrl)})}),self.addEventListener("fetch",e=>{if(e.request.method==="GET"&&!!e.request.url.match(/^https?:\/\//i)&&!(e.request.url.indexOf(self.location.origin)<0)){var r=e.request.url.replace(self.location.origin,""),a=r.split("/"),c=a[a.length-1];a.pop(),a=a.join("/"),c!=="priory.js"&&(c.match(/(mp3|mp4|wav|avi|rm|rmvb)$/i)||c.match(/hot-update\.json/i)||!!a.match(/^[\/\\]*api[\/\\]/i)||!!a.match(/^[\/\\]*api$/i)||(CacheUrl.includes(r)||caches.open(CacheName).then(t=>{t.add(r),CacheUrl.push(r)}),e.respondWith(caches.match(e.request).then(t=>{if(t)return t;var n=fetch(e.request).then(s=>(cacheResource(e.request,s.clone()).then(()=>{console.log("CacheUpaded: "+e.request.url)}),s)).catch(s=>{console.error("Fetch Failed: "+e.request.url),console.error(s)});return n}))))}});
