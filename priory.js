const CacheName="schwarzschild",CacheUrl=["/","/index.html","/404.png","/favicon.ico","/webapp.json"];var CacheAfterLoad=!0;const prepare=async()=>{var a=await caches.keys();a.length>0&&a.forEach(async e=>{var t=await caches.open(e),s=await t.keys();s.forEach(c=>{var r=c.url;CacheUrl.includes(r)||CacheUrl.push(r)})})};CacheAfterLoad||prepare();const cacheResource=async(a,e)=>{var t=await caches.open(CacheName);await t.put(a,e)};self.addEventListener("install",a=>{console.log("[:>  SW Installed <:]"),self.skipWaiting(),a.waitUntil(async()=>{await caches.delete(CacheName),console.log("[:>  SW removed cache ("+CacheName+") <:]");var e=await caches.open(CacheName);await e.addAll(CacheUrl)})}),self.addEventListener("activate",async a=>{console.log("[:>  SW Activated <:]"),await caches.delete(CacheName),console.log("[:>  SW removed cache ("+CacheName+") <:]");var e=await caches.open(CacheName);await e.addAll(CacheUrl),globalThis.BroadcastChannel&&new BroadcastChannel("updater").postMessage(!0)}),self.addEventListener("fetch",a=>{if(a.request.method==="GET"){var e=a.request.url.replace(self.location.origin,"");e=e.split(/[\?\#]/)[0];var t=e.split("/"),s=t[t.length-1];if(t.pop(),t=t.join("/"),t=t||"/",filetype=s.match(/\.([^\\\/\?]+)(\?[^\\\/]+)?$/),filetype?filetype=filetype[1].toLowerCase():filetype="",!!t.match(/^(\/|\\|https?|ftps?)/i)&&!s.match(/hot-update\.js/i)&&!s.match(/priory\.js/i)){if(t.match(/^(ht|f)tps?/i)){if(!filetype||!["md","mu","txt","doc","docx","xls","xlsx","ppt","pptx","pdf","ps","jpg","jpeg","gif","png","webp","ico"].includes(filetype))return}else if(["json","mu","md"].includes(filetype))return;CacheAfterLoad?caches.open(CacheName).then(c=>{c.add(e)}):(e.match(/^\/*#\/+|^\/*#$/)||caches.open(CacheName).then(c=>c.add(e)),CacheUrl.includes(e)||caches.open(CacheName).then(c=>{c.add(e),CacheUrl.push(e)})),a.respondWith(caches.match(a.request).then(c=>{if(c)return c;var r=fetch(a.request).then(n=>(cacheResource(a.request,n.clone()).then(()=>{console.log("CacheUpaded: "+a.request.url)}),n)).catch(n=>{console.error("Fetch Failed: "+a.request.url),console.error(n)});return r}))}}});
