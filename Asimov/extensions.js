const generateRandomKey=MarkUp.generateRandomKey;MarkUp.addExtension({name:"LaTeX",parse:(e,g,d)=>{d[MarkUp.SymHidden]=d[MarkUp.SymHidden]||{};var r=!1;return e=e.replace(/(\\+)\$/g,(u,s)=>{var a=Math.floor(s.length/2),t="",f="%"+MarkUp.PreserveWords["\\"]+"%";for(let n=0;n<a;n++)t+=f;if(a*2!==s.length){let n=MarkUp.PreserveWords.$;t+="%"+n+"%"}else t+="$";return r=!0,t}),e=e.replace(/\$([\w\W]+?)\$/g,(u,s)=>{if(u.indexOf("$$")>=0)return u;var a="latex-"+generateRandomKey();return d[MarkUp.SymHidden][a]='<span class="latex inline">$'+s+"$</span>",r=!0,"%"+a+"%"}),[e,r]}},0,-1),MarkUp.addExtension({name:"FontAwesome",parse:(e,g,d)=>{var r=!1;return e=e.replace(/:([\w\-\.]+?):/g,(u,s,a)=>(s=s.trim(),r=!0,'<i class="fas far fa-'+s+'"></i>')),[e,r]}},0,3),MarkUp.addExtension({name:"HyperLinks",parse:(e,g,d)=>{g.links=g.links||[];var r=!1;return e=e.replace(/([!@#]?)\[([\w %'"\*_\^\|~\-\.\+=·,;:\?!\\\/&\u0800-\uffff]*?)\] *\((\@?[\w\W]*?)\)/g,(u,s,a,t,f)=>{if(t=t.trim(),t.length===0||d[a])return u;if(s===""){g.links.push([a,t]);let n=t.substr(0,1),o=n==="@",p=MarkUp.parseLine(a,g,3,d),i="link-"+generateRandomKey(),l='<a href="';return o?l=l+"#"+t.substr(1,t.length)+'">':t.indexOf("@")>1?l=l+"mailto:"+t+'">':n==="."||n==="\\"||n==="/"||n==="#"?l=l+t+'">':l=l+t+'" target="_blank">',l=l+p+"</a>",d[i]=l,r=!0,"%"+i+"%"}return u}),[e,r]}},0,3),MarkUp.addExtension({name:"AnchorAndTerm",parse:(e,g,d)=>{var r=!1;return e=e.replace(/\[([\w %'"\-\.\+=,;:\?!\\\/&\u0800-\uffff]*?)\] *\{([\w \-\.]+?)\}/g,(u,s,a,t)=>{if(a=a.trim(),s=s.trim(),a.length===0||s.length===0||d[s])return u;var f;if(s=MarkUp.parseLine(s,g,3,d),g.refs[a]){f="term-"+generateRandomKey(),g.termList=g.termList||[],g.termList.push([a,s]),g.termList[a]=s;let n='<a class="terminology" name="'+a+'" href="#ref-'+a+'"><strong>'+s+"</strong></a>";d[f]=n}else{f="anchor-"+generateRandomKey();let n='<a name="'+a+'">'+s+"</a>";d[f]=n}return r=!0,"%"+f+"%"}),[e,r]}},0,3),MarkUp.addExtension({name:"Code",parse:(e,g,d)=>{d[MarkUp.SymHidden]=d[MarkUp.SymHidden]||{};var r=!1;return e=e.replace(/`([\w\W]+?)`/g,(u,s)=>{if(u.indexOf("``")>=0)return u;var a="code-"+generateRandomKey();return d[MarkUp.SymHidden][a]="<code>"+s+"</code>",r=!0,"%"+a+"%"}),[e,r]}}),MarkUp.addExtension({name:"BoldAndItalic",parse:(e,g,d)=>{var r=[];if(e.replace(/\*+/g,(t,f)=>{r.push([f,t.length])}),r.length<2)return[e,!1];var u=(t,f,n)=>{var o=e.substring(t,f+(n?2:1)),p;n?p=o.substring(2,o.length-2):p=o.substring(1,o.length-1);var i=(n?"strong":"em")+"-"+generateRandomKey();p=MarkUp.parseLine(p,g,5,d),n?d[i]="<strong>"+p+"</strong>":d[i]="<em>"+p+"</em>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"SubAndUnderline",parse:(e,g,d)=>{var r=[];if(e.replace(/_+/g,(t,f)=>{r.push([f,t.length])}),r.length<2)return[e,!1];var u=(t,f,n)=>{var o=e.substring(t,f+(n?2:1)),p;n?p=o.substring(2,o.length-2):p=o.substring(1,o.length-1);var i=(n?"underline":"sub")+"-"+generateRandomKey();p=MarkUp.parseLine(p,g,5,d),n?d[i]="<u>"+p+"</u>":d[i]="<sub>"+p+"</sub>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"WavyAndDelete",parse:(e,g,d)=>{var r=[];if(e.replace(/~+/g,(t,f)=>{r.push([f,t.length])}),r.length<2)return[e,!1];var u=(t,f,n)=>{var o=e.substring(t,f+(n?2:1)),p;n?p=o.substring(2,o.length-2):p=o.substring(1,o.length-1);var i=(n?"delete":"wavy")+"-"+generateRandomKey();p=MarkUp.parseLine(p,g,5,d),n?d[i]="<del>"+p+"</del>":d[i]='<span class="text-wavy">'+p+"</span>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"SupAndLarger",parse:(e,g,d)=>{var r=(s,a,t)=>{var f=e.substring(s,a+t),n=f.substring(t,f.length-t),o="larger-"+t+"-"+generateRandomKey();n=MarkUp.parseLine(n,g,5,d),t<=1?d[o]="<sup>"+n+"</sup>":d[o]='<span class="text-larger level-'+(t-1)+'">'+n+"</span>",o="%"+o+"%",e=e.replace(f,o)},u=!1;return e.replace(/(\^+)([\w\W]+?)(\^+)/,(s,a,t,f,n)=>{var o=t.match(/(\\*)\[/);if(o){let p=o[1].length;if(p>>1<<1===p)return s}return a=a.length,f=f.length,a>f?r(n+a-f,n+s.length-f,f):r(n,n+s.length-f,a),u=!0,s}),[e,u]}}),MarkUp.addExtension({name:"Color",parse:(e,g,d)=>{var r=!1;return e=e.replace(/\[(\w+)\]([\w\W]+?)\[\/\]/,(u,s,a,t)=>{if(a.length===0)return u;a=MarkUp.parseLine(a,g,5,d);var f="color-"+generateRandomKey();return d[f]='<span class="color-'+s+'">'+a+"</span>",r=!0,"%"+f+"%"}),[e,r]}},0,6),MarkUp.addExtension({name:"FootnoteAndEndnote",parse:(e,g,d)=>{var r=!1;return e=e.replace(/(\[([\w %'"\-\.\+=,;:\?!\\\/&\u0800-\uffff]*?)\])?\[([\^:])([\w \-\.]+?)\]/g,(u,s,a="",t,f)=>{if(f=f.trim(),f.length===0||!g.refs[f])return u;var n='<a class="notemark" type="';if(t==="^"?n+='endnote" href="#endnote-'+f:n+="footnote",n+='" name="'+f+'">',a&&(n=n+MarkUp.parseLine(a,g,6,d)),n+="<sup>",t==="^"){g.endnotes=g.endnotes||[];let p=g.endnotes.indexOf(f);p<0&&(p=g.endnotes.length,g.endnotes.push(f)),p++,n+="("+p+")"}else{g.footnotes=g.footnotes||[];let p=g.footnotes.indexOf(f);p<0&&(p=g.footnotes.length,g.footnotes.push(f)),n+="[%%FN-"+p+"%%]"}n+="</sup></a>";var o="notemark-"+generateRandomKey();return d[o]=n,"%"+o+"%"}),[e,r]}},0,6),MarkUp.addExtension({name:"Images",parse:(e,g,d)=>{var r=!1;return e=e.replace(/([!@#])\[([^\n]*?)\] *\((\@?[\w\W]*?)\)/g,(u,s,a,t,f)=>{if(t=t.trim(),t.length===0)return u;var n=t.match(/[ 　\t]+"(left|right)"/);n&&(t=t.replace(n[0],""),n=n[1]);var o="image";s==="@"?o="video":s==="#"&&(o="audio"),g[o]=g[o]||[],g[o].push([a,t]);var p='<div class="resource '+o;n&&(p+=" float-"+n),p+='">',p+="<figure>",s==="!"?p+='<img src="'+t+'">':s==="@"?p+='<video src="'+t+'" controls>\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 <code>video</code> \u6807\u7B7E.</video>':s==="#"&&(p+='<audio src="'+t+'" controls>\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 <code>audio</code> \u6807\u7B7E.</audio>'),p+="</figure>",p+="<figcaption>"+a+"</figcaption>",p+="</div>";var i=o+"-"+generateRandomKey();return d[i]=p,r=!0,"%"+i+"%"}),[e,r]}},0,7),MarkUp.addExtension({name:"InlineLinks",parse:(e,g,d)=>{var r=!1;return g.mainParser?(e=e.replace(/https?:\/\/[\w\-\+=\.;\?\\\/%]+/gi,(u,s)=>{g.links.push([u,u]);var a='<a href="'+u+'" target="_blank">'+u+"</a>",t="link-"+generateRandomKey();return d[t]=a,r=!0,"%"+t+"%"}),[e,r]):[e,r]}},0,8);
