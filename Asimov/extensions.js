const generateRandomKey=MarkUp.generateRandomKey;MarkUp.addExtension({name:"LaTeX",parse:(e,p,g)=>{g[MarkUp.SymHidden]=g[MarkUp.SymHidden]||{};var r=!1;return e=e.replace(/(\\+)\$/g,(u,s)=>{var a=Math.floor(s.length/2),t="",d="%"+MarkUp.PreserveWords["\\"]+"%";for(let n=0;n<a;n++)t+=d;if(a*2!==s.length){let n=MarkUp.PreserveWords.$;t+="%"+n+"%"}else t+="$";return r=!0,t}),e=e.replace(/\$([\w\W]+?)\$/g,(u,s)=>{if(u.indexOf("$$")>=0)return u;var a="latex-"+generateRandomKey();return g[MarkUp.SymHidden][a]='<span class="latex inline">$'+s+"$</span>",r=!0,"%"+a+"%"}),[e,r]}},0,-1),MarkUp.addExtension({name:"FontAwesome",parse:(e,p,g)=>{var r=!1;return e=e.replace(/:([\w\-\.]+?):/g,(u,s,a)=>(s=s.trim(),r=!0,'<i class="fas far fa-'+s+'"></i>')),[e,r]}},0,3),MarkUp.addExtension({name:"HyperLinks",parse:(e,p,g)=>{p.links=p.links||[];var r=!1;return e=e.replace(/([!@#]?)\[([\w %'"\*_\^\|~\-\.\+=·,;:\?!\\\/&\u0800-\uffff]*?)\] *\((\@?[\w\W]*?)\)/g,(u,s,a,t,d)=>{if(t=t.trim(),t.length===0||g[a])return u;if(s===""){p.links.push([a,t]);let n=t.substr(0,1),o=n==="@",f=MarkUp.parseLine(a,p,3,g),i="link-"+generateRandomKey(),l='<a href="';return o?l=l+"#"+t.substr(1,t.length)+'">':t.indexOf("@")>1?l=l+"mailto:"+t+'">':n==="."||n==="\\"||n==="/"||n==="#"?l=l+t+'">':l=l+t+'" target="_blank">',l=l+f+"</a>",g[i]=l,r=!0,"%"+i+"%"}return u}),[e,r]}},0,3),MarkUp.addExtension({name:"AnchorAndTerm",parse:(e,p,g)=>{var r=!1;return e=e.replace(/\[([\w %'"\-\.\+=,;:\?!\\\/&\u0800-\uffff]*?)\] *\{([\w \-\.]+?)\}/g,(u,s,a,t)=>{if(a=a.trim(),s=s.trim(),a.length===0||s.length===0||g[s])return u;var d=MarkUp.parseLine(s,p,3,g),n;if(p.refs[a]){n="term-"+generateRandomKey(),p.termList=p.termList||[],p.termList.push([a,s]),p.termList[a]=s;let o='<a class="terminology" name="'+a+'" href="#ref-'+a+'"><strong>'+s+"</strong></a>";g[n]=o}else{n="anchor-"+generateRandomKey();let o='<a name="'+a+'">'+s+"</a>";g[n]=o}return r=!0,"%"+n+"%"}),[e,r]}},0,3),MarkUp.addExtension({name:"Code",parse:(e,p,g)=>{g[MarkUp.SymHidden]=g[MarkUp.SymHidden]||{};var r=!1;return e=e.replace(/`([\w\W]+?)`/g,(u,s)=>{if(u.indexOf("``")>=0)return u;var a="code-"+generateRandomKey();return g[MarkUp.SymHidden][a]="<code>"+s+"</code>",r=!0,"%"+a+"%"}),[e,r]}}),MarkUp.addExtension({name:"BoldAndItalic",parse:(e,p,g)=>{var r=[];if(e.replace(/\*+/g,(t,d)=>{r.push([d,t.length])}),r.length<2)return[e,!1];var u=(t,d,n)=>{var o=e.substring(t,d+(n?2:1)),f;n?f=o.substring(2,o.length-2):f=o.substring(1,o.length-1);var i=(n?"strong":"em")+"-"+generateRandomKey();f=MarkUp.parseLine(f,p,5,g),n?g[i]="<strong>"+f+"</strong>":g[i]="<em>"+f+"</em>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"SubAndUnderline",parse:(e,p,g)=>{var r=[];if(e.replace(/_+/g,(t,d)=>{r.push([d,t.length])}),r.length<2)return[e,!1];var u=(t,d,n)=>{var o=e.substring(t,d+(n?2:1)),f;n?f=o.substring(2,o.length-2):f=o.substring(1,o.length-1);var i=(n?"underline":"sub")+"-"+generateRandomKey();f=MarkUp.parseLine(f,p,5,g),n?g[i]="<u>"+f+"</u>":g[i]="<sub>"+f+"</sub>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"WavyAndDelete",parse:(e,p,g)=>{var r=[];if(e.replace(/~+/g,(t,d)=>{r.push([d,t.length])}),r.length<2)return[e,!1];var u=(t,d,n)=>{var o=e.substring(t,d+(n?2:1)),f;n?f=o.substring(2,o.length-2):f=o.substring(1,o.length-1);var i=(n?"delete":"wavy")+"-"+generateRandomKey();f=MarkUp.parseLine(f,p,5,g),n?g[i]="<del>"+f+"</del>":g[i]='<span class="text-wavy">'+f+"</span>",i="%"+i+"%",e=e.replace(o,i)},s=r[0][1],a=r[1][1];if(s<3){if(s===a)return u(r[0][0],r[1][0],s===2),[e,!0];if(a<3){let t=r[2];return t?(t=t[1],t<3?a===t?(u(r[1][0],r[2][0],a===2),[e,!0]):s===t?(u(r[0][0],r[2][0],s===2),[e,!0]):[e,!1]:(u(r[1][0],r[2][0],a===2),[e,!0])):s>a?(u(r[0][0]+1,r[1][0],!1),[e,!0]):(u(r[0][0],r[1][0],!1),[e,!0])}else return u(r[0][0],r[1][0],s===2),[e,!0]}else return a<3?a===1?(u(r[0][0]+s-1,r[1][0],!1),[e,!0]):(u(r[0][0]+s-2,r[1][0],!0),[e,!0]):(u(r[0][0],r[1][0]+a-2,!0),[e,!0]);return[e,!1]}}),MarkUp.addExtension({name:"SupAndLarger",parse:(e,p,g)=>{var r=(s,a,t)=>{var d=e.substring(s,a+t),n=d.substring(t,d.length-t),o="larger-"+t+"-"+generateRandomKey();n=MarkUp.parseLine(n,p,5,g),t<=1?g[o]="<sup>"+n+"</sup>":g[o]='<span class="text-larger level-'+(t-1)+'">'+n+"</span>",o="%"+o+"%",e=e.replace(d,o)},u=!1;return e.replace(/(\^+)([\w\W]+?)(\^+)/,(s,a,t,d,n)=>{var o=t.match(/(\\*)\[/);if(o){let f=o[1].length;if(f>>1<<1===f)return s}return a=a.length,d=d.length,a>d?r(n+a-d,n+s.length-d,d):r(n,n+s.length-d,a),u=!0,s}),[e,u]}}),MarkUp.addExtension({name:"Color",parse:(e,p,g)=>{var r=!1;return e=e.replace(/\[(\w+)\]([\w\W]+?)\[\/\]/,(u,s,a,t)=>{if(a.length===0)return u;a=MarkUp.parseLine(a,p,5,g);var d="color-"+generateRandomKey();return g[d]='<span class="color-'+s+'">'+a+"</span>",r=!0,"%"+d+"%"}),[e,r]}},0,6),MarkUp.addExtension({name:"FootnoteAndEndnote",parse:(e,p,g)=>{var r=!1;return e=e.replace(/(\[([\w %'"\-\.\+=,;:\?!\\\/&\u0800-\uffff]*?)\])?\[([\^:])([\w \-\.]+?)\]/g,(u,s,a="",t,d)=>{if(d=d.trim(),d.length===0||!p.refs[d])return u;var n='<a class="notemark" type="';if(t==="^"?n+='endnote" href="#endnote-'+d:n+="footnote",n+='" name="'+d+'">',a&&(n=n+MarkUp.parseLine(a,p,6,g)),n+="<sup>",t==="^"){p.endnotes=p.endnotes||[];let f=p.endnotes.indexOf(d);f<0&&(f=p.endnotes.length,p.endnotes.push(d)),f++,n+="("+f+")"}else{p.footnotes=p.footnotes||[];let f=p.footnotes.indexOf(d);f<0&&(f=p.footnotes.length,p.footnotes.push(d)),n+="[%%FN-"+f+"%%]"}n+="</sup></a>";var o="notemark-"+generateRandomKey();return g[o]=n,"%"+o+"%"}),[e,r]}},0,6),MarkUp.addExtension({name:"Images",parse:(e,p,g)=>{var r=!1;return e=e.replace(/([!@#])\[([^\n]*?)\] *\((\@?[\w\W]*?)\)/g,(u,s,a,t,d)=>{if(t=t.trim(),t.length===0)return u;var n=t.match(/[ 　\t]+"(left|right)"/);n&&(t=t.replace(n[0],""),n=n[1]);var o="image";s==="@"?o="video":s==="#"&&(o="audio"),p[o]=p[o]||[],p[o].push([a,t]);var f='<div class="resource '+o;n&&(f+=" float-"+n),f+='">',f+="<figure>",s==="!"?f+='<img src="'+t+'">':s==="@"?f+='<video src="'+t+'" controls>\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 <code>video</code> \u6807\u7B7E.</video>':s==="#"&&(f+='<audio src="'+t+'" controls>\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 <code>audio</code> \u6807\u7B7E.</audio>'),f+="</figure>",f+="<figcaption>"+a+"</figcaption>",f+="</div>";var i=o+"-"+generateRandomKey();return g[i]=f,r=!0,"%"+i+"%"}),[e,r]}},0,7),MarkUp.addExtension({name:"InlineLinks",parse:(e,p,g)=>{var r=!1;return p.mainParser?(e=e.replace(/https?:\/\/[\w\-\+=\.;\?\\\/%]+/gi,(u,s)=>{p.links.push([u,u]);var a='<a href="'+u+'" target="_blank">'+u+"</a>",t="link-"+generateRandomKey();return g[t]=a,r=!0,"%"+t+"%"}),[e,r]):[e,r]}},0,8);
