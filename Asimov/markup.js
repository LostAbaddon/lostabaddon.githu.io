(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","UPDATE","PUBLISH","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(e,t=1){return t<1||e<=t?1:e*MathTools.factorial(e-t,t)},permutate(e,t){return e<=1?1:t<=1?e:t>e?1:(e-t+1)*MathTools.permutate(e,t-1)},combinate(e,t){return e<=1||t<=0||t>=e?1:(e-t+1)/t*MathTools.combinate(e,t-1)},round(e,t=0){var r=10**t;return e*=r,e=Math.round(e),e/r},floor(e,t=0){var r=10**t;return e*=r,e=Math.floor(e),e/r},ceil(e,t=0){var r=10**t;return e*=r,e=Math.ceil(e),e/r}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(e=>ReversePreserveWords[PreserveWords[e].toLowerCase()]=e),ReversePreserveWords.$="&#36;",MetaWords.forEach((e,t)=>MetaWords[t]=e.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(e=8)=>{var t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10)+"";return t};MarkUp.addExtension=(e,t=0,r=5)=>{if(t===0){let s=LineRender._indexes_;s||(s=[],LineRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,l)=>n-l)),s=LineRender[r],s||(s=[],LineRender[r]=s),s.push(e)}else if(t===1){let s=BlockRender._indexes_;s||(s=[],BlockRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,l)=>n-l)),s=BlockRender[r],s||(s=[],BlockRender[r]=s),s.push(e)}else if(t===2){let s=FinalRender._indexes_;s||(s=[],FinalRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,l)=>n-l)),s=FinalRender[r],s||(s=[],FinalRender[r]=s),s.push(e)}};const prepare=e=>(e=`
`+e+`
`,e=e.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(t,r)=>{var s=r.replace(/　/g,"  ").length;return s<4?`
`:t}),e=e.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(t,r,s)=>r+`
`+s),MetaWords.forEach(t=>{var r=new RegExp("([\\w\\W]? *)\\["+t+"\\]( *[\\w\\W]?)","gi");e=e.replace(r,(s,n,l)=>n==="]"||l==="["||l==="("?s:n+"%"+t+"%"+l)}),e),regularize=e=>(e=e.replace(/^\n+|\n+$/gi,""),e=e.replace(/\n{3,}/gi,`


`),e),parseLine=(e,t,r=-Infinity,s)=>{var n=LineRender._indexes_;if(!n)return"";var l=!s;return s=s||{},n.some(a=>{if(r>a||a>=0)return!0;for(var i=LineRender[a],u=!0;u;)u=!1,i.forEach(p=>{var f;[e,f]=p.parse(e,t,s),f&&(u=!0)})}),e=convertPreserves(e),n.forEach(a=>{if(!(r>a)&&!(a<0))for(var i=LineRender[a],u=!0;u;)u=!1,i.forEach(p=>{var f;[e,f]=p.parse(e,t,s),f&&(u=!0)})}),l&&(e=restorePreserves(e,s)),e},parseSection=(e,t,r=0,s)=>{t.parseLevel++;var n=[],l=!1;s||(l=!0,s={});var a=[];n=e.split(`
`),n.forEach((p,f)=>{var h=p.match(/^[ 　\t]*$/);if(p.length===0){a.push([f,1,0,0,0,0,0,0]);return}if(p.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){p.match(/^\-+$|^=+$/)?a.push([f,0,2,0,0,0,0,0]):p.match(/^~+$/)?a.push([f,0,2,0,0,1,0,0]):a.push([f,0,1,0,0,0,0,0]);return}if(h=p.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([f,0,0,0,0,2,0,0,h[1]]):a.push([f,0,0,0,0,1,0,0,h[1]]);return}if(h=p.match(/^\${2}[ 　\t]*$/),h){h[2]?a.push([f,0,0,0,0,0,0,1]):a.push([f,0,0,0,0,0,0,1]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),h){if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([f,0,0,0,1,2,0,0]):a.push([f,0,0,0,1,1,0,0]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([f,0,0,0,1,0,0,1]):a.push([f,0,0,0,1,0,0,1]);return}a.push([f,0,0,0,1,0,0,0]);return}if(h=p.match(/^(> *)+/),h){if(h=p.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([f,0,0,1,0,2,0,0]):a.push([f,0,0,1,0,1,0,0]);return}if(h=p.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([f,0,0,1,0,0,0,1]):a.push([f,0,0,1,0,0,0,1]);return}a.push([f,0,0,1,0,0,0,0]);return}if(h=p.match(/^([ 　\t]+)/),h){if(h=p.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([f,0,0,1,1,2,0,0]):a.push([f,0,0,1,1,1,0,0]);return}if(h=p.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([f,0,0,1,1,0,0,1]):a.push([f,0,0,1,1,0,0,1]);return}a.push([f,0,0,1,1,0,0,0]);return}if(h=p.match(/\|/g),h){let c=p.match(/\\\|/g);if(!c||!!c&&c.length!==h.length){let o=!0;for(c=p;o;){o=!1;let g=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");g=g.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),g=g.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=g!==c,c=g}if(c.indexOf("|")>=0){a.push([f,0,0,0,0,0,1,0]);return}}}});var i={};a.forEach(p=>{i[p[0]]=p});var u=!1;if(a.length>0){if(u=parseLaTeX(a,i,n,t,s)||u,a.length>0&&(u=parseCodeBlock(a,i,n,t,s)||u),a.length>0&&(u=parseTable(a,i,n,t,s)||u),l&&r===0&&!!t.metas.linenumber){let p=0;n.forEach((f,h)=>{if(!!f&&!f.match(/^%[\w\-]+%$/)){var c=i[h];if(!(!!c&&(c[1]>0||c[2]>0))&&!f.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=f.match(/\{[<\|>]\}$/);o?(o=o[0],f=f.substr(0,f.length-o.length)+'<span name="line-'+p+'"></span>'+o):f=f+'<span name="line-'+p+'"></span>',p++,n[h]=f}}}),t.metas.totalLineCount=p}[n,i]=squeezeContents(a,i,n),a.length>0&&(u=parseListAndBlockQuote(a,i,n,t,s)||u,[n,i]=squeezeContents(a,i,n)),a.length>0&&(u=parseHeadline(a,i,n,t,s)||u,[n,i]=squeezeContents(a,i,n))}return u=parseResources(a,i,n,t,s)||u,[n,i]=squeezeContents(a,i,n),u=parseParagraph(a,i,n,t,s)||u,n=n.map(p=>{if(p===null||p===void 0||p.length===0)return"";var f="";if(l)p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?f=restorePreserves(p,s,!1):(f=parsePlainParaStyle(p,t),f=restorePreserves(f,s,!1));else{f=parsePlainParaStyle(p,t);let h="param-"+generateRandomKey();s[h]=f,f="%"+h+"%"}return f}),t.parseLevel--,t.parseLevel>0&&(n=n.join("")),n},squeezeContents=(e,t,r)=>(r=r.map((s,n)=>[n,s]),r=r.filter(s=>!(!s[1]&&s[1]!=="")),r.forEach((s,n)=>{var l=s[0],a=t[l];!a||(a[0]=n)}),t={},e.forEach(s=>{t[s[0]]=s}),r=r.map(s=>s[1]),[r,t]),parsePlainParaStyle=(e,t)=>{var r="<p",s="</p>",n=[],l=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),a=l.match(/^\{[<\|>]\}/);a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(u,p)=>p||"")),l=e.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),a=l.match(/\{[<\|>]\}$/),a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(u,p)=>p||"")),l=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var i=l.match(/^:+/);return!!i&&!l.match(/^:([\w\-\.]+?):/)&&(i=i[0],n.push("indent","indent-"+i.length),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(u,p)=>p||"")),n.length>0&&(r=r+' class="'+n.join(" ")+'"'),r=r+">",e.length===0?"":r+e+s},parseLaTeX=(e,t,r,s,n)=>{var l=[];if(e.forEach(f=>{!f[7]||l.push(f)}),l.length===0)return!1;if(l.length===1)return l[0][7]=0,!1;var a=l.length,i=l[0];i[7]=2;for(let f=1;f<a;f++){let h=l[f];i[7]===2?(h[3]=i[3],h[4]=i[4],h[7]=3):i[7]===3&&(h[7]=2),i=h}l[l.length-1][7]===2&&(l[l.length-1][7]=0),l.forEach(f=>{f[7]===1&&(f[7]=0)});var u=[];l=l.filter(f=>f[7]<2?!1:(f[7]===2&&u.push(f[0]),!0)),a=l.length;for(let f=a-1;f>0;f-=2){let h=l[f-1][0];u.includes(h)||l.splice(f-1,2)}var p=[];a=l.length;for(let f=0;f<a;f+=2)p.push([l[f][0],l[f+1][0]]);return p.forEach(f=>{var h=['<p class="latex block">$$'];for(let o=f[0]+1;o<f[1];o++)h.push(r[o]);h.push("$$</p>"),h=h.join("<br>");var c="latex-"+generateRandomKey();s.finals[c]=h,r[f[0]]="%"+c+"%";for(let o=f[0]+1;o<=f[1];o++)r[o]=null;for(let o=f[0];o<=f[1];o++){let g=t[o];if(!g)continue;let y=e.indexOf(g);y>=0&&e.splice(y,1),delete t[o],g[0]=-1}}),p.length>0},parseCodeBlock=(e,t,r,s,n)=>{var l=[];if(e.forEach(c=>{!c[5]||l.push(c)}),l.length===0)return!1;if(l.length===1)return l[0][5]=0,!1;var a=l.length,i=l[0],u=[],p;i[5]=2,p=i[8];for(let c=1;c<a;c++){let o=l[c];if(!!p&&o[8]!==p){o[5]=0;continue}if(o[5]===2){if(c===a-1&&(o[5]=0),i[5]!==3){i[5]=0;continue}p=o[8]}i[5]===2?(o[3]=i[3],o[4]=i[4],o[5]=3,p=null):i[5]===3&&(o[5]=2),i=o}l[l.length-1][5]===2&&(l[l.length-1][5]=0),l.forEach(c=>{c[5]===1&&(c[5]=0)});var f=[];l=l.filter(c=>c[5]<2?!1:(c[5]===2&&f.push(c[0]),!0)),a=l.length;for(let c=a-1;c>0;c-=2){let o=l[c-1][0];f.includes(o)||l.splice(c-1,2)}var h=[];a=l.length;for(let c=0;c<a;c+=2){let o=l[c],g=l[c+1];if(!o||!g)break;o=o[0],g=g[0],h.push([o,g])}return h.forEach(c=>{var o=r[c[0]],g=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],y=o.indexOf(g);g=o.substr(y+g.length,o.length),g=g.replace(/^[ 　\t]+|[ 　\t]+$/g,""),g=g.toLowerCase(),(!g||g===""||g==="text")&&(g="plaintext");var S='<pre lang="'+g+'"><code>',T="</code></pre>",j=!1,v=[],R=[];if(g==="plaintext")for(let d=c[0]+1;d<c[1];d++){let m=r[d];v.push("<p>"+m+"</p>")}else for(let d=c[0]+1;d<c[1];d++){let m=r[d],E=[],k=-1,M=null,A=[],W=!1;if(j){let L=m.match(/(\\*)`/);if(!L)E.push([0,m.length-1]);else{let w=L[1].length;w>>1<<1!==w?E.push([0,m.length-1]):(j=!1,W=!0,k=0,M="`",m.replace(/(\\*)(['"`])/g,($,C,b,x)=>{var O=C.length;!!M&&b!==M||O>>1<<1===O&&(x+=O,k===-1?(k=x,M=b,b==="`"&&(W=!0)):(E.push([k,x]),k=-1,M=null,b==="`"&&(W=!1)))}),W&&(E.push([k,m.length-1]),j=!0))}}else m.replace(/(\\*)(['"`])/g,(L,w,$,C)=>{var b=w.length;!!M&&$!==M||b>>1<<1===b&&(C+=b,k===-1?(k=C,M=$,$==="`"&&(W=!0)):(E.push([k,C]),k=-1,M=null,$==="`"&&(W=!1)))}),W&&(E.push([k,m.length-1]),j=!0);for(let L=E.length-1;L>=0;L--){let w=E[L],$=m.substring(0,w[0]),C=m.substring(w[0],w[1]+1),b=m.substring(w[1]+1,m.length),x="[%:"+A.length+":%]";A.push(C),m=$+x+b}m=m.replace(CodeBlockKeyWords.operator,(L,w,$,C,b)=>{var x=E.some(P=>b>=P[0]&&b<=P[1]);if(x)return L;var O=(w||"")+'<span CLASS="operatorword">'+$+"</span>"+(C||"");return O}),m=m.replace(CodeBlockKeyWords.system,(L,w,$,C,b)=>{var x=E.some(P=>b>=P[0]&&b<=P[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return L;var O=(w||"")+'<span CLASS="flowword">'+$+"</span>"+(C||"");return O}),m=m.replace(CodeBlockKeyWords.function,(L,w,$,C,b)=>{var x=E.some(P=>b>=P[0]&&b<=P[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return L;var O=(w||"")+'<span CLASS="keyword">'+$+"</span>"+(C||"");return O}),m=m.replace(CodeBlockKeyWords.consts,(L,w,$,C,b,x)=>{var O=E.some(N=>x>=N[0]&&x<=N[1]);if(O||!!w&&w.match(/[\w\d_\.]/)||!!b&&b.match(/[\w\d_\.]/))return L;var P=(w||"")+'<span CLASS="constsword">'+$+"</span>"+(b||"");return P}),m=m.replace(CodeBlockKeyWords.object,(L,w,$,C,b)=>{var x=E.some(P=>b>=P[0]&&b<=P[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return L;var O=(w||"")+'<span CLASS="objectword">'+$+"</span>"+(C||"");return O}),A.forEach((L,w)=>{var $='\\[%:(<span CLASS="constsword">)?'+w+"(</span>)?:%\\]";$=new RegExp($),m=m.replace($,'<span CLASS="constsword">'+L+"</span>")}),m=m.replace(/<span CLASS="/g,'<span class="'),v.push("<p>"+m+"</p>")}v=v.join(""),v=S+v+T;var _="codeblock-"+generateRandomKey();s.finals[_]=v,r[c[0]]="%"+_+"%";for(let d=c[0]+1;d<=c[1];d++)r[d]=null;for(let d=c[0];d<=c[1];d++){let m=t[d];if(!m)continue;let E=e.indexOf(m);E>=0&&e.splice(E,1),delete t[d],m[0]=-1}}),h.length>0},parseTable=(e,t,r,s,n)=>{var l=[];if(e.forEach(f=>{!f[6]||l.push(f)}),l.length!==0){var a=[],i=0,u=l[0][0];a.push([l[0]]);var p=l.length;for(let f=1;f<p;f++){let h=l[f];h[0]===u+1?a[i].push(h):(i++,a[i]=[h]),u=h[0]}return a=a.filter(f=>!(f.length<2)),a.forEach(f=>{generateTable(f,e,t,r,s,n)}),!0}},parseListAndBlockQuote=(e,t,r,s,n)=>{var l=0,a=r.length;if(e.forEach((o,g)=>{if(o[3]+o[4]!==0){var y=o[0];y<a&&(a=y),y>l&&(l=y)}}),a>l)return!1;for(let o=l+1;o<r.length-1;o++){let g=t[o],y=t[o+1];if(!!g&&g[1]>0&&!!y&&y[1]>0)break;l=o}if(l===r.length-2){let o=r.length-1,g=t[o];(!g||g[1]===0)&&(l=o)}var i=0,u=[[[a,t[a]]]],p=!1,f=!0;t[a][3]>0&&(p=!0);for(let o=a+1;o<=l;o++){var h=t[o];if(!h){f&&u[i].push([o,null]);continue}if(h[1]){if(!f)continue;let g=t[o+1];if(!g||g[1]>0){f=!1;continue}u[i].push([o,h]);continue}if(h[3]+h[4]===0){f&&u[i].push([o,h]);continue}if(f){u[i].push([o,h]);continue}i++,u[i]=[],t[o][3]>0?p=!0:p=!1,f=!0,u[i].push([o,h])}var c=!1;return u.forEach(o=>{o.forEach(T=>{var j=T[0];T[1]||(r[j]="    "+r[j])});var g=0,y=o[0][0],S=r[y],g=-1;S.match(/^[ 　\t>]/)?g=0:S.match(/^[\-\+]|[\*~][ 　\t]/)?g=1:S.match(/^\d+\.[ 　\t]/)&&(g=2),!(g<0)&&(change=!0,g===0?generateQuotes(o,e,t,r,s,n):g===1?generateList(!1,o,e,t,r,s,n):g===2&&generateList(!0,o,e,t,r,s,n))}),c},parseHeadline=(e,t,r,s,n)=>{var l=[],a=[];e.forEach(i=>{if(i[2]!==0){var u=i[0],p=t[u-1];if(p)p[1]>0&&l.push([u,r[u].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let f=r[u-1];if(u===0||!!f.match(/^%[\w\-]+%$/))l.push([u,r[u].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let h=r[u].substr(0,1);h==="="?a.push([u-1,1]):h==="-"?a.push([u-1,2]):h==="~"?a.push([u-1,3]):h==="+"?a.push([u-1,3]):h==="_"?a.push([u-1,3]):h==="*"?a.push([u-1,4]):h==="#"?a.push([u-1,5]):h==="."&&a.push([u-1,6]),r[u]=null}}}});for(let i=0;i<r.length;i++){let u=r[i];if(!u)continue;let p=u.match(/^(#+)[ 　\t]*/);if(p){let f=p[0],h=p[1];f!==u&&u.indexOf(f+"[")!==0&&(a.push([i,h.length]),r[i]=u.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return l.length+a.length===0?!1:(a.sort((i,u)=>i[0]-u[0]),l.forEach(i=>{var[u,p]=i,f="headline-"+generateRandomKey(),h="<hr";p==="="?h=h+' class="heavy">':p==="-"?h=h+' class="light">':p==="*"?h=h+' class="star">':p==="~"?h=h+' class="wavy">':p==="."?h=h+' class="dotted">':p==="_"?h=h+' class="dashed">':p==="+"?h=h+' class="strong">':p==="#"?h=h+' class="heavystrong">':h=h+">",n[f]=h,r[u]="%"+f+"%"}),a.forEach(i=>{var[u,p]=i,f="header-"+generateRandomKey(),h="h"+(p||1),c=r[u];c=parseLine(c,s),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+h+">"+c+"</"+h+">",n[f]=c,r[u]="%"+f+"%"}),!0)},parseResources=(e,t,r,s,n)=>{for(var l=[],a=!0;a;)a=!1,r.forEach(i=>{if(i.length===0)return l.push(i);i=i.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(h,c,o,g)=>{var y=s.refs[g],S;if(!y||y.indexOf("://")<0&&y.indexOf("@")<0&&!y.match(/^\.{0,2}[\\\/]/)||y.indexOf(`
`)>=0){if(S=s.metas[g.toLowerCase()],!S||S.indexOf("://")<0&&S.indexOf("@")<0&&!S.match(/^\.{0,2}[\\\/]/)||S.indexOf(`
`)>=0)return h;y=S}return c+"("+y+")"});for(var u=[],p=[],f=!0;f;)f=!1,i=i.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(h,c,o)=>(f=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?p.push(h):u.push(h),""));i=i.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.forEach(h=>l.push(h)),i.length>0&&(u.length>0&&(a=!0),l.push(i)),u.forEach(h=>l.push(h))}),r.splice(0,r.length),l.forEach(i=>r.push(i)),l=[];return!0},parseParagraph=(e,t,r,s,n)=>{var l=[],a=[],i=[],u=-1;r.forEach((p,f)=>{if(!p||p.length===0){u=-1;return}var h=p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(h){u=-1;return}if(h=p.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),h){i.push([f,p]),u=-1;return}h=p.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=h?1:0;c===u?c===0?l[l.length-1].push([f,p]):c===1&&a[a.length-1].push([f,p]):(c===0?l[l.length]=[[f,p]]:c===1&&(a[a.length]=[[f,p]]),u=c)}),a=a.filter(p=>{var f=p.length>1;return p.length===1&&i.push(p[0]),f}),l.forEach(p=>{var f=[],h=p[0][0];p.forEach(c=>{var o=c[0],g=c[1];g.length!==0&&(f.push(parseLine(g,s)),r[o]=null)}),f=f.join("<br>"),r[h]=f}),a.forEach(p=>{var f=[],h=p[0][0];p.forEach(o=>{f.push(parseLine(o[1],s)),r[o[0]]=null}),f=f.join(""),f='<div class="image-wall">'+f+"</div>";var c="imagewall-"+generateRandomKey();n[c]=f,r[h]="%"+c+"%"}),i.forEach(p=>{var[f,h]=p;h=parseLine(h,s);var c="resource-"+generateRandomKey();n[c]=h,r[f]="%"+c+"%"})},generateTable=(e,t,r,s,n,l)=>{var a=!0,i=null,u=null,p=-1,f=!1;i=s[e[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),i?(i=i[1].trim(),i.match(/\{h\}/i)&&(f=!0,i=i.replace(/\{h\}/gi,"").replace(/(^[ 　\t]+|[ 　\t]+$)/g,"")),s[e[0][0]]="",e.shift()):i=generateRandomKey(16),e.some((v,R)=>{var _=s[v[0]];_=_.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=_.match(/[\|:\-]+/);if(!!d&&(d=d[0],_===d))return u=d,p=v[0],R===0&&(a=!1),!0}),u?(u=u.replace(/^\||\|$/g,""),u=u.split("|"),u=u.map(v=>v.match(/^:\-:$/)?1:v.match(/^:\-$/)?0:v.match(/^\-:$/)?2:3)):(a=!1,u=[]);var h=[],c=0;e.forEach((v,R)=>{var _=v[0];if(_!==p){var d=parseTableRow(s[_]);h.push(d),d.length>c&&(c=d.length)}});for(let v=u.length;v<c;v++)u.push("");for(let v=0;v<h.length-1;v++){let R=h[v],_=R?R.length:c;for(let d=R.length;d<c;d++)R.push("")}var o;a&&(o=h[0],h.shift());for(let v=0;v<c;v++){if(u[v]!==3)continue;let R=!0;h.some(_=>{var d=_[v];if(!!d&&d*1!==d)return R=!1,!0}),R?u[v]=2:u[v]=0}var g='<table name="'+i+'"',y=[];f&&(g+=' hidden="true"'),g+=">",a&&(g+="<thead><tr>",o.forEach((v,R)=>{var _=!1;v.match(/\{s\}$/i)&&(_=!0,v=v.replace(/[ 　\t]*\{s\}$/i,""));var d=!1;v.match(/\{h\}$/i)&&(y[R]=!0,d=!0,v=v.replace(/[ 　\t]*\{h\}$/i,"")),v=parseLine(v,n);var m='<th align="',E=u[R];E===1?m+="center":E===2?m+="right":m+="left",_&&(m+='" sortable="true'),m+='"',d&&(m+=' hidden="true"'),m+=">"+v+"</td>",g+=m}),g+="</tr></thead>"),g+="<tbody>";var S=[];h.forEach((v,R)=>{v.forEach((_,d)=>{var m=_.match(/^[ 　\t]*CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!m){var E=m[1]*1;(isNaN(E)||E<1)&&(E=1);var k=m[2];S[d]=[E,k,R+1]}})}),S.length>0&&calculateTable(h,S);var T=[];h.forEach((v,R)=>{g+="<tr>";var _=[];v.forEach((d,m)=>{d=parseLine(d,n);var E=d.replace(/<.*?>/gi,"");_[m]=E.trim();var k='<td align="',M=u[m];M===1?k+="center":M===2?k+="right":k+="left",k+='"',y[m]&&(k+=' hidden="true"'),k+=">"+d+"</td>",g+=k}),g+="</tr>",T[R]=_}),g+="</tbody></table>",n.tables=n.tables||{},n.tables[i]=T;var j="table-"+generateRandomKey();l[j]=g,o=e[0][0],total=e.length;for(let v=0;v<total;v++){let R=e[v],_=R[0];s[_]=null,delete r[_];let d=t.indexOf(R);d>=0&&t.splice(d,1),R[0]=-1}s[o]="%"+j+"%"},calculateTable=(e,t)=>{var r=[],s=[];t.forEach((l,a)=>{if(!!l){var[i,u,p]=l;r[i]=r[i]||[],r[i].push([a,parseEquation(u,p,s)])}});var n=[];e.forEach((l,a)=>{list=[],s.forEach(i=>{var u=l[i]*1;isNaN(u)&&(u=0),list[i]=u}),n.push(list)}),r.forEach(l=>{!l||l.length===0||e.forEach((a,i)=>{l.forEach(([u,p])=>{var f="";try{f=p(n,i),n[i]=n[i]||[],n[i][u]=f,f=f+""}catch(h){f=""}a[u]=f})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\(\)\+\-\*\/ ]+)(!+)/g,(e,t,r)=>"MathTools.factorial("+t+","+r.length+")").replace(/([a-zA-Z]+)(\d+)/gi,(e,t,r)=>{if(!t||!r||(r=r*1,r*1!==r)||(t=t.replace(/\w/g,n=>Char2Dig[n.toLowerCase()]),t=parseInt(t,26),isNaN(t)))return"0";dataCol.includes(t)||dataCol.push(t);var s=r-line;return s===0?"((dataList[lineNum]||[])["+t+"]||0)":s>0?"((dataList[lineNum+"+s+"]||[])["+t+"]||0)":(s*=-1,"((dataList[lineNum-"+s+"]||[])["+t+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,e=>"Math."+e.toLowerCase()).replace(/per(mutate)?/gi,e=>"MathTools.permutate").replace(/com(binate)?/gi,e=>"MathTools.combinate").replace(/round/gi,e=>"MathTools.round").replace(/ceil/gi,e=>"MathTools.ceil").replace(/floor/gi,e=>"MathTools.floor"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=e=>{e.substr(0,1)!=="|"&&(e="|"+e),e.substr(e.length-1,1)!=="|"&&(e=e+"|");var t=e.length,r=0,s=[],n=0;for(let l=1;l<t;l++){let a=e.substr(l,1);if(a==="|"&&r===0){s.push(e.substr(n+1,l-n-1)),n=l;continue}"([{<".indexOf(a)>=0?r++:">}])".indexOf(a)>=0&&r--}return s},generateQuotes=(e,t,r,s,n,l)=>{var a="quote",i=s[e[0][0]];if(i=i.match(/^>[ 　\t]*\[([\w\W]+?)\]/),i){let h=i[1];h=h.replace(/^[ 　\t]+|[ 　\t]+$/g,""),h.length>0&&!n.metas[h]&&!n.blocks[h]&&(a=h)}var u=!0;i=e.map((h,c)=>{var o=h[0],g=s[o];c>0&&(u=u&&!!g.match(/^(\t|　　|    | 　 |  　|　  )/));var y=g.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return y!==g&&u?g=y:(head=g.match(/^>[ 　\t]*/),head&&(head=head[0],g=g.replace(head,""))),g}),i[0]=i[0].replace(new RegExp("^[ \u3000\\t]*\\["+a.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),i=i.join(`
`),i=i.replace(/^\n+|\n+$/g,"");var p='<blockquote class="'+a+'">';i=parseSection(i,n,2,l),p+=i,p+="</blockquote>";var f="blockquote-"+generateRandomKey();l[f]=p,e.forEach(h=>{var c=h[0];s[c]=null,delete r[c];var o=t.indexOf(h[1]);o>=0&&t.splice(o,1)}),s[e[0][0]]="%"+f+"%"},generateList=(e,t,r,s,n,l,a)=>{var i=[],u=-1;t.forEach(h=>{var c=h[0],o=n[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),u++,i[u]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),i[u].push(o)}),i=i.map(h=>(h=h.join(`
`),h=h.replace(/^\n+|\n+$/g,""),h));var p="";e?p="<ol>":p="<ul>",i.forEach(h=>{p+="<li>",p+=parseSection(h,l,2,a),p+="</li>"}),e?p+="</ol>":p+="</ul>";var f="list-"+generateRandomKey();a[f]=p,t.forEach(h=>{var c=h[0];n[c]=null,delete s[c];var o=r.indexOf(h[1]);o>=0&&r.splice(o,1)}),n[t[0][0]]="%"+f+"%"},analyzeSections=(e,t)=>{var r=[[]],s=0,n=[0],l=[];if(e.forEach(a=>{var i=!1;a=a.replace(/^<h(\d+)>/i,(u,p)=>{i=!0,p=p*1,p===1&&(s++,r[s]=[]),n[p-1]=(n[p-1]||0)+1;for(let h=p;h<n.length;h++)n[h]=0;var f="chap";for(let h=0;h<p;h++)f+="-"+(n[h]||1);return u=u+'<a name="'+f+'">',l.push([p,f,a.replace(/<[\w\W]+?>/gi,"")]),u}).replace(/<\/h(\d+)>$/i,u=>"</a>"+u).replace(/\{([\w \-\.]+)\}/g,(u,p)=>{var f=t.termList[p];return f?(Array.isArray(f)&&(f=f[0]),'<a class="terminology" name="'+p+'" href="#ref-'+p+'"><strong>'+f+"</strong></a>"):u}),r[s].push(a)}),r=r.filter(a=>a.length>0),t.chapList=l,r=applyFootNotes(r,t),!!t.endnotes&&t.endnotes.length>0&&r.push(applyEndNotes(t)),t.metas.glossary&&!!t.termList&&t.termList.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',a+=generateGlossary(t),a+="</section>",r.push(a)}if(t.image=t.image||[],t.video=t.video||[],t.audio=t.audio||[],t.metas.resources&&t.image.length+t.video.length+t.audio.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',t.image.length>0&&(a+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',a+=generateResourceList(t,"image")),t.video.length>0&&(a+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',a+=generateResourceList(t,"video")),t.audio.length>0&&(a+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',a+=generateResourceList(t,"audio")),a+="</section>",r.push(a)}if(t.metas.showtitle){let a='<header class="article-title">';if(a+="<p>"+t.metas.title+"</p>",t.metas.showauthor){if(t.metas.author&&(a+='<p class="author">',t.metas.email&&(a+='<a href="mailto:'+t.metas.email+'">'),a+=t.metas.author,t.metas.email&&(a+="</a>"),a+="</p>"),t.metas.publish){a+='<p class="author date publish">';let i=t.metas.publish*1;if(isNaN(i))i=t.metas.publish;else{i=new Date(i);let u=i.getYear()+1900,p=i.getMonth()+1;p<10&&(p="0"+p);let f=i.getDate();f<10&&(f="0"+f);let h=i.getHours();h<10&&(h="0"+h);let c=i.getMinutes();c<10&&(c="0"+c);let o=i.getSeconds();o<10&&(o="0"+o),i=u+"/"+p+"/"+f+" "+h+":"+c+":"+o}a+=i,a+="</p>"}if(t.metas.update){a+='<p class="author date update">';let i=t.metas.update*1;if(isNaN(i))i=t.metas.update;else{i=new Date(i);let u=i.getYear()+1900,p=i.getMonth()+1;p<10&&(p="0"+p);let f=i.getDate();f<10&&(f="0"+f);let h=i.getHours();h<10&&(h="0"+h);let c=i.getMinutes();c<10&&(c="0"+c);let o=i.getSeconds();o<10&&(o="0"+o),i=u+"/"+p+"/"+f+" "+h+":"+c+":"+o}a+=i,a+="</p>"}}a+="</header>",r.unshift(a)}return r},applyBlockReference=(e,t)=>{for(var r=!0,s=0;r&&(r=!1,e=e.map(n=>(n=n.replace(/\[([\w \-\.]+?)\]/g,(l,a,i)=>{var u=n.lastIndexOf("<sup>",i),p=n.lastIndexOf("</sup>",i);if(u>p)return l;var f=t.blocks[a];return f?(r=!0,f):l}),n)),s++,s!==10););return e},applyMarkUpReference=(e,t)=>{var r=(t.metas.LANG||"zh").toLowerCase();if(e=e.map(s=>(s=s.replace(/%glossary%/gi,n=>generateGlossary(t)),s=s.replace(/%resources%/gi,n=>generateResourceList(t,"image")+generateResourceList(t,"video")+generateResourceList(t,"audio")),s=s.replace(/%images%/gi,n=>generateResourceList(t,"image")),s=s.replace(/%videos%/gi,n=>generateResourceList(t,"video")),s=s.replace(/%audios%/gi,n=>generateResourceList(t,"audio")),s=s.replace(/%toc%(\{[\w\W]+?\})*/gi,n=>{var l=n.match(/\{[\w\W]+?\}/g),a="\u76EE\u5F55",i=3;return l&&l.forEach(u=>{u=u.substr(1,u.length-2);var p=u*1;isNaN(p)?a=u:i=p}),t.toced=!0,generateTableOfContent(t,a,i)}),Object.keys(t.metas).forEach(n=>{var l=n.toLowerCase();PreservedKeywords.includes(n)||(l=t.metas[n],l===!0||l===!1?r==="zh"?l=l?"\u662F":"\u5426":l=l?"On":"Off":Array.isArray(l)&&(r==="zh"?l=l.join("\u3001"):l=l.join(", ")),s=s.replace(new RegExp("%"+n+"%","gi"),a=>l))}),s=s.replace(/%([\w \-\.]+)%/g,(n,l)=>{var a=t.finals[l];return a||n}),s)),t.metas.toc&&!t.toced){let s=generateTableOfContent(t,"\u76EE\u5F55",3);s.indexOf('<p class="content-')>=0&&(s="<section>"+s+"</section>",t.metas.showtitle?e.splice(1,0,s):e.unshift(s))}return e},applyFootNotes=(e,t)=>(e=e.map(r=>{var s=[],n="<section>",l="</section>";return r.forEach((a,i)=>{var u=!1;a=a.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(p,f)=>{u=!0,s.push(f);var h=p.substr(0,p.length-1)+' href="#footnote-'+f+'">';return h}),u&&(r[i]=a)}),r=r.join(""),s.length===0||(s=s.map((a,i)=>{var u=t.refs[a],p=t.footnotes.indexOf(a);return i++,r=r.replace(new RegExp("%%FN-"+p+"%%","g"),i),'<p class="footnote-content"><a class="index" name="footnote-'+a+'">'+i+"\uFF1A</a>"+u+"</p>"}),r+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',r+=s.join(""),r+='</footer><hr class="footnote-line end">'),n+r+l}),e),applyEndNotes=e=>{let t='<hr class="endnote-line">';return t+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',e.endnotes.forEach((r,s)=>{t+='<p class="endnote-content"><a class="index" name="endnote-'+r+'">'+(s+1)+"\uFF1A</a>"+e.refs[r]+"</p>"}),t+="</section>",t},generateTableOfContent=(e,t,r)=>{var s='<h1 name="ContentTable">'+t+'</h1><aside class="content-table">';return e.chapList.forEach(n=>{if(!(n[0]>r)){var l='<p class="content-item level-'+n[0]+'">';for(let a=0;a<n[0];a++)l+='<span class="content-indent"></span>';l+='<a class="content-link" href="#'+n[1]+'">'+n[2]+"</a>",l+="</p>",s+=l}}),!!e.endnotes&&e.endnotes.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),e.metas.glossary&&!!e.termList&&e.termList.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),e.metas.resources&&e.image.length+e.video.length+e.audio.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',e.image.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),e.video.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),e.audio.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),s+="</aside>",s},generateGlossary=e=>{var t="";return e.termList===0?"":(e.termList.forEach(r=>{var[s,n]=r,l=e.terms[s],a='<p class="glossary-item">';a+='<a class="glossary-indent" name="ref-'+s+'">'+n+"</a>",a+=l,a+="</p>",t+=a}),t)},generateResourceList=(e,t)=>{var r=e[t];if(!r||!Array.isArray(r)||r.length===0)return"";var s=[],n="<ul>";return r.forEach(l=>{var a=l[1];a=a.replace(/\%([\w \-]+?)\%/g,(i,u)=>{var p=ReversePreserveWords[u.toLowerCase()];return p||i}),!s.includes(a)&&(s.push(a),n+='<li><a href="'+a+'" target="_blank">'+a+"</a></li>")}),n+="</ul>",n},convertPreserves=e=>(e=e.replace(/(\\+)(.)/g,(t,r,s)=>{var n=Math.floor(r.length/2),l=n*2!==r.length,a="",i="%"+PreserveWords["\\"]+"%";for(let u=0;u<n;u++)a+=i;if(l){let u=PreserveWords[s];u?a=a+"%"+u+"%":a=a+s}else a=a+s;return a}),e),restorePreserves=(e,t,r=!0)=>{for(var s=!0;s;)s=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,l)=>{var a=t[l];return a?(s=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,l)=>{var a=t[l];return a?(s=!0,a):n});if(!r)return e;for(s=!0;s;)s=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,l)=>{var a=t[SymHidden][l.toLowerCase()];return a?(s=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,l)=>{var a=t[SymHidden][l.toLowerCase()];return a?(s=!0,a):n});return e=e.replace(/\n+/g,"<br>"),e=e.replace(/\/{2}/g,(n,l)=>{if(l===0)return"<br>";var a=e.substr(l-1,1);return a===":"?n:"<br>"}),e=e.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),e},getKeywords=e=>{if(!e)return[];e=e.split(/[ ,，；;、　]+/).filter(r=>r.length>0);var t=[];return e.forEach(r=>{t.includes(r)||t.push(r)}),t},getMetas=(e,t)=>{var r={},s=!0;if(MetaWords.forEach(n=>{var l=new RegExp("(^|\\n)"+n+"[:\uFF1A][ \u3000\\t]*([^\\n]*?)(\\n|$)","gi");t=t.replace(l,(a,i,u,p)=>(r[n]=u,i+p))}),!!r.showtitle&&["on","yes","true"].includes(r.showtitle.toLowerCase())?r.showtitle=!0:r.showtitle=void 0,!!r.glossary&&["on","yes","true"].includes(r.glossary.toLowerCase())?r.glossary=!0:r.glossary=void 0,!!r.links&&["on","yes","true"].includes(r.links.toLowerCase())?r.links=!0:r.links=void 0,!!r.refs&&["on","yes","true"].includes(r.refs.toLowerCase())?r.refs=!0:r.refs=void 0,!!r.terms&&["on","yes","true"].includes(r.terms.toLowerCase())?r.terms=!0:r.terms=void 0,!!r.resources&&["on","yes","true"].includes(r.resources.toLowerCase())?r.resources=!0:r.resources=void 0,!!r.toc&&["on","yes","true"].includes(r.toc.toLowerCase())?r.toc=!0:r.toc=void 0,e.metas=r,e.metas.keyword=getKeywords(e.metas.keyword),e.metas.update)try{e.metas.update=new Date(e.metas.update).getTime()}catch(n){delete e.metas.update}if(e.metas.publish)try{e.metas.publish=new Date(e.metas.publish).getTime()}catch(n){delete e.metas.publish}for(!!e.metas.update&&!e.metas.publish&&(e.metas.publish=e.metas.update,delete e.metas.update),e.metas.god=e.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',e.metas.script?e.metas.script=e.metas.script.split(/[,; 　\t]+/):e.metas.script=[],e.metas.style?e.metas.style=e.metas.style.split(/[,; 　\t]+/).map(n=>n.replace(/\{[\w\W]*\}/,"")):e.metas.style=[],e.termList=e.termList||[],e.mainParser=!1,e.refs={},s=!0;s;)s=!1,t=t.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(n,l,a,i,u)=>(l=l.trim(),a=a.trim(),l.length===0||a.length===0?n:(e.refs[l]=a,s=!0,`
`+i)));for(e.blocks={},s=!0;s;)s=!1,t=t.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(n,l,a)=>{if(l=l.trim(),!(l.length===0||a.length===0))return e.blocks[l]=a,s=!0,""});return e.anchors=[],e.terms={},e.notes={},t.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(n,l,a,i)=>{var u=a||i;e.refs[u]?l.substr(0,1)==="{"?e.terms[u]=u:e.notes[u]=u:l.substr(0,1)==="{"&&!e.anchors.includes(u)&&e.anchors.push(u)}),t=regularize(t),t};MarkUp.fullParse=(e,t)=>{var r={finals:{},toced:!1};t=t||{};var s=e.replace(/\n标题[:：][ 　\t]*/gi,`
`).replace(/\n作者[:：][ 　\t]*/gi,`
`).replace(/\n简介[:：][ 　\t]*/gi,`
`).replace(/\n关键词[:：][ 　\t]*/gi,`
`).replace(/\n发布[:：][ 　\t]*/gi,`
`).replace(/\n更新[:：][ 　\t]*/gi,`
`);for(MetaWords.forEach(i=>{var u=new RegExp("(^|\\n)"+i+"[:\uFF1A][ \u3000\\t]*[^\\n]*?(\\n|$)","gi");s=s.replace(u,"")}),PreservedKeywords.forEach(i=>{var u=new RegExp("\\["+i+"\\]","gi");s=s.replace(u,"")});;){let i=s.replace(/\[(.*?)\][ 　\t]*\[.*?\]/g,(u,p)=>p).replace(/\[(.*?)\][ 　\t]*\{.*?\}/g,(u,p)=>p).replace(/\[(.*?)\][ 　\t]*\(.*?\)/g,(u,p)=>p).replace(/<\w.*?\w>|<\w>/g,"").replace(/\n[ 　\t]*(\-+|\++|#+|>|=+|\*+|~+|`+|\$+|\d+\.)[ 　\t]*/g,`
`);if(s===i)break;s=i}s=s.match(/[\u4e00-\u9fa5]|[a-zA-Z0-9]+/gi)||"",s=s.length||0,e=prepare(e),e=getMetas(r,e),r.parseLevel=0,r.mainParser=!0,r.metas.title=r.metas.title||"\u65E0\u540D\u6587";var n=Object.keys(r.metas);Object.keys(t).forEach(i=>{n.includes(i)||n.push(i)}),t.overwrite?n.forEach(i=>{r.metas[i]=t[i]===null||t[i]===void 0?r.metas[i]:t[i]}):n.forEach(i=>{r.metas[i]=r.metas[i]===null||r.metas[i]===void 0?t[i]:r.metas[i]}),n.forEach(i=>{(r.metas[i]===null||r.metas[i]===void 0)&&(r.metas[i]=!1)}),e=parseSection(e,r),Object.keys(r.refs).forEach(i=>{var u=r.refs[i];u=parseLine(u,r),u=u.replace(/\%([\w \-]+?)\%/g,(p,f)=>{var h=ReversePreserveWords[f.toLowerCase()];return h||p}),r.refs[i]=u}),Object.keys(r.blocks).forEach(i=>{var u=r.blocks[i],p=u.match(/^\n+/);u=u.trim();var f;r.parseLevel=0,p?f=parseSection(u,r,1):f=[parseLine(u,r)],r.blocks[i]=f.join("")});for(let i in r.terms)r.terms[i]=r.refs[i];for(let i in r.notes)r.notes[i]=r.refs[i];e=e.map(i=>(i=i.replace(/\%([\w \-]+?)\%/g,(u,p)=>{var f=ReversePreserveWords[p.toLowerCase()];return f||u}),i=i.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(u,p)=>{var f=ReversePreserveWords[p.toLowerCase()];return f||u}),i)),e=applyBlockReference(e,r),e=analyzeSections(e,r),e=applyMarkUpReference(e,r),r.metas.classname?e='<article class="'+r.metas.classname+'">'+e.join("")+"</article>":e="<article>"+e.join("")+"</article>",r.metas.fullexport&&(r.metas.style.forEach(i=>{e+='<link type="text/css" rel="stylesheet" href="'+i+'">'}),r.metas.script.forEach(i=>{e+='<script type="text/javascript" src="'+i+'"></script>'}));var l=FinalRender._indexes_||[];l.forEach(i=>{var u=FinalRender[i];!u||u.forEach(p=>{e=p.parse(e,r)})}),e=e.replace(/<p>(<br\/?>)+<\/p>/gi,"");var a={};return a.content=e,a.title=r.metas.title,a.lineCount=r.metas.totalLineCount,a.chapList=r.chapList,a.tables=r.tables,a.meta={},a.meta.author=r.metas.author,a.meta.email=r.metas.email,a.meta.description=r.metas.description,a.meta.publish=r.metas.publish,a.meta.update=r.metas.update,a.meta.keywords=r.metas.keyword.map(i=>i),r.metas.others&&(a.meta.others=r.metas.others),a.terminology={},r.termList.forEach(i=>{a.terminology[i[0]]=i[1]}),a.notes={},Object.keys(r.refs).forEach(i=>{a.notes[i]=r.refs[i]}),a.blocks={},Object.keys(r.refs).forEach(i=>{a.blocks[i]=r.blocks[i]}),a.wordCount=s,a},MarkUp.parse=(e,t)=>{var r;return r=MarkUp.fullParse(`
`+e+`
`,t),r?r.content:""};const reverseSection=(e,t)=>{t.__level++;var r=[],s="",n=!0;return e.childNodes.forEach(l=>{var a=l.tagName;if(!a){if(l.nodeName==="#comment")return;let u=l.textContent||"";u=u.trim(),u.length>0&&(s+=u);return}a=a.trim().toLowerCase();var i;if(ParagraphTags.includes(a)){if(n=!1,s.length>0&&(r.push(t.__prefix+s),s=""),a==="blockquote"){let u=t.__prefix;t.__prefix=t.__prefix+">	",i=reverseSection(l,t),i=i.flat(Infinity),i.push(`
`),t.__prefix=u}else if(a==="ol"){let u=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"1.	",i=reverseSection(l,t),i=i.flat(Infinity),i.push(""),t.__prefix=u}else if(a==="ul"){let u=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"-	",i=reverseSection(l,t),i=i.flat(Infinity),i.push(""),t.__prefix=u}else i=reverseSection(l,t),i=i.flat(Infinity),i.push("");!!i&&i.length>0&&r.push(...i)}else{let[u,p]=reverseMix(l,a,t);p?u.length>0&&(s+=u.join("")):(s.length>0&&(r.push(t.__prefix+s),s=""),u.forEach(f=>{r.push(t.__prefix+f)}))}}),s.length>0&&r.push(t.__prefix+s),t.__level--,r},reverseLine=(e,t)=>{var r="";return e.childNodes.forEach(s=>{var n=s.tagName;if(!n){if(s.nodeName==="#comment")return;let l=s.textContent||"";l=l.trim(),l.length>0&&(r+=l);return}if(n=n.trim().toLowerCase(),n==="a"){let l=s.href;l.indexOf("javascript:")===0&&(l="");let a=reverseLine(s,t);!l||l.substr(0,1)==="#"||(l.match(/^(ftp|https?):\/\//i)||(l=t.host+l),a="["+a+"]("+l+")"),r+=a;return}if(n==="span"||n==="font"){r+=reverseLine(s,t);return}if(n==="strong"||n==="b"){r+=reverseLine(s,t);return}if(n==="em"||n==="i"){r+=reverseLine(s,t);return}if(n==="sup"){r+=reverseLine(s,t);return}if(n==="sub"){r+=reverseLine(s,t);return}if(n==="del"){r+=reverseLine(s,t);return}r+=s.innerText}),r},reverseMix=(e,t,r)=>{if(t==="script")return[[""],!0];if(t==="style")return[[""],!0];if(t==="link")return[[""],!0];if(t==="hr")return[[`
---
`],!1];if(t==="br")return[[`
`],!0];if(t.match(/^h\d+$/)){let n=t.substring(1,t.length);n*=1;let l=`
`;for(let i=0;i<n;i++)l+="#";let a=reverseLine(e,r);return a=l+a+`
`,[[a],!1]}if(t==="a"){let n=e.href;n.indexOf("javascript:")===0&&(n="");let l=reverseLine(e,r);return!n||n.substr(0,1)==="#"?[[l],!0]:(n.match(/^(ftp|https?):\/\//i)||(n=r.host+n),l="["+l+"]("+n+")",[[l],!0])}if(t==="img")return e.src.length===0?[[""],!0]:[[`
![](`+e.src+`)
`],!1];if(t==="video")return e.src.length===0?[[""],!0]:[[`
@[](`+e.src+`)
`],!0];if(t==="audio")return e.src.length===0?[[""],!0]:[[`
#[](`+e.src+`)
`],!0];if(t==="span"||t==="font")return[[reverseLine(e,r)],!0];if(t==="strong"||t==="b"){let n=reverseLine(e,r);return[["**"+n+"**"],!0]}if(t==="em"||t==="i"){let n=reverseLine(e,r);return[["*"+n+"*"],!0]}if(t==="u"){let n=reverseLine(e,r);return[["__"+n+"__"],!0]}if(t==="sup"){let n=reverseLine(e,r);return[["^"+n+"^"],!0]}if(t==="sub"){let n=reverseLine(e,r);return[["_"+n+"_"],!0]}if(t==="del"){let n=reverseLine(e,r);return[["~~"+n+"~~"],!0]}var s=reverseLine(e,r);return[[s],!1]};MarkUp.plaintextReverse=e=>{for(e=e.replace(/\r/g,""),e=e.replace(/<!(.*?|\s*?)*?>/g,""),e=e.replace(/<xml(.*?|\s*?)*?>[\w\W]*?<\/xml>/gi,""),e=e.replace(/<style(.*?|\s*?)*?>[\w\W]*?<\/style>/gi,""),e=e.replace(/<(\/?\w+).*?>/g,(s,n)=>{if(n=n.toLowerCase(),n==="a"){let l=s.match(/href=('|")(.*?)\1/i);return!l||(l=l[2],!l)?"<a>":'<a src="'+l+'">'}else if(n==="img"){let l=s.match(/src=('|")(.*?)\1/i);return!l||(l=l[2],!l)?"<img>":'<img src="'+l+'">'}else return["div","article","section","aside","nav","footer","header","foot"].includes(n.replace("/",""))?n.indexOf("/")===0?"</p>":"<p>":"<"+n+">"}),e=e.replace(/<p([ \s](.*?))*?>/gi,"<p>"),e=e.replace(/<\/?(html|head|body|span|lable|nobr|link|meta|w:\w*?|w|xml|o|m|style)([ \s](.*?))*?>/gi,"");;){let s=e;if(s=s.replace(/<(.*?)( .*?)*>(<\1( .*?)*>)*/gi,(n,l)=>"<"+l+">"),s=s.replace(/<(.*?)( .*?)*>[ 　\s]*<\/\1>/gi,""),s=s.replace(/<(h\d|blockquote|li|pre)([ \s](.*?))*?>(<p([ \s](.*?))*?>)*/gi,(n,l)=>"<"+l+">"),s=s.replace(/(<\/p>)+(<\/(h\d|blockquote|li|pre)>)/gi,(n,l,a)=>a),s===e)break;e=s}e=e.replace(/<\/?(b|strong)>/gi,"**"),e=e.replace(/<\/?(i|em)>/gi,"*"),e=e.replace(/<\/?sup>/gi,"^"),e=e.replace(/<\/?sub>/gi,"_"),e=e.replace(/<\/?u>/gi,"__"),e=e.replace(/<\/?(del|strike)>/gi,"~~"),e=e.replace(/<\/?code>/gi,"`"),e=e.replace(/<a src=('|")(.*?)\1>(.*?)<\/a>/gi,(s,n,l,a)=>l?"["+a+"]("+l+")":a),e=e.replace(/<img src=('|")(.*?)\1>/gi,(s,n,l)=>l?`
![](`+l+`)
`:""),e=e.replace(/<h(\d)>/gi,(s,n)=>{var l=n.length,a="";for(let i=0;i<l;i++)a+="#";return a+"	"}),e=e.replace(/<p>/gi,"");var t=!1,r=1;return e=e.replace(/<(ul|li|ol)>/gi,(s,n)=>(n=n.toLowerCase(),n==="ol"?(t=!0,r=1,""):n==="ul"?(t=!1,r=1,""):t?(s=r+".	",r++,s):"-	")),t=!1,e=e.replace(/<(pre|\/pre|\/p)>/gi,(s,n)=>(n=n.toLowerCase(),n==="pre"?(t=!0,"``"):n==="/code"?(t=!1,"``"):t?`
`:`

`)),e=e.replace(/<\/(h\d)>/gi,`

`),e=e.replace(/<\/?br\/?>/gi,`
`),e=e.replace(/<\/(li|ul|ol)>/gi,`
`),e=e.replace(/<(blockquote)>/gi,">	"),e=e.replace(/<\/(blockquote)>/gi,`


`),e=e.replace(/<\/?hr\/?>/gi,`
----

`),e=e.replace(/<.*?>/gi,""),e=e.replace(/(^[\n\r]+|[\n\r]+$)/gi,""),e},MarkUp.reverse=(e,t,r=!0)=>{if(!e)return"";if(t==="plain"||t==="plaintext")return MarkUp.plaintextReverse(e);t=t||{},t.__level=0,t.__prefix="",t.host=t.host||"";var s=reverseSection(e,t);return s=s.flat(Infinity),s=s.join(`
`),s=s.replace(/\n{2,}/g,`

`),s},MarkUp.fullPlainify=(e,t)=>{PreservedKeywords.forEach(s=>{var n=new RegExp("\\["+s+"\\]","gi");e=e.replace(n,"")});var r=MarkUp.fullParse(e,t);for(r.content=r.content.replace(/<\/(article|section|div|p|header|footer|aside|ul|ol|li|blockquote|pre|figure|figcaption|h\d)>/gi,`
`).replace(/<br\/?>/gi,`
`).replace(/\$\$+/gi,`
`),r.content=r.content.replace(/\/?<(br|hr)\/?>/gi,`
`);;){let s=r.content.replace(/<\/?.+?\/?>/gi,"");if(s===r.content)break;r.content=s}return r.content=r.content.replace(/\n\n+/gi,`
`).replace(/\n+$/,""),r},MarkUp.plainify=(e,t)=>MarkUp.fullPlainify(e,t).content,MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch(e){try{global.MarkUp=MarkUp}catch(t){console.error(t)}}})();
