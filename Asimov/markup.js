(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(r,t=1){return t<1||r<=t?1:r*MathTools.factorial(r-t,t)},permutate(r,t){return r<=1?1:t<=1?r:t>r?1:(r-t+1)*MathTools.permutate(r,t-1)},combinate(r,t){return r<=1||t<=0||t>=r?1:(r-t+1)/t*MathTools.combinate(r,t-1)},round(r,t=0){var e=10**t;return r*=e,r=Math.round(r),r/e},floor(r,t=0){var e=10**t;return r*=e,r=Math.floor(r),r/e},ceil(r,t=0){var e=10**t;return r*=e,r=Math.ceil(r),r/e}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(r=>ReversePreserveWords[PreserveWords[r].toLowerCase()]=r),ReversePreserveWords.$="&#36;",MetaWords.forEach((r,t)=>MetaWords[t]=r.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(r=8)=>{var t="";for(let e=0;e<r;e++)t+=Math.floor(Math.random()*10)+"";return t};MarkUp.addExtension=(r,t=0,e=5)=>{if(t===0){let s=LineRender._indexes_;s||(s=[],LineRender._indexes_=s),s.includes(e)||(s.push(e),s.sort((l,i)=>l-i)),s=LineRender[e],s||(s=[],LineRender[e]=s),s.push(r)}else if(t===1){let s=BlockRender._indexes_;s||(s=[],BlockRender._indexes_=s),s.includes(e)||(s.push(e),s.sort((l,i)=>l-i)),s=BlockRender[e],s||(s=[],BlockRender[e]=s),s.push(r)}else if(t===2){let s=FinalRender._indexes_;s||(s=[],FinalRender._indexes_=s),s.includes(e)||(s.push(e),s.sort((l,i)=>l-i)),s=FinalRender[e],s||(s=[],FinalRender[e]=s),s.push(r)}};const prepare=r=>(r=`
`+r+`
`,r=r.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(t,e)=>{var s=e.replace(/　/g,"  ").length;return s<4?`
`:t}),r=r.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(t,e,s)=>e+`
`+s),MetaWords.forEach(t=>{var e=new RegExp("([\\w\\W]? *)\\["+t+"\\]( *[\\w\\W]?)","gi");r=r.replace(e,(s,l,i)=>l==="]"||i==="["||i==="("?s:l+"%"+t+"%"+i)}),r),regularize=r=>(r=r.replace(/^\n+|\n+$/gi,""),r=r.replace(/\n{3,}/gi,`


`),r),parseLine=(r,t,e=-Infinity,s)=>{var l=LineRender._indexes_;if(!l)return"";var i=!s;return s=s||{},l.some(a=>{if(e>a||a>=0)return!0;for(var n=LineRender[a],f=!0;f;)f=!1,n.forEach(p=>{var u;[r,u]=p.parse(r,t,s),u&&(f=!0)})}),r=convertPreserves(r),l.forEach(a=>{if(!(e>a)&&!(a<0))for(var n=LineRender[a],f=!0;f;)f=!1,n.forEach(p=>{var u;[r,u]=p.parse(r,t,s),u&&(f=!0)})}),i&&(r=restorePreserves(r,s)),r},parseSection=(r,t,e=0,s)=>{t.parseLevel++;var l=[],i=!1;s||(i=!0,s={});var a=[];l=r.split(`
`),l.forEach((p,u)=>{var h=p.match(/^[ 　\t]*$/);if(p.length===0){a.push([u,1,0,0,0,0,0,0]);return}if(p.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){p.match(/^\-+$|^=+$/)?a.push([u,0,2,0,0,0,0,0]):p.match(/^~+$/)?a.push([u,0,2,0,0,1,0,0]):a.push([u,0,1,0,0,0,0,0]);return}if(h=p.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,0,0,2,0,0,h[1]]):a.push([u,0,0,0,0,1,0,0,h[1]]);return}if(h=p.match(/^\${2}[ 　\t]*$/),h){h[2]?a.push([u,0,0,0,0,0,0,1]):a.push([u,0,0,0,0,0,0,1]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),h){if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,0,1,2,0,0]):a.push([u,0,0,0,1,1,0,0]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([u,0,0,0,1,0,0,1]):a.push([u,0,0,0,1,0,0,1]);return}a.push([u,0,0,0,1,0,0,0]);return}if(h=p.match(/^(> *)+/),h){if(h=p.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,1,0,2,0,0]):a.push([u,0,0,1,0,1,0,0]);return}if(h=p.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([u,0,0,1,0,0,0,1]):a.push([u,0,0,1,0,0,0,1]);return}a.push([u,0,0,1,0,0,0,0]);return}if(h=p.match(/^([ 　\t]+)/),h){if(h=p.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([u,0,0,1,1,2,0,0]):a.push([u,0,0,1,1,1,0,0]);return}if(h=p.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([u,0,0,1,1,0,0,1]):a.push([u,0,0,1,1,0,0,1]);return}a.push([u,0,0,1,1,0,0,0]);return}if(h=p.match(/\|/g),h){let c=p.match(/\\\|/g);if(!c||!!c&&c.length!==h.length){let o=!0;for(c=p;o;){o=!1;let m=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");m=m.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),m=m.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=m!==c,c=m}if(c.indexOf("|")>=0){a.push([u,0,0,0,0,0,1,0]);return}}}});var n={};a.forEach(p=>{n[p[0]]=p});var f=!1;if(a.length>0){if(f=parseLaTeX(a,n,l,t,s)||f,a.length>0&&(f=parseCodeBlock(a,n,l,t,s)||f),a.length>0&&(f=parseTable(a,n,l,t,s)||f),i&&e===0&&!!t.metas.linenumber){let p=0;l.forEach((u,h)=>{if(!!u&&!u.match(/^%[\w\-]+%$/)){var c=n[h];if(!(!!c&&(c[1]>0||c[2]>0))&&!u.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=u.match(/\{[<\|>]\}$/);o?(o=o[0],u=u.substr(0,u.length-o.length)+'<span name="line-'+p+'"></span>'+o):u=u+'<span name="line-'+p+'"></span>',p++,l[h]=u}}}),t.metas.totalLineCount=p}[l,n]=squeezeContents(a,n,l),a.length>0&&(f=parseListAndBlockQuote(a,n,l,t,s)||f,[l,n]=squeezeContents(a,n,l)),a.length>0&&(f=parseHeadline(a,n,l,t,s)||f,[l,n]=squeezeContents(a,n,l))}return f=parseResources(a,n,l,t,s)||f,[l,n]=squeezeContents(a,n,l),f=parseParagraph(a,n,l,t,s)||f,l=l.map(p=>{if(p===null||p===void 0||p.length===0)return"";var u="";if(i)p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?u=restorePreserves(p,s,!1):(u=parsePlainParaStyle(p,t),u=restorePreserves(u,s,!1));else{u=parsePlainParaStyle(p,t);let h="param-"+generateRandomKey();s[h]=u,u="%"+h+"%"}return u}),t.parseLevel--,t.parseLevel>0&&(l=l.join("")),l},squeezeContents=(r,t,e)=>(e=e.map((s,l)=>[l,s]),e=e.filter(s=>!(!s[1]&&s[1]!=="")),e.forEach((s,l)=>{var i=s[0],a=t[i];!a||(a[0]=l)}),t={},r.forEach(s=>{t[s[0]]=s}),e=e.map(s=>s[1]),[e,t]),parsePlainParaStyle=(r,t)=>{var e="<p",s="</p>",l=[],i=r.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),a=i.match(/^\{[<\|>]\}/);a&&(a=a[0],a==="{<}"?l.push("align-left"):a==="{|}"?l.push("align-center"):a==="{>}"&&l.push("align-right"),r=r.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(f,p)=>p||"")),i=r.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),a=i.match(/\{[<\|>]\}$/),a&&(a=a[0],a==="{<}"?l.push("align-left"):a==="{|}"?l.push("align-center"):a==="{>}"&&l.push("align-right"),r=r.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(f,p)=>p||"")),i=r.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var n=i.match(/^:+/);return!!n&&!i.match(/^:([\w\-\.]+?):/)&&(n=n[0],l.push("indent","indent-"+n.length),r=r.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(f,p)=>p||"")),l.length>0&&(e=e+' class="'+l.join(" ")+'"'),e=e+">",r.length===0?"":e+r+s},parseLaTeX=(r,t,e,s,l)=>{var i=[];if(r.forEach(u=>{!u[7]||i.push(u)}),i.length===0)return!1;if(i.length===1)return i[0][7]=0,!1;var a=i.length,n=i[0];n[7]=2;for(let u=1;u<a;u++){let h=i[u];n[7]===2?(h[3]=n[3],h[4]=n[4],h[7]=3):n[7]===3&&(h[7]=2),n=h}i[i.length-1][7]===2&&(i[i.length-1][7]=0),i.forEach(u=>{u[7]===1&&(u[7]=0)});var f=[];i=i.filter(u=>u[7]<2?!1:(u[7]===2&&f.push(u[0]),!0)),a=i.length;for(let u=a-1;u>0;u-=2){let h=i[u-1][0];f.includes(h)||i.splice(u-1,2)}var p=[];a=i.length;for(let u=0;u<a;u+=2)p.push([i[u][0],i[u+1][0]]);return p.forEach(u=>{var h=['<p class="latex block">$$'];for(let o=u[0]+1;o<u[1];o++)h.push(e[o]);h.push("$$</p>"),h=h.join("<br>");var c="latex-"+generateRandomKey();s.finals[c]=h,e[u[0]]="%"+c+"%";for(let o=u[0]+1;o<=u[1];o++)e[o]=null;for(let o=u[0];o<=u[1];o++){let m=t[o];if(!m)continue;let L=r.indexOf(m);L>=0&&r.splice(L,1),delete t[o],m[0]=-1}}),p.length>0},parseCodeBlock=(r,t,e,s,l)=>{var i=[];if(r.forEach(c=>{!c[5]||i.push(c)}),i.length===0)return!1;if(i.length===1)return i[0][5]=0,!1;var a=i.length,n=i[0],f=[],p;n[5]=2,p=n[8];for(let c=1;c<a;c++){let o=i[c];if(!!p&&o[8]!==p){o[5]=0;continue}if(o[5]===2){if(c===a-1&&(o[5]=0),n[5]!==3){n[5]=0;continue}p=o[8]}n[5]===2?(o[3]=n[3],o[4]=n[4],o[5]=3,p=null):n[5]===3&&(o[5]=2),n=o}i[i.length-1][5]===2&&(i[i.length-1][5]=0),i.forEach(c=>{c[5]===1&&(c[5]=0)});var u=[];i=i.filter(c=>c[5]<2?!1:(c[5]===2&&u.push(c[0]),!0)),a=i.length;for(let c=a-1;c>0;c-=2){let o=i[c-1][0];u.includes(o)||i.splice(c-1,2)}var h=[];a=i.length;for(let c=0;c<a;c+=2)h.push([i[c][0],i[c+1][0]]);return h.forEach(c=>{var o=e[c[0]],m=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],L=o.indexOf(m);m=o.substr(L+m.length,o.length),m=m.replace(/^[ 　\t]+|[ 　\t]+$/g,""),m=m.toLowerCase(),(!m||m===""||m==="text")&&(m="plaintext");var O='<pre lang="'+m+'"><code>',A="</code></pre>",T=!1,g=[],b=[];if(m==="plaintext")for(let d=c[0]+1;d<c[1];d++){let v=e[d];g.push("<p>"+v+"</p>")}else for(let d=c[0]+1;d<c[1];d++){let v=e[d],E=[],$=-1,P=null,W=[],M=!1;if(T){let y=v.match(/(\\*)`/);if(!y)E.push([0,v.length-1]);else{let w=y[1].length;w>>1<<1!==w?E.push([0,v.length-1]):(T=!1,M=!0,$=0,P="`",v.replace(/(\\*)(['"`])/g,(S,C,_,x)=>{var j=C.length;!!P&&_!==P||j>>1<<1===j&&(x+=j,$===-1?($=x,P=_,_==="`"&&(M=!0)):(E.push([$,x]),$=-1,P=null,_==="`"&&(M=!1)))}),M&&(E.push([$,v.length-1]),T=!0))}}else v.replace(/(\\*)(['"`])/g,(y,w,S,C)=>{var _=w.length;!!P&&S!==P||_>>1<<1===_&&(C+=_,$===-1?($=C,P=S,S==="`"&&(M=!0)):(E.push([$,C]),$=-1,P=null,S==="`"&&(M=!1)))}),M&&(E.push([$,v.length-1]),T=!0);for(let y=E.length-1;y>=0;y--){let w=E[y],S=v.substring(0,w[0]),C=v.substring(w[0],w[1]+1),_=v.substring(w[1]+1,v.length),x="[%:"+W.length+":%]";W.push(C),v=S+x+_}v=v.replace(CodeBlockKeyWords.operator,(y,w,S,C,_)=>{var x=E.some(k=>_>=k[0]&&_<=k[1]);if(x)return y;var j=(w||"")+'<span CLASS="operatorword">'+S+"</span>"+(C||"");return j}),v=v.replace(CodeBlockKeyWords.system,(y,w,S,C,_)=>{var x=E.some(k=>_>=k[0]&&_<=k[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return y;var j=(w||"")+'<span CLASS="flowword">'+S+"</span>"+(C||"");return j}),v=v.replace(CodeBlockKeyWords.function,(y,w,S,C,_)=>{var x=E.some(k=>_>=k[0]&&_<=k[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return y;var j=(w||"")+'<span CLASS="keyword">'+S+"</span>"+(C||"");return j}),v=v.replace(CodeBlockKeyWords.consts,(y,w,S,C,_,x)=>{var j=E.some(N=>x>=N[0]&&x<=N[1]);if(j||!!w&&w.match(/[\w\d_\.]/)||!!_&&_.match(/[\w\d_\.]/))return y;var k=(w||"")+'<span CLASS="constsword">'+S+"</span>"+(_||"");return k}),v=v.replace(CodeBlockKeyWords.object,(y,w,S,C,_)=>{var x=E.some(k=>_>=k[0]&&_<=k[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return y;var j=(w||"")+'<span CLASS="objectword">'+S+"</span>"+(C||"");return j}),W.forEach((y,w)=>{var S='\\[%:(<span CLASS="constsword">)?'+w+"(</span>)?:%\\]";S=new RegExp(S),v=v.replace(S,'<span CLASS="constsword">'+y+"</span>")}),v=v.replace(/<span CLASS="/g,'<span class="'),g.push("<p>"+v+"</p>")}g=g.join(""),g=O+g+A;var R="codeblock-"+generateRandomKey();s.finals[R]=g,e[c[0]]="%"+R+"%";for(let d=c[0]+1;d<=c[1];d++)e[d]=null;for(let d=c[0];d<=c[1];d++){let v=t[d];if(!v)continue;let E=r.indexOf(v);E>=0&&r.splice(E,1),delete t[d],v[0]=-1}}),h.length>0},parseTable=(r,t,e,s,l)=>{var i=[];if(r.forEach(u=>{!u[6]||i.push(u)}),i.length!==0){var a=[],n=0,f=i[0][0];a.push([i[0]]);var p=i.length;for(let u=1;u<p;u++){let h=i[u];h[0]===f+1?a[n].push(h):(n++,a[n]=[h]),f=h[0]}return a=a.filter(u=>!(u.length<2)),a.forEach(u=>{generateTable(u,r,t,e,s,l)}),!0}},parseListAndBlockQuote=(r,t,e,s,l)=>{var i=0,a=e.length;if(r.forEach((o,m)=>{if(o[3]+o[4]!==0){var L=o[0];L<a&&(a=L),L>i&&(i=L)}}),a>i)return!1;for(let o=i+1;o<e.length-1;o++){let m=t[o],L=t[o+1];if(!!m&&m[1]>0&&!!L&&L[1]>0)break;i=o}if(i===e.length-2){let o=e.length-1,m=t[o];(!m||m[1]===0)&&(i=o)}var n=0,f=[[[a,t[a]]]],p=!1,u=!0;t[a][3]>0&&(p=!0);for(let o=a+1;o<=i;o++){var h=t[o];if(!h){u&&f[n].push([o,null]);continue}if(h[1]){if(!u)continue;let m=t[o+1];if(!m||m[1]>0){u=!1;continue}f[n].push([o,h]);continue}if(h[3]+h[4]===0){u&&f[n].push([o,h]);continue}if(u){f[n].push([o,h]);continue}n++,f[n]=[],t[o][3]>0?p=!0:p=!1,u=!0,f[n].push([o,h])}var c=!1;return f.forEach(o=>{o.forEach(A=>{var T=A[0];A[1]||(e[T]="    "+e[T])});var m=0,L=o[0][0],O=e[L],m=-1;O.match(/^[ 　\t>]/)?m=0:O.match(/^[\-\+]|[\*~][ 　\t]/)?m=1:O.match(/^\d+\.[ 　\t]/)&&(m=2),!(m<0)&&(change=!0,m===0?generateQuotes(o,r,t,e,s,l):m===1?generateList(!1,o,r,t,e,s,l):m===2&&generateList(!0,o,r,t,e,s,l))}),c},parseHeadline=(r,t,e,s,l)=>{var i=[],a=[];r.forEach(n=>{if(n[2]!==0){var f=n[0],p=t[f-1];if(p)p[1]>0&&i.push([f,e[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let u=e[f-1];if(f===0||!!u.match(/^%[\w\-]+%$/))i.push([f,e[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let h=e[f].substr(0,1);h==="="?a.push([f-1,1]):h==="-"?a.push([f-1,2]):h==="~"?a.push([f-1,3]):h==="+"?a.push([f-1,3]):h==="_"?a.push([f-1,3]):h==="*"?a.push([f-1,4]):h==="#"?a.push([f-1,5]):h==="."&&a.push([f-1,6]),e[f]=null}}}});for(let n=0;n<e.length;n++){let f=e[n];if(!f)continue;let p=f.match(/^(#+)[ 　\t]*/);if(p){let u=p[0],h=p[1];u!==f&&f.indexOf(u+"[")!==0&&(a.push([n,h.length]),e[n]=f.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return i.length+a.length===0?!1:(a.sort((n,f)=>n[0]-f[0]),i.forEach(n=>{var[f,p]=n,u="headline-"+generateRandomKey(),h="<hr";p==="="?h=h+' class="heavy">':p==="-"?h=h+' class="light">':p==="*"?h=h+' class="star">':p==="~"?h=h+' class="wavy">':p==="."?h=h+' class="dotted">':p==="_"?h=h+' class="dashed">':p==="+"?h=h+' class="strong">':p==="#"?h=h+' class="heavystrong">':h=h+">",l[u]=h,e[f]="%"+u+"%"}),a.forEach(n=>{var[f,p]=n,u="header-"+generateRandomKey(),h="h"+(p||1),c=e[f];c=parseLine(c,s),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+h+">"+c+"</"+h+">",l[u]=c,e[f]="%"+u+"%"}),!0)},parseResources=(r,t,e,s,l)=>{for(var i=[],a=!0;a;)a=!1,e.forEach(n=>{if(n.length===0)return i.push(n);n=n.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(h,c,o,m)=>{var L=s.refs[m],O;if(!L||L.indexOf("://")<0&&L.indexOf("@")<0&&!L.match(/^\.{0,2}[\\\/]/)||L.indexOf(`
`)>=0){if(O=s.metas[m.toLowerCase()],!O||O.indexOf("://")<0&&O.indexOf("@")<0&&!O.match(/^\.{0,2}[\\\/]/)||O.indexOf(`
`)>=0)return h;L=O}return c+"("+L+")"});for(var f=[],p=[],u=!0;u;)u=!1,n=n.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(h,c,o)=>(u=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?p.push(h):f.push(h),""));n=n.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.forEach(h=>i.push(h)),n.length>0&&(f.length>0&&(a=!0),i.push(n)),f.forEach(h=>i.push(h))}),e.splice(0,e.length),i.forEach(n=>e.push(n)),i=[];return!0},parseParagraph=(r,t,e,s,l)=>{var i=[],a=[],n=[],f=-1;e.forEach((p,u)=>{if(!p||p.length===0){f=-1;return}var h=p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(h){f=-1;return}if(h=p.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),h){n.push([u,p]),f=-1;return}h=p.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=h?1:0;c===f?c===0?i[i.length-1].push([u,p]):c===1&&a[a.length-1].push([u,p]):(c===0?i[i.length]=[[u,p]]:c===1&&(a[a.length]=[[u,p]]),f=c)}),a=a.filter(p=>{var u=p.length>1;return p.length===1&&n.push(p[0]),u}),i.forEach(p=>{var u=[],h=p[0][0];p.forEach(c=>{var o=c[0],m=c[1];m.length!==0&&(u.push(parseLine(m,s)),e[o]=null)}),u=u.join("<br>"),e[h]=u}),a.forEach(p=>{var u=[],h=p[0][0];p.forEach(o=>{u.push(parseLine(o[1],s)),e[o[0]]=null}),u=u.join(""),u='<div class="image-wall">'+u+"</div>";var c="imagewall-"+generateRandomKey();l[c]=u,e[h]="%"+c+"%"}),n.forEach(p=>{var[u,h]=p;h=parseLine(h,s);var c="resource-"+generateRandomKey();l[c]=h,e[u]="%"+c+"%"})},generateTable=(r,t,e,s,l,i)=>{var a=!0,n=null,f=null,p=-1,u=!1;n=s[r[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),n?(n=n[1].trim(),n.match(/\{h\}/i)&&(u=!0,n=n.replace(/\{h\}/gi,"").replace(/(^[ 　\t]+|[ 　\t]+$)/g,"")),s[r[0][0]]="",r.shift()):n=generateRandomKey(16),r.some((g,b)=>{var R=s[g[0]];R=R.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=R.match(/[\|:\-]+/);if(!!d&&(d=d[0],R===d))return f=d,p=g[0],b===0&&(a=!1),!0}),f?(f=f.replace(/^\||\|$/g,""),f=f.split("|"),f=f.map(g=>g.match(/^:\-:$/)?1:g.match(/^:\-$/)?0:g.match(/^\-:$/)?2:3)):(a=!1,f=[]);var h=[],c=0;r.forEach((g,b)=>{var R=g[0];if(R!==p){var d=parseTableRow(s[R]);h.push(d),d.length>c&&(c=d.length)}});for(let g=f.length;g<c;g++)f.push("");for(let g=0;g<h.length-1;g++){let b=h[g],R=b?b.length:c;for(let d=b.length;d<c;d++)b.push("")}var o;a&&(o=h[0],h.shift());for(let g=0;g<c;g++){if(f[g]!==3)continue;let b=!0;h.some(R=>{var d=R[g];if(!!d&&d*1!==d)return b=!1,!0}),b?f[g]=2:f[g]=0}var m='<table name="'+n+'"',L=[];u&&(m+=' hidden="true"'),m+=">",a&&(m+="<thead><tr>",o.forEach((g,b)=>{var R=!1;g.match(/\{s\}$/i)&&(R=!0,g=g.replace(/[ 　\t]*\{s\}$/i,""));var d=!1;g.match(/\{h\}$/i)&&(L[b]=!0,d=!0,g=g.replace(/[ 　\t]*\{h\}$/i,"")),g=parseLine(g,l);var v='<th align="',E=f[b];E===1?v+="center":E===2?v+="right":v+="left",R&&(v+='" sortable="true'),v+='"',d&&(v+=' hidden="true"'),v+=">"+g+"</td>",m+=v}),m+="</tr></thead>"),m+="<tbody>";var O=[];h.forEach((g,b)=>{g.forEach((R,d)=>{var v=R.match(/^[ 　\t]*CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!v){var E=v[1]*1;(isNaN(E)||E<1)&&(E=1);var $=v[2];O[d]=[E,$,b+1]}})}),O.length>0&&calculateTable(h,O);var A=[];h.forEach((g,b)=>{m+="<tr>";var R=[];g.forEach((d,v)=>{d=parseLine(d,l);var E=d.replace(/<.*?>/gi,"");R[v]=E.trim();var $='<td align="',P=f[v];P===1?$+="center":P===2?$+="right":$+="left",$+='"',L[v]&&($+=' hidden="true"'),$+=">"+d+"</td>",m+=$}),m+="</tr>",A[b]=R}),m+="</tbody></table>",l.tables=l.tables||{},l.tables[n]=A;var T="table-"+generateRandomKey();i[T]=m,o=r[0][0],total=r.length;for(let g=0;g<total;g++){let b=r[g],R=b[0];s[R]=null,delete e[R];let d=t.indexOf(b);d>=0&&t.splice(d,1),b[0]=-1}s[o]="%"+T+"%"},calculateTable=(r,t)=>{var e=[],s=[];t.forEach((i,a)=>{if(!!i){var[n,f,p]=i;e[n]=e[n]||[],e[n].push([a,parseEquation(f,p,s)])}});var l=[];r.forEach((i,a)=>{list=[],s.forEach(n=>{var f=i[n]*1;isNaN(f)&&(f=0),list[n]=f}),l.push(list)}),e.forEach(i=>{!i||i.length===0||r.forEach((a,n)=>{i.forEach(([f,p])=>{var u="";try{u=p(l,n),l[n]=l[n]||[],l[n][f]=u,u=u+""}catch{u=""}a[f]=u})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\(\)\+\-\*\/ ]+)(!+)/g,(r,t,e)=>"MathTools.factorial("+t+","+e.length+")").replace(/([a-zA-Z]+)(\d+)/gi,(r,t,e)=>{if(!t||!e||(e=e*1,e*1!==e)||(t=t.replace(/\w/g,l=>Char2Dig[l.toLowerCase()]),t=parseInt(t,26),isNaN(t)))return"0";dataCol.includes(t)||dataCol.push(t);var s=e-line;return s===0?"((dataList[lineNum]||[])["+t+"]||0)":s>0?"((dataList[lineNum+"+s+"]||[])["+t+"]||0)":(s*=-1,"((dataList[lineNum-"+s+"]||[])["+t+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,r=>"Math."+r.toLowerCase()).replace(/per(mutate)?/gi,r=>"MathTools.permutate").replace(/com(binate)?/gi,r=>"MathTools.combinate").replace(/round/gi,r=>"MathTools.round").replace(/ceil/gi,r=>"MathTools.ceil").replace(/floor/gi,r=>"MathTools.floor"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=r=>{r.substr(0,1)!=="|"&&(r="|"+r),r.substr(r.length-1,1)!=="|"&&(r=r+"|");var t=r.length,e=0,s=[],l=0;for(let i=1;i<t;i++){let a=r.substr(i,1);if(a==="|"&&e===0){s.push(r.substr(l+1,i-l-1)),l=i;continue}"([{<".indexOf(a)>=0?e++:">}])".indexOf(a)>=0&&e--}return s},generateQuotes=(r,t,e,s,l,i)=>{var a="quote",n=s[r[0][0]];if(n=n.match(/^>[ 　\t]*\[([\w\W]+?)\]/),n){let h=n[1];h=h.replace(/^[ 　\t]+|[ 　\t]+$/g,""),h.length>0&&!l.metas[h]&&!l.blocks[h]&&(a=h)}var f=!0;n=r.map((h,c)=>{var o=h[0],m=s[o];c>0&&(f=f&&!!m.match(/^(\t|　　|    | 　 |  　|　  )/));var L=m.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return L!==m&&f?m=L:(head=m.match(/^>[ 　\t]*/),head&&(head=head[0],m=m.replace(head,""))),m}),n[0]=n[0].replace(new RegExp("^[ \u3000\\t]*\\["+a.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),n=n.join(`
`),n=n.replace(/^\n+|\n+$/g,"");var p='<blockquote class="'+a+'">';n=parseSection(n,l,2,i),p+=n,p+="</blockquote>";var u="blockquote-"+generateRandomKey();i[u]=p,r.forEach(h=>{var c=h[0];s[c]=null,delete e[c];var o=t.indexOf(h[1]);o>=0&&t.splice(o,1)}),s[r[0][0]]="%"+u+"%"},generateList=(r,t,e,s,l,i,a)=>{var n=[],f=-1;t.forEach(h=>{var c=h[0],o=l[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),f++,n[f]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),n[f].push(o)}),n=n.map(h=>(h=h.join(`
`),h=h.replace(/^\n+|\n+$/g,""),h));var p="";r?p="<ol>":p="<ul>",n.forEach(h=>{p+="<li>",p+=parseSection(h,i,2,a),p+="</li>"}),r?p+="</ol>":p+="</ul>";var u="list-"+generateRandomKey();a[u]=p,t.forEach(h=>{var c=h[0];l[c]=null,delete s[c];var o=e.indexOf(h[1]);o>=0&&e.splice(o,1)}),l[t[0][0]]="%"+u+"%"},analyzeSections=(r,t)=>{var e=[[]],s=0,l=[0],i=[];if(r.forEach(a=>{var n=!1;a=a.replace(/^<h(\d+)>/i,(f,p)=>{n=!0,p=p*1,p===1&&(s++,e[s]=[]),l[p-1]=(l[p-1]||0)+1;for(let h=p;h<l.length;h++)l[h]=0;var u="chap";for(let h=0;h<p;h++)u+="-"+(l[h]||1);return f=f+'<a name="'+u+'">',i.push([p,u,a.replace(/<[\w\W]+?>/gi,"")]),f}).replace(/<\/h(\d+)>$/i,f=>"</a>"+f).replace(/\{([\w \-\.]+)\}/g,(f,p)=>{var u=t.termList[p];return u?(Array.isArray(u)&&(u=u[0]),'<a class="terminology" name="'+p+'" href="#ref-'+p+'"><strong>'+u+"</strong></a>"):f}),e[s].push(a)}),e=e.filter(a=>a.length>0),t.chapList=i,e=applyFootNotes(e,t),!!t.endnotes&&t.endnotes.length>0&&e.push(applyEndNotes(t)),t.metas.glossary&&!!t.termList&&t.termList.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',a+=generateGlossary(t),a+="</section>",e.push(a)}if(t.image=t.image||[],t.video=t.video||[],t.audio=t.audio||[],t.metas.resources&&t.image.length+t.video.length+t.audio.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',t.image.length>0&&(a+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',a+=generateResourceList(t,"image")),t.video.length>0&&(a+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',a+=generateResourceList(t,"video")),t.audio.length>0&&(a+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',a+=generateResourceList(t,"audio")),a+="</section>",e.push(a)}if(t.metas.showtitle){let a='<header class="article-title">';if(a+="<p>"+t.metas.title+"</p>",t.metas.showauthor&&(t.metas.author&&(a+='<p class="author">',t.metas.email&&(a+='<a href="mailto:'+t.metas.email+'">'),a+=t.metas.author,t.metas.email&&(a+="</a>"),a+="</p>"),t.metas.date)){a+='<p class="author date">';let n=t.metas.date*1;if(isNaN(n))n=t.metas.date;else{n=new Date(n);let f=n.getYear()+1900,p=n.getMonth()+1;p<10&&(p="0"+p);let u=n.getDate();u<10&&(u="0"+u);let h=n.getHours();h<10&&(h="0"+h);let c=n.getMinutes();c<10&&(c="0"+c);let o=n.getSeconds();o<10&&(o="0"+o),n=f+"/"+p+"/"+u+" "+h+":"+c+":"+o}a+=n,a+="</p>"}a+="</header>",e.unshift(a)}return e},applyBlockReference=(r,t)=>{for(var e=!0,s=0;e&&(e=!1,r=r.map(l=>(l=l.replace(/\[([\w \-\.]+?)\]/g,(i,a,n)=>{var f=l.lastIndexOf("<sup>",n),p=l.lastIndexOf("</sup>",n);if(f>p)return i;var u=t.blocks[a];return u?(e=!0,u):i}),l)),s++,s!==10););return r},applyMarkUpReference=(r,t)=>{var e=(t.metas.LANG||"zh").toLowerCase();if(r=r.map(s=>(s=s.replace(/%glossary%/gi,l=>generateGlossary(t)),s=s.replace(/%resources%/gi,l=>generateResourceList(t,"image")+generateResourceList(t,"video")+generateResourceList(t,"audio")),s=s.replace(/%images%/gi,l=>generateResourceList(t,"image")),s=s.replace(/%videos%/gi,l=>generateResourceList(t,"video")),s=s.replace(/%audios%/gi,l=>generateResourceList(t,"audio")),s=s.replace(/%toc%(\{[\w\W]+?\})*/gi,l=>{var i=l.match(/\{[\w\W]+?\}/g),a="\u76EE\u5F55",n=3;return i&&i.forEach(f=>{f=f.substr(1,f.length-2);var p=f*1;isNaN(p)?a=f:n=p}),t.toced=!0,generateTableOfContent(t,a,n)}),Object.keys(t.metas).forEach(l=>{var i=l.toLowerCase();PreservedKeywords.includes(l)||(i=t.metas[l],i===!0||i===!1?e==="zh"?i=i?"\u662F":"\u5426":i=i?"On":"Off":Array.isArray(i)&&(e==="zh"?i=i.join("\u3001"):i=i.join(", ")),s=s.replace(new RegExp("%"+l+"%","gi"),a=>i))}),s=s.replace(/%([\w \-\.]+)%/g,(l,i)=>{var a=t.finals[i];return a||l}),s)),t.metas.toc&&!t.toced){let s=generateTableOfContent(t,"\u76EE\u5F55",3);s.indexOf('<p class="content-')>=0&&(s="<section>"+s+"</section>",t.metas.showtitle?r.splice(1,0,s):r.unshift(s))}return r},applyFootNotes=(r,t)=>(r=r.map(e=>{var s=[],l="<section>",i="</section>";return e.forEach((a,n)=>{var f=!1;a=a.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(p,u)=>{f=!0,s.push(u);var h=p.substr(0,p.length-1)+' href="#footnote-'+u+'">';return h}),f&&(e[n]=a)}),e=e.join(""),s.length===0||(s=s.map((a,n)=>{var f=t.refs[a],p=t.footnotes.indexOf(a);return n++,e=e.replace(new RegExp("%%FN-"+p+"%%","g"),n),'<p class="footnote-content"><a class="index" name="footnote-'+a+'">'+n+"\uFF1A</a>"+f+"</p>"}),e+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',e+=s.join(""),e+='</footer><hr class="footnote-line end">'),l+e+i}),r),applyEndNotes=r=>{let t='<hr class="endnote-line">';return t+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',r.endnotes.forEach((e,s)=>{t+='<p class="endnote-content"><a class="index" name="endnote-'+e+'">'+(s+1)+"\uFF1A</a>"+r.refs[e]+"</p>"}),t+="</section>",t},generateTableOfContent=(r,t,e)=>{var s='<h1 name="ContentTable">'+t+'</h1><aside class="content-table">';return r.chapList.forEach(l=>{if(!(l[0]>e)){var i='<p class="content-item level-'+l[0]+'">';for(let a=0;a<l[0];a++)i+='<span class="content-indent"></span>';i+='<a class="content-link" href="#'+l[1]+'">'+l[2]+"</a>",i+="</p>",s+=i}}),!!r.endnotes&&r.endnotes.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),r.metas.glossary&&!!r.termList&&r.termList.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),r.metas.resources&&r.image.length+r.video.length+r.audio.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',r.image.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),r.video.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),r.audio.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),s+="</aside>",s},generateGlossary=r=>{var t="";return r.termList===0?"":(r.termList.forEach(e=>{var[s,l]=e,i=r.terms[s],a='<p class="glossary-item">';a+='<a class="glossary-indent" name="ref-'+s+'">'+l+"</a>",a+=i,a+="</p>",t+=a}),t)},generateResourceList=(r,t)=>{var e=r[t];if(!e||!Array.isArray(e)||e.length===0)return"";var s=[],l="<ul>";return e.forEach(i=>{var a=i[1];a=a.replace(/\%([\w \-]+?)\%/g,(n,f)=>{var p=ReversePreserveWords[f.toLowerCase()];return p||n}),!s.includes(a)&&(s.push(a),l+='<li><a href="'+a+'" target="_blank">'+a+"</a></li>")}),l+="</ul>",l},convertPreserves=r=>(r=r.replace(/(\\+)(.)/g,(t,e,s)=>{var l=Math.floor(e.length/2),i=l*2!==e.length,a="",n="%"+PreserveWords["\\"]+"%";for(let f=0;f<l;f++)a+=n;if(i){let f=PreserveWords[s];f?a=a+"%"+f+"%":a=a+s}else a=a+s;return a}),r),restorePreserves=(r,t,e=!0)=>{for(var s=!0;s;)s=!1,r=r.replace(/\%([\w \-]+?)\%/g,(l,i)=>{var a=t[i];return a?(s=!0,a):l});if(!e)return r;for(s=!0;s;)s=!1,r=r.replace(/\%([\w \-]+?)\%/g,(l,i)=>{var a=t[SymHidden][i.toLowerCase()];return a?(s=!0,a):l});return r=r.replace(/\n+/g,"<br>"),r=r.replace(/\/{2}/g,(l,i)=>{if(i===0)return"<br>";var a=r.substr(i-1,1);return a===":"?l:"<br>"}),r=r.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),r},getKeywords=r=>{if(!r)return[];r=r.split(/[ ,，；;、　]+/).filter(e=>e.length>0);var t=[];return r.forEach(e=>{t.includes(e)||t.push(e)}),t},getMetas=(r,t)=>{for(var e={},s=!0;s;)s=!1,t=t.replace(/\n([A-Z\u0800-\uffff]+?) *[:：] *([\w\W]*?)\n/,(l,i,a)=>a.length===0||(i==="\u6807\u9898"?i="title":i==="\u4F5C\u8005"?i="author":i==="\u7B80\u4ECB"?i="description":i==="\u5173\u952E\u8BCD"?i="keyword":i==="\u66F4\u65B0"?i="date":i=i.toLowerCase(),!MetaWords.includes(i))?l:(s=!0,e[i]=a,`
`));if(!!e.showtitle&&["on","yes","true"].includes(e.showtitle.toLowerCase())?e.showtitle=!0:e.showtitle=void 0,!!e.glossary&&["on","yes","true"].includes(e.glossary.toLowerCase())?e.glossary=!0:e.glossary=void 0,!!e.links&&["on","yes","true"].includes(e.links.toLowerCase())?e.links=!0:e.links=void 0,!!e.refs&&["on","yes","true"].includes(e.refs.toLowerCase())?e.refs=!0:e.refs=void 0,!!e.terms&&["on","yes","true"].includes(e.terms.toLowerCase())?e.terms=!0:e.terms=void 0,!!e.resources&&["on","yes","true"].includes(e.resources.toLowerCase())?e.resources=!0:e.resources=void 0,!!e.toc&&["on","yes","true"].includes(e.toc.toLowerCase())?e.toc=!0:e.toc=void 0,r.metas=e,r.metas.keyword=getKeywords(r.metas.keyword),r.metas.date)try{r.metas.date=new Date(r.metas.date).getTime()}catch{delete r.metas.date}for(r.metas.god=r.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',r.metas.script?r.metas.script=r.metas.script.split(/[,; 　\t]+/):r.metas.script=[],r.metas.style?r.metas.style=r.metas.style.split(/[,; 　\t]+/).map(l=>l.replace(/\{[\w\W]*\}/,"")):r.metas.style=[],r.termList=r.termList||[],r.mainParser=!1,r.refs={},s=!0;s;)s=!1,t=t.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(l,i,a,n,f)=>(i=i.trim(),a=a.trim(),i.length===0||a.length===0?l:(r.refs[i]=a,s=!0,`
`+n)));for(r.blocks={},s=!0;s;)s=!1,t=t.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(l,i,a)=>{if(i=i.trim(),!(i.length===0||a.length===0))return r.blocks[i]=a,s=!0,""});return r.anchors=[],r.terms={},r.notes={},t.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(l,i,a,n)=>{var f=a||n;r.refs[f]?i.substr(0,1)==="{"?r.terms[f]=f:r.notes[f]=f:i.substr(0,1)==="{"&&!r.anchors.includes(f)&&r.anchors.push(f)}),t=regularize(t),t};MarkUp.fullParse=(r,t)=>{var e={finals:{},toced:!1};t=t||{};var s=r.replace(/\n标题[:：][ 　\t]*/gi,`
`).replace(/\n作者[:：][ 　\t]*/gi,`
`).replace(/\n简介[:：][ 　\t]*/gi,`
`).replace(/\n关键词[:：][ 　\t]*/gi,`
`).replace(/\n更新[:：][ 　\t]*/gi,`
`);for(MetaWords.forEach(n=>{var f=new RegExp(`
`+n+"[:\uFF1A][ \u3000\\t]*","gi");s=s.replace(f,`
`)}),PreservedKeywords.forEach(n=>{var f=new RegExp("\\["+n+"\\]","gi");s=s.replace(f,"")});;){let n=s.replace(/\[(.*?)\][ 　\t]*\[.*?\]/g,(f,p)=>p).replace(/\[(.*?)\][ 　\t]*\{.*?\}/g,(f,p)=>p).replace(/\[(.*?)\][ 　\t]*\(.*?\)/g,(f,p)=>p).replace(/<\w.*?\w>|<\w>/g,"").replace(/\n[ 　\t]*(\-+|\++|#+|>|=+|\*+|~+|`+|\$+|\d+\.)[ 　\t]*/g,`
`);if(s===n)break;s=n}s=s.match(/[\u4e00-\u9fa5]|[a-zA-Z0-9]+/gi)||"",s=s.length||0,r=prepare(r),r=getMetas(e,r),e.parseLevel=0,e.mainParser=!0,e.metas.title=e.metas.title||"\u65E0\u540D\u6587";var l=Object.keys(e.metas);Object.keys(t).forEach(n=>{l.includes(n)||l.push(n)}),t.overwrite?l.forEach(n=>{e.metas[n]=t[n]===null||t[n]===void 0?e.metas[n]:t[n]}):l.forEach(n=>{e.metas[n]=e.metas[n]===null||e.metas[n]===void 0?t[n]:e.metas[n]}),l.forEach(n=>{(e.metas[n]===null||e.metas[n]===void 0)&&(e.metas[n]=!1)}),r=parseSection(r,e),Object.keys(e.refs).forEach(n=>{var f=e.refs[n];f=parseLine(f,e),f=f.replace(/\%([\w \-]+?)\%/g,(p,u)=>{var h=ReversePreserveWords[u.toLowerCase()];return h||p}),e.refs[n]=f}),Object.keys(e.blocks).forEach(n=>{var f=e.blocks[n],p=f.match(/^\n+/);f=f.trim();var u;e.parseLevel=0,p?u=parseSection(f,e,1):u=[parseLine(f,e)],e.blocks[n]=u.join("")});for(let n in e.terms)e.terms[n]=e.refs[n];for(let n in e.notes)e.notes[n]=e.refs[n];r=r.map(n=>n.replace(/\%([\w \-]+?)\%/g,(f,p)=>{var u=ReversePreserveWords[p.toLowerCase()];return u||f})),r=applyBlockReference(r,e),r=analyzeSections(r,e),r=applyMarkUpReference(r,e),e.metas.classname?r='<article class="'+e.metas.classname+'">'+r.join("")+"</article>":r="<article>"+r.join("")+"</article>",e.metas.fullexport&&(e.metas.style.forEach(n=>{r+='<link type="text/css" rel="stylesheet" href="'+n+'">'}),e.metas.script.forEach(n=>{r+='<script type="text/javascript" src="'+n+'"></script>'}));var i=FinalRender._indexes_||[];i.forEach(n=>{var f=FinalRender[n];!f||f.forEach(p=>{r=p.parse(r,e)})}),r=r.replace(/<p>(<br\/?>)+<\/p>/gi,"");var a={};return a.content=r,a.title=e.metas.title,a.lineCount=e.metas.totalLineCount,a.chapList=e.chapList,a.tables=e.tables,a.meta={},a.meta.author=e.metas.author,a.meta.email=e.metas.email,a.meta.description=e.metas.description,a.meta.update=e.metas.date,a.meta.keywords=e.metas.keyword.map(n=>n),e.metas.others&&(a.meta.others=e.metas.others),a.terminology={},e.termList.forEach(n=>{a.terminology[n[0]]=n[1]}),a.notes={},Object.keys(e.refs).forEach(n=>{a.notes[n]=e.refs[n]}),a.blocks={},Object.keys(e.refs).forEach(n=>{a.blocks[n]=e.blocks[n]}),a.wordCount=s,a},MarkUp.parse=(r,t)=>{var e;return e=MarkUp.fullParse(`
`+r+`
`,t),e?e.content:""};const reverseSection=(r,t)=>{t.__level++;var e=[],s="",l=!0;return r.childNodes.forEach(i=>{var a=i.tagName;if(!a){if(i.nodeName==="#comment")return;let f=i.textContent||"";f=f.trim(),f.length>0&&(s+=f);return}a=a.trim().toLowerCase();var n;if(ParagraphTags.includes(a)){if(l=!1,s.length>0&&(e.push(t.__prefix+s),s=""),a==="blockquote"){let f=t.__prefix;t.__prefix=t.__prefix+">	",n=reverseSection(i,t),n=n.flat(Infinity),n.push(`
`),t.__prefix=f}else if(a==="ol"){let f=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"1.	",n=reverseSection(i,t),n=n.flat(Infinity),n.push(""),t.__prefix=f}else if(a==="ul"){let f=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"-	",n=reverseSection(i,t),n=n.flat(Infinity),n.push(""),t.__prefix=f}else n=reverseSection(i,t),n=n.flat(Infinity),n.push("");!!n&&n.length>0&&e.push(...n)}else{let[f,p]=reverseMix(i,a,t);p?f.length>0&&(s+=f.join("")):(s.length>0&&(e.push(t.__prefix+s),s=""),f.forEach(u=>{e.push(t.__prefix+u)}))}}),s.length>0&&e.push(t.__prefix+s),t.__level--,e},reverseLine=(r,t)=>{var e="";return r.childNodes.forEach(s=>{var l=s.tagName;if(!l){if(s.nodeName==="#comment")return;let i=s.textContent||"";i=i.trim(),i.length>0&&(e+=i);return}if(l=l.trim().toLowerCase(),l==="a"){let i=s.href;i.indexOf("javascript:")===0&&(i="");let a=reverseLine(s,t);!i||i.substr(0,1)==="#"||(i.match(/^(ftp|https?):\/\//i)||(i=t.host+i),a="["+a+"]("+i+")"),e+=a;return}if(l==="span"||l==="font"){e+=reverseLine(s,t);return}if(l==="strong"||l==="b"){e+=reverseLine(s,t);return}if(l==="em"||l==="i"){e+=reverseLine(s,t);return}if(l==="sup"){e+=reverseLine(s,t);return}if(l==="sub"){e+=reverseLine(s,t);return}if(l==="del"){e+=reverseLine(s,t);return}e+=s.innerText}),e},reverseMix=(r,t,e)=>{if(t==="script")return[[""],!0];if(t==="style")return[[""],!0];if(t==="link")return[[""],!0];if(t==="hr")return[[`
---
`],!1];if(t==="br")return[[`
`],!0];if(t.match(/^h\d+$/)){let l=t.substring(1,t.length);l*=1;let i=`
`;for(let n=0;n<l;n++)i+="#";let a=reverseLine(r,e);return a=i+a+`
`,[[a],!1]}if(t==="a"){let l=r.href;l.indexOf("javascript:")===0&&(l="");let i=reverseLine(r,e);return!l||l.substr(0,1)==="#"?[[i],!0]:(l.match(/^(ftp|https?):\/\//i)||(l=e.host+l),i="["+i+"]("+l+")",[[i],!0])}if(t==="img")return r.src.length===0?[[""],!0]:[[`
![](`+r.src+`)
`],!1];if(t==="video")return r.src.length===0?[[""],!0]:[[`
@[](`+r.src+`)
`],!0];if(t==="audio")return r.src.length===0?[[""],!0]:[[`
#[](`+r.src+`)
`],!0];if(t==="span"||t==="font")return[[reverseLine(r,e)],!0];if(t==="strong"||t==="b"){let l=reverseLine(r,e);return[["**"+l+"**"],!0]}if(t==="em"||t==="i"){let l=reverseLine(r,e);return[["*"+l+"*"],!0]}if(t==="u"){let l=reverseLine(r,e);return[["__"+l+"__"],!0]}if(t==="sup"){let l=reverseLine(r,e);return[["^"+l+"^"],!0]}if(t==="sub"){let l=reverseLine(r,e);return[["_"+l+"_"],!0]}if(t==="del"){let l=reverseLine(r,e);return[["~~"+l+"~~"],!0]}var s=reverseLine(r,e);return[[s],!1]};MarkUp.reverse=(r,t,e=!0)=>{if(!r)return"";t=t||{},t.__level=0,t.__prefix="",t.host=t.host||"";var s=reverseSection(r,t);return s=s.flat(Infinity),s=s.join(`
`),s=s.replace(/\n{2,}/g,`

`),s},MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch{try{global.MarkUp=MarkUp}catch(r){console.error(r)}}})();
