(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(t,a=1){return a<1||t<=a?1:t*MathTools.factorial(t-a,a)},permutate(t,a){return t<=1?1:a<=1?t:a>t?1:(t-a+1)*MathTools.permutate(t,a-1)},combinate(t,a){return t<=1||a<=0||a>=t?1:(t-a+1)/a*MathTools.combinate(t,a-1)},round(t,a=0){var r=10**a;return t*=r,t=Math.round(t),t/r},floor(t,a=0){var r=10**a;return t*=r,t=Math.floor(t),t/r},ceil(t,a=0){var r=10**a;return t*=r,t=Math.ceil(t),t/r}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(t=>ReversePreserveWords[PreserveWords[t].toLowerCase()]=t),ReversePreserveWords.$="&#36;",MetaWords.forEach((t,a)=>MetaWords[a]=t.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(t=8)=>{var a="";for(let r=0;r<t;r++)a+=Math.floor(Math.random()*10)+"";return a};MarkUp.addExtension=(t,a=0,r=5)=>{if(a===0){let n=LineRender._indexes_;n||(n=[],LineRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=LineRender[r],n||(n=[],LineRender[r]=n),n.push(t)}else if(a===1){let n=BlockRender._indexes_;n||(n=[],BlockRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=BlockRender[r],n||(n=[],BlockRender[r]=n),n.push(t)}else if(a===2){let n=FinalRender._indexes_;n||(n=[],FinalRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=FinalRender[r],n||(n=[],FinalRender[r]=n),n.push(t)}};const prepare=t=>(t=`
`+t+`
`,t=t.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(a,r)=>{var n=r.replace(/　/g,"  ").length;return n<4?`
`:a}),t=t.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(a,r,n)=>r+`
`+n),MetaWords.forEach(a=>{var r=new RegExp("([\\w\\W]? *)\\["+a+"\\]( *[\\w\\W]?)","gi");t=t.replace(r,(n,l,s)=>l==="]"||s==="["||s==="("?n:l+"%"+a+"%"+s)}),t),regularize=t=>(t=t.replace(/^\n+|\n+$/gi,""),t=t.replace(/\n{3,}/gi,`


`),t),parseLine=(t,a,r=-Infinity,n)=>{var l=LineRender._indexes_;if(!l)return"";var s=!n;return n=n||{},l.some(e=>{if(r>e||e>=0)return!0;for(var i=LineRender[e],u=!0;u;)u=!1,i.forEach(p=>{var f;[t,f]=p.parse(t,a,n),f&&(u=!0)})}),t=convertPreserves(t),l.forEach(e=>{if(!(r>e)&&!(e<0))for(var i=LineRender[e],u=!0;u;)u=!1,i.forEach(p=>{var f;[t,f]=p.parse(t,a,n),f&&(u=!0)})}),s&&(t=restorePreserves(t,n)),t},parseSection=(t,a,r=0,n)=>{a.parseLevel++;var l=[],s=!1;n||(s=!0,n={});var e=[];l=t.split(`
`),l.forEach((p,f)=>{var h=p.match(/^[ 　\t]*$/);if(p.length===0){e.push([f,1,0,0,0,0,0,0]);return}if(p.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){p.match(/^\-+$|^=+$/)?e.push([f,0,2,0,0,0,0,0]):p.match(/^~+$/)?e.push([f,0,2,0,0,1,0,0]):e.push([f,0,1,0,0,0,0,0]);return}if(h=p.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?e.push([f,0,0,0,0,2,0,0,h[1]]):e.push([f,0,0,0,0,1,0,0,h[1]]);return}if(h=p.match(/^\${2}[ 　\t]*$/),h){h[2]?e.push([f,0,0,0,0,0,0,1]):e.push([f,0,0,0,0,0,0,1]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),h){if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?e.push([f,0,0,0,1,2,0,0]):e.push([f,0,0,0,1,1,0,0]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?e.push([f,0,0,0,1,0,0,1]):e.push([f,0,0,0,1,0,0,1]);return}e.push([f,0,0,0,1,0,0,0]);return}if(h=p.match(/^(> *)+/),h){if(h=p.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?e.push([f,0,0,1,0,2,0,0]):e.push([f,0,0,1,0,1,0,0]);return}if(h=p.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?e.push([f,0,0,1,0,0,0,1]):e.push([f,0,0,1,0,0,0,1]);return}e.push([f,0,0,1,0,0,0,0]);return}if(h=p.match(/^([ 　\t]+)/),h){if(h=p.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?e.push([f,0,0,1,1,2,0,0]):e.push([f,0,0,1,1,1,0,0]);return}if(h=p.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?e.push([f,0,0,1,1,0,0,1]):e.push([f,0,0,1,1,0,0,1]);return}e.push([f,0,0,1,1,0,0,0]);return}if(h=p.match(/\|/g),h){let c=p.match(/\\\|/g);if(!c||!!c&&c.length!==h.length){let o=!0;for(c=p;o;){o=!1;let m=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");m=m.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),m=m.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=m!==c,c=m}if(c.indexOf("|")>=0){e.push([f,0,0,0,0,0,1,0]);return}}}});var i={};e.forEach(p=>{i[p[0]]=p});var u=!1;if(e.length>0){if(u=parseLaTeX(e,i,l,a,n)||u,e.length>0&&(u=parseCodeBlock(e,i,l,a,n)||u),e.length>0&&(u=parseTable(e,i,l,a,n)||u),s&&r===0&&!!a.metas.linenumber){let p=0;l.forEach((f,h)=>{if(!!f&&!f.match(/^%[\w\-]+%$/)){var c=i[h];if(!(!!c&&(c[1]>0||c[2]>0))&&!f.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=f.match(/\{[<\|>]\}$/);o?(o=o[0],f=f.substr(0,f.length-o.length)+'<span name="line-'+p+'"></span>'+o):f=f+'<span name="line-'+p+'"></span>',p++,l[h]=f}}}),a.metas.totalLineCount=p}[l,i]=squeezeContents(e,i,l),e.length>0&&(u=parseListAndBlockQuote(e,i,l,a,n)||u,[l,i]=squeezeContents(e,i,l)),e.length>0&&(u=parseHeadline(e,i,l,a,n)||u,[l,i]=squeezeContents(e,i,l))}return u=parseResources(e,i,l,a,n)||u,[l,i]=squeezeContents(e,i,l),u=parseParagraph(e,i,l,a,n)||u,l=l.map(p=>{if(p===null||p===void 0||p.length===0)return"";var f="";if(s)p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?f=restorePreserves(p,n,!1):(f=parsePlainParaStyle(p,a),f=restorePreserves(f,n,!1));else{f=parsePlainParaStyle(p,a);let h="param-"+generateRandomKey();n[h]=f,f="%"+h+"%"}return f}),a.parseLevel--,a.parseLevel>0&&(l=l.join("")),l},squeezeContents=(t,a,r)=>(r=r.map((n,l)=>[l,n]),r=r.filter(n=>!(!n[1]&&n[1]!=="")),r.forEach((n,l)=>{var s=n[0],e=a[s];!e||(e[0]=l)}),a={},t.forEach(n=>{a[n[0]]=n}),r=r.map(n=>n[1]),[r,a]),parsePlainParaStyle=(t,a)=>{var r="<p",n="</p>",l=[],s=t.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),e=s.match(/^\{[<\|>]\}/);e&&(e=e[0],e==="{<}"?l.push("align-left"):e==="{|}"?l.push("align-center"):e==="{>}"&&l.push("align-right"),t=t.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(u,p)=>p||"")),s=t.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),e=s.match(/\{[<\|>]\}$/),e&&(e=e[0],e==="{<}"?l.push("align-left"):e==="{|}"?l.push("align-center"):e==="{>}"&&l.push("align-right"),t=t.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(u,p)=>p||"")),s=t.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var i=s.match(/^:+/);return!!i&&!s.match(/^:([\w\-\.]+?):/)&&(i=i[0],l.push("indent","indent-"+i.length),t=t.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(u,p)=>p||"")),l.length>0&&(r=r+' class="'+l.join(" ")+'"'),r=r+">",t.length===0?"":r+t+n},parseLaTeX=(t,a,r,n,l)=>{var s=[];if(t.forEach(f=>{!f[7]||s.push(f)}),s.length===0)return!1;if(s.length===1)return s[0][7]=0,!1;var e=s.length,i=s[0];i[7]=2;for(let f=1;f<e;f++){let h=s[f];i[7]===2?(h[3]=i[3],h[4]=i[4],h[7]=3):i[7]===3&&(h[7]=2),i=h}s[s.length-1][7]===2&&(s[s.length-1][7]=0),s.forEach(f=>{f[7]===1&&(f[7]=0)});var u=[];s=s.filter(f=>f[7]<2?!1:(f[7]===2&&u.push(f[0]),!0)),e=s.length;for(let f=e-1;f>0;f-=2){let h=s[f-1][0];u.includes(h)||s.splice(f-1,2)}var p=[];e=s.length;for(let f=0;f<e;f+=2)p.push([s[f][0],s[f+1][0]]);return p.forEach(f=>{var h=['<p class="latex block">$$'];for(let o=f[0]+1;o<f[1];o++)h.push(r[o]);h.push("$$</p>"),h=h.join("<br>");var c="latex-"+generateRandomKey();n.finals[c]=h,r[f[0]]="%"+c+"%";for(let o=f[0]+1;o<=f[1];o++)r[o]=null;for(let o=f[0];o<=f[1];o++){let m=a[o];if(!m)continue;let y=t.indexOf(m);y>=0&&t.splice(y,1),delete a[o],m[0]=-1}}),p.length>0},parseCodeBlock=(t,a,r,n,l)=>{var s=[];if(t.forEach(c=>{!c[5]||s.push(c)}),s.length===0)return!1;if(s.length===1)return s[0][5]=0,!1;var e=s.length,i=s[0],u=[],p;i[5]=2,p=i[8];for(let c=1;c<e;c++){let o=s[c];if(!!p&&o[8]!==p){o[5]=0;continue}if(o[5]===2){if(c===e-1&&(o[5]=0),i[5]!==3){i[5]=0;continue}p=o[8]}i[5]===2?(o[3]=i[3],o[4]=i[4],o[5]=3,p=null):i[5]===3&&(o[5]=2),i=o}s[s.length-1][5]===2&&(s[s.length-1][5]=0),s.forEach(c=>{c[5]===1&&(c[5]=0)});var f=[];s=s.filter(c=>c[5]<2?!1:(c[5]===2&&f.push(c[0]),!0)),e=s.length;for(let c=e-1;c>0;c-=2){let o=s[c-1][0];f.includes(o)||s.splice(c-1,2)}var h=[];e=s.length;for(let c=0;c<e;c+=2)h.push([s[c][0],s[c+1][0]]);return h.forEach(c=>{var o=r[c[0]],m=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],y=o.indexOf(m);m=o.substr(y+m.length,o.length),m=m.replace(/^[ 　\t]+|[ 　\t]+$/g,""),m=m.toLowerCase(),(!m||m===""||m==="text")&&(m="plaintext");var O='<pre lang="'+m+'"><code>',v="</code></pre>",E=!1,L=[],d=[];if(m==="plaintext")for(let b=c[0]+1;b<c[1];b++){let g=r[b];L.push("<p>"+g+"</p>")}else for(let b=c[0]+1;b<c[1];b++){let g=r[b],$=[],P=-1,A=null,W=[],M=!1;if(E){let _=g.match(/(\\*)`/);if(!_)$.push([0,g.length-1]);else{let w=_[1].length;w>>1<<1!==w?$.push([0,g.length-1]):(E=!1,M=!0,P=0,A="`",g.replace(/(\\*)(['"`])/g,(S,C,R,j)=>{var x=C.length;!!A&&R!==A||x>>1<<1===x&&(j+=x,P===-1?(P=j,A=R,R==="`"&&(M=!0)):($.push([P,j]),P=-1,A=null,R==="`"&&(M=!1)))}),M&&($.push([P,g.length-1]),E=!0))}}else g.replace(/(\\*)(['"`])/g,(_,w,S,C)=>{var R=w.length;!!A&&S!==A||R>>1<<1===R&&(C+=R,P===-1?(P=C,A=S,S==="`"&&(M=!0)):($.push([P,C]),P=-1,A=null,S==="`"&&(M=!1)))}),M&&($.push([P,g.length-1]),E=!0);for(let _=$.length-1;_>=0;_--){let w=$[_],S=g.substring(0,w[0]),C=g.substring(w[0],w[1]+1),R=g.substring(w[1]+1,g.length),j="[%:"+W.length+":%]";W.push(C),g=S+j+R}g=g.replace(CodeBlockKeyWords.operator,(_,w,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j)return _;var x=(w||"")+'<span CLASS="operatorword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.system,(_,w,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return _;var x=(w||"")+'<span CLASS="flowword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.function,(_,w,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return _;var x=(w||"")+'<span CLASS="keyword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.consts,(_,w,S,C,R,j)=>{var x=$.some(N=>j>=N[0]&&j<=N[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!R&&R.match(/[\w\d_\.]/))return _;var k=(w||"")+'<span CLASS="constsword">'+S+"</span>"+(R||"");return k}),g=g.replace(CodeBlockKeyWords.object,(_,w,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return _;var x=(w||"")+'<span CLASS="objectword">'+S+"</span>"+(C||"");return x}),W.forEach((_,w)=>{var S='\\[%:(<span CLASS="constsword">)?'+w+"(</span>)?:%\\]";S=new RegExp(S),g=g.replace(S,'<span CLASS="constsword">'+_+"</span>")}),g=g.replace(/<span CLASS="/g,'<span class="'),L.push("<p>"+g+"</p>")}L=L.join(""),L=O+L+v;var T="codeblock-"+generateRandomKey();n.finals[T]=L,r[c[0]]="%"+T+"%";for(let b=c[0]+1;b<=c[1];b++)r[b]=null;for(let b=c[0];b<=c[1];b++){let g=a[b];if(!g)continue;let $=t.indexOf(g);$>=0&&t.splice($,1),delete a[b],g[0]=-1}}),h.length>0},parseTable=(t,a,r,n,l)=>{var s=[];if(t.forEach(f=>{!f[6]||s.push(f)}),s.length!==0){var e=[],i=0,u=s[0][0];e.push([s[0]]);var p=s.length;for(let f=1;f<p;f++){let h=s[f];h[0]===u+1?e[i].push(h):(i++,e[i]=[h]),u=h[0]}return e=e.filter(f=>!(f.length<2)),e.forEach(f=>{generateTable(f,t,a,r,n,l)}),!0}},parseListAndBlockQuote=(t,a,r,n,l)=>{var s=0,e=r.length;if(t.forEach((o,m)=>{if(o[3]+o[4]!==0){var y=o[0];y<e&&(e=y),y>s&&(s=y)}}),e>s)return!1;for(let o=s+1;o<r.length-1;o++){let m=a[o],y=a[o+1];if(!!m&&m[1]>0&&!!y&&y[1]>0)break;s=o}if(s===r.length-2){let o=r.length-1,m=a[o];(!m||m[1]===0)&&(s=o)}var i=0,u=[[[e,a[e]]]],p=!1,f=!0;a[e][3]>0&&(p=!0);for(let o=e+1;o<=s;o++){var h=a[o];if(!h){f&&u[i].push([o,null]);continue}if(h[1]){if(!f)continue;let m=a[o+1];if(!m||m[1]>0){f=!1;continue}u[i].push([o,h]);continue}if(h[3]+h[4]===0){f&&u[i].push([o,h]);continue}if(f){u[i].push([o,h]);continue}i++,u[i]=[],a[o][3]>0?p=!0:p=!1,f=!0,u[i].push([o,h])}var c=!1;return u.forEach(o=>{o.forEach(v=>{var E=v[0];v[1]||(r[E]="    "+r[E])});var m=0,y=o[0][0],O=r[y],m=-1;O.match(/^[ 　\t>]/)?m=0:O.match(/^[\-\+]|[\*~][ 　\t]/)?m=1:O.match(/^\d+\.[ 　\t]/)&&(m=2),!(m<0)&&(change=!0,m===0?generateQuotes(o,t,a,r,n,l):m===1?generateList(!1,o,t,a,r,n,l):m===2&&generateList(!0,o,t,a,r,n,l))}),c},parseHeadline=(t,a,r,n,l)=>{var s=[],e=[];t.forEach(i=>{if(i[2]!==0){var u=i[0],p=a[u-1];if(p)p[1]>0&&s.push([u,r[u].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let f=r[u-1];if(u===0||!!f.match(/^%[\w\-]+%$/))s.push([u,r[u].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let h=r[u].substr(0,1);h==="="?e.push([u-1,1]):h==="-"?e.push([u-1,2]):h==="~"?e.push([u-1,3]):h==="+"?e.push([u-1,3]):h==="_"?e.push([u-1,3]):h==="*"?e.push([u-1,4]):h==="#"?e.push([u-1,5]):h==="."&&e.push([u-1,6]),r[u]=null}}}});for(let i=0;i<r.length;i++){let u=r[i];if(!u)continue;let p=u.match(/^(#+)[ 　\t]*/);if(p){let f=p[0],h=p[1];f!==u&&u.indexOf(f+"[")!==0&&(e.push([i,h.length]),r[i]=u.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return s.length+e.length===0?!1:(e.sort((i,u)=>i[0]-u[0]),s.forEach(i=>{var[u,p]=i,f="headline-"+generateRandomKey(),h="<hr";p==="="?h=h+' class="heavy">':p==="-"?h=h+' class="light">':p==="*"?h=h+' class="star">':p==="~"?h=h+' class="wavy">':p==="."?h=h+' class="dotted">':p==="_"?h=h+' class="dashed">':p==="+"?h=h+' class="strong">':p==="#"?h=h+' class="heavystrong">':h=h+">",l[f]=h,r[u]="%"+f+"%"}),e.forEach(i=>{var[u,p]=i,f="header-"+generateRandomKey(),h="h"+(p||1),c=r[u];c=parseLine(c,n),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+h+">"+c+"</"+h+">",l[f]=c,r[u]="%"+f+"%"}),!0)},parseResources=(t,a,r,n,l)=>{for(var s=[],e=!0;e;)e=!1,r.forEach(i=>{if(i.length===0)return s.push(i);i=i.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(h,c,o,m)=>{var y=n.refs[m],O;if(!y||y.indexOf("://")<0&&y.indexOf("@")<0&&!y.match(/^\.{0,2}[\\\/]/)||y.indexOf(`
`)>=0){if(O=n.metas[m.toLowerCase()],!O||O.indexOf("://")<0&&O.indexOf("@")<0&&!O.match(/^\.{0,2}[\\\/]/)||O.indexOf(`
`)>=0)return h;y=O}return c+"("+y+")"});for(var u=[],p=[],f=!0;f;)f=!1,i=i.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(h,c,o)=>(f=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?p.push(h):u.push(h),""));i=i.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.forEach(h=>s.push(h)),i.length>0&&(u.length>0&&(e=!0),s.push(i)),u.forEach(h=>s.push(h))}),r.splice(0,r.length),s.forEach(i=>r.push(i)),s=[];return!0},parseParagraph=(t,a,r,n,l)=>{var s=[],e=[],i=[],u=-1;r.forEach((p,f)=>{if(!p||p.length===0){u=-1;return}var h=p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(h){u=-1;return}if(h=p.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),h){i.push([f,p]),u=-1;return}h=p.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=h?1:0;c===u?c===0?s[s.length-1].push([f,p]):c===1&&e[e.length-1].push([f,p]):(c===0?s[s.length]=[[f,p]]:c===1&&(e[e.length]=[[f,p]]),u=c)}),e=e.filter(p=>{var f=p.length>1;return p.length===1&&i.push(p[0]),f}),s.forEach(p=>{var f=[],h=p[0][0];p.forEach(c=>{var o=c[0],m=c[1];m.length!==0&&(f.push(parseLine(m,n)),r[o]=null)}),f=f.join("<br>"),r[h]=f}),e.forEach(p=>{var f=[],h=p[0][0];p.forEach(o=>{f.push(parseLine(o[1],n)),r[o[0]]=null}),f=f.join(""),f='<div class="image-wall">'+f+"</div>";var c="imagewall-"+generateRandomKey();l[c]=f,r[h]="%"+c+"%"}),i.forEach(p=>{var[f,h]=p;h=parseLine(h,n);var c="resource-"+generateRandomKey();l[c]=h,r[f]="%"+c+"%"})},generateTable=(t,a,r,n,l,s)=>{var e=!0,i=null,u=null,p=-1;i=n[t[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),i?(i=i[1].trim(),n[t[0][0]]="",t.shift()):i=generateRandomKey(16),t.some((v,E)=>{var L=n[v[0]];L=L.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=L.match(/[\|:\-]+/);if(!!d&&(d=d[0],L===d))return u=d,p=v[0],E===0&&(e=!1),!0}),u?(u=u.replace(/^\||\|$/g,""),u=u.split("|"),u=u.map(v=>v.match(/^:\-:$/)?1:v.match(/^:\-$/)?0:v.match(/^\-:$/)?2:3)):(e=!1,u=[]);var f=[],h=0;t.forEach((v,E)=>{var L=v[0];if(L!==p){var d=parseTableRow(n[L]);f.push(d),d.length>h&&(h=d.length)}});for(let v=u.length;v<h;v++)u.push("");for(let v=0;v<f.length-1;v++){let E=f[v],L=E?E.length:h;for(let d=E.length;d<h;d++)E.push("")}var c;e&&(c=f[0],f.shift());for(let v=0;v<h;v++){if(u[v]!==3)continue;let E=!0;f.some(L=>{var d=L[v];if(!!d&&d*1!==d)return E=!1,!0}),E?u[v]=2:u[v]=0}var o='<table name="'+i+'">';e&&(o+="<thead><tr>",c.forEach((v,E)=>{var L=!1;v.match(/\{s\}$/i)&&(L=!0,v=v.replace(/[ 　\t]*\{s\}$/i,"")),v=parseLine(v,l);var d='<th align="',T=u[E];T===1?d+="center":T===2?d+="right":d+="left",L&&(d+='" sortable="true'),d+='">'+v+"</td>",o+=d}),o+="</tr></thead>"),o+="<tbody>";var m=[];f.forEach((v,E)=>{v.forEach((L,d)=>{var T=L.match(/^[ 　\t]*CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!T){var b=T[1]*1;(isNaN(b)||b<1)&&(b=1);var g=T[2];m[d]=[b,g,E+1]}})}),m.length>0&&calculateTable(f,m);var y=[];f.forEach((v,E)=>{o+="<tr>";var L=[];v.forEach((d,T)=>{d=parseLine(d,l);var b=d.replace(/<.*?>/gi,"");L[T]=b;var g='<td align="',$=u[T];$===1?g+="center":$===2?g+="right":g+="left",g+='">'+d+"</td>",o+=g}),o+="</tr>",y[E]=L}),o+="</tbody></table>",l.tables=l.tables||{},l.tables[i]=y;var O="table-"+generateRandomKey();s[O]=o,c=t[0][0],total=t.length;for(let v=0;v<total;v++){let E=t[v],L=E[0];n[L]=null,delete r[L];let d=a.indexOf(E);d>=0&&a.splice(d,1),E[0]=-1}n[c]="%"+O+"%"},calculateTable=(t,a)=>{var r=[],n=[];a.forEach((s,e)=>{if(!!s){var[i,u,p]=s;r[i]=r[i]||[],r[i].push([e,parseEquation(u,p,n)])}});var l=[];t.forEach((s,e)=>{list=[],n.forEach(i=>{var u=s[i]*1;isNaN(u)&&(u=0),list[i]=u}),l.push(list)}),r.forEach(s=>{!s||s.length===0||t.forEach((e,i)=>{s.forEach(([u,p])=>{var f="";try{f=p(l,i),l[i]=l[i]||[],l[i][u]=f,f=f+""}catch{f=""}e[u]=f})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\(\)\+\-\*\/ ]+)(!+)/g,(t,a,r)=>"MathTools.factorial("+a+","+r.length+")").replace(/([a-zA-Z]+)(\d+)/gi,(t,a,r)=>{if(!a||!r||(r=r*1,r*1!==r)||(a=a.replace(/\w/g,l=>Char2Dig[l.toLowerCase()]),a=parseInt(a,26),isNaN(a)))return"0";dataCol.includes(a)||dataCol.push(a);var n=r-line;return n===0?"((dataList[lineNum]||[])["+a+"]||0)":n>0?"((dataList[lineNum+"+n+"]||[])["+a+"]||0)":(n*=-1,"((dataList[lineNum-"+n+"]||[])["+a+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,t=>"Math."+t.toLowerCase()).replace(/per(mutate)?/gi,t=>"MathTools.permutate").replace(/com(binate)?/gi,t=>"MathTools.combinate").replace(/round/gi,t=>"MathTools.round").replace(/ceil/gi,t=>"MathTools.ceil").replace(/floor/gi,t=>"MathTools.floor"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=t=>{t.substr(0,1)!=="|"&&(t="|"+t),t.substr(t.length-1,1)!=="|"&&(t=t+"|");var a=t.length,r=0,n=[],l=0;for(let s=1;s<a;s++){let e=t.substr(s,1);if(e==="|"&&r===0){n.push(t.substr(l+1,s-l-1)),l=s;continue}"([{<".indexOf(e)>=0?r++:">}])".indexOf(e)>=0&&r--}return n},generateQuotes=(t,a,r,n,l,s)=>{var e="quote",i=n[t[0][0]];if(i=i.match(/^>[ 　\t]*\[([\w\W]+?)\]/),i){let h=i[1];h=h.replace(/^[ 　\t]+|[ 　\t]+$/g,""),h.length>0&&!l.metas[h]&&!l.blocks[h]&&(e=h)}var u=!0;i=t.map((h,c)=>{var o=h[0],m=n[o];c>0&&(u=u&&!!m.match(/^(\t|　　|    | 　 |  　|　  )/));var y=m.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return y!==m&&u?m=y:(head=m.match(/^>[ 　\t]*/),head&&(head=head[0],m=m.replace(head,""))),m}),i[0]=i[0].replace(new RegExp("^[ \u3000\\t]*\\["+e.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),i=i.join(`
`),i=i.replace(/^\n+|\n+$/g,"");var p='<blockquote class="'+e+'">';i=parseSection(i,l,2,s),p+=i,p+="</blockquote>";var f="blockquote-"+generateRandomKey();s[f]=p,t.forEach(h=>{var c=h[0];n[c]=null,delete r[c];var o=a.indexOf(h[1]);o>=0&&a.splice(o,1)}),n[t[0][0]]="%"+f+"%"},generateList=(t,a,r,n,l,s,e)=>{var i=[],u=-1;a.forEach(h=>{var c=h[0],o=l[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),u++,i[u]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),i[u].push(o)}),i=i.map(h=>(h=h.join(`
`),h=h.replace(/^\n+|\n+$/g,""),h));var p="";t?p="<ol>":p="<ul>",i.forEach(h=>{p+="<li>",p+=parseSection(h,s,2,e),p+="</li>"}),t?p+="</ol>":p+="</ul>";var f="list-"+generateRandomKey();e[f]=p,a.forEach(h=>{var c=h[0];l[c]=null,delete n[c];var o=r.indexOf(h[1]);o>=0&&r.splice(o,1)}),l[a[0][0]]="%"+f+"%"},analyzeSections=(t,a)=>{var r=[[]],n=0,l=[0],s=[];if(t.forEach(e=>{var i=!1;e=e.replace(/^<h(\d+)>/i,(u,p)=>{i=!0,p=p*1,p===1&&(n++,r[n]=[]),l[p-1]=(l[p-1]||0)+1;for(let h=p;h<l.length;h++)l[h]=0;var f="chap";for(let h=0;h<p;h++)f+="-"+(l[h]||1);return u=u+'<a name="'+f+'">',s.push([p,f,e.replace(/<[\w\W]+?>/gi,"")]),u}).replace(/<\/h(\d+)>$/i,u=>"</a>"+u).replace(/\{([\w \-\.]+)\}/g,(u,p)=>{var f=a.termList[p];return f?(Array.isArray(f)&&(f=f[0]),'<a class="terminology" name="'+p+'" href="#ref-'+p+'"><strong>'+f+"</strong></a>"):u}),r[n].push(e)}),r=r.filter(e=>e.length>0),a.chapList=s,r=applyFootNotes(r,a),!!a.endnotes&&a.endnotes.length>0&&r.push(applyEndNotes(a)),a.metas.glossary&&!!a.termList&&a.termList.length>0){let e='<hr class="endnote-line">';e+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',e+=generateGlossary(a),e+="</section>",r.push(e)}if(a.image=a.image||[],a.video=a.video||[],a.audio=a.audio||[],a.metas.resources&&a.image.length+a.video.length+a.audio.length>0){let e='<hr class="endnote-line">';e+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',a.image.length>0&&(e+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',e+=generateResourceList(a,"image")),a.video.length>0&&(e+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',e+=generateResourceList(a,"video")),a.audio.length>0&&(e+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',e+=generateResourceList(a,"audio")),e+="</section>",r.push(e)}if(a.metas.showtitle){let e='<header class="article-title">';if(e+="<p>"+a.metas.title+"</p>",a.metas.showauthor&&(a.metas.author&&(e+='<p class="author">',a.metas.email&&(e+='<a href="mailto:'+a.metas.email+'">'),e+=a.metas.author,a.metas.email&&(e+="</a>"),e+="</p>"),a.metas.date)){e+='<p class="author date">';let i=a.metas.date*1;if(isNaN(i))i=a.metas.date;else{i=new Date(i);let u=i.getYear()+1900,p=i.getMonth()+1;p<10&&(p="0"+p);let f=i.getDate();f<10&&(f="0"+f);let h=i.getHours();h<10&&(h="0"+h);let c=i.getMinutes();c<10&&(c="0"+c);let o=i.getSeconds();o<10&&(o="0"+o),i=u+"/"+p+"/"+f+" "+h+":"+c+":"+o}e+=i,e+="</p>"}e+="</header>",r.unshift(e)}return r},applyBlockReference=(t,a)=>{for(var r=!0,n=0;r&&(r=!1,t=t.map(l=>(l=l.replace(/\[([\w \-\.]+?)\]/g,(s,e,i)=>{var u=l.lastIndexOf("<sup>",i),p=l.lastIndexOf("</sup>",i);if(u>p)return s;var f=a.blocks[e];return f?(r=!0,f):s}),l)),n++,n!==10););return t},applyMarkUpReference=(t,a)=>{var r=(a.metas.LANG||"zh").toLowerCase();if(t=t.map(n=>(n=n.replace(/%glossary%/gi,l=>generateGlossary(a)),n=n.replace(/%resources%/gi,l=>generateResourceList(a,"image")+generateResourceList(a,"video")+generateResourceList(a,"audio")),n=n.replace(/%images%/gi,l=>generateResourceList(a,"image")),n=n.replace(/%videos%/gi,l=>generateResourceList(a,"video")),n=n.replace(/%audios%/gi,l=>generateResourceList(a,"audio")),n=n.replace(/%toc%(\{[\w\W]+?\})*/gi,l=>{var s=l.match(/\{[\w\W]+?\}/g),e="\u76EE\u5F55",i=3;return s&&s.forEach(u=>{u=u.substr(1,u.length-2);var p=u*1;isNaN(p)?e=u:i=p}),a.toced=!0,generateTableOfContent(a,e,i)}),Object.keys(a.metas).forEach(l=>{var s=l.toLowerCase();PreservedKeywords.includes(l)||(s=a.metas[l],s===!0||s===!1?r==="zh"?s=s?"\u662F":"\u5426":s=s?"On":"Off":Array.isArray(s)&&(r==="zh"?s=s.join("\u3001"):s=s.join(", ")),n=n.replace(new RegExp("%"+l+"%","gi"),e=>s))}),n=n.replace(/%([\w \-\.]+)%/g,(l,s)=>{var e=a.finals[s];return e||l}),n)),a.metas.toc&&!a.toced){let n=generateTableOfContent(a,"\u76EE\u5F55",3);n.indexOf('<p class="content-')>=0&&(n="<section>"+n+"</section>",a.metas.showtitle?t.splice(1,0,n):t.unshift(n))}return t},applyFootNotes=(t,a)=>(t=t.map(r=>{var n=[],l="<section>",s="</section>";return r.forEach((e,i)=>{var u=!1;e=e.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(p,f)=>{u=!0,n.push(f);var h=p.substr(0,p.length-1)+' href="#footnote-'+f+'">';return h}),u&&(r[i]=e)}),r=r.join(""),n.length===0||(n=n.map((e,i)=>{var u=a.refs[e],p=a.footnotes.indexOf(e);return i++,r=r.replace(new RegExp("%%FN-"+p+"%%","g"),i),'<p class="footnote-content"><a class="index" name="footnote-'+e+'">'+i+"\uFF1A</a>"+u+"</p>"}),r+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',r+=n.join(""),r+='</footer><hr class="footnote-line end">'),l+r+s}),t),applyEndNotes=t=>{let a='<hr class="endnote-line">';return a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',t.endnotes.forEach((r,n)=>{a+='<p class="endnote-content"><a class="index" name="endnote-'+r+'">'+(n+1)+"\uFF1A</a>"+t.refs[r]+"</p>"}),a+="</section>",a},generateTableOfContent=(t,a,r)=>{var n='<h1 name="ContentTable">'+a+'</h1><aside class="content-table">';return t.chapList.forEach(l=>{if(!(l[0]>r)){var s='<p class="content-item level-'+l[0]+'">';for(let e=0;e<l[0];e++)s+='<span class="content-indent"></span>';s+='<a class="content-link" href="#'+l[1]+'">'+l[2]+"</a>",s+="</p>",n+=s}}),!!t.endnotes&&t.endnotes.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),t.metas.glossary&&!!t.termList&&t.termList.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),t.metas.resources&&t.image.length+t.video.length+t.audio.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',t.image.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),t.video.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),t.audio.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),n+="</aside>",n},generateGlossary=t=>{var a="";return t.termList===0?"":(t.termList.forEach(r=>{var[n,l]=r,s=t.terms[n],e='<p class="glossary-item">';e+='<a class="glossary-indent" name="ref-'+n+'">'+l+"</a>",e+=s,e+="</p>",a+=e}),a)},generateResourceList=(t,a)=>{var r=t[a];if(!r||!Array.isArray(r)||r.length===0)return"";var n=[],l="<ul>";return r.forEach(s=>{var e=s[1];e=e.replace(/\%([\w \-]+?)\%/g,(i,u)=>{var p=ReversePreserveWords[u.toLowerCase()];return p||i}),!n.includes(e)&&(n.push(e),l+='<li><a href="'+e+'" target="_blank">'+e+"</a></li>")}),l+="</ul>",l},convertPreserves=t=>(t=t.replace(/(\\+)(.)/g,(a,r,n)=>{var l=Math.floor(r.length/2),s=l*2!==r.length,e="",i="%"+PreserveWords["\\"]+"%";for(let u=0;u<l;u++)e+=i;if(s){let u=PreserveWords[n];u?e=e+"%"+u+"%":e=e+n}else e=e+n;return e}),t),restorePreserves=(t,a,r=!0)=>{for(var n=!0;n;)n=!1,t=t.replace(/\%([\w \-]+?)\%/g,(l,s)=>{var e=a[s];return e?(n=!0,e):l});if(!r)return t;for(n=!0;n;)n=!1,t=t.replace(/\%([\w \-]+?)\%/g,(l,s)=>{var e=a[SymHidden][s.toLowerCase()];return e?(n=!0,e):l});return t=t.replace(/\n+/g,"<br>"),t=t.replace(/\/{2}/g,(l,s)=>{if(s===0)return"<br>";var e=t.substr(s-1,1);return e===":"?l:"<br>"}),t=t.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),t},getKeywords=t=>{if(!t)return[];t=t.split(/[ ,，；;、　]+/).filter(r=>r.length>0);var a=[];return t.forEach(r=>{a.includes(r)||a.push(r)}),a},getMetas=(t,a)=>{for(var r={},n=!0;n;)n=!1,a=a.replace(/\n([A-Z\u0800-\uffff]+?) *[:：] *([\w\W]*?)\n/,(l,s,e)=>e.length===0||(s==="\u6807\u9898"?s="title":s==="\u4F5C\u8005"?s="author":s==="\u7B80\u4ECB"?s="description":s==="\u5173\u952E\u8BCD"?s="keyword":s==="\u66F4\u65B0"?s="date":s=s.toLowerCase(),!MetaWords.includes(s))?l:(n=!0,r[s]=e,`
`));if(!!r.showtitle&&["on","yes","true"].includes(r.showtitle.toLowerCase())?r.showtitle=!0:r.showtitle=void 0,!!r.glossary&&["on","yes","true"].includes(r.glossary.toLowerCase())?r.glossary=!0:r.glossary=void 0,!!r.links&&["on","yes","true"].includes(r.links.toLowerCase())?r.links=!0:r.links=void 0,!!r.refs&&["on","yes","true"].includes(r.refs.toLowerCase())?r.refs=!0:r.refs=void 0,!!r.terms&&["on","yes","true"].includes(r.terms.toLowerCase())?r.terms=!0:r.terms=void 0,!!r.resources&&["on","yes","true"].includes(r.resources.toLowerCase())?r.resources=!0:r.resources=void 0,!!r.toc&&["on","yes","true"].includes(r.toc.toLowerCase())?r.toc=!0:r.toc=void 0,t.metas=r,t.metas.keyword=getKeywords(t.metas.keyword),t.metas.date)try{t.metas.date=new Date(t.metas.date).getTime()}catch{delete t.metas.date}for(t.metas.god=t.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',t.metas.script?t.metas.script=t.metas.script.split(/[,; 　\t]+/):t.metas.script=[],t.metas.style?t.metas.style=t.metas.style.split(/[,; 　\t]+/).map(l=>l.replace(/\{[\w\W]*\}/,"")):t.metas.style=[],t.termList=t.termList||[],t.mainParser=!1,t.refs={},n=!0;n;)n=!1,a=a.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(l,s,e,i,u)=>(s=s.trim(),e=e.trim(),s.length===0||e.length===0?l:(t.refs[s]=e,n=!0,`
`+i)));for(t.blocks={},n=!0;n;)n=!1,a=a.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(l,s,e)=>{if(s=s.trim(),!(s.length===0||e.length===0))return t.blocks[s]=e,n=!0,""});return t.anchors=[],t.terms={},t.notes={},a.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(l,s,e,i)=>{var u=e||i;t.refs[u]?s.substr(0,1)==="{"?t.terms[u]=u:t.notes[u]=u:s.substr(0,1)==="{"&&!t.anchors.includes(u)&&t.anchors.push(u)}),a=regularize(a),a};MarkUp.fullParse=(t,a)=>{var r={finals:{},toced:!1};t=prepare(t),t=getMetas(r,t),r.parseLevel=0,r.mainParser=!0,r.metas.title=r.metas.title||"\u65E0\u540D\u6587";var n=Object.keys(r.metas);Object.keys(a).forEach(e=>{n.includes(e)||n.push(e)}),a.overwrite?n.forEach(e=>{r.metas[e]=a[e]===null||a[e]===void 0?r.metas[e]:a[e]}):n.forEach(e=>{r.metas[e]=r.metas[e]===null||r.metas[e]===void 0?a[e]:r.metas[e]}),n.forEach(e=>{(r.metas[e]===null||r.metas[e]===void 0)&&(r.metas[e]=!1)}),t=parseSection(t,r),Object.keys(r.refs).forEach(e=>{var i=r.refs[e];i=parseLine(i,r),i=i.replace(/\%([\w \-]+?)\%/g,(u,p)=>{var f=ReversePreserveWords[p.toLowerCase()];return f||u}),r.refs[e]=i}),Object.keys(r.blocks).forEach(e=>{var i=r.blocks[e],u=i.match(/^\n+/);i=i.trim();var p;r.parseLevel=0,u?p=parseSection(i,r,1):p=[parseLine(i,r)],r.blocks[e]=p.join("")});for(let e in r.terms)r.terms[e]=r.refs[e];for(let e in r.notes)r.notes[e]=r.refs[e];t=t.map(e=>e.replace(/\%([\w \-]+?)\%/g,(i,u)=>{var p=ReversePreserveWords[u.toLowerCase()];return p||i})),t=applyBlockReference(t,r),t=analyzeSections(t,r),t=applyMarkUpReference(t,r),r.metas.classname?t='<article class="'+r.metas.classname+'">'+t.join("")+"</article>":t="<article>"+t.join("")+"</article>",r.metas.fullexport&&(r.metas.style.forEach(e=>{t+='<link type="text/css" rel="stylesheet" href="'+e+'">'}),r.metas.script.forEach(e=>{t+='<script type="text/javascript" src="'+e+'"></script>'}));var l=FinalRender._indexes_||[];l.forEach(e=>{var i=FinalRender[e];!i||i.forEach(u=>{t=u.parse(t,r)})}),t=t.replace(/<p>(<br\/?>)+<\/p>/gi,"");var s={};return s.content=t,s.title=r.metas.title,s.lineCount=r.metas.totalLineCount,s.chapList=r.chapList,s.tables=r.tables,s.meta={},s.meta.author=r.metas.author,s.meta.email=r.metas.email,s.meta.description=r.metas.description,s.meta.update=r.metas.date,s.meta.keywords=r.metas.keyword.map(e=>e),r.metas.others&&(s.meta.others=r.metas.others),s.terminology={},r.termList.forEach(e=>{s.terminology[e[0]]=e[1]}),s.notes={},Object.keys(r.refs).forEach(e=>{s.notes[e]=r.refs[e]}),s.blocks={},Object.keys(r.refs).forEach(e=>{s.blocks[e]=r.blocks[e]}),s},MarkUp.parse=(t,a)=>{var r;return r=MarkUp.fullParse(t+`
`,a),r?r.content:""};const reverseSection=(t,a)=>{a.__level++;var r=[],n="",l=!0;return t.childNodes.forEach(s=>{var e=s.tagName;if(!e){if(s.nodeName==="#comment")return;let u=s.textContent||"";u=u.trim(),u.length>0&&(n+=u);return}e=e.trim().toLowerCase();var i;if(ParagraphTags.includes(e)){if(l=!1,n.length>0&&(r.push(a.__prefix+n),n=""),e==="blockquote"){let u=a.__prefix;a.__prefix=a.__prefix+">	",i=reverseSection(s,a),i=i.flat(Infinity),i.push(`
`),a.__prefix=u}else if(e==="ol"){let u=a.__prefix;a.__prefix.indexOf("-	")>=0||a.__prefix.indexOf("1.	")>=0?a.__prefix="	"+a.__prefix:a.__prefix=a.__prefix+"1.	",i=reverseSection(s,a),i=i.flat(Infinity),i.push(""),a.__prefix=u}else if(e==="ul"){let u=a.__prefix;a.__prefix.indexOf("-	")>=0||a.__prefix.indexOf("1.	")>=0?a.__prefix="	"+a.__prefix:a.__prefix=a.__prefix+"-	",i=reverseSection(s,a),i=i.flat(Infinity),i.push(""),a.__prefix=u}else i=reverseSection(s,a),i=i.flat(Infinity),i.push("");!!i&&i.length>0&&r.push(...i)}else{let[u,p]=reverseMix(s,e,a);p?u.length>0&&(n+=u.join("")):(n.length>0&&(r.push(a.__prefix+n),n=""),u.forEach(f=>{r.push(a.__prefix+f)}))}}),n.length>0&&r.push(a.__prefix+n),a.__level--,r},reverseLine=(t,a)=>{var r="";return t.childNodes.forEach(n=>{var l=n.tagName;if(!l){if(n.nodeName==="#comment")return;let s=n.textContent||"";s=s.trim(),s.length>0&&(r+=s);return}if(l=l.trim().toLowerCase(),l==="a"){let s=n.href;s.indexOf("javascript:")===0&&(s="");let e=reverseLine(n,a);!s||s.substr(0,1)==="#"||(s.match(/^(ftp|https?):\/\//i)||(s=a.host+s),e="["+e+"]("+s+")"),r+=e;return}if(l==="span"||l==="font"){r+=reverseLine(n,a);return}if(l==="strong"||l==="b"){r+=reverseLine(n,a);return}if(l==="em"||l==="i"){r+=reverseLine(n,a);return}if(l==="sup"){r+=reverseLine(n,a);return}if(l==="sub"){r+=reverseLine(n,a);return}if(l==="del"){r+=reverseLine(n,a);return}r+=n.innerText}),r},reverseMix=(t,a,r)=>{if(a==="script")return[[""],!0];if(a==="style")return[[""],!0];if(a==="link")return[[""],!0];if(a==="hr")return[[`
---
`],!1];if(a==="br")return[[`
`],!0];if(a.match(/^h\d+$/)){let l=a.substring(1,a.length);l*=1;let s=`
`;for(let i=0;i<l;i++)s+="#";let e=reverseLine(t,r);return e=s+e+`
`,[[e],!1]}if(a==="a"){let l=t.href;l.indexOf("javascript:")===0&&(l="");let s=reverseLine(t,r);return!l||l.substr(0,1)==="#"?[[s],!0]:(l.match(/^(ftp|https?):\/\//i)||(l=r.host+l),s="["+s+"]("+l+")",[[s],!0])}if(a==="img")return t.src.length===0?[[""],!0]:[[`
![](`+t.src+`)
`],!1];if(a==="video")return t.src.length===0?[[""],!0]:[[`
@[](`+t.src+`)
`],!0];if(a==="audio")return t.src.length===0?[[""],!0]:[[`
#[](`+t.src+`)
`],!0];if(a==="span"||a==="font")return[[reverseLine(t,r)],!0];if(a==="strong"||a==="b"){let l=reverseLine(t,r);return[["**"+l+"**"],!0]}if(a==="em"||a==="i"){let l=reverseLine(t,r);return[["*"+l+"*"],!0]}if(a==="u"){let l=reverseLine(t,r);return[["__"+l+"__"],!0]}if(a==="sup"){let l=reverseLine(t,r);return[["^"+l+"^"],!0]}if(a==="sub"){let l=reverseLine(t,r);return[["_"+l+"_"],!0]}if(a==="del"){let l=reverseLine(t,r);return[["~~"+l+"~~"],!0]}var n=reverseLine(t,r);return[[n],!1]};MarkUp.reverse=(t,a,r=!0)=>{if(!t)return"";a=a||{},a.__level=0,a.__prefix="",a.host=a.host||"";var n=reverseSection(t,a);return n=n.flat(Infinity),n=n.join(`
`),n=n.replace(/\n{2,}/g,`

`),n},MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch{try{global.MarkUp=MarkUp}catch(t){console.error(t)}}})();
