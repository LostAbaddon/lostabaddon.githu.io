(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(a,t=1){return t<1||a<=t?1:a*MathTools.factorial(a-t,t)},permutate(a,t){return a<=1?1:t<=1?a:t>a?1:(a-t+1)*MathTools.permutate(a,t-1)},combinate(a,t){return a<=1||t<=0||t>=a?1:(a-t+1)/t*MathTools.combinate(a,t-1)}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(a=>ReversePreserveWords[PreserveWords[a].toLowerCase()]=a),ReversePreserveWords.$="&#36;",MetaWords.forEach((a,t)=>MetaWords[t]=a.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(a=8)=>{var t="";for(let r=0;r<a;r++)t+=Math.floor(Math.random()*10)+"";return t};MarkUp.addExtension=(a,t=0,r=5)=>{if(t===0){let n=LineRender._indexes_;n||(n=[],LineRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=LineRender[r],n||(n=[],LineRender[r]=n),n.push(a)}else if(t===1){let n=BlockRender._indexes_;n||(n=[],BlockRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=BlockRender[r],n||(n=[],BlockRender[r]=n),n.push(a)}else if(t===2){let n=FinalRender._indexes_;n||(n=[],FinalRender._indexes_=n),n.includes(r)||(n.push(r),n.sort((l,s)=>l-s)),n=FinalRender[r],n||(n=[],FinalRender[r]=n),n.push(a)}};const prepare=a=>(a=`
`+a+`
`,a=a.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(t,r)=>{var n=r.replace(/　/g,"  ").length;return n<4?`
`:t}),a=a.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(t,r,n)=>r+`
`+n),MetaWords.forEach(t=>{var r=new RegExp("([\\w\\W]? *)\\["+t+"\\]( *[\\w\\W]?)","gi");a=a.replace(r,(n,l,s)=>l==="]"||s==="["||s==="("?n:l+"%"+t+"%"+s)}),a),regularize=a=>(a=a.replace(/^\n+|\n+$/gi,""),a=a.replace(/\n{3,}/gi,`


`),a),parseLine=(a,t,r=-Infinity,n)=>{var l=LineRender._indexes_;if(!l)return"";var s=!n;return n=n||{},l.some(e=>{if(r>e||e>=0)return!0;for(var i=LineRender[e],h=!0;h;)h=!1,i.forEach(p=>{var f;[a,f]=p.parse(a,t,n),f&&(h=!0)})}),a=convertPreserves(a),l.forEach(e=>{if(!(r>e)&&!(e<0))for(var i=LineRender[e],h=!0;h;)h=!1,i.forEach(p=>{var f;[a,f]=p.parse(a,t,n),f&&(h=!0)})}),s&&(a=restorePreserves(a,n)),a},parseSection=(a,t,r=0,n)=>{t.parseLevel++;var l=[],s=!1;n||(s=!0,n={});var e=[];l=a.split(`
`),l.forEach((p,f)=>{var u=p.match(/^[ 　\t]*$/);if(p.length===0){e.push([f,1,0,0,0,0,0,0]);return}if(p.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){p.match(/^\-+$|^=+$/)?e.push([f,0,2,0,0,0,0,0]):p.match(/^~+$/)?e.push([f,0,2,0,0,1,0,0]):e.push([f,0,1,0,0,0,0,0]);return}if(u=p.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),u){u[2]?e.push([f,0,0,0,0,2,0,0,u[1]]):e.push([f,0,0,0,0,1,0,0,u[1]]);return}if(u=p.match(/^\${2}[ 　\t]*$/),u){u[2]?e.push([f,0,0,0,0,0,0,1]):e.push([f,0,0,0,0,0,0,1]);return}if(u=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),u){if(u=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),u){u[2]?e.push([f,0,0,0,1,2,0,0]):e.push([f,0,0,0,1,1,0,0]);return}if(u=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),u){u[2]?e.push([f,0,0,0,1,0,0,1]):e.push([f,0,0,0,1,0,0,1]);return}e.push([f,0,0,0,1,0,0,0]);return}if(u=p.match(/^(> *)+/),u){if(u=p.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),u){u[2]?e.push([f,0,0,1,0,2,0,0]):e.push([f,0,0,1,0,1,0,0]);return}if(u=p.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),u){u[2]?e.push([f,0,0,1,0,0,0,1]):e.push([f,0,0,1,0,0,0,1]);return}e.push([f,0,0,1,0,0,0,0]);return}if(u=p.match(/^([ 　\t]+)/),u){if(u=p.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),u){u[1]?e.push([f,0,0,1,1,2,0,0]):e.push([f,0,0,1,1,1,0,0]);return}if(u=p.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),u){u[1]?e.push([f,0,0,1,1,0,0,1]):e.push([f,0,0,1,1,0,0,1]);return}e.push([f,0,0,1,1,0,0,0]);return}if(u=p.match(/\|/g),u){let c=p.match(/\\\|/g);if(!c||!!c&&c.length!==u.length){let o=!0;for(c=p;o;){o=!1;let m=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");m=m.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),m=m.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=m!==c,c=m}if(c.indexOf("|")>=0){e.push([f,0,0,0,0,0,1,0]);return}}}});var i={};e.forEach(p=>{i[p[0]]=p});var h=!1;if(e.length>0){if(h=parseLaTeX(e,i,l,t,n)||h,e.length>0&&(h=parseCodeBlock(e,i,l,t,n)||h),e.length>0&&(h=parseTable(e,i,l,t,n)||h),s&&r===0&&!!t.metas.linenumber){let p=0;l.forEach((f,u)=>{if(!!f&&!f.match(/^%[\w\-]+%$/)){var c=i[u];if(!(!!c&&(c[1]>0||c[2]>0))&&!f.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!f.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=f.match(/\{[<\|>]\}$/);o?(o=o[0],f=f.substr(0,f.length-o.length)+'<span name="line-'+p+'"></span>'+o):f=f+'<span name="line-'+p+'"></span>',p++,l[u]=f}}}),t.metas.totalLineCount=p}[l,i]=squeezeContents(e,i,l),e.length>0&&(h=parseListAndBlockQuote(e,i,l,t,n)||h,[l,i]=squeezeContents(e,i,l)),e.length>0&&(h=parseHeadline(e,i,l,t,n)||h,[l,i]=squeezeContents(e,i,l))}return h=parseResources(e,i,l,t,n)||h,[l,i]=squeezeContents(e,i,l),h=parseParagraph(e,i,l,t,n)||h,l=l.map(p=>{if(p===null||p===void 0||p.length===0)return"";var f="";if(s)p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?f=restorePreserves(p,n,!1):(f=parsePlainParaStyle(p,t),f=restorePreserves(f,n,!1));else{f=parsePlainParaStyle(p,t);let u="param-"+generateRandomKey();n[u]=f,f="%"+u+"%"}return f}),t.parseLevel--,t.parseLevel>0&&(l=l.join("")),l},squeezeContents=(a,t,r)=>(r=r.map((n,l)=>[l,n]),r=r.filter(n=>!(!n[1]&&n[1]!=="")),r.forEach((n,l)=>{var s=n[0],e=t[s];!e||(e[0]=l)}),t={},a.forEach(n=>{t[n[0]]=n}),r=r.map(n=>n[1]),[r,t]),parsePlainParaStyle=(a,t)=>{var r="<p",n="</p>",l=[],s=a.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),e=s.match(/^\{[<\|>]\}/);e&&(e=e[0],e==="{<}"?l.push("align-left"):e==="{|}"?l.push("align-center"):e==="{>}"&&l.push("align-right"),a=a.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(h,p)=>p||"")),s=a.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),e=s.match(/\{[<\|>]\}$/),e&&(e=e[0],e==="{<}"?l.push("align-left"):e==="{|}"?l.push("align-center"):e==="{>}"&&l.push("align-right"),a=a.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(h,p)=>p||"")),s=a.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var i=s.match(/^:+/);return!!i&&!s.match(/^:([\w\-\.]+?):/)&&(i=i[0],l.push("indent","indent-"+i.length),a=a.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(h,p)=>p||"")),l.length>0&&(r=r+' class="'+l.join(" ")+'"'),r=r+">",a.length===0?"":r+a+n},parseLaTeX=(a,t,r,n,l)=>{var s=[];if(a.forEach(f=>{!f[7]||s.push(f)}),s.length===0)return!1;if(s.length===1)return s[0][7]=0,!1;var e=s.length,i=s[0];i[7]=2;for(let f=1;f<e;f++){let u=s[f];i[7]===2?(u[3]=i[3],u[4]=i[4],u[7]=3):i[7]===3&&(u[7]=2),i=u}s[s.length-1][7]===2&&(s[s.length-1][7]=0),s.forEach(f=>{f[7]===1&&(f[7]=0)});var h=[];s=s.filter(f=>f[7]<2?!1:(f[7]===2&&h.push(f[0]),!0)),e=s.length;for(let f=e-1;f>0;f-=2){let u=s[f-1][0];h.includes(u)||s.splice(f-1,2)}var p=[];e=s.length;for(let f=0;f<e;f+=2)p.push([s[f][0],s[f+1][0]]);return p.forEach(f=>{var u=['<p class="latex block">$$'];for(let o=f[0]+1;o<f[1];o++)u.push(r[o]);u.push("$$</p>"),u=u.join("<br>");var c="latex-"+generateRandomKey();n.finals[c]=u,r[f[0]]="%"+c+"%";for(let o=f[0]+1;o<=f[1];o++)r[o]=null;for(let o=f[0];o<=f[1];o++){let m=t[o];if(!m)continue;let y=a.indexOf(m);y>=0&&a.splice(y,1),delete t[o],m[0]=-1}}),p.length>0},parseCodeBlock=(a,t,r,n,l)=>{var s=[];if(a.forEach(c=>{!c[5]||s.push(c)}),s.length===0)return!1;if(s.length===1)return s[0][5]=0,!1;var e=s.length,i=s[0],h=[],p;i[5]=2,p=i[8];for(let c=1;c<e;c++){let o=s[c];if(!!p&&o[8]!==p){o[5]=0;continue}if(o[5]===2){if(c===e-1&&(o[5]=0),i[5]!==3){i[5]=0;continue}p=o[8]}i[5]===2?(o[3]=i[3],o[4]=i[4],o[5]=3,p=null):i[5]===3&&(o[5]=2),i=o}s[s.length-1][5]===2&&(s[s.length-1][5]=0),s.forEach(c=>{c[5]===1&&(c[5]=0)});var f=[];s=s.filter(c=>c[5]<2?!1:(c[5]===2&&f.push(c[0]),!0)),e=s.length;for(let c=e-1;c>0;c-=2){let o=s[c-1][0];f.includes(o)||s.splice(c-1,2)}var u=[];e=s.length;for(let c=0;c<e;c+=2)u.push([s[c][0],s[c+1][0]]);return u.forEach(c=>{var o=r[c[0]],m=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],y=o.indexOf(m);m=o.substr(y+m.length,o.length),m=m.replace(/^[ 　\t]+|[ 　\t]+$/g,""),m=m.toLowerCase(),(!m||m===""||m==="text")&&(m="plaintext");var O='<pre lang="'+m+'"><code>',v="</code></pre>",E=!1,w=[],d=[];if(m==="plaintext")for(let b=c[0]+1;b<c[1];b++){let g=r[b];w.push("<p>"+g+"</p>")}else for(let b=c[0]+1;b<c[1];b++){let g=r[b],$=[],T=-1,W=null,N=[],A=!1;if(E){let _=g.match(/(\\*)`/);if(!_)$.push([0,g.length-1]);else{let L=_[1].length;L>>1<<1!==L?$.push([0,g.length-1]):(E=!1,A=!0,T=0,W="`",g.replace(/(\\*)(['"`])/g,(S,C,R,j)=>{var x=C.length;!!W&&R!==W||x>>1<<1===x&&(j+=x,T===-1?(T=j,W=R,R==="`"&&(A=!0)):($.push([T,j]),T=-1,W=null,R==="`"&&(A=!1)))}),A&&($.push([T,g.length-1]),E=!0))}}else g.replace(/(\\*)(['"`])/g,(_,L,S,C)=>{var R=L.length;!!W&&S!==W||R>>1<<1===R&&(C+=R,T===-1?(T=C,W=S,S==="`"&&(A=!0)):($.push([T,C]),T=-1,W=null,S==="`"&&(A=!1)))}),A&&($.push([T,g.length-1]),E=!0);for(let _=$.length-1;_>=0;_--){let L=$[_],S=g.substring(0,L[0]),C=g.substring(L[0],L[1]+1),R=g.substring(L[1]+1,g.length),j="[%:"+N.length+":%]";N.push(C),g=S+j+R}g=g.replace(CodeBlockKeyWords.operator,(_,L,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j)return _;var x=(L||"")+'<span CLASS="operatorword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.system,(_,L,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!L&&L.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return _;var x=(L||"")+'<span CLASS="flowword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.function,(_,L,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!L&&L.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return _;var x=(L||"")+'<span CLASS="keyword">'+S+"</span>"+(C||"");return x}),g=g.replace(CodeBlockKeyWords.consts,(_,L,S,C,R,j)=>{var x=$.some(M=>j>=M[0]&&j<=M[1]);if(x||!!L&&L.match(/[\w\d_\.]/)||!!R&&R.match(/[\w\d_\.]/))return _;var k=(L||"")+'<span CLASS="constsword">'+S+"</span>"+(R||"");return k}),g=g.replace(CodeBlockKeyWords.object,(_,L,S,C,R)=>{var j=$.some(k=>R>=k[0]&&R<=k[1]);if(j||!!L&&L.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return _;var x=(L||"")+'<span CLASS="objectword">'+S+"</span>"+(C||"");return x}),N.forEach((_,L)=>{var S='\\[%:(<span CLASS="constsword">)?'+L+"(</span>)?:%\\]";S=new RegExp(S),g=g.replace(S,'<span CLASS="constsword">'+_+"</span>")}),g=g.replace(/<span CLASS="/g,'<span class="'),w.push("<p>"+g+"</p>")}w=w.join(""),w=O+w+v;var P="codeblock-"+generateRandomKey();n.finals[P]=w,r[c[0]]="%"+P+"%";for(let b=c[0]+1;b<=c[1];b++)r[b]=null;for(let b=c[0];b<=c[1];b++){let g=t[b];if(!g)continue;let $=a.indexOf(g);$>=0&&a.splice($,1),delete t[b],g[0]=-1}}),u.length>0},parseTable=(a,t,r,n,l)=>{var s=[];if(a.forEach(f=>{!f[6]||s.push(f)}),s.length!==0){var e=[],i=0,h=s[0][0];e.push([s[0]]);var p=s.length;for(let f=1;f<p;f++){let u=s[f];u[0]===h+1?e[i].push(u):(i++,e[i]=[u]),h=u[0]}return e=e.filter(f=>!(f.length<2)),e.forEach(f=>{generateTable(f,a,t,r,n,l)}),!0}},parseListAndBlockQuote=(a,t,r,n,l)=>{var s=0,e=r.length;if(a.forEach((o,m)=>{if(o[3]+o[4]!==0){var y=o[0];y<e&&(e=y),y>s&&(s=y)}}),e>s)return!1;for(let o=s+1;o<r.length-1;o++){let m=t[o],y=t[o+1];if(!!m&&m[1]>0&&!!y&&y[1]>0)break;s=o}if(s===r.length-2){let o=r.length-1,m=t[o];(!m||m[1]===0)&&(s=o)}var i=0,h=[[[e,t[e]]]],p=!1,f=!0;t[e][3]>0&&(p=!0);for(let o=e+1;o<=s;o++){var u=t[o];if(!u){f&&h[i].push([o,null]);continue}if(u[1]){if(!f)continue;let m=t[o+1];if(!m||m[1]>0){f=!1;continue}h[i].push([o,u]);continue}if(u[3]+u[4]===0){f&&h[i].push([o,u]);continue}if(f){h[i].push([o,u]);continue}i++,h[i]=[],t[o][3]>0?p=!0:p=!1,f=!0,h[i].push([o,u])}var c=!1;return h.forEach(o=>{o.forEach(v=>{var E=v[0];v[1]||(r[E]="    "+r[E])});var m=0,y=o[0][0],O=r[y],m=-1;O.match(/^[ 　\t>]/)?m=0:O.match(/^[\-\+]|[\*~][ 　\t]/)?m=1:O.match(/^\d+\.[ 　\t]/)&&(m=2),!(m<0)&&(change=!0,m===0?generateQuotes(o,a,t,r,n,l):m===1?generateList(!1,o,a,t,r,n,l):m===2&&generateList(!0,o,a,t,r,n,l))}),c},parseHeadline=(a,t,r,n,l)=>{var s=[],e=[];a.forEach(i=>{if(i[2]!==0){var h=i[0],p=t[h-1];if(p)p[1]>0&&s.push([h,r[h].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let f=r[h-1];if(h===0||!!f.match(/^%[\w\-]+%$/))s.push([h,r[h].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let u=r[h].substr(0,1);u==="="?e.push([h-1,1]):u==="-"?e.push([h-1,2]):u==="~"?e.push([h-1,3]):u==="+"?e.push([h-1,3]):u==="_"?e.push([h-1,3]):u==="*"?e.push([h-1,4]):u==="#"?e.push([h-1,5]):u==="."&&e.push([h-1,6]),r[h]=null}}}});for(let i=0;i<r.length;i++){let h=r[i];if(!h)continue;let p=h.match(/^(#+)[ 　\t]*/);if(p){let f=p[0],u=p[1];f!==h&&h.indexOf(f+"[")!==0&&(e.push([i,u.length]),r[i]=h.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return s.length+e.length===0?!1:(e.sort((i,h)=>i[0]-h[0]),s.forEach(i=>{var[h,p]=i,f="headline-"+generateRandomKey(),u="<hr";p==="="?u=u+' class="heavy">':p==="-"?u=u+' class="light">':p==="*"?u=u+' class="star">':p==="~"?u=u+' class="wavy">':p==="."?u=u+' class="dotted">':p==="_"?u=u+' class="dashed">':p==="+"?u=u+' class="strong">':p==="#"?u=u+' class="heavystrong">':u=u+">",l[f]=u,r[h]="%"+f+"%"}),e.forEach(i=>{var[h,p]=i,f="header-"+generateRandomKey(),u="h"+(p||1),c=r[h];c=parseLine(c,n),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+u+">"+c+"</"+u+">",l[f]=c,r[h]="%"+f+"%"}),!0)},parseResources=(a,t,r,n,l)=>{for(var s=[],e=!0;e;)e=!1,r.forEach(i=>{if(i.length===0)return s.push(i);i=i.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(u,c,o,m)=>{var y=n.refs[m],O;if(!y||y.indexOf("://")<0&&y.indexOf("@")<0&&!y.match(/^\.{0,2}[\\\/]/)||y.indexOf(`
`)>=0){if(O=n.metas[m.toLowerCase()],!O||O.indexOf("://")<0&&O.indexOf("@")<0&&!O.match(/^\.{0,2}[\\\/]/)||O.indexOf(`
`)>=0)return u;y=O}return c+"("+y+")"});for(var h=[],p=[],f=!0;f;)f=!1,i=i.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(u,c,o)=>(f=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?p.push(u):h.push(u),""));i=i.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.forEach(u=>s.push(u)),i.length>0&&(h.length>0&&(e=!0),s.push(i)),h.forEach(u=>s.push(u))}),r.splice(0,r.length),s.forEach(i=>r.push(i)),s=[];return!0},parseParagraph=(a,t,r,n,l)=>{var s=[],e=[],i=[],h=-1;r.forEach((p,f)=>{if(!p||p.length===0){h=-1;return}var u=p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(u){h=-1;return}if(u=p.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),u){i.push([f,p]),h=-1;return}u=p.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=u?1:0;c===h?c===0?s[s.length-1].push([f,p]):c===1&&e[e.length-1].push([f,p]):(c===0?s[s.length]=[[f,p]]:c===1&&(e[e.length]=[[f,p]]),h=c)}),e=e.filter(p=>{var f=p.length>1;return p.length===1&&i.push(p[0]),f}),s.forEach(p=>{var f=[],u=p[0][0];p.forEach(c=>{var o=c[0],m=c[1];m.length!==0&&(f.push(parseLine(m,n)),r[o]=null)}),f=f.join("<br>"),r[u]=f}),e.forEach(p=>{var f=[],u=p[0][0];p.forEach(o=>{f.push(parseLine(o[1],n)),r[o[0]]=null}),f=f.join(""),f='<div class="image-wall">'+f+"</div>";var c="imagewall-"+generateRandomKey();l[c]=f,r[u]="%"+c+"%"}),i.forEach(p=>{var[f,u]=p;u=parseLine(u,n);var c="resource-"+generateRandomKey();l[c]=u,r[f]="%"+c+"%"})},generateTable=(a,t,r,n,l,s)=>{var e=!0,i=null,h=null,p=-1;i=n[a[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),i?(i=i[1].trim(),n[a[0][0]]="",a.shift()):i=generateRandomKey(16),a.some((v,E)=>{var w=n[v[0]];w=w.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=w.match(/[\|:\-]+/);if(!!d&&(d=d[0],w===d))return h=d,p=v[0],E===0&&(e=!1),!0}),h?(h=h.replace(/^\||\|$/g,""),h=h.split("|"),h=h.map(v=>v.match(/^:\-:$/)?1:v.match(/^:\-$/)?0:v.match(/^\-:$/)?2:3)):(e=!1,h=[]);var f=[],u=0;a.forEach((v,E)=>{var w=v[0];if(w!==p){var d=parseTableRow(n[w]);f.push(d),d.length>u&&(u=d.length)}});for(let v=h.length;v<u;v++)h.push("");for(let v=0;v<f.length-1;v++){let E=f[v],w=E?E.length:u;for(let d=E.length;d<u;d++)E.push("")}var c;e&&(c=f[0],f.shift());for(let v=0;v<u;v++){if(h[v]!==3)continue;let E=!0;f.some(w=>{var d=w[v];if(!!d&&d*1!==d)return E=!1,!0}),E?h[v]=2:h[v]=0}var o='<table name="'+i+'">';e&&(o+="<thead><tr>",c.forEach((v,E)=>{var w=!1;v.match(/\{s\}$/i)&&(w=!0,v=v.replace(/[ 　\t]*\{s\}$/i,"")),v=parseLine(v,l);var d='<th align="',P=h[E];P===1?d+="center":P===2?d+="right":d+="left",w&&(d+='" sortable="true'),d+='">'+v+"</td>",o+=d}),o+="</tr></thead>"),o+="<tbody>";var m=[];f.forEach((v,E)=>{v.forEach((w,d)=>{var P=w.match(/^CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!P){var b=P[1]*1;(isNaN(b)||b<1)&&(b=1);var g=P[2];m[d]=[b,g,E+1]}})}),m.length>0&&calculateTable(f,m);var y=[];f.forEach((v,E)=>{o+="<tr>";var w=[];v.forEach((d,P)=>{d=parseLine(d,l);var b=d.replace(/<.*?>/gi,"");w[P]=b;var g='<td align="',$=h[P];$===1?g+="center":$===2?g+="right":g+="left",g+='">'+d+"</td>",o+=g}),o+="</tr>",y[E]=w}),o+="</tbody></table>",l.tables=l.tables||{},l.tables[i]=y;var O="table-"+generateRandomKey();s[O]=o,c=a[0][0],total=a.length;for(let v=0;v<total;v++){let E=a[v],w=E[0];n[w]=null,delete r[w];let d=t.indexOf(E);d>=0&&t.splice(d,1),E[0]=-1}n[c]="%"+O+"%"},calculateTable=(a,t)=>{var r=[],n=[];t.forEach((s,e)=>{if(!!s){var[i,h,p]=s;r[i]=r[i]||[],r[i].push([e,parseEquation(h,p,n)])}});var l=[];a.forEach((s,e)=>{list=[],n.forEach(i=>{var h=s[i]*1;isNaN(h)&&(h=0),list[i]=h}),l.push(list)}),r.forEach(s=>{!s||s.length===0||a.forEach((e,i)=>{s.forEach(([h,p])=>{var f="";try{f=p(l,i),f=f+""}catch{f=""}e[h]=f})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\d\(\)\+\-\*\/ ]+)(!+)/g,(a,t,r)=>"MathTools.factorial("+t+","+r.length+")").replace(/(\w+)(\d+)/gi,(a,t,r)=>{if(!t||!r||(r=r*1,!Number.is(r))||(t=t.replace(/\w/g,l=>Char2Dig[l.toLowerCase()]),t=parseInt(t,26),isNaN(t)))return"0";dataCol.includes(t)||dataCol.push(t);var n=r-line;return n===0?"((dataList[lineNum]||[])["+t+"]||0)":n>0?"((dataList[lineNum+"+n+"]||[])["+t+"]||0)":(n*=-1,"((dataList[lineNum-"+n+"]||[])["+t+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,a=>"Math."+a.toLowerCase()).replace(/per(mutate)?/gi,a=>"MathTools.permutate").replace(/com(binate)?/gi,a=>"MathTools.combinate"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=a=>{a.substr(0,1)!=="|"&&(a="|"+a),a.substr(a.length-1,1)!=="|"&&(a=a+"|");var t=a.length,r=0,n=[],l=0;for(let s=1;s<t;s++){let e=a.substr(s,1);if(e==="|"&&r===0){n.push(a.substr(l+1,s-l-1)),l=s;continue}"([{<".indexOf(e)>=0?r++:">}])".indexOf(e)>=0&&r--}return n},generateQuotes=(a,t,r,n,l,s)=>{var e="quote",i=n[a[0][0]];if(i=i.match(/^>[ 　\t]*\[([\w\W]+?)\]/),i){let u=i[1];u=u.replace(/^[ 　\t]+|[ 　\t]+$/g,""),u.length>0&&!l.metas[u]&&!l.blocks[u]&&(e=u)}var h=!0;i=a.map((u,c)=>{var o=u[0],m=n[o];c>0&&(h=h&&!!m.match(/^(\t|　　|    | 　 |  　|　  )/));var y=m.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return y!==m&&h?m=y:(head=m.match(/^>[ 　\t]*/),head&&(head=head[0],m=m.replace(head,""))),m}),i[0]=i[0].replace(new RegExp("^[ \u3000\\t]*\\["+e.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),i=i.join(`
`),i=i.replace(/^\n+|\n+$/g,"");var p='<blockquote class="'+e+'">';i=parseSection(i,l,2,s),p+=i,p+="</blockquote>";var f="blockquote-"+generateRandomKey();s[f]=p,a.forEach(u=>{var c=u[0];n[c]=null,delete r[c];var o=t.indexOf(u[1]);o>=0&&t.splice(o,1)}),n[a[0][0]]="%"+f+"%"},generateList=(a,t,r,n,l,s,e)=>{var i=[],h=-1;t.forEach(u=>{var c=u[0],o=l[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),h++,i[h]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),i[h].push(o)}),i=i.map(u=>(u=u.join(`
`),u=u.replace(/^\n+|\n+$/g,""),u));var p="";a?p="<ol>":p="<ul>",i.forEach(u=>{p+="<li>",p+=parseSection(u,s,2,e),p+="</li>"}),a?p+="</ol>":p+="</ul>";var f="list-"+generateRandomKey();e[f]=p,t.forEach(u=>{var c=u[0];l[c]=null,delete n[c];var o=r.indexOf(u[1]);o>=0&&r.splice(o,1)}),l[t[0][0]]="%"+f+"%"},analyzeSections=(a,t)=>{var r=[[]],n=0,l=[0],s=[];if(a.forEach(e=>{var i=!1;e=e.replace(/^<h(\d+)>/i,(h,p)=>{i=!0,p=p*1,p===1&&(n++,r[n]=[]),l[p-1]=(l[p-1]||0)+1;for(let u=p;u<l.length;u++)l[u]=0;var f="chap";for(let u=0;u<p;u++)f+="-"+(l[u]||1);return h=h+'<a name="'+f+'">',s.push([p,f,e.replace(/<[\w\W]+?>/gi,"")]),h}).replace(/<\/h(\d+)>$/i,h=>"</a>"+h).replace(/\{([\w \-\.]+)\}/g,(h,p)=>{var f=t.termList[p];return f?(Array.isArray(f)&&(f=f[0]),'<a class="terminology" name="'+p+'" href="#ref-'+p+'"><strong>'+f+"</strong></a>"):h}),r[n].push(e)}),r=r.filter(e=>e.length>0),t.chapList=s,r=applyFootNotes(r,t),!!t.endnotes&&t.endnotes.length>0&&r.push(applyEndNotes(t)),t.metas.glossary&&!!t.termList&&t.termList.length>0){let e='<hr class="endnote-line">';e+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',e+=generateGlossary(t),e+="</section>",r.push(e)}if(t.image=t.image||[],t.video=t.video||[],t.audio=t.audio||[],t.metas.resources&&t.image.length+t.video.length+t.audio.length>0){let e='<hr class="endnote-line">';e+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',t.image.length>0&&(e+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',e+=generateResourceList(t,"image")),t.video.length>0&&(e+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',e+=generateResourceList(t,"video")),t.audio.length>0&&(e+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',e+=generateResourceList(t,"audio")),e+="</section>",r.push(e)}if(t.metas.showtitle){let e='<header class="article-title">';if(e+="<p>"+t.metas.title+"</p>",t.metas.showauthor&&(t.metas.author&&(e+='<p class="author">',t.metas.email&&(e+='<a href="mailto:'+t.metas.email+'">'),e+=t.metas.author,t.metas.email&&(e+="</a>"),e+="</p>"),t.metas.date)){e+='<p class="author date">';let i=t.metas.date*1;if(isNaN(i))i=t.metas.date;else{i=new Date(i);let h=i.getYear()+1900,p=i.getMonth()+1;p<10&&(p="0"+p);let f=i.getDate();f<10&&(f="0"+f);let u=i.getHours();u<10&&(u="0"+u);let c=i.getMinutes();c<10&&(c="0"+c);let o=i.getSeconds();o<10&&(o="0"+o),i=h+"/"+p+"/"+f+" "+u+":"+c+":"+o}e+=i,e+="</p>"}e+="</header>",r.unshift(e)}return r},applyBlockReference=(a,t)=>{for(var r=!0,n=0;r&&(r=!1,a=a.map(l=>(l=l.replace(/\[([\w \-\.]+?)\]/g,(s,e,i)=>{var h=l.lastIndexOf("<sup>",i),p=l.lastIndexOf("</sup>",i);if(h>p)return s;var f=t.blocks[e];return f?(r=!0,f):s}),l)),n++,n!==10););return a},applyMarkUpReference=(a,t)=>{var r=(t.metas.LANG||"zh").toLowerCase();if(a=a.map(n=>(n=n.replace(/%glossary%/gi,l=>generateGlossary(t)),n=n.replace(/%resources%/gi,l=>generateResourceList(t,"image")+generateResourceList(t,"video")+generateResourceList(t,"audio")),n=n.replace(/%images%/gi,l=>generateResourceList(t,"image")),n=n.replace(/%videos%/gi,l=>generateResourceList(t,"video")),n=n.replace(/%audios%/gi,l=>generateResourceList(t,"audio")),n=n.replace(/%toc%(\{[\w\W]+?\})*/gi,l=>{var s=l.match(/\{[\w\W]+?\}/g),e="\u76EE\u5F55",i=3;return s&&s.forEach(h=>{h=h.substr(1,h.length-2);var p=h*1;isNaN(p)?e=h:i=p}),t.toced=!0,generateTableOfContent(t,e,i)}),Object.keys(t.metas).forEach(l=>{var s=l.toLowerCase();PreservedKeywords.includes(l)||(s=t.metas[l],s===!0||s===!1?r==="zh"?s=s?"\u662F":"\u5426":s=s?"On":"Off":Array.isArray(s)&&(r==="zh"?s=s.join("\u3001"):s=s.join(", ")),n=n.replace(new RegExp("%"+l+"%","gi"),e=>s))}),n=n.replace(/%([\w \-\.]+)%/g,(l,s)=>{var e=t.finals[s];return e||l}),n)),t.metas.toc&&!t.toced){let n=generateTableOfContent(t,"\u76EE\u5F55",3);n.indexOf('<p class="content-')>=0&&(n="<section>"+n+"</section>",t.metas.showtitle?a.splice(1,0,n):a.unshift(n))}return a},applyFootNotes=(a,t)=>(a=a.map(r=>{var n=[],l="<section>",s="</section>";return r.forEach((e,i)=>{var h=!1;e=e.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(p,f)=>{h=!0,n.push(f);var u=p.substr(0,p.length-1)+' href="#footnote-'+f+'">';return u}),h&&(r[i]=e)}),r=r.join(""),n.length===0||(n=n.map((e,i)=>{var h=t.refs[e],p=t.footnotes.indexOf(e);return i++,r=r.replace(new RegExp("%%FN-"+p+"%%","g"),i),'<p class="footnote-content"><a class="index" name="footnote-'+e+'">'+i+"\uFF1A</a>"+h+"</p>"}),r+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',r+=n.join(""),r+='</footer><hr class="footnote-line end">'),l+r+s}),a),applyEndNotes=a=>{let t='<hr class="endnote-line">';return t+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',a.endnotes.forEach((r,n)=>{t+='<p class="endnote-content"><a class="index" name="endnote-'+r+'">'+(n+1)+"\uFF1A</a>"+a.refs[r]+"</p>"}),t+="</section>",t},generateTableOfContent=(a,t,r)=>{var n='<h1 name="ContentTable">'+t+'</h1><aside class="content-table">';return a.chapList.forEach(l=>{if(!(l[0]>r)){var s='<p class="content-item level-'+l[0]+'">';for(let e=0;e<l[0];e++)s+='<span class="content-indent"></span>';s+='<a class="content-link" href="#'+l[1]+'">'+l[2]+"</a>",s+="</p>",n+=s}}),!!a.endnotes&&a.endnotes.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),a.metas.glossary&&!!a.termList&&a.termList.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),a.metas.resources&&a.image.length+a.video.length+a.audio.length>0&&(n+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',a.image.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),a.video.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),a.audio.length>0&&(n+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),n+="</aside>",n},generateGlossary=a=>{var t="";return a.termList===0?"":(a.termList.forEach(r=>{var[n,l]=r,s=a.terms[n],e='<p class="glossary-item">';e+='<a class="glossary-indent" name="ref-'+n+'">'+l+"</a>",e+=s,e+="</p>",t+=e}),t)},generateResourceList=(a,t)=>{var r=a[t];if(!r||!Array.isArray(r)||r.length===0)return"";var n=[],l="<ul>";return r.forEach(s=>{var e=s[1];e=e.replace(/\%([\w \-]+?)\%/g,(i,h)=>{var p=ReversePreserveWords[h.toLowerCase()];return p||i}),!n.includes(e)&&(n.push(e),l+='<li><a href="'+e+'" target="_blank">'+e+"</a></li>")}),l+="</ul>",l},convertPreserves=a=>(a=a.replace(/(\\+)(.)/g,(t,r,n)=>{var l=Math.floor(r.length/2),s=l*2!==r.length,e="",i="%"+PreserveWords["\\"]+"%";for(let h=0;h<l;h++)e+=i;if(s){let h=PreserveWords[n];h?e=e+"%"+h+"%":e=e+n}else e=e+n;return e}),a),restorePreserves=(a,t,r=!0)=>{for(var n=!0;n;)n=!1,a=a.replace(/\%([\w \-]+?)\%/g,(l,s)=>{var e=t[s];return e?(n=!0,e):l});if(!r)return a;for(n=!0;n;)n=!1,a=a.replace(/\%([\w \-]+?)\%/g,(l,s)=>{var e=t[SymHidden][s.toLowerCase()];return e?(n=!0,e):l});return a=a.replace(/\n+/g,"<br>"),a=a.replace(/\/{2}/g,(l,s)=>{if(s===0)return"<br>";var e=a.substr(s-1,1);return e===":"?l:"<br>"}),a=a.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),a},getKeywords=a=>{if(!a)return[];a=a.split(/[ ,，；;、　]+/).filter(r=>r.length>0);var t=[];return a.forEach(r=>{t.includes(r)||t.push(r)}),t},getMetas=(a,t)=>{for(var r={},n=!0;n;)n=!1,t=t.replace(/\n([A-Z\u0800-\uffff]+?) *[:：] *([\w\W]*?)\n/,(l,s,e)=>e.length===0||(s==="\u6807\u9898"?s="title":s==="\u4F5C\u8005"?s="author":s==="\u7B80\u4ECB"?s="description":s==="\u5173\u952E\u8BCD"?s="keyword":s==="\u66F4\u65B0"?s="date":s=s.toLowerCase(),!MetaWords.includes(s))?l:(n=!0,r[s]=e,`
`));if(!!r.showtitle&&["on","yes","true"].includes(r.showtitle.toLowerCase())?r.showtitle=!0:r.showtitle=void 0,!!r.glossary&&["on","yes","true"].includes(r.glossary.toLowerCase())?r.glossary=!0:r.glossary=void 0,!!r.links&&["on","yes","true"].includes(r.links.toLowerCase())?r.links=!0:r.links=void 0,!!r.refs&&["on","yes","true"].includes(r.refs.toLowerCase())?r.refs=!0:r.refs=void 0,!!r.terms&&["on","yes","true"].includes(r.terms.toLowerCase())?r.terms=!0:r.terms=void 0,!!r.resources&&["on","yes","true"].includes(r.resources.toLowerCase())?r.resources=!0:r.resources=void 0,!!r.toc&&["on","yes","true"].includes(r.toc.toLowerCase())?r.toc=!0:r.toc=void 0,a.metas=r,a.metas.keyword=getKeywords(a.metas.keyword),a.metas.date)try{a.metas.date=new Date(a.metas.date).getTime()}catch{delete a.metas.date}for(a.metas.god=a.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',a.metas.script?a.metas.script=a.metas.script.split(/[,; 　\t]+/):a.metas.script=[],a.metas.style?a.metas.style=a.metas.style.split(/[,; 　\t]+/).map(l=>l.replace(/\{[\w\W]*\}/,"")):a.metas.style=[],a.termList=a.termList||[],a.mainParser=!1,a.refs={},n=!0;n;)n=!1,t=t.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(l,s,e,i,h)=>(s=s.trim(),e=e.trim(),s.length===0||e.length===0?l:(a.refs[s]=e,n=!0,`
`+i)));for(a.blocks={},n=!0;n;)n=!1,t=t.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(l,s,e)=>{if(s=s.trim(),!(s.length===0||e.length===0))return a.blocks[s]=e,n=!0,""});return a.anchors=[],a.terms={},a.notes={},t.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(l,s,e,i)=>{var h=e||i;a.refs[h]?s.substr(0,1)==="{"?a.terms[h]=h:a.notes[h]=h:s.substr(0,1)==="{"&&!a.anchors.includes(h)&&a.anchors.push(h)}),t=regularize(t),t};MarkUp.fullParse=(a,t)=>{var r={finals:{},toced:!1};a=prepare(a),a=getMetas(r,a),r.parseLevel=0,r.mainParser=!0,r.metas.title=r.metas.title||"\u65E0\u540D\u6587";var n=Object.keys(r.metas);Object.keys(t).forEach(e=>{n.includes(e)||n.push(e)}),t.overwrite?n.forEach(e=>{r.metas[e]=t[e]===null||t[e]===void 0?r.metas[e]:t[e]}):n.forEach(e=>{r.metas[e]=r.metas[e]===null||r.metas[e]===void 0?t[e]:r.metas[e]}),n.forEach(e=>{(r.metas[e]===null||r.metas[e]===void 0)&&(r.metas[e]=!1)}),a=parseSection(a,r),Object.keys(r.refs).forEach(e=>{var i=r.refs[e];i=parseLine(i,r),i=i.replace(/\%([\w \-]+?)\%/g,(h,p)=>{var f=ReversePreserveWords[p.toLowerCase()];return f||h}),r.refs[e]=i}),Object.keys(r.blocks).forEach(e=>{var i=r.blocks[e],h=i.match(/^\n+/);i=i.trim();var p;r.parseLevel=0,h?p=parseSection(i,r,1):p=[parseLine(i,r)],r.blocks[e]=p.join("")});for(let e in r.terms)r.terms[e]=r.refs[e];for(let e in r.notes)r.notes[e]=r.refs[e];a=a.map(e=>e.replace(/\%([\w \-]+?)\%/g,(i,h)=>{var p=ReversePreserveWords[h.toLowerCase()];return p||i})),a=applyBlockReference(a,r),a=analyzeSections(a,r),a=applyMarkUpReference(a,r),r.metas.classname?a='<article class="'+r.metas.classname+'">'+a.join("")+"</article>":a="<article>"+a.join("")+"</article>",r.metas.fullexport&&(r.metas.style.forEach(e=>{a+='<link type="text/css" rel="stylesheet" href="'+e+'">'}),r.metas.script.forEach(e=>{a+='<script type="text/javascript" src="'+e+'"></script>'}));var l=FinalRender._indexes_||[];l.forEach(e=>{var i=FinalRender[e];!i||i.forEach(h=>{a=h.parse(a,r)})}),a=a.replace(/<p>(<br\/?>)+<\/p>/gi,"");var s={};return s.content=a,s.title=r.metas.title,s.lineCount=r.metas.totalLineCount,s.chapList=r.chapList,s.tables=r.tables,s.meta={},s.meta.author=r.metas.author,s.meta.email=r.metas.email,s.meta.description=r.metas.description,s.meta.update=r.metas.date,s.meta.keywords=r.metas.keyword.map(e=>e),r.metas.others&&(s.meta.others=r.metas.others),s.terminology={},r.termList.forEach(e=>{s.terminology[e[0]]=e[1]}),s.notes={},Object.keys(r.refs).forEach(e=>{s.notes[e]=r.refs[e]}),s.blocks={},Object.keys(r.refs).forEach(e=>{s.blocks[e]=r.blocks[e]}),s},MarkUp.parse=(a,t)=>{var r;return r=MarkUp.fullParse(a+`
`,t),r?r.content:""};const reverseSection=(a,t)=>{t.__level++;var r=[],n="",l=!0;return a.childNodes.forEach(s=>{var e=s.tagName;if(!e){if(s.nodeName==="#comment")return;let h=s.textContent||"";h=h.trim(),h.length>0&&(n+=h);return}e=e.trim().toLowerCase();var i;if(ParagraphTags.includes(e)){if(l=!1,n.length>0&&(r.push(t.__prefix+n),n=""),e==="blockquote"){let h=t.__prefix;t.__prefix=t.__prefix+">	",i=reverseSection(s,t),i=i.flat(Infinity),i.push(`
`),t.__prefix=h}else if(e==="ol"){let h=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"1.	",i=reverseSection(s,t),i=i.flat(Infinity),i.push(""),t.__prefix=h}else if(e==="ul"){let h=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"-	",i=reverseSection(s,t),i=i.flat(Infinity),i.push(""),t.__prefix=h}else i=reverseSection(s,t),i=i.flat(Infinity),i.push("");!!i&&i.length>0&&r.push(...i)}else{let[h,p]=reverseMix(s,e,t);p?h.length>0&&(n+=h.join("")):(n.length>0&&(r.push(t.__prefix+n),n=""),h.forEach(f=>{r.push(t.__prefix+f)}))}}),n.length>0&&r.push(t.__prefix+n),t.__level--,r},reverseLine=(a,t)=>{var r="";return a.childNodes.forEach(n=>{var l=n.tagName;if(!l){if(n.nodeName==="#comment")return;let s=n.textContent||"";s=s.trim(),s.length>0&&(r+=s);return}if(l=l.trim().toLowerCase(),l==="a"){let s=n.href;s.indexOf("javascript:")===0&&(s="");let e=reverseLine(n,t);!s||s.substr(0,1)==="#"||(s.match(/^(ftp|https?):\/\//i)||(s=t.host+s),e="["+e+"]("+s+")"),r+=e;return}if(l==="span"||l==="font"){r+=reverseLine(n,t);return}if(l==="strong"||l==="b"){r+=reverseLine(n,t);return}if(l==="em"||l==="i"){r+=reverseLine(n,t);return}if(l==="sup"){r+=reverseLine(n,t);return}if(l==="sub"){r+=reverseLine(n,t);return}if(l==="del"){r+=reverseLine(n,t);return}r+=n.innerText}),r},reverseMix=(a,t,r)=>{if(t==="script")return[[""],!0];if(t==="style")return[[""],!0];if(t==="link")return[[""],!0];if(t==="hr")return[[`
---
`],!1];if(t==="br")return[[`
`],!0];if(t.match(/^h\d+$/)){let l=t.substring(1,t.length);l*=1;let s=`
`;for(let i=0;i<l;i++)s+="#";let e=reverseLine(a,r);return e=s+e+`
`,[[e],!1]}if(t==="a"){let l=a.href;l.indexOf("javascript:")===0&&(l="");let s=reverseLine(a,r);return!l||l.substr(0,1)==="#"?[[s],!0]:(l.match(/^(ftp|https?):\/\//i)||(l=r.host+l),s="["+s+"]("+l+")",[[s],!0])}if(t==="img")return a.src.length===0?[[""],!0]:[[`
![](`+a.src+`)
`],!1];if(t==="video")return a.src.length===0?[[""],!0]:[[`
@[](`+a.src+`)
`],!0];if(t==="audio")return a.src.length===0?[[""],!0]:[[`
#[](`+a.src+`)
`],!0];if(t==="span"||t==="font")return[[reverseLine(a,r)],!0];if(t==="strong"||t==="b"){let l=reverseLine(a,r);return[["**"+l+"**"],!0]}if(t==="em"||t==="i"){let l=reverseLine(a,r);return[["*"+l+"*"],!0]}if(t==="u"){let l=reverseLine(a,r);return[["__"+l+"__"],!0]}if(t==="sup"){let l=reverseLine(a,r);return[["^"+l+"^"],!0]}if(t==="sub"){let l=reverseLine(a,r);return[["_"+l+"_"],!0]}if(t==="del"){let l=reverseLine(a,r);return[["~~"+l+"~~"],!0]}var n=reverseLine(a,r);return[[n],!1]};MarkUp.reverse=(a,t,r=!0)=>{if(!a)return"";t=t||{},t.__level=0,t.__prefix="",t.host=t.host||"";var n=reverseSection(a,t);return n=n.flat(Infinity),n=n.join(`
`),n=n.replace(/\n{2,}/g,`

`),n},MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch{try{global.MarkUp=MarkUp}catch(a){console.error(a)}}})();
