(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","UPDATE","PUBLISH","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],MetaAlias={\u6807\u9898:"title",\u4F5C\u8005:"author",\u7B80\u4ECB:"description",\u5173\u952E\u8BCD:"keywords",\u53D1\u5E03:"publish",\u66F4\u65B0:"update"},PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],TimeStampKeywords=["date","update","publish"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(e,r=1){return r<1||e<=r?1:e*MathTools.factorial(e-r,r)},permutate(e,r){return e<=1?1:r<=1?e:r>e?1:(e-r+1)*MathTools.permutate(e,r-1)},combinate(e,r){return e<=1||r<=0||r>=e?1:(e-r+1)/r*MathTools.combinate(e,r-1)},round(e,r=0){var t=10**r;return e*=t,e=Math.round(e),e/t},floor(e,r=0){var t=10**r;return e*=t,e=Math.floor(e),e/t},ceil(e,r=0){var t=10**r;return e*=t,e=Math.ceil(e),e/t}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(e=>ReversePreserveWords[PreserveWords[e].toLowerCase()]=e),ReversePreserveWords.$="&#36;",MetaWords.forEach((e,r)=>MetaWords[r]=e.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(e=8)=>{var r="";for(let t=0;t<e;t++)r+=Math.floor(Math.random()*10)+"";return r};MarkUp.addExtension=(e,r=0,t=5)=>{if(r===0){let i=LineRender._indexes_;i||(i=[],LineRender._indexes_=i),i.includes(t)||(i.push(t),i.sort((n,l)=>n-l)),i=LineRender[t],i||(i=[],LineRender[t]=i),i.push(e)}else if(r===1){let i=BlockRender._indexes_;i||(i=[],BlockRender._indexes_=i),i.includes(t)||(i.push(t),i.sort((n,l)=>n-l)),i=BlockRender[t],i||(i=[],BlockRender[t]=i),i.push(e)}else if(r===2){let i=FinalRender._indexes_;i||(i=[],FinalRender._indexes_=i),i.includes(t)||(i.push(t),i.sort((n,l)=>n-l)),i=FinalRender[t],i||(i=[],FinalRender[t]=i),i.push(e)}};const prepare=e=>(e=`
`+e+`
`,e=e.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(r,t)=>{var i=t.replace(/　/g,"  ").length;return i<4?`
`:r}),e=e.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(r,t,i)=>t+`
`+i),MetaWords.forEach(r=>{var t=new RegExp("([\\w\\W]? *)\\["+r+"\\]( *[\\w\\W]?)","gi");e=e.replace(t,(i,n,l)=>n==="]"||l==="["||l==="("?i:n+"%"+r+"%"+l)}),e),regularize=e=>(e=e.replace(/^\n+|\n+$/gi,""),e=e.replace(/\n{3,}/gi,`


`),e),parseLine=(e,r,t=-Infinity,i)=>{var n=LineRender._indexes_;if(!n)return"";var l=!i;return i=i||{},n.some(a=>{if(t>a||a>=0)return!0;for(var s=LineRender[a],f=!0;f;)f=!1,s.forEach(h=>{var u;[e,u]=h.parse(e,r,i),u&&(f=!0)})}),e=convertPreserves(e),n.forEach(a=>{if(!(t>a)&&!(a<0))for(var s=LineRender[a],f=!0;f;)f=!1,s.forEach(h=>{var u;[e,u]=h.parse(e,r,i),u&&(f=!0)})}),l&&(e=restorePreserves(e,i)),e},parseSection=(e,r,t=0,i)=>{r.parseLevel++;var n=[],l=!1;i||(l=!0,i={});var a=[];n=e.split(`
`),n.forEach((h,u)=>{var p=h.match(/^[ 　\t]*$/);if(h.length===0){a.push([u,1,0,0,0,0,0,0]);return}if(h.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){h.match(/^\-+$|^=+$/)?a.push([u,0,2,0,0,0,0,0]):h.match(/^~+$/)?a.push([u,0,2,0,0,1,0,0]):a.push([u,0,1,0,0,0,0,0]);return}if(p=h.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),p){p[2]?a.push([u,0,0,0,0,2,0,0,p[1]]):a.push([u,0,0,0,0,1,0,0,p[1]]);return}if(p=h.match(/^\${2}[ 　\t]*$/),p){p[2]?a.push([u,0,0,0,0,0,0,1]):a.push([u,0,0,0,0,0,0,1]);return}if(p=h.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),p){if(p=h.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),p){p[2]?a.push([u,0,0,0,1,2,0,0]):a.push([u,0,0,0,1,1,0,0]);return}if(p=h.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),p){p[2]?a.push([u,0,0,0,1,0,0,1]):a.push([u,0,0,0,1,0,0,1]);return}a.push([u,0,0,0,1,0,0,0]);return}if(p=h.match(/^(> *)+/),p){if(p=h.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),p){p[2]?a.push([u,0,0,1,0,2,0,0]):a.push([u,0,0,1,0,1,0,0]);return}if(p=h.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),p){p[2]?a.push([u,0,0,1,0,0,0,1]):a.push([u,0,0,1,0,0,0,1]);return}a.push([u,0,0,1,0,0,0,0]);return}if(p=h.match(/^([ 　\t]+)/),p){if(p=h.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),p){p[1]?a.push([u,0,0,1,1,2,0,0]):a.push([u,0,0,1,1,1,0,0]);return}if(p=h.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),p){p[1]?a.push([u,0,0,1,1,0,0,1]):a.push([u,0,0,1,1,0,0,1]);return}a.push([u,0,0,1,1,0,0,0]);return}if(p=h.match(/\|/g),p){let c=h.match(/\\\|/g);if(!c||!!c&&c.length!==p.length){let o=!0;for(c=h;o;){o=!1;let g=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");g=g.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),g=g.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=g!==c,c=g}if(c.indexOf("|")>=0){a.push([u,0,0,0,0,0,1,0]);return}}}});var s={};a.forEach(h=>{s[h[0]]=h});var f=!1;if(a.length>0){if(f=parseLaTeX(a,s,n,r,i)||f,a.length>0&&(f=parseCodeBlock(a,s,n,r,i)||f),a.length>0&&(f=parseTable(a,s,n,r,i)||f),l&&t===0&&!!r.metas.linenumber){let h=0;n.forEach((u,p)=>{if(!!u&&!u.match(/^%[\w\-]+%$/)){var c=s[p];if(!(!!c&&(c[1]>0||c[2]>0))&&!u.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=u.match(/\{[<\|>]\}$/);o?(o=o[0],u=u.substr(0,u.length-o.length)+'<span name="line-'+h+'"></span>'+o):u=u+'<span name="line-'+h+'"></span>',h++,n[p]=u}}}),r.metas.totalLineCount=h}[n,s]=squeezeContents(a,s,n),a.length>0&&(f=parseListAndBlockQuote(a,s,n,r,i)||f,[n,s]=squeezeContents(a,s,n)),a.length>0&&(f=parseHeadline(a,s,n,r,i)||f,[n,s]=squeezeContents(a,s,n))}return f=parseResources(a,s,n,r,i)||f,[n,s]=squeezeContents(a,s,n),f=parseParagraph(a,s,n,r,i)||f,n=n.map(h=>{if(h===null||h===void 0||h.length===0)return"";var u="";if(l)h.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?u=restorePreserves(h,i,!1):(u=parsePlainParaStyle(h,r),u=restorePreserves(u,i,!1));else{u=parsePlainParaStyle(h,r);let p="param-"+generateRandomKey();i[p]=u,u="%"+p+"%"}return u}),r.parseLevel--,r.parseLevel>0&&(n=n.join("")),n},squeezeContents=(e,r,t)=>(t=t.map((i,n)=>[n,i]),t=t.filter(i=>!(!i[1]&&i[1]!=="")),t.forEach((i,n)=>{var l=i[0],a=r[l];!a||(a[0]=n)}),r={},e.forEach(i=>{r[i[0]]=i}),t=t.map(i=>i[1]),[t,r]),parsePlainParaStyle=(e,r)=>{var t="<p",i="</p>",n=[],l=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),a=l.match(/^\{[<\|>]\}/);a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(f,h)=>h||"")),l=e.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),a=l.match(/\{[<\|>]\}$/),a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(f,h)=>h||"")),l=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var s=l.match(/^:+/);return!!s&&!l.match(/^:([\w\-\.]+?):/)&&(s=s[0],n.push("indent","indent-"+s.length),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(f,h)=>h||"")),n.length>0&&(t=t+' class="'+n.join(" ")+'"'),t=t+">",e.length===0?"":t+e+i},parseLaTeX=(e,r,t,i,n)=>{var l=[];if(e.forEach(u=>{!u[7]||l.push(u)}),l.length===0)return!1;if(l.length===1)return l[0][7]=0,!1;var a=l.length,s=l[0];s[7]=2;for(let u=1;u<a;u++){let p=l[u];s[7]===2?(p[3]=s[3],p[4]=s[4],p[7]=3):s[7]===3&&(p[7]=2),s=p}l[l.length-1][7]===2&&(l[l.length-1][7]=0),l.forEach(u=>{u[7]===1&&(u[7]=0)});var f=[];l=l.filter(u=>u[7]<2?!1:(u[7]===2&&f.push(u[0]),!0)),a=l.length;for(let u=a-1;u>0;u-=2){let p=l[u-1][0];f.includes(p)||l.splice(u-1,2)}var h=[];a=l.length;for(let u=0;u<a;u+=2)h.push([l[u][0],l[u+1][0]]);return h.forEach(u=>{var p=['<p class="latex block">$$'];for(let o=u[0]+1;o<u[1];o++)p.push(t[o]);p.push("$$</p>"),p=p.join("<br>");var c="latex-"+generateRandomKey();i.finals[c]=p,t[u[0]]="%"+c+"%";for(let o=u[0]+1;o<=u[1];o++)t[o]=null;for(let o=u[0];o<=u[1];o++){let g=r[o];if(!g)continue;let y=e.indexOf(g);y>=0&&e.splice(y,1),delete r[o],g[0]=-1}}),h.length>0},parseCodeBlock=(e,r,t,i,n)=>{var l=[];if(e.forEach(c=>{!c[5]||l.push(c)}),l.length===0)return!1;if(l.length===1)return l[0][5]=0,!1;var a=l.length,s=l[0],f=[],h;s[5]=2,h=s[8];for(let c=1;c<a;c++){let o=l[c];if(!!h&&o[8]!==h){o[5]=0;continue}if(o[5]===2){if(c===a-1&&(o[5]=0),s[5]!==3){s[5]=0;continue}h=o[8]}s[5]===2?(o[3]=s[3],o[4]=s[4],o[5]=3,h=null):s[5]===3&&(o[5]=2),s=o}l[l.length-1][5]===2&&(l[l.length-1][5]=0),l.forEach(c=>{c[5]===1&&(c[5]=0)});var u=[];l=l.filter(c=>c[5]<2?!1:(c[5]===2&&u.push(c[0]),!0)),a=l.length;for(let c=a-1;c>0;c-=2){let o=l[c-1][0];u.includes(o)||l.splice(c-1,2)}var p=[];a=l.length;for(let c=0;c<a;c+=2){let o=l[c],g=l[c+1];if(!o||!g)break;o=o[0],g=g[0],p.push([o,g])}return p.forEach(c=>{var o=t[c[0]],g=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],y=o.indexOf(g);g=o.substr(y+g.length,o.length),g=g.replace(/^[ 　\t]+|[ 　\t]+$/g,""),g=g.toLowerCase(),(!g||g===""||g==="text")&&(g="plaintext");var $='<pre lang="'+g+'"><code>',j="</code></pre>",P=!1,v=[],R=[];if(g==="plaintext")for(let d=c[0]+1;d<c[1];d++){let m=t[d];v.push("<p>"+m+"</p>")}else for(let d=c[0]+1;d<c[1];d++){let m=t[d],b=[],S=-1,x=null,W=[],A=!1;if(P){let L=m.match(/(\\*)`/);if(!L)b.push([0,m.length-1]);else{let w=L[1].length;w>>1<<1!==w?b.push([0,m.length-1]):(P=!1,A=!0,S=0,x="`",m.replace(/(\\*)(['"`])/g,(k,C,E,M)=>{var T=C.length;!!x&&E!==x||T>>1<<1===T&&(M+=T,S===-1?(S=M,x=E,E==="`"&&(A=!0)):(b.push([S,M]),S=-1,x=null,E==="`"&&(A=!1)))}),A&&(b.push([S,m.length-1]),P=!0))}}else m.replace(/(\\*)(['"`])/g,(L,w,k,C)=>{var E=w.length;!!x&&k!==x||E>>1<<1===E&&(C+=E,S===-1?(S=C,x=k,k==="`"&&(A=!0)):(b.push([S,C]),S=-1,x=null,k==="`"&&(A=!1)))}),A&&(b.push([S,m.length-1]),P=!0);for(let L=b.length-1;L>=0;L--){let w=b[L],k=m.substring(0,w[0]),C=m.substring(w[0],w[1]+1),E=m.substring(w[1]+1,m.length),M="[%:"+W.length+":%]";W.push(C),m=k+M+E}m=m.replace(CodeBlockKeyWords.operator,(L,w,k,C,E)=>{var M=b.some(O=>E>=O[0]&&E<=O[1]);if(M)return L;var T=(w||"")+'<span CLASS="operatorword">'+k+"</span>"+(C||"");return T}),m=m.replace(CodeBlockKeyWords.system,(L,w,k,C,E)=>{var M=b.some(O=>E>=O[0]&&E<=O[1]);if(M||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return L;var T=(w||"")+'<span CLASS="flowword">'+k+"</span>"+(C||"");return T}),m=m.replace(CodeBlockKeyWords.function,(L,w,k,C,E)=>{var M=b.some(O=>E>=O[0]&&E<=O[1]);if(M||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return L;var T=(w||"")+'<span CLASS="keyword">'+k+"</span>"+(C||"");return T}),m=m.replace(CodeBlockKeyWords.consts,(L,w,k,C,E,M)=>{var T=b.some(N=>M>=N[0]&&M<=N[1]);if(T||!!w&&w.match(/[\w\d_\.]/)||!!E&&E.match(/[\w\d_\.]/))return L;var O=(w||"")+'<span CLASS="constsword">'+k+"</span>"+(E||"");return O}),m=m.replace(CodeBlockKeyWords.object,(L,w,k,C,E)=>{var M=b.some(O=>E>=O[0]&&E<=O[1]);if(M||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return L;var T=(w||"")+'<span CLASS="objectword">'+k+"</span>"+(C||"");return T}),W.forEach((L,w)=>{var k='\\[%:(<span CLASS="constsword">)?'+w+"(</span>)?:%\\]";k=new RegExp(k),m=m.replace(k,'<span CLASS="constsword">'+L+"</span>")}),m=m.replace(/<span CLASS="/g,'<span class="'),v.push("<p>"+m+"</p>")}v=v.join(""),v=$+v+j;var _="codeblock-"+generateRandomKey();i.finals[_]=v,t[c[0]]="%"+_+"%";for(let d=c[0]+1;d<=c[1];d++)t[d]=null;for(let d=c[0];d<=c[1];d++){let m=r[d];if(!m)continue;let b=e.indexOf(m);b>=0&&e.splice(b,1),delete r[d],m[0]=-1}}),p.length>0},parseTable=(e,r,t,i,n)=>{var l=[];if(e.forEach(u=>{!u[6]||l.push(u)}),l.length!==0){var a=[],s=0,f=l[0][0];a.push([l[0]]);var h=l.length;for(let u=1;u<h;u++){let p=l[u];p[0]===f+1?a[s].push(p):(s++,a[s]=[p]),f=p[0]}return a=a.filter(u=>!(u.length<2)),a.forEach(u=>{generateTable(u,e,r,t,i,n)}),!0}},parseListAndBlockQuote=(e,r,t,i,n)=>{var l=0,a=t.length;if(e.forEach((o,g)=>{if(o[3]+o[4]!==0){var y=o[0];y<a&&(a=y),y>l&&(l=y)}}),a>l)return!1;for(let o=l+1;o<t.length-1;o++){let g=r[o],y=r[o+1];if(!!g&&g[1]>0&&!!y&&y[1]>0)break;l=o}if(l===t.length-2){let o=t.length-1,g=r[o];(!g||g[1]===0)&&(l=o)}var s=0,f=[[[a,r[a]]]],h=!1,u=!0;r[a][3]>0&&(h=!0);for(let o=a+1;o<=l;o++){var p=r[o];if(!p){u&&f[s].push([o,null]);continue}if(p[1]){if(!u)continue;let g=r[o+1];if(!g||g[1]>0){u=!1;continue}f[s].push([o,p]);continue}if(p[3]+p[4]===0){u&&f[s].push([o,p]);continue}if(u){f[s].push([o,p]);continue}s++,f[s]=[],r[o][3]>0?h=!0:h=!1,u=!0,f[s].push([o,p])}var c=!1;return f.forEach(o=>{o.forEach(j=>{var P=j[0];j[1]||(t[P]="    "+t[P])});var g=0,y=o[0][0],$=t[y],g=-1;$.match(/^[ 　\t>]/)?g=0:$.match(/^[\-\+]|[\*~][ 　\t]/)?g=1:$.match(/^\d+\.[ 　\t]/)&&(g=2),!(g<0)&&(change=!0,g===0?generateQuotes(o,e,r,t,i,n):g===1?generateList(!1,o,e,r,t,i,n):g===2&&generateList(!0,o,e,r,t,i,n))}),c},parseHeadline=(e,r,t,i,n)=>{var l=[],a=[];e.forEach(s=>{if(s[2]!==0){var f=s[0],h=r[f-1];if(h)h[1]>0&&l.push([f,t[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let u=t[f-1];if(f===0||!!u.match(/^%[\w\-]+%$/))l.push([f,t[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let p=t[f].substr(0,1);p==="="?a.push([f-1,1]):p==="-"?a.push([f-1,2]):p==="~"?a.push([f-1,3]):p==="+"?a.push([f-1,3]):p==="_"?a.push([f-1,3]):p==="*"?a.push([f-1,4]):p==="#"?a.push([f-1,5]):p==="."&&a.push([f-1,6]),t[f]=null}}}});for(let s=0;s<t.length;s++){let f=t[s];if(!f)continue;let h=f.match(/^(#+)[ 　\t]*/);if(h){let u=h[0],p=h[1];u!==f&&f.indexOf(u+"[")!==0&&(a.push([s,p.length]),t[s]=f.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return l.length+a.length===0?!1:(a.sort((s,f)=>s[0]-f[0]),l.forEach(s=>{var[f,h]=s,u="headline-"+generateRandomKey(),p="<hr";h==="="?p=p+' class="heavy">':h==="-"?p=p+' class="light">':h==="*"?p=p+' class="star">':h==="~"?p=p+' class="wavy">':h==="."?p=p+' class="dotted">':h==="_"?p=p+' class="dashed">':h==="+"?p=p+' class="strong">':h==="#"?p=p+' class="heavystrong">':p=p+">",n[u]=p,t[f]="%"+u+"%"}),a.forEach(s=>{var[f,h]=s,u="header-"+generateRandomKey(),p="h"+(h||1),c=t[f];c=parseLine(c,i),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+p+">"+c+"</"+p+">",n[u]=c,t[f]="%"+u+"%"}),!0)},parseResources=(e,r,t,i,n)=>{for(var l=[],a=!0;a;)a=!1,t.forEach(s=>{if(s.length===0)return l.push(s);s=s.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(p,c,o,g)=>{var y=i.refs[g],$;if(!y||y.indexOf("://")<0&&y.indexOf("@")<0&&!y.match(/^\.{0,2}[\\\/]/)||y.indexOf(`
`)>=0){if($=i.metas[g.toLowerCase()],!$||$.indexOf("://")<0&&$.indexOf("@")<0&&!$.match(/^\.{0,2}[\\\/]/)||$.indexOf(`
`)>=0)return p;y=$}return c+"("+y+")"});for(var f=[],h=[],u=!0;u;)u=!1,s=s.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(p,c,o)=>(u=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?h.push(p):f.push(p),""));s=s.replace(/^[ 　\t]+|[ 　\t]+$/g,""),h.forEach(p=>l.push(p)),s.length>0&&(f.length>0&&(a=!0),l.push(s)),f.forEach(p=>l.push(p))}),t.splice(0,t.length),l.forEach(s=>t.push(s)),l=[];return!0},parseParagraph=(e,r,t,i,n)=>{var l=[],a=[],s=[],f=-1;t.forEach((h,u)=>{if(!h||h.length===0){f=-1;return}var p=h.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(p){f=-1;return}if(p=h.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),p){s.push([u,h]),f=-1;return}p=h.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=p?1:0;c===f?c===0?l[l.length-1].push([u,h]):c===1&&a[a.length-1].push([u,h]):(c===0?l[l.length]=[[u,h]]:c===1&&(a[a.length]=[[u,h]]),f=c)}),a=a.filter(h=>{var u=h.length>1;return h.length===1&&s.push(h[0]),u}),l.forEach(h=>{var u=[],p=h[0][0];h.forEach(c=>{var o=c[0],g=c[1];g.length!==0&&(u.push(parseLine(g,i)),t[o]=null)}),u=u.join("<br>"),t[p]=u}),a.forEach(h=>{var u=[],p=h[0][0];h.forEach(o=>{u.push(parseLine(o[1],i)),t[o[0]]=null}),u=u.join(""),u='<div class="image-wall">'+u+"</div>";var c="imagewall-"+generateRandomKey();n[c]=u,t[p]="%"+c+"%"}),s.forEach(h=>{var[u,p]=h;p=parseLine(p,i);var c="resource-"+generateRandomKey();n[c]=p,t[u]="%"+c+"%"})},generateTable=(e,r,t,i,n,l)=>{var a=!0,s=null,f=null,h=-1,u=!1;s=i[e[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),s?(s=s[1].trim(),s.match(/\{h\}/i)&&(u=!0,s=s.replace(/\{h\}/gi,"").replace(/(^[ 　\t]+|[ 　\t]+$)/g,"")),i[e[0][0]]="",e.shift()):s=generateRandomKey(16),e.some((v,R)=>{var _=i[v[0]];_=_.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=_.match(/[\|:\-]+/);if(!!d&&(d=d[0],_===d))return f=d,h=v[0],R===0&&(a=!1),!0}),f?(f=f.replace(/^\||\|$/g,""),f=f.split("|"),f=f.map(v=>v.match(/^:\-:$/)?1:v.match(/^:\-$/)?0:v.match(/^\-:$/)?2:3)):(a=!1,f=[]);var p=[],c=0;e.forEach((v,R)=>{var _=v[0];if(_!==h){var d=parseTableRow(i[_]);p.push(d),d.length>c&&(c=d.length)}});for(let v=f.length;v<c;v++)f.push("");for(let v=0;v<p.length-1;v++){let R=p[v],_=R?R.length:c;for(let d=R.length;d<c;d++)R.push("")}var o;a&&(o=p[0],p.shift());for(let v=0;v<c;v++){if(f[v]!==3)continue;let R=!0;p.some(_=>{var d=_[v];if(!!d&&d*1!==d)return R=!1,!0}),R?f[v]=2:f[v]=0}var g='<table name="'+s+'"',y=[];u&&(g+=' hidden="true"'),g+=">",a&&(g+="<thead><tr>",o.forEach((v,R)=>{var _=!1;v.match(/\{s\}$/i)&&(_=!0,v=v.replace(/[ 　\t]*\{s\}$/i,""));var d=!1;v.match(/\{h\}$/i)&&(y[R]=!0,d=!0,v=v.replace(/[ 　\t]*\{h\}$/i,"")),v=parseLine(v,n);var m='<th align="',b=f[R];b===1?m+="center":b===2?m+="right":m+="left",_&&(m+='" sortable="true'),m+='"',d&&(m+=' hidden="true"'),m+=">"+v+"</td>",g+=m}),g+="</tr></thead>"),g+="<tbody>";var $=[];p.forEach((v,R)=>{v.forEach((_,d)=>{var m=_.match(/^[ 　\t]*CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!m){var b=m[1]*1;(isNaN(b)||b<1)&&(b=1);var S=m[2];$[d]=[b,S,R+1]}})}),$.length>0&&calculateTable(p,$);var j=[];p.forEach((v,R)=>{g+="<tr>";var _=[];v.forEach((d,m)=>{d=parseLine(d,n);var b=d.replace(/<.*?>/gi,"");_[m]=b.trim();var S='<td align="',x=f[m];x===1?S+="center":x===2?S+="right":S+="left",S+='"',y[m]&&(S+=' hidden="true"'),S+=">"+d+"</td>",g+=S}),g+="</tr>",j[R]=_}),g+="</tbody></table>",n.tables=n.tables||{},n.tables[s]=j;var P="table-"+generateRandomKey();l[P]=g,o=e[0][0],total=e.length;for(let v=0;v<total;v++){let R=e[v],_=R[0];i[_]=null,delete t[_];let d=r.indexOf(R);d>=0&&r.splice(d,1),R[0]=-1}i[o]="%"+P+"%"},calculateTable=(e,r)=>{var t=[],i=[];r.forEach((l,a)=>{if(!!l){var[s,f,h]=l;t[s]=t[s]||[],t[s].push([a,parseEquation(f,h,i)])}});var n=[];e.forEach((l,a)=>{list=[],i.forEach(s=>{var f=l[s]*1;isNaN(f)&&(f=0),list[s]=f}),n.push(list)}),t.forEach(l=>{!l||l.length===0||e.forEach((a,s)=>{l.forEach(([f,h])=>{var u="";try{u=h(n,s),n[s]=n[s]||[],n[s][f]=u,u=u+""}catch(p){u=""}a[f]=u})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\(\)\+\-\*\/ ]+)(!+)/g,(e,r,t)=>"MathTools.factorial("+r+","+t.length+")").replace(/([a-zA-Z]+)(\d+)/gi,(e,r,t)=>{if(!r||!t||(t=t*1,t*1!==t)||(r=r.replace(/\w/g,n=>Char2Dig[n.toLowerCase()]),r=parseInt(r,26),isNaN(r)))return"0";dataCol.includes(r)||dataCol.push(r);var i=t-line;return i===0?"((dataList[lineNum]||[])["+r+"]||0)":i>0?"((dataList[lineNum+"+i+"]||[])["+r+"]||0)":(i*=-1,"((dataList[lineNum-"+i+"]||[])["+r+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,e=>"Math."+e.toLowerCase()).replace(/per(mutate)?/gi,e=>"MathTools.permutate").replace(/com(binate)?/gi,e=>"MathTools.combinate").replace(/round/gi,e=>"MathTools.round").replace(/ceil/gi,e=>"MathTools.ceil").replace(/floor/gi,e=>"MathTools.floor"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=e=>{e.substr(0,1)!=="|"&&(e="|"+e),e.substr(e.length-1,1)!=="|"&&(e=e+"|");var r=e.length,t=0,i=[],n=0;for(let l=1;l<r;l++){let a=e.substr(l,1);if(a==="|"&&t===0){i.push(e.substr(n+1,l-n-1)),n=l;continue}"([{<".indexOf(a)>=0?t++:">}])".indexOf(a)>=0&&t--}return i},generateQuotes=(e,r,t,i,n,l)=>{var a="quote",s=i[e[0][0]];if(s=s.match(/^>[ 　\t]*\[([\w\W]+?)\]/),s){let p=s[1];p=p.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.length>0&&!n.metas[p]&&!n.blocks[p]&&(a=p)}var f=!0;s=e.map((p,c)=>{var o=p[0],g=i[o];c>0&&(f=f&&!!g.match(/^(\t|　　|    | 　 |  　|　  )/));var y=g.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return y!==g&&f?g=y:(head=g.match(/^>[ 　\t]*/),head&&(head=head[0],g=g.replace(head,""))),g}),s[0]=s[0].replace(new RegExp("^[ \u3000\\t]*\\["+a.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),s=s.join(`
`),s=s.replace(/^\n+|\n+$/g,"");var h='<blockquote class="'+a+'">';s=parseSection(s,n,2,l),h+=s,h+="</blockquote>";var u="blockquote-"+generateRandomKey();l[u]=h,e.forEach(p=>{var c=p[0];i[c]=null,delete t[c];var o=r.indexOf(p[1]);o>=0&&r.splice(o,1)}),i[e[0][0]]="%"+u+"%"},generateList=(e,r,t,i,n,l,a)=>{var s=[],f=-1;r.forEach(p=>{var c=p[0],o=n[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),f++,s[f]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),s[f].push(o)}),s=s.map(p=>(p=p.join(`
`),p=p.replace(/^\n+|\n+$/g,""),p));var h="";e?h="<ol>":h="<ul>",s.forEach(p=>{h+="<li>",h+=parseSection(p,l,2,a),h+="</li>"}),e?h+="</ol>":h+="</ul>";var u="list-"+generateRandomKey();a[u]=h,r.forEach(p=>{var c=p[0];n[c]=null,delete i[c];var o=t.indexOf(p[1]);o>=0&&t.splice(o,1)}),n[r[0][0]]="%"+u+"%"},analyzeSections=(e,r)=>{var t=[[]],i=0,n=[0],l=[];if(e.forEach(a=>{var s=!1;a=a.replace(/^<h(\d+)>/i,(f,h)=>{s=!0,h=h*1,h===1&&(i++,t[i]=[]),n[h-1]=(n[h-1]||0)+1;for(let p=h;p<n.length;p++)n[p]=0;var u="chap";for(let p=0;p<h;p++)u+="-"+(n[p]||1);return f=f+'<a name="'+u+'">',l.push([h,u,a.replace(/<[\w\W]+?>/gi,"")]),f}).replace(/<\/h(\d+)>$/i,f=>"</a>"+f).replace(/\{([\w \-\.]+)\}/g,(f,h)=>{var u=r.termList[h];return u?(Array.isArray(u)&&(u=u[0]),'<a class="terminology" name="'+h+'" href="#ref-'+h+'"><strong>'+u+"</strong></a>"):f}),t[i].push(a)}),t=t.filter(a=>a.length>0),r.chapList=l,t=applyFootNotes(t,r),!!r.endnotes&&r.endnotes.length>0&&t.push(applyEndNotes(r)),r.metas.glossary&&!!r.termList&&r.termList.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',a+=generateGlossary(r),a+="</section>",t.push(a)}if(r.image=r.image||[],r.video=r.video||[],r.audio=r.audio||[],r.metas.resources&&r.image.length+r.video.length+r.audio.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',r.image.length>0&&(a+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',a+=generateResourceList(r,"image")),r.video.length>0&&(a+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',a+=generateResourceList(r,"video")),r.audio.length>0&&(a+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',a+=generateResourceList(r,"audio")),a+="</section>",t.push(a)}if(r.metas.showtitle){let a='<header class="article-title">';if(a+="<p>"+r.metas.title+"</p>",r.metas.showauthor){if(r.metas.author&&(a+='<p class="author">',r.metas.email&&(a+='<a href="mailto:'+r.metas.email+'">'),a+=r.metas.author,r.metas.email&&(a+="</a>"),a+="</p>"),r.metas.publish){a+='<p class="author date publish">';let s=r.metas.publish*1;if(isNaN(s))s=r.metas.publish;else{s=new Date(s);let f=s.getYear()+1900,h=s.getMonth()+1;h<10&&(h="0"+h);let u=s.getDate();u<10&&(u="0"+u);let p=s.getHours();p<10&&(p="0"+p);let c=s.getMinutes();c<10&&(c="0"+c);let o=s.getSeconds();o<10&&(o="0"+o),s=f+"/"+h+"/"+u+" "+p+":"+c+":"+o}a+=s,a+="</p>"}if(r.metas.update){a+='<p class="author date update">';let s=r.metas.update*1;if(isNaN(s))s=r.metas.update;else{s=new Date(s);let f=s.getYear()+1900,h=s.getMonth()+1;h<10&&(h="0"+h);let u=s.getDate();u<10&&(u="0"+u);let p=s.getHours();p<10&&(p="0"+p);let c=s.getMinutes();c<10&&(c="0"+c);let o=s.getSeconds();o<10&&(o="0"+o),s=f+"/"+h+"/"+u+" "+p+":"+c+":"+o}a+=s,a+="</p>"}}a+="</header>",t.unshift(a)}return t},applyBlockReference=(e,r)=>{for(var t=!0,i=0;t&&(t=!1,e=e.map(n=>(n=n.replace(/\[([\w \-\.]+?)\]/g,(l,a,s)=>{var f=n.lastIndexOf("<sup>",s),h=n.lastIndexOf("</sup>",s);if(f>h)return l;var u=r.blocks[a];return u?(t=!0,u):l}),n)),i++,i!==10););return e},applyMarkUpReference=(e,r)=>{var t=(r.metas.LANG||"zh").toLowerCase();if(e=e.map(i=>(i=i.replace(/%glossary%/gi,n=>generateGlossary(r)),i=i.replace(/%resources%/gi,n=>generateResourceList(r,"image")+generateResourceList(r,"video")+generateResourceList(r,"audio")),i=i.replace(/%images%/gi,n=>generateResourceList(r,"image")),i=i.replace(/%videos%/gi,n=>generateResourceList(r,"video")),i=i.replace(/%audios%/gi,n=>generateResourceList(r,"audio")),i=i.replace(/%toc%(\{[\w\W]+?\})*/gi,n=>{var l=n.match(/\{[\w\W]+?\}/g),a="\u76EE\u5F55",s=3;return l&&l.forEach(f=>{f=f.substr(1,f.length-2);var h=f*1;isNaN(h)?a=f:s=h}),r.toced=!0,generateTableOfContent(r,a,s)}),Object.keys(r.metas).forEach(n=>{var l=n.toLowerCase();PreservedKeywords.includes(n)||(l=r.metas[n],l===!0||l===!1?t==="zh"?l=l?"\u662F":"\u5426":l=l?"On":"Off":Array.isArray(l)&&(t==="zh"?l=l.join("\u3001"):l=l.join(", ")),i=i.replace(new RegExp("%"+n+"%({.*?})?","gi"),(a,s)=>{s=s||"YYYY/MM/DD";var f=l;return TimeStampKeywords.includes(n.toLowerCase())&&(f=generateTimeStamp(l,s.replace(/^\{|\}$/g,""))),f}))}),i=i.replace(/%([\w \-\.]+)%/g,(n,l)=>{var a=r.finals[l];return a||n}),i)),r.metas.toc&&!r.toced){let i=generateTableOfContent(r,"\u76EE\u5F55",3);i.indexOf('<p class="content-')>=0&&(i="<section>"+i+"</section>",r.metas.showtitle?e.splice(1,0,i):e.unshift(i))}return e},applyFootNotes=(e,r)=>(e=e.map(t=>{var i=[],n="<section>",l="</section>";return t.forEach((a,s)=>{var f=!1;a=a.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(h,u)=>{f=!0,i.push(u);var p=h.substr(0,h.length-1)+' href="#footnote-'+u+'">';return p}),f&&(t[s]=a)}),t=t.join(""),i.length===0||(i=i.map((a,s)=>{var f=r.refs[a],h=r.footnotes.indexOf(a);return s++,t=t.replace(new RegExp("%%FN-"+h+"%%","g"),s),'<p class="footnote-content"><a class="index" name="footnote-'+a+'">'+s+"\uFF1A</a>"+f+"</p>"}),t+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',t+=i.join(""),t+='</footer><hr class="footnote-line end">'),n+t+l}),e),applyEndNotes=e=>{let r='<hr class="endnote-line">';return r+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',e.endnotes.forEach((t,i)=>{r+='<p class="endnote-content"><a class="index" name="endnote-'+t+'">'+(i+1)+"\uFF1A</a>"+e.refs[t]+"</p>"}),r+="</section>",r},generateTableOfContent=(e,r,t)=>{var i='<h1 name="ContentTable">'+r+'</h1><aside class="content-table">';return e.chapList.forEach(n=>{if(!(n[0]>t)){var l='<p class="content-item level-'+n[0]+'">';for(let a=0;a<n[0];a++)l+='<span class="content-indent"></span>';l+='<a class="content-link" href="#'+n[1]+'">'+n[2]+"</a>",l+="</p>",i+=l}}),!!e.endnotes&&e.endnotes.length>0&&(i+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),e.metas.glossary&&!!e.termList&&e.termList.length>0&&(i+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),e.metas.resources&&e.image.length+e.video.length+e.audio.length>0&&(i+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',e.image.length>0&&(i+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),e.video.length>0&&(i+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),e.audio.length>0&&(i+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),i+="</aside>",i},generateGlossary=e=>{var r="";return e.termList===0?"":(e.termList.forEach(t=>{var[i,n]=t,l=e.terms[i],a='<p class="glossary-item">';a+='<a class="glossary-indent" name="ref-'+i+'">'+n+"</a>",a+=l,a+="</p>",r+=a}),r)},generateResourceList=(e,r)=>{var t=e[r];if(!t||!Array.isArray(t)||t.length===0)return"";var i=[],n="<ul>";return t.forEach(l=>{var a=l[1];a=a.replace(/\%([\w \-]+?)\%/g,(s,f)=>{var h=ReversePreserveWords[f.toLowerCase()];return h||s}),!i.includes(a)&&(i.push(a),n+='<li><a href="'+a+'" target="_blank">'+a+"</a></li>")}),n+="</ul>",n},generateTimeStamp=(e,r)=>{var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1,l=t.getDate(),a=t.getHours(),s=t.getMinutes(),f=t.getSeconds(),h=t.getMilliseconds(),u;return u=r.match(/Y+/),u&&(r=convertTimeStamp(r,u[0],i,u[0].length>2?4:2)),u=r.match(/M+/),u&&(r=convertTimeStamp(r,u[0],n)),u=r.match(/D+/),u&&(r=convertTimeStamp(r,u[0],l)),u=r.match(/h+/),u&&(r=convertTimeStamp(r,u[0],a)),u=r.match(/m+/),u&&(r=convertTimeStamp(r,u[0],s)),u=r.match(/s+/),u&&(r=convertTimeStamp(r,u[0],f)),u=r.match(/ms/),u&&(r=convertTimeStamp(r,u[0],h,3)),r},convertTimeStamp=(e,r,t,i=2)=>{var n=r.length;for(valur=""+t;t.length<n;)t="0"+t;return t.length>i&&(t=t.substring(t.length-i)),e.replace(r,t)},convertPreserves=e=>(e=e.replace(/(\\+)(.)/g,(r,t,i)=>{var n=Math.floor(t.length/2),l=n*2!==t.length,a="",s="%"+PreserveWords["\\"]+"%";for(let f=0;f<n;f++)a+=s;if(l){let f=PreserveWords[i];f?a=a+"%"+f+"%":a=a+i}else a=a+i;return a}),e),restorePreserves=(e,r,t=!0)=>{for(var i=!0;i;)i=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,l)=>{var a=r[l];return a?(i=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,l)=>{var a=r[l];return a?(i=!0,a):n});if(!t)return e;for(i=!0;i;)i=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,l)=>{var a=r[SymHidden][l.toLowerCase()];return a?(i=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,l)=>{var a=r[SymHidden][l.toLowerCase()];return a?(i=!0,a):n});return e=e.replace(/\n+/g,"<br>"),e=e.replace(/\/{2}/g,(n,l)=>{if(l===0)return"<br>";var a=e.substr(l-1,1);return a===":"?n:"<br>"}),e=e.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),e},getKeywords=e=>{if(!e)return[];e=e.split(/[ ,，；;、　]+/).filter(t=>t.length>0);var r=[];return e.forEach(t=>{r.includes(t)||r.push(t)}),r},getMetas=(e,r)=>{var t={},i=!0;for(let l in MetaAlias){let a=MetaAlias[l];var n=new RegExp("(^|\\n)"+l+"[:\uFF1A][ \u3000\\t]*([^\\n]*?)(\\n|$)","gi");r=r.replace(n,(s,f,h,u)=>(t[a]=h,f+u))}if(MetaWords.forEach(l=>{var a=new RegExp("(^|\\n)"+l+"[:\uFF1A][ \u3000\\t]*([^\\n]*?)(\\n|$)","gi");r=r.replace(a,(s,f,h,u)=>(t[l]=h,f+u))}),!!t.showtitle&&["on","yes","true"].includes(t.showtitle.toLowerCase())?t.showtitle=!0:t.showtitle=void 0,!!t.glossary&&["on","yes","true"].includes(t.glossary.toLowerCase())?t.glossary=!0:t.glossary=void 0,!!t.links&&["on","yes","true"].includes(t.links.toLowerCase())?t.links=!0:t.links=void 0,!!t.refs&&["on","yes","true"].includes(t.refs.toLowerCase())?t.refs=!0:t.refs=void 0,!!t.terms&&["on","yes","true"].includes(t.terms.toLowerCase())?t.terms=!0:t.terms=void 0,!!t.resources&&["on","yes","true"].includes(t.resources.toLowerCase())?t.resources=!0:t.resources=void 0,!!t.toc&&["on","yes","true"].includes(t.toc.toLowerCase())?t.toc=!0:t.toc=void 0,e.metas=t,e.metas.keyword=getKeywords(e.metas.keyword),e.metas.update)try{e.metas.update=new Date(e.metas.update).getTime()}catch(l){delete e.metas.update}if(e.metas.publish)try{e.metas.publish=new Date(e.metas.publish).getTime()}catch(l){delete e.metas.publish}for(!!e.metas.update&&!e.metas.publish&&(e.metas.publish=e.metas.update,delete e.metas.update),e.metas.god=e.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',e.metas.script?e.metas.script=e.metas.script.split(/[,; 　\t]+/):e.metas.script=[],e.metas.style?e.metas.style=e.metas.style.split(/[,; 　\t]+/).map(l=>l.replace(/\{[\w\W]*\}/,"")):e.metas.style=[],e.termList=e.termList||[],e.mainParser=!1,e.refs={},i=!0;i;)i=!1,r=r.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(l,a,s,f,h)=>(a=a.trim(),s=s.trim(),a.length===0||s.length===0?l:(e.refs[a]=s,i=!0,`
`+f)));for(e.blocks={},i=!0;i;)i=!1,r=r.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(l,a,s)=>{if(a=a.trim(),!(a.length===0||s.length===0))return e.blocks[a]=s,i=!0,""});return e.anchors=[],e.terms={},e.notes={},r.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(l,a,s,f)=>{var h=s||f;e.refs[h]?a.substr(0,1)==="{"?e.terms[h]=h:e.notes[h]=h:a.substr(0,1)==="{"&&!e.anchors.includes(h)&&e.anchors.push(h)}),r=regularize(r),r};MarkUp.fullParse=(e,r)=>{var t={finals:{},toced:!1};r=r||{};var i=e.replace(/\n标题[:：][ 　\t]*/gi,`
`).replace(/\n作者[:：][ 　\t]*/gi,`
`).replace(/\n简介[:：][ 　\t]*/gi,`
`).replace(/\n关键词[:：][ 　\t]*/gi,`
`).replace(/\n发布[:：][ 　\t]*/gi,`
`).replace(/\n更新[:：][ 　\t]*/gi,`
`);for(MetaWords.forEach(s=>{var f=new RegExp("(^|\\n)"+s+"[:\uFF1A][ \u3000\\t]*[^\\n]*?(\\n|$)","gi");i=i.replace(f,"")}),PreservedKeywords.forEach(s=>{var f=new RegExp("\\["+s+"\\]","gi");i=i.replace(f,"")});;){let s=i.replace(/\[(.*?)\][ 　\t]*\[.*?\]/g,(f,h)=>h).replace(/\[(.*?)\][ 　\t]*\{.*?\}/g,(f,h)=>h).replace(/\[(.*?)\][ 　\t]*\(.*?\)/g,(f,h)=>h).replace(/<\w.*?\w>|<\w>/g,"").replace(/\n[ 　\t]*(\-+|\++|#+|>|=+|\*+|~+|`+|\$+|\d+\.)[ 　\t]*/g,`
`);if(i===s)break;i=s}i=i.match(/[\u4e00-\u9fa5]|[a-zA-Z0-9]+/gi)||"",i=i.length||0,e=prepare(e),e=getMetas(t,e),t.parseLevel=0,t.mainParser=!0,t.metas.title=t.metas.title||"\u65E0\u540D\u6587";var n=Object.keys(t.metas);Object.keys(r).forEach(s=>{n.includes(s)||n.push(s)}),r.overwrite?n.forEach(s=>{t.metas[s]=r[s]===null||r[s]===void 0?t.metas[s]:r[s]}):n.forEach(s=>{t.metas[s]=t.metas[s]===null||t.metas[s]===void 0?r[s]:t.metas[s]}),n.forEach(s=>{(t.metas[s]===null||t.metas[s]===void 0)&&(t.metas[s]=!1)}),e=parseSection(e,t),Object.keys(t.refs).forEach(s=>{var f=t.refs[s];f=parseLine(f,t),f=f.replace(/\%([\w \-]+?)\%/g,(h,u)=>{var p=ReversePreserveWords[u.toLowerCase()];return p||h}),t.refs[s]=f}),Object.keys(t.blocks).forEach(s=>{var f=t.blocks[s],h=f.match(/^\n+/);f=f.trim();var u;t.parseLevel=0,h?u=parseSection(f,t,1):u=[parseLine(f,t)],t.blocks[s]=u.join("")});for(let s in t.terms)t.terms[s]=t.refs[s];for(let s in t.notes)t.notes[s]=t.refs[s];e=e.map(s=>(s=s.replace(/\%([\w \-]+?)\%/g,(f,h)=>{var u=ReversePreserveWords[h.toLowerCase()];return u||f}),s=s.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(f,h)=>{var u=ReversePreserveWords[h.toLowerCase()];return u||f}),s)),e=applyBlockReference(e,t),e=analyzeSections(e,t),e=applyMarkUpReference(e,t),t.metas.classname?e='<article class="'+t.metas.classname+'">'+e.join("")+"</article>":e="<article>"+e.join("")+"</article>",t.metas.fullexport&&(t.metas.style.forEach(s=>{e+='<link type="text/css" rel="stylesheet" href="'+s+'">'}),t.metas.script.forEach(s=>{e+='<script type="text/javascript" src="'+s+'"></script>'}));var l=FinalRender._indexes_||[];l.forEach(s=>{var f=FinalRender[s];!f||f.forEach(h=>{e=h.parse(e,t)})}),e=e.replace(/<p>(<br\/?>)+<\/p>/gi,"");var a={};return a.content=e,a.title=t.metas.title,a.lineCount=t.metas.totalLineCount,a.chapList=t.chapList,a.tables=t.tables,a.meta={},a.meta.author=t.metas.author,a.meta.email=t.metas.email,a.meta.description=t.metas.description,a.meta.publish=t.metas.publish,a.meta.update=t.metas.update,a.meta.keywords=t.metas.keyword.map(s=>s),t.metas.others&&(a.meta.others=t.metas.others),a.terminology={},t.termList.forEach(s=>{a.terminology[s[0]]=s[1]}),a.notes={},Object.keys(t.refs).forEach(s=>{a.notes[s]=t.refs[s]}),a.blocks={},Object.keys(t.refs).forEach(s=>{a.blocks[s]=t.blocks[s]}),a.wordCount=i,a},MarkUp.parse=(e,r)=>{var t;return t=MarkUp.fullParse(`
`+e+`
`,r),t?t.content:""};const reverseSection=(e,r)=>{r.__level++;var t=[],i="",n=!0;return e.childNodes.forEach(l=>{var a=l.tagName;if(!a){if(l.nodeName==="#comment")return;let f=l.textContent||"";f=f.trim(),f.length>0&&(i+=f);return}a=a.trim().toLowerCase();var s;if(ParagraphTags.includes(a)){if(n=!1,i.length>0&&(t.push(r.__prefix+i),i=""),a==="blockquote"){let f=r.__prefix;r.__prefix=r.__prefix+">	",s=reverseSection(l,r),s=s.flat(Infinity),s.push(`
`),r.__prefix=f}else if(a==="ol"){let f=r.__prefix;r.__prefix.indexOf("-	")>=0||r.__prefix.indexOf("1.	")>=0?r.__prefix="	"+r.__prefix:r.__prefix=r.__prefix+"1.	",s=reverseSection(l,r),s=s.flat(Infinity),s.push(""),r.__prefix=f}else if(a==="ul"){let f=r.__prefix;r.__prefix.indexOf("-	")>=0||r.__prefix.indexOf("1.	")>=0?r.__prefix="	"+r.__prefix:r.__prefix=r.__prefix+"-	",s=reverseSection(l,r),s=s.flat(Infinity),s.push(""),r.__prefix=f}else s=reverseSection(l,r),s=s.flat(Infinity),s.push("");!!s&&s.length>0&&t.push(...s)}else{let[f,h]=reverseMix(l,a,r);h?f.length>0&&(i+=f.join("")):(i.length>0&&(t.push(r.__prefix+i),i=""),f.forEach(u=>{t.push(r.__prefix+u)}))}}),i.length>0&&t.push(r.__prefix+i),r.__level--,t},reverseLine=(e,r)=>{var t="";return e.childNodes.forEach(i=>{var n=i.tagName;if(!n){if(i.nodeName==="#comment")return;let l=i.textContent||"";l=l.trim(),l.length>0&&(t+=l);return}if(n=n.trim().toLowerCase(),n==="a"){let l=i.href;l.indexOf("javascript:")===0&&(l="");let a=reverseLine(i,r);!l||l.substr(0,1)==="#"||(l.match(/^(ftp|https?):\/\//i)||(l=r.host+l),a="["+a+"]("+l+")"),t+=a;return}if(n==="span"||n==="font"){t+=reverseLine(i,r);return}if(n==="strong"||n==="b"){t+=reverseLine(i,r);return}if(n==="em"||n==="i"){t+=reverseLine(i,r);return}if(n==="sup"){t+=reverseLine(i,r);return}if(n==="sub"){t+=reverseLine(i,r);return}if(n==="del"){t+=reverseLine(i,r);return}t+=i.innerText}),t},reverseMix=(e,r,t)=>{if(r==="script")return[[""],!0];if(r==="style")return[[""],!0];if(r==="link")return[[""],!0];if(r==="hr")return[[`
---
`],!1];if(r==="br")return[[`
`],!0];if(r.match(/^h\d+$/)){let n=r.substring(1,r.length);n*=1;let l=`
`;for(let s=0;s<n;s++)l+="#";let a=reverseLine(e,t);return a=l+a+`
`,[[a],!1]}if(r==="a"){let n=e.href;n.indexOf("javascript:")===0&&(n="");let l=reverseLine(e,t);return!n||n.substr(0,1)==="#"?[[l],!0]:(n.match(/^(ftp|https?):\/\//i)||(n=t.host+n),l="["+l+"]("+n+")",[[l],!0])}if(r==="img")return e.src.length===0?[[""],!0]:[[`
![](`+e.src+`)
`],!1];if(r==="video")return e.src.length===0?[[""],!0]:[[`
@[](`+e.src+`)
`],!0];if(r==="audio")return e.src.length===0?[[""],!0]:[[`
#[](`+e.src+`)
`],!0];if(r==="span"||r==="font")return[[reverseLine(e,t)],!0];if(r==="strong"||r==="b"){let n=reverseLine(e,t);return[["**"+n+"**"],!0]}if(r==="em"||r==="i"){let n=reverseLine(e,t);return[["*"+n+"*"],!0]}if(r==="u"){let n=reverseLine(e,t);return[["__"+n+"__"],!0]}if(r==="sup"){let n=reverseLine(e,t);return[["^"+n+"^"],!0]}if(r==="sub"){let n=reverseLine(e,t);return[["_"+n+"_"],!0]}if(r==="del"){let n=reverseLine(e,t);return[["~~"+n+"~~"],!0]}var i=reverseLine(e,t);return[[i],!1]};MarkUp.plaintextReverse=e=>{for(e=e.replace(/\r/g,""),e=e.replace(/<!(.*?|\s*?)*?>/g,""),e=e.replace(/<xml(.*?|\s*?)*?>[\w\W]*?<\/xml>/gi,""),e=e.replace(/<style(.*?|\s*?)*?>[\w\W]*?<\/style>/gi,""),e=e.replace(/<(\/?\w+).*?>/g,(i,n)=>{if(n=n.toLowerCase(),n==="a"){let l=i.match(/href=('|")(.*?)\1/i);return!l||(l=l[2],!l)?"<a>":'<a src="'+l+'">'}else if(n==="img"){let l=i.match(/src=('|")(.*?)\1/i);return!l||(l=l[2],!l)?"<img>":'<img src="'+l+'">'}else return["div","article","section","aside","nav","footer","header","foot"].includes(n.replace("/",""))?n.indexOf("/")===0?"</p>":"<p>":"<"+n+">"}),e=e.replace(/<p([ \s](.*?))*?>/gi,"<p>"),e=e.replace(/<\/?(html|head|body|span|lable|nobr|link|meta|w:\w*?|w|xml|o|m|style)([ \s](.*?))*?>/gi,"");;){let i=e;if(i=i.replace(/<(.*?)( .*?)*>(<\1( .*?)*>)*/gi,(n,l)=>"<"+l+">"),i=i.replace(/<(.*?)( .*?)*>[ 　\s]*<\/\1>/gi,""),i=i.replace(/<(h\d|blockquote|li|pre)([ \s](.*?))*?>(<p([ \s](.*?))*?>)*/gi,(n,l)=>"<"+l+">"),i=i.replace(/(<\/p>)+(<\/(h\d|blockquote|li|pre)>)/gi,(n,l,a)=>a),i===e)break;e=i}e=e.replace(/<\/?(b|strong)>/gi,"**"),e=e.replace(/<\/?(i|em)>/gi,"*"),e=e.replace(/<\/?sup>/gi,"^"),e=e.replace(/<\/?sub>/gi,"_"),e=e.replace(/<\/?u>/gi,"__"),e=e.replace(/<\/?(del|strike)>/gi,"~~"),e=e.replace(/<\/?code>/gi,"`"),e=e.replace(/<a src=('|")(.*?)\1>(.*?)<\/a>/gi,(i,n,l,a)=>l?"["+a+"]("+l+")":a),e=e.replace(/<img src=('|")(.*?)\1>/gi,(i,n,l)=>l?`
![](`+l+`)
`:""),e=e.replace(/<h(\d)>/gi,(i,n)=>{var l=n.length,a="";for(let s=0;s<l;s++)a+="#";return a+"	"}),e=e.replace(/<p>/gi,"");var r=!1,t=1;return e=e.replace(/<(ul|li|ol)>/gi,(i,n)=>(n=n.toLowerCase(),n==="ol"?(r=!0,t=1,""):n==="ul"?(r=!1,t=1,""):r?(i=t+".	",t++,i):"-	")),r=!1,e=e.replace(/<(pre|\/pre|\/p)>/gi,(i,n)=>(n=n.toLowerCase(),n==="pre"?(r=!0,"``"):n==="/code"?(r=!1,"``"):r?`
`:`

`)),e=e.replace(/<\/(h\d)>/gi,`

`),e=e.replace(/<\/?br\/?>/gi,`
`),e=e.replace(/<\/(li|ul|ol)>/gi,`
`),e=e.replace(/<(blockquote)>/gi,">	"),e=e.replace(/<\/(blockquote)>/gi,`


`),e=e.replace(/<\/?hr\/?>/gi,`
----

`),e=e.replace(/<.*?>/gi,""),e=e.replace(/(^[\n\r]+|[\n\r]+$)/gi,""),e},MarkUp.reverse=(e,r,t=!0)=>{if(!e)return"";if(r==="plain"||r==="plaintext")return MarkUp.plaintextReverse(e);r=r||{},r.__level=0,r.__prefix="",r.host=r.host||"";var i=reverseSection(e,r);return i=i.flat(Infinity),i=i.join(`
`),i=i.replace(/\n{2,}/g,`

`),i},MarkUp.fullPlainify=(e,r)=>{PreservedKeywords.forEach(i=>{var n=new RegExp("\\["+i+"\\]","gi");e=e.replace(n,"")});var t=MarkUp.fullParse(e,r);for(t.content=t.content.replace(/<\/(article|section|div|p|header|footer|aside|ul|ol|li|blockquote|pre|figure|figcaption|h\d)>/gi,`
`).replace(/<br\/?>/gi,`
`).replace(/\$\$+/gi,`
`),t.content=t.content.replace(/\/?<(br|hr)\/?>/gi,`
`);;){let i=t.content.replace(/<\/?.+?\/?>/gi,"");if(i===t.content)break;t.content=i}return t.content=t.content.replace(/\n\n+/gi,`
`).replace(/\n+$/,""),t},MarkUp.plainify=(e,r)=>MarkUp.fullPlainify(e,r).content,MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch(e){try{global.MarkUp=MarkUp}catch(r){console.error(r)}}})();
