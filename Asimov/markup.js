(()=>{const SymHidden=Symbol("HIDDEN"),MetaWords=["GOD","THEONE","TITLE","AUTHOR","EMAIL","DESCRIPTION","STYLE","SCRIPT","DATE","KEYWORD","GLOSSARY","TOC","REF","LINK","IMAGES","VIDEOS","AUDIOS","ARCHOR","SHOWTITLE","SHOWAUTHOR","RESOURCES"],PreservedKeywords=["toc","glossary","resources","images","videos","audios"],ParagraphTags=["article","section","div","p","header","footer","aside","ul","ol","li","blockquote","pre","figure","figcaption"],CodeBlockKeyWords={system:/(.?)(if|else|for|while|do|continue|break|return|new|delete|try|catch|final|then|async|await|yield|null|undefined|nil|import|export|module|require|default)(.?)/g,function:/(.?)(const|var|let|function|class|Class|Number|String|Boolean|Integer|Float|Promise|Proxy|Array|ArrayBuffer|AysncFunction|Object|Function|Uint8Array|Uint16Array|Uint64Array|Int8Array|Int16Array|Int64Array|Buffer|BigInt)(.?)/g,operator:/(.?)(=>|>=|<=|\+=|\-=|\*=|\/=|\/|\+{1,2}|\-{1,2}|={1,3}|>{1,2}|<{1,2}|\-|\+|\*{1,2})(.?)/g,consts:/(.?)(\d+(\.\d*)?)(.?)/g,object:/(.?)(Math|console|window|process|document|Document|location|localStorage|sessionStorage|navigator|Navigator|Blob|BroadcastChannel|Cache|CacheStorage|CachedDB|History)(.?)/g},Char2Dig={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7",i:"8",j:"9",k:"a",l:"b",m:"c",n:"d",o:"e",p:"f",q:"g",r:"h",s:"i",t:"j",u:"k",v:"l",w:"m",x:"n",y:"o",z:"p"},MathTools={factorial(e,t=1){return t<1||e<=t?1:e*MathTools.factorial(e-t,t)},permutate(e,t){return e<=1?1:t<=1?e:t>e?1:(e-t+1)*MathTools.permutate(e,t-1)},combinate(e,t){return e<=1||t<=0||t>=e?1:(e-t+1)/t*MathTools.combinate(e,t-1)},round(e,t=0){var r=10**t;return e*=r,e=Math.round(e),e/r},floor(e,t=0){var r=10**t;return e*=r,e=Math.floor(e),e/r},ceil(e,t=0){var r=10**t;return e*=r,e=Math.ceil(e),e/r}},PreserveWords={"\\":"slash","/":"antislash",_:"underline","*":"star","+":"plus","-":"minus","=":"equal","`":"dash","~":"wavy","!":"bang","?":"question",":":"colon","@":"at-circle","#":"sharp","^":"angle",$:"dollar","%":"percent","(":"left-bracket",")":"right-bracket","[":"left-square-bracket","]":"right-square-bracket","{":"left-curve-bracket","}":"right-curve-bracket","|":"vertical-line"},ReversePreserveWords={};Object.keys(PreserveWords).forEach(e=>ReversePreserveWords[PreserveWords[e].toLowerCase()]=e),ReversePreserveWords.$="&#36;",MetaWords.forEach((e,t)=>MetaWords[t]=e.toLowerCase());const MarkUp={},LineRender={},BlockRender={},FinalRender={},generateRandomKey=(e=8)=>{var t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10)+"";return t};MarkUp.addExtension=(e,t=0,r=5)=>{if(t===0){let s=LineRender._indexes_;s||(s=[],LineRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,i)=>n-i)),s=LineRender[r],s||(s=[],LineRender[r]=s),s.push(e)}else if(t===1){let s=BlockRender._indexes_;s||(s=[],BlockRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,i)=>n-i)),s=BlockRender[r],s||(s=[],BlockRender[r]=s),s.push(e)}else if(t===2){let s=FinalRender._indexes_;s||(s=[],FinalRender._indexes_=s),s.includes(r)||(s.push(r),s.sort((n,i)=>n-i)),s=FinalRender[r],s||(s=[],FinalRender[r]=s),s.push(e)}};const prepare=e=>(e=`
`+e+`
`,e=e.replace(/(\r\n|\n\r)/g,`
`).replace(/\n([ 　]+)/g,(t,r)=>{var s=r.replace(/　/g,"  ").length;return s<4?`
`:t}),e=e.replace(/(\n[ 　\t>\-\+\*(\d+\.)]+)(`{3}|~{3}|\${2})/g,(t,r,s)=>r+`
`+s),MetaWords.forEach(t=>{var r=new RegExp("([\\w\\W]? *)\\["+t+"\\]( *[\\w\\W]?)","gi");e=e.replace(r,(s,n,i)=>n==="]"||i==="["||i==="("?s:n+"%"+t+"%"+i)}),e),regularize=e=>(e=e.replace(/^\n+|\n+$/gi,""),e=e.replace(/\n{3,}/gi,`


`),e),parseLine=(e,t,r=-Infinity,s)=>{var n=LineRender._indexes_;if(!n)return"";var i=!s;return s=s||{},n.some(a=>{if(r>a||a>=0)return!0;for(var l=LineRender[a],f=!0;f;)f=!1,l.forEach(p=>{var u;[e,u]=p.parse(e,t,s),u&&(f=!0)})}),e=convertPreserves(e),n.forEach(a=>{if(!(r>a)&&!(a<0))for(var l=LineRender[a],f=!0;f;)f=!1,l.forEach(p=>{var u;[e,u]=p.parse(e,t,s),u&&(f=!0)})}),i&&(e=restorePreserves(e,s)),e},parseSection=(e,t,r=0,s)=>{t.parseLevel++;var n=[],i=!1;s||(i=!0,s={});var a=[];n=e.split(`
`),n.forEach((p,u)=>{var h=p.match(/^[ 　\t]*$/);if(p.length===0){a.push([u,1,0,0,0,0,0,0]);return}if(p.match(/^([=\-\+\*\._#]{3,}|~{4,})$/)){p.match(/^\-+$|^=+$/)?a.push([u,0,2,0,0,0,0,0]):p.match(/^~+$/)?a.push([u,0,2,0,0,1,0,0]):a.push([u,0,1,0,0,0,0,0]);return}if(h=p.match(/^(`{3}|~{3})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,0,0,2,0,0,h[1]]):a.push([u,0,0,0,0,1,0,0,h[1]]);return}if(h=p.match(/^\${2}[ 　\t]*$/),h){h[2]?a.push([u,0,0,0,0,0,0,1]):a.push([u,0,0,0,0,0,0,1]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+/),h){if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,0,1,2,0,0]):a.push([u,0,0,0,1,1,0,0]);return}if(h=p.match(/^([\-\+\*~]|\d+\.)[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([u,0,0,0,1,0,0,1]):a.push([u,0,0,0,1,0,0,1]);return}a.push([u,0,0,0,1,0,0,0]);return}if(h=p.match(/^(> *)+/),h){if(h=p.match(/^(> *)+[ 　\t]+(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[2]?a.push([u,0,0,1,0,2,0,0]):a.push([u,0,0,1,0,1,0,0]);return}if(h=p.match(/^(> *)+[ 　\t]+(\${2})[ 　\t]*$/),h){h[2]?a.push([u,0,0,1,0,0,0,1]):a.push([u,0,0,1,0,0,0,1]);return}a.push([u,0,0,1,0,0,0,0]);return}if(h=p.match(/^([ 　\t]+)/),h){if(h=p.match(/(`{3,}|~{3,})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([u,0,0,1,1,2,0,0]):a.push([u,0,0,1,1,1,0,0]);return}if(h=p.match(/(\${2})[ 　\t]*([\w\-\.\+=\?\~\\\/]*)$/),h){h[1]?a.push([u,0,0,1,1,0,0,1]):a.push([u,0,0,1,1,0,0,1]);return}a.push([u,0,0,1,1,0,0,0]);return}if(h=p.match(/\|/g),h){let c=p.match(/\\\|/g);if(!c||!!c&&c.length!==h.length){let o=!0;for(c=p;o;){o=!1;let m=c.replace(/\([^\(\)\[\]\{\}]+?\)/g,"");m=m.replace(/\[[^\(\)\[\]\{\}]+?\]/g,""),m=m.replace(/\{[^\(\)\[\]\{\}]+?\}/g,""),o=m!==c,c=m}if(c.indexOf("|")>=0){a.push([u,0,0,0,0,0,1,0]);return}}}});var l={};a.forEach(p=>{l[p[0]]=p});var f=!1;if(a.length>0){if(f=parseLaTeX(a,l,n,t,s)||f,a.length>0&&(f=parseCodeBlock(a,l,n,t,s)||f),a.length>0&&(f=parseTable(a,l,n,t,s)||f),i&&r===0&&!!t.metas.linenumber){let p=0;n.forEach((u,h)=>{if(!!u&&!u.match(/^%[\w\-]+%$/)){var c=l[h];if(!(!!c&&(c[1]>0||c[2]>0))&&!u.match(/^[ 　\t>\+\-\*`\^\|_~=\{\}<]$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))$/)&&!u.match(/^[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\[[^\(\)\[\]\{\}]*?\])$/)){var o=u.match(/\{[<\|>]\}$/);o?(o=o[0],u=u.substr(0,u.length-o.length)+'<span name="line-'+p+'"></span>'+o):u=u+'<span name="line-'+p+'"></span>',p++,n[h]=u}}}),t.metas.totalLineCount=p}[n,l]=squeezeContents(a,l,n),a.length>0&&(f=parseListAndBlockQuote(a,l,n,t,s)||f,[n,l]=squeezeContents(a,l,n)),a.length>0&&(f=parseHeadline(a,l,n,t,s)||f,[n,l]=squeezeContents(a,l,n))}return f=parseResources(a,l,n,t,s)||f,[n,l]=squeezeContents(a,l,n),f=parseParagraph(a,l,n,t,s)||f,n=n.map(p=>{if(p===null||p===void 0||p.length===0)return"";var u="";if(i)p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/)?u=restorePreserves(p,s,!1):(u=parsePlainParaStyle(p,t),u=restorePreserves(u,s,!1));else{u=parsePlainParaStyle(p,t);let h="param-"+generateRandomKey();s[h]=u,u="%"+h+"%"}return u}),t.parseLevel--,t.parseLevel>0&&(n=n.join("")),n},squeezeContents=(e,t,r)=>(r=r.map((s,n)=>[n,s]),r=r.filter(s=>!(!s[1]&&s[1]!=="")),r.forEach((s,n)=>{var i=s[0],a=t[i];!a||(a[0]=n)}),t={},e.forEach(s=>{t[s[0]]=s}),r=r.map(s=>s[1]),[r,t]),parsePlainParaStyle=(e,t)=>{var r="<p",s="</p>",n=[],i=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,""),a=i.match(/^\{[<\|>]\}/);a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*\{[<\|>]\}[ 　\t]*/,(f,p)=>p||"")),i=e.replace(/[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,""),a=i.match(/\{[<\|>]\}$/),a&&(a=a[0],a==="{<}"?n.push("align-left"):a==="{|}"?n.push("align-center"):a==="{>}"&&n.push("align-right"),e=e.replace(/[ 　\t]*\{[<\|>]\}[ 　\t]*(<\/\w+.*?>)?[ 　\t]*$/,(f,p)=>p||"")),i=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*/,"");var l=i.match(/^:+/);return!!l&&!i.match(/^:([\w\-\.]+?):/)&&(l=l[0],n.push("indent","indent-"+l.length),e=e.replace(/^[ 　\t]*(<\w+.*?>)?[ 　\t]*:+/,(f,p)=>p||"")),n.length>0&&(r=r+' class="'+n.join(" ")+'"'),r=r+">",e.length===0?"":r+e+s},parseLaTeX=(e,t,r,s,n)=>{var i=[];if(e.forEach(u=>{!u[7]||i.push(u)}),i.length===0)return!1;if(i.length===1)return i[0][7]=0,!1;var a=i.length,l=i[0];l[7]=2;for(let u=1;u<a;u++){let h=i[u];l[7]===2?(h[3]=l[3],h[4]=l[4],h[7]=3):l[7]===3&&(h[7]=2),l=h}i[i.length-1][7]===2&&(i[i.length-1][7]=0),i.forEach(u=>{u[7]===1&&(u[7]=0)});var f=[];i=i.filter(u=>u[7]<2?!1:(u[7]===2&&f.push(u[0]),!0)),a=i.length;for(let u=a-1;u>0;u-=2){let h=i[u-1][0];f.includes(h)||i.splice(u-1,2)}var p=[];a=i.length;for(let u=0;u<a;u+=2)p.push([i[u][0],i[u+1][0]]);return p.forEach(u=>{var h=['<p class="latex block">$$'];for(let o=u[0]+1;o<u[1];o++)h.push(r[o]);h.push("$$</p>"),h=h.join("<br>");var c="latex-"+generateRandomKey();s.finals[c]=h,r[u[0]]="%"+c+"%";for(let o=u[0]+1;o<=u[1];o++)r[o]=null;for(let o=u[0];o<=u[1];o++){let m=t[o];if(!m)continue;let L=e.indexOf(m);L>=0&&e.splice(L,1),delete t[o],m[0]=-1}}),p.length>0},parseCodeBlock=(e,t,r,s,n)=>{var i=[];if(e.forEach(c=>{!c[5]||i.push(c)}),i.length===0)return!1;if(i.length===1)return i[0][5]=0,!1;var a=i.length,l=i[0],f=[],p;l[5]=2,p=l[8];for(let c=1;c<a;c++){let o=i[c];if(!!p&&o[8]!==p){o[5]=0;continue}if(o[5]===2){if(c===a-1&&(o[5]=0),l[5]!==3){l[5]=0;continue}p=o[8]}l[5]===2?(o[3]=l[3],o[4]=l[4],o[5]=3,p=null):l[5]===3&&(o[5]=2),l=o}i[i.length-1][5]===2&&(i[i.length-1][5]=0),i.forEach(c=>{c[5]===1&&(c[5]=0)});var u=[];i=i.filter(c=>c[5]<2?!1:(c[5]===2&&u.push(c[0]),!0)),a=i.length;for(let c=a-1;c>0;c-=2){let o=i[c-1][0];u.includes(o)||i.splice(c-1,2)}var h=[];a=i.length;for(let c=0;c<a;c+=2){let o=i[c],m=i[c+1];if(!o||!m)break;o=o[0],m=m[0],h.push([o,m])}return h.forEach(c=>{var o=r[c[0]],m=o.match(/(`{3,}|~{3,})[ 　\t]*/)[0],L=o.indexOf(m);m=o.substr(L+m.length,o.length),m=m.replace(/^[ 　\t]+|[ 　\t]+$/g,""),m=m.toLowerCase(),(!m||m===""||m==="text")&&(m="plaintext");var O='<pre lang="'+m+'"><code>',M="</code></pre>",W=!1,v=[],R=[];if(m==="plaintext")for(let d=c[0]+1;d<c[1];d++){let g=r[d];v.push("<p>"+g+"</p>")}else for(let d=c[0]+1;d<c[1];d++){let g=r[d],E=[],$=-1,P=null,A=[],T=!1;if(W){let y=g.match(/(\\*)`/);if(!y)E.push([0,g.length-1]);else{let w=y[1].length;w>>1<<1!==w?E.push([0,g.length-1]):(W=!1,T=!0,$=0,P="`",g.replace(/(\\*)(['"`])/g,(S,C,b,x)=>{var k=C.length;!!P&&b!==P||k>>1<<1===k&&(x+=k,$===-1?($=x,P=b,b==="`"&&(T=!0)):(E.push([$,x]),$=-1,P=null,b==="`"&&(T=!1)))}),T&&(E.push([$,g.length-1]),W=!0))}}else g.replace(/(\\*)(['"`])/g,(y,w,S,C)=>{var b=w.length;!!P&&S!==P||b>>1<<1===b&&(C+=b,$===-1?($=C,P=S,S==="`"&&(T=!0)):(E.push([$,C]),$=-1,P=null,S==="`"&&(T=!1)))}),T&&(E.push([$,g.length-1]),W=!0);for(let y=E.length-1;y>=0;y--){let w=E[y],S=g.substring(0,w[0]),C=g.substring(w[0],w[1]+1),b=g.substring(w[1]+1,g.length),x="[%:"+A.length+":%]";A.push(C),g=S+x+b}g=g.replace(CodeBlockKeyWords.operator,(y,w,S,C,b)=>{var x=E.some(j=>b>=j[0]&&b<=j[1]);if(x)return y;var k=(w||"")+'<span CLASS="operatorword">'+S+"</span>"+(C||"");return k}),g=g.replace(CodeBlockKeyWords.system,(y,w,S,C,b)=>{var x=E.some(j=>b>=j[0]&&b<=j[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_\.]/))return y;var k=(w||"")+'<span CLASS="flowword">'+S+"</span>"+(C||"");return k}),g=g.replace(CodeBlockKeyWords.function,(y,w,S,C,b)=>{var x=E.some(j=>b>=j[0]&&b<=j[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return y;var k=(w||"")+'<span CLASS="keyword">'+S+"</span>"+(C||"");return k}),g=g.replace(CodeBlockKeyWords.consts,(y,w,S,C,b,x)=>{var k=E.some(N=>x>=N[0]&&x<=N[1]);if(k||!!w&&w.match(/[\w\d_\.]/)||!!b&&b.match(/[\w\d_\.]/))return y;var j=(w||"")+'<span CLASS="constsword">'+S+"</span>"+(b||"");return j}),g=g.replace(CodeBlockKeyWords.object,(y,w,S,C,b)=>{var x=E.some(j=>b>=j[0]&&b<=j[1]);if(x||!!w&&w.match(/[\w\d_\.]/)||!!C&&C.match(/[\w\d_]/))return y;var k=(w||"")+'<span CLASS="objectword">'+S+"</span>"+(C||"");return k}),A.forEach((y,w)=>{var S='\\[%:(<span CLASS="constsword">)?'+w+"(</span>)?:%\\]";S=new RegExp(S),g=g.replace(S,'<span CLASS="constsword">'+y+"</span>")}),g=g.replace(/<span CLASS="/g,'<span class="'),v.push("<p>"+g+"</p>")}v=v.join(""),v=O+v+M;var _="codeblock-"+generateRandomKey();s.finals[_]=v,r[c[0]]="%"+_+"%";for(let d=c[0]+1;d<=c[1];d++)r[d]=null;for(let d=c[0];d<=c[1];d++){let g=t[d];if(!g)continue;let E=e.indexOf(g);E>=0&&e.splice(E,1),delete t[d],g[0]=-1}}),h.length>0},parseTable=(e,t,r,s,n)=>{var i=[];if(e.forEach(u=>{!u[6]||i.push(u)}),i.length!==0){var a=[],l=0,f=i[0][0];a.push([i[0]]);var p=i.length;for(let u=1;u<p;u++){let h=i[u];h[0]===f+1?a[l].push(h):(l++,a[l]=[h]),f=h[0]}return a=a.filter(u=>!(u.length<2)),a.forEach(u=>{generateTable(u,e,t,r,s,n)}),!0}},parseListAndBlockQuote=(e,t,r,s,n)=>{var i=0,a=r.length;if(e.forEach((o,m)=>{if(o[3]+o[4]!==0){var L=o[0];L<a&&(a=L),L>i&&(i=L)}}),a>i)return!1;for(let o=i+1;o<r.length-1;o++){let m=t[o],L=t[o+1];if(!!m&&m[1]>0&&!!L&&L[1]>0)break;i=o}if(i===r.length-2){let o=r.length-1,m=t[o];(!m||m[1]===0)&&(i=o)}var l=0,f=[[[a,t[a]]]],p=!1,u=!0;t[a][3]>0&&(p=!0);for(let o=a+1;o<=i;o++){var h=t[o];if(!h){u&&f[l].push([o,null]);continue}if(h[1]){if(!u)continue;let m=t[o+1];if(!m||m[1]>0){u=!1;continue}f[l].push([o,h]);continue}if(h[3]+h[4]===0){u&&f[l].push([o,h]);continue}if(u){f[l].push([o,h]);continue}l++,f[l]=[],t[o][3]>0?p=!0:p=!1,u=!0,f[l].push([o,h])}var c=!1;return f.forEach(o=>{o.forEach(M=>{var W=M[0];M[1]||(r[W]="    "+r[W])});var m=0,L=o[0][0],O=r[L],m=-1;O.match(/^[ 　\t>]/)?m=0:O.match(/^[\-\+]|[\*~][ 　\t]/)?m=1:O.match(/^\d+\.[ 　\t]/)&&(m=2),!(m<0)&&(change=!0,m===0?generateQuotes(o,e,t,r,s,n):m===1?generateList(!1,o,e,t,r,s,n):m===2&&generateList(!0,o,e,t,r,s,n))}),c},parseHeadline=(e,t,r,s,n)=>{var i=[],a=[];e.forEach(l=>{if(l[2]!==0){var f=l[0],p=t[f-1];if(p)p[1]>0&&i.push([f,r[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let u=r[f-1];if(f===0||!!u.match(/^%[\w\-]+%$/))i.push([f,r[f].replace(/^[ 　\t]+|[ 　\t]+$/,"")[0]]);else{let h=r[f].substr(0,1);h==="="?a.push([f-1,1]):h==="-"?a.push([f-1,2]):h==="~"?a.push([f-1,3]):h==="+"?a.push([f-1,3]):h==="_"?a.push([f-1,3]):h==="*"?a.push([f-1,4]):h==="#"?a.push([f-1,5]):h==="."&&a.push([f-1,6]),r[f]=null}}}});for(let l=0;l<r.length;l++){let f=r[l];if(!f)continue;let p=f.match(/^(#+)[ 　\t]*/);if(p){let u=p[0],h=p[1];u!==f&&f.indexOf(u+"[")!==0&&(a.push([l,h.length]),r[l]=f.replace(/^#+[ 　\t]*|[ 　\t]*#+$/g,""))}}return i.length+a.length===0?!1:(a.sort((l,f)=>l[0]-f[0]),i.forEach(l=>{var[f,p]=l,u="headline-"+generateRandomKey(),h="<hr";p==="="?h=h+' class="heavy">':p==="-"?h=h+' class="light">':p==="*"?h=h+' class="star">':p==="~"?h=h+' class="wavy">':p==="."?h=h+' class="dotted">':p==="_"?h=h+' class="dashed">':p==="+"?h=h+' class="strong">':p==="#"?h=h+' class="heavystrong">':h=h+">",n[u]=h,r[f]="%"+u+"%"}),a.forEach(l=>{var[f,p]=l,u="header-"+generateRandomKey(),h="h"+(p||1),c=r[f];c=parseLine(c,s),c=c.replace(/^[ 　\t\n]+|[ 　\t\n]+$/,""),c="<"+h+">"+c+"</"+h+">",n[u]=c,r[f]="%"+u+"%"}),!0)},parseResources=(e,t,r,s,n)=>{for(var i=[],a=!0;a;)a=!1,r.forEach(l=>{if(l.length===0)return i.push(l);l=l.replace(/(\])[ 　\t]*(\[([\w \-\.]+)\])/g,(h,c,o,m)=>{var L=s.refs[m],O;if(!L||L.indexOf("://")<0&&L.indexOf("@")<0&&!L.match(/^\.{0,2}[\\\/]/)||L.indexOf(`
`)>=0){if(O=s.metas[m.toLowerCase()],!O||O.indexOf("://")<0&&O.indexOf("@")<0&&!O.match(/^\.{0,2}[\\\/]/)||O.indexOf(`
`)>=0)return h;L=O}return c+"("+L+")"});for(var f=[],p=[],u=!0;u;)u=!1,l=l.replace(/[!@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\](\([^\(\)\[\]\{\}]*?\))/g,(h,c,o)=>(u=!0,o.match(/[ 　\t]+"(left|right)"\)$/)?p.push(h):f.push(h),""));l=l.replace(/^[ 　\t]+|[ 　\t]+$/g,""),p.forEach(h=>i.push(h)),l.length>0&&(f.length>0&&(a=!0),i.push(l)),f.forEach(h=>i.push(h))}),r.splice(0,r.length),i.forEach(l=>r.push(l)),i=[];return!0},parseParagraph=(e,t,r,s,n)=>{var i=[],a=[],l=[],f=-1;r.forEach((p,u)=>{if(!p||p.length===0){f=-1;return}var h=p.match(/^%([\w\W]+)%(\{[\w \-\.\u0800-\uffff]+\})*$/);if(h){f=-1;return}if(h=p.match(/^[@#]\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/),h){l.push([u,p]),f=-1;return}h=p.match(/^!\[[^\(\)\[\]\{\}]*?(\[.*?\][ 　\t]*\(.*?\))*?[^\(\)\[\]\{\}]*?\]\([^\(\)\[\]\{\}]*?\)$/);var c=h?1:0;c===f?c===0?i[i.length-1].push([u,p]):c===1&&a[a.length-1].push([u,p]):(c===0?i[i.length]=[[u,p]]:c===1&&(a[a.length]=[[u,p]]),f=c)}),a=a.filter(p=>{var u=p.length>1;return p.length===1&&l.push(p[0]),u}),i.forEach(p=>{var u=[],h=p[0][0];p.forEach(c=>{var o=c[0],m=c[1];m.length!==0&&(u.push(parseLine(m,s)),r[o]=null)}),u=u.join("<br>"),r[h]=u}),a.forEach(p=>{var u=[],h=p[0][0];p.forEach(o=>{u.push(parseLine(o[1],s)),r[o[0]]=null}),u=u.join(""),u='<div class="image-wall">'+u+"</div>";var c="imagewall-"+generateRandomKey();n[c]=u,r[h]="%"+c+"%"}),l.forEach(p=>{var[u,h]=p;h=parseLine(h,s);var c="resource-"+generateRandomKey();n[c]=h,r[u]="%"+c+"%"})},generateTable=(e,t,r,s,n,i)=>{var a=!0,l=null,f=null,p=-1,u=!1;l=s[e[0][0]].match(/\|>[ 　\t]*(.*)[ 　\t]*<\|/),l?(l=l[1].trim(),l.match(/\{h\}/i)&&(u=!0,l=l.replace(/\{h\}/gi,"").replace(/(^[ 　\t]+|[ 　\t]+$)/g,"")),s[e[0][0]]="",e.shift()):l=generateRandomKey(16),e.some((v,R)=>{var _=s[v[0]];_=_.replace(/^[ 　\t]+|[ 　\t]+$/g,"");var d=_.match(/[\|:\-]+/);if(!!d&&(d=d[0],_===d))return f=d,p=v[0],R===0&&(a=!1),!0}),f?(f=f.replace(/^\||\|$/g,""),f=f.split("|"),f=f.map(v=>v.match(/^:\-:$/)?1:v.match(/^:\-$/)?0:v.match(/^\-:$/)?2:3)):(a=!1,f=[]);var h=[],c=0;e.forEach((v,R)=>{var _=v[0];if(_!==p){var d=parseTableRow(s[_]);h.push(d),d.length>c&&(c=d.length)}});for(let v=f.length;v<c;v++)f.push("");for(let v=0;v<h.length-1;v++){let R=h[v],_=R?R.length:c;for(let d=R.length;d<c;d++)R.push("")}var o;a&&(o=h[0],h.shift());for(let v=0;v<c;v++){if(f[v]!==3)continue;let R=!0;h.some(_=>{var d=_[v];if(!!d&&d*1!==d)return R=!1,!0}),R?f[v]=2:f[v]=0}var m='<table name="'+l+'"',L=[];u&&(m+=' hidden="true"'),m+=">",a&&(m+="<thead><tr>",o.forEach((v,R)=>{var _=!1;v.match(/\{s\}$/i)&&(_=!0,v=v.replace(/[ 　\t]*\{s\}$/i,""));var d=!1;v.match(/\{h\}$/i)&&(L[R]=!0,d=!0,v=v.replace(/[ 　\t]*\{h\}$/i,"")),v=parseLine(v,n);var g='<th align="',E=f[R];E===1?g+="center":E===2?g+="right":g+="left",_&&(g+='" sortable="true'),g+='"',d&&(g+=' hidden="true"'),g+=">"+v+"</td>",m+=g}),m+="</tr></thead>"),m+="<tbody>";var O=[];h.forEach((v,R)=>{v.forEach((_,d)=>{var g=_.match(/^[ 　\t]*CAL(\d*)=[ 　\t]*(.*)[ 　\t]*$/);if(!!g){var E=g[1]*1;(isNaN(E)||E<1)&&(E=1);var $=g[2];O[d]=[E,$,R+1]}})}),O.length>0&&calculateTable(h,O);var M=[];h.forEach((v,R)=>{m+="<tr>";var _=[];v.forEach((d,g)=>{d=parseLine(d,n);var E=d.replace(/<.*?>/gi,"");_[g]=E.trim();var $='<td align="',P=f[g];P===1?$+="center":P===2?$+="right":$+="left",$+='"',L[g]&&($+=' hidden="true"'),$+=">"+d+"</td>",m+=$}),m+="</tr>",M[R]=_}),m+="</tbody></table>",n.tables=n.tables||{},n.tables[l]=M;var W="table-"+generateRandomKey();i[W]=m,o=e[0][0],total=e.length;for(let v=0;v<total;v++){let R=e[v],_=R[0];s[_]=null,delete r[_];let d=t.indexOf(R);d>=0&&t.splice(d,1),R[0]=-1}s[o]="%"+W+"%"},calculateTable=(e,t)=>{var r=[],s=[];t.forEach((i,a)=>{if(!!i){var[l,f,p]=i;r[l]=r[l]||[],r[l].push([a,parseEquation(f,p,s)])}});var n=[];e.forEach((i,a)=>{list=[],s.forEach(l=>{var f=i[l]*1;isNaN(f)&&(f=0),list[l]=f}),n.push(list)}),r.forEach(i=>{!i||i.length===0||e.forEach((a,l)=>{i.forEach(([f,p])=>{var u="";try{u=p(n,l),n[l]=n[l]||[],n[l][f]=u,u=u+""}catch(h){u=""}a[f]=u})})})},parseEquation=(equ,line,dataCol)=>(equ=equ.replace(/([\w\(\)\+\-\*\/ ]+)(!+)/g,(e,t,r)=>"MathTools.factorial("+t+","+r.length+")").replace(/([a-zA-Z]+)(\d+)/gi,(e,t,r)=>{if(!t||!r||(r=r*1,r*1!==r)||(t=t.replace(/\w/g,n=>Char2Dig[n.toLowerCase()]),t=parseInt(t,26),isNaN(t)))return"0";dataCol.includes(t)||dataCol.push(t);var s=r-line;return s===0?"((dataList[lineNum]||[])["+t+"]||0)":s>0?"((dataList[lineNum+"+s+"]||[])["+t+"]||0)":(s*=-1,"((dataList[lineNum-"+s+"]||[])["+t+"]||0)")}).replace(/(max|min|abs|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|asinh|acosh|atanh|exp|log)/gi,e=>"Math."+e.toLowerCase()).replace(/per(mutate)?/gi,e=>"MathTools.permutate").replace(/com(binate)?/gi,e=>"MathTools.combinate").replace(/round/gi,e=>"MathTools.round").replace(/ceil/gi,e=>"MathTools.ceil").replace(/floor/gi,e=>"MathTools.floor"),equ="(dataList,lineNum)=>"+equ,eval(equ)),parseTableRow=e=>{e.substr(0,1)!=="|"&&(e="|"+e),e.substr(e.length-1,1)!=="|"&&(e=e+"|");var t=e.length,r=0,s=[],n=0;for(let i=1;i<t;i++){let a=e.substr(i,1);if(a==="|"&&r===0){s.push(e.substr(n+1,i-n-1)),n=i;continue}"([{<".indexOf(a)>=0?r++:">}])".indexOf(a)>=0&&r--}return s},generateQuotes=(e,t,r,s,n,i)=>{var a="quote",l=s[e[0][0]];if(l=l.match(/^>[ 　\t]*\[([\w\W]+?)\]/),l){let h=l[1];h=h.replace(/^[ 　\t]+|[ 　\t]+$/g,""),h.length>0&&!n.metas[h]&&!n.blocks[h]&&(a=h)}var f=!0;l=e.map((h,c)=>{var o=h[0],m=s[o];c>0&&(f=f&&!!m.match(/^(\t|　　|    | 　 |  　|　  )/));var L=m.replace(/^(\t|　　|    | 　 |  　|　  )/,"");return L!==m&&f?m=L:(head=m.match(/^>[ 　\t]*/),head&&(head=head[0],m=m.replace(head,""))),m}),l[0]=l[0].replace(new RegExp("^[ \u3000\\t]*\\["+a.replace(/\\/g,"\\\\")+"\\][ \u3000\\t]*"),""),l=l.join(`
`),l=l.replace(/^\n+|\n+$/g,"");var p='<blockquote class="'+a+'">';l=parseSection(l,n,2,i),p+=l,p+="</blockquote>";var u="blockquote-"+generateRandomKey();i[u]=p,e.forEach(h=>{var c=h[0];s[c]=null,delete r[c];var o=t.indexOf(h[1]);o>=0&&t.splice(o,1)}),s[e[0][0]]="%"+u+"%"},generateList=(e,t,r,s,n,i,a)=>{var l=[],f=-1;t.forEach(h=>{var c=h[0],o=n[c];if(head=o.match(/^([\-\+\*>~]|\d+\.)[ 　\t]+/),head){o=o.replace(head[0],""),f++,l[f]=[o];return}o=o.replace(/^(\t|　　|    | 　 |  　|　  )/,""),l[f].push(o)}),l=l.map(h=>(h=h.join(`
`),h=h.replace(/^\n+|\n+$/g,""),h));var p="";e?p="<ol>":p="<ul>",l.forEach(h=>{p+="<li>",p+=parseSection(h,i,2,a),p+="</li>"}),e?p+="</ol>":p+="</ul>";var u="list-"+generateRandomKey();a[u]=p,t.forEach(h=>{var c=h[0];n[c]=null,delete s[c];var o=r.indexOf(h[1]);o>=0&&r.splice(o,1)}),n[t[0][0]]="%"+u+"%"},analyzeSections=(e,t)=>{var r=[[]],s=0,n=[0],i=[];if(e.forEach(a=>{var l=!1;a=a.replace(/^<h(\d+)>/i,(f,p)=>{l=!0,p=p*1,p===1&&(s++,r[s]=[]),n[p-1]=(n[p-1]||0)+1;for(let h=p;h<n.length;h++)n[h]=0;var u="chap";for(let h=0;h<p;h++)u+="-"+(n[h]||1);return f=f+'<a name="'+u+'">',i.push([p,u,a.replace(/<[\w\W]+?>/gi,"")]),f}).replace(/<\/h(\d+)>$/i,f=>"</a>"+f).replace(/\{([\w \-\.]+)\}/g,(f,p)=>{var u=t.termList[p];return u?(Array.isArray(u)&&(u=u[0]),'<a class="terminology" name="'+p+'" href="#ref-'+p+'"><strong>'+u+"</strong></a>"):f}),r[s].push(a)}),r=r.filter(a=>a.length>0),t.chapList=i,r=applyFootNotes(r,t),!!t.endnotes&&t.endnotes.length>0&&r.push(applyEndNotes(t)),t.metas.glossary&&!!t.termList&&t.termList.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="Glossary">\u672F\u8BED\u8868</a></h1>',a+=generateGlossary(t),a+="</section>",r.push(a)}if(t.image=t.image||[],t.video=t.video||[],t.audio=t.audio||[],t.metas.resources&&t.image.length+t.video.length+t.audio.length>0){let a='<hr class="endnote-line">';a+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="ResourceList">\u8D44\u6E90\u8868</a></h1>',t.image.length>0&&(a+='<h2><a name="ImageResourceList">\u56FE\u7247</a></h2>',a+=generateResourceList(t,"image")),t.video.length>0&&(a+='<h2><a name="VideoResourceList">\u89C6\u9891</a></h2>',a+=generateResourceList(t,"video")),t.audio.length>0&&(a+='<h2><a name="AudioResourceList">\u97F3\u9891</a></h2>',a+=generateResourceList(t,"audio")),a+="</section>",r.push(a)}if(t.metas.showtitle){let a='<header class="article-title">';if(a+="<p>"+t.metas.title+"</p>",t.metas.showauthor&&(t.metas.author&&(a+='<p class="author">',t.metas.email&&(a+='<a href="mailto:'+t.metas.email+'">'),a+=t.metas.author,t.metas.email&&(a+="</a>"),a+="</p>"),t.metas.date)){a+='<p class="author date">';let l=t.metas.date*1;if(isNaN(l))l=t.metas.date;else{l=new Date(l);let f=l.getYear()+1900,p=l.getMonth()+1;p<10&&(p="0"+p);let u=l.getDate();u<10&&(u="0"+u);let h=l.getHours();h<10&&(h="0"+h);let c=l.getMinutes();c<10&&(c="0"+c);let o=l.getSeconds();o<10&&(o="0"+o),l=f+"/"+p+"/"+u+" "+h+":"+c+":"+o}a+=l,a+="</p>"}a+="</header>",r.unshift(a)}return r},applyBlockReference=(e,t)=>{for(var r=!0,s=0;r&&(r=!1,e=e.map(n=>(n=n.replace(/\[([\w \-\.]+?)\]/g,(i,a,l)=>{var f=n.lastIndexOf("<sup>",l),p=n.lastIndexOf("</sup>",l);if(f>p)return i;var u=t.blocks[a];return u?(r=!0,u):i}),n)),s++,s!==10););return e},applyMarkUpReference=(e,t)=>{var r=(t.metas.LANG||"zh").toLowerCase();if(e=e.map(s=>(s=s.replace(/%glossary%/gi,n=>generateGlossary(t)),s=s.replace(/%resources%/gi,n=>generateResourceList(t,"image")+generateResourceList(t,"video")+generateResourceList(t,"audio")),s=s.replace(/%images%/gi,n=>generateResourceList(t,"image")),s=s.replace(/%videos%/gi,n=>generateResourceList(t,"video")),s=s.replace(/%audios%/gi,n=>generateResourceList(t,"audio")),s=s.replace(/%toc%(\{[\w\W]+?\})*/gi,n=>{var i=n.match(/\{[\w\W]+?\}/g),a="\u76EE\u5F55",l=3;return i&&i.forEach(f=>{f=f.substr(1,f.length-2);var p=f*1;isNaN(p)?a=f:l=p}),t.toced=!0,generateTableOfContent(t,a,l)}),Object.keys(t.metas).forEach(n=>{var i=n.toLowerCase();PreservedKeywords.includes(n)||(i=t.metas[n],i===!0||i===!1?r==="zh"?i=i?"\u662F":"\u5426":i=i?"On":"Off":Array.isArray(i)&&(r==="zh"?i=i.join("\u3001"):i=i.join(", ")),s=s.replace(new RegExp("%"+n+"%","gi"),a=>i))}),s=s.replace(/%([\w \-\.]+)%/g,(n,i)=>{var a=t.finals[i];return a||n}),s)),t.metas.toc&&!t.toced){let s=generateTableOfContent(t,"\u76EE\u5F55",3);s.indexOf('<p class="content-')>=0&&(s="<section>"+s+"</section>",t.metas.showtitle?e.splice(1,0,s):e.unshift(s))}return e},applyFootNotes=(e,t)=>(e=e.map(r=>{var s=[],n="<section>",i="</section>";return r.forEach((a,l)=>{var f=!1;a=a.replace(/<a class="notemark" type="footnote" name="([\w \-\.]+?)">/g,(p,u)=>{f=!0,s.push(u);var h=p.substr(0,p.length-1)+' href="#footnote-'+u+'">';return h}),f&&(r[l]=a)}),r=r.join(""),s.length===0||(s=s.map((a,l)=>{var f=t.refs[a],p=t.footnotes.indexOf(a);return l++,r=r.replace(new RegExp("%%FN-"+p+"%%","g"),l),'<p class="footnote-content"><a class="index" name="footnote-'+a+'">'+l+"\uFF1A</a>"+f+"</p>"}),r+='<hr class="footnote-line"><footer><p class="footnote-title">\u811A\u6CE8\uFF1A</p>',r+=s.join(""),r+='</footer><hr class="footnote-line end">'),n+r+i}),e),applyEndNotes=e=>{let t='<hr class="endnote-line">';return t+='<section class="endnote-chapter"><h1 class="endnote-title"><a name="EndNote">\u5C3E\u6CE8</a></h1>',e.endnotes.forEach((r,s)=>{t+='<p class="endnote-content"><a class="index" name="endnote-'+r+'">'+(s+1)+"\uFF1A</a>"+e.refs[r]+"</p>"}),t+="</section>",t},generateTableOfContent=(e,t,r)=>{var s='<h1 name="ContentTable">'+t+'</h1><aside class="content-table">';return e.chapList.forEach(n=>{if(!(n[0]>r)){var i='<p class="content-item level-'+n[0]+'">';for(let a=0;a<n[0];a++)i+='<span class="content-indent"></span>';i+='<a class="content-link" href="#'+n[1]+'">'+n[2]+"</a>",i+="</p>",s+=i}}),!!e.endnotes&&e.endnotes.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#EndNote">\u5C3E\u6CE8</a></p>'),e.metas.glossary&&!!e.termList&&e.termList.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#Glossary">\u672F\u8BED\u8868</a></p>'),e.metas.resources&&e.image.length+e.video.length+e.audio.length>0&&(s+='<p class="content-item level-1"><span class="content-indent"></span><a class="content-link" href="#ResourceList">\u8D44\u6E90\u8868</a></p>',e.image.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#ImageResourceList">\u56FE\u7247</a></p>'),e.video.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#VideoResourceList">\u89C6\u9891</a></p>'),e.audio.length>0&&(s+='<p class="content-item level-2"><span class="content-indent"></span><span class="content-indent"></span><a class="content-link" href="#AudioResourceList">\u97F3\u9891</a></p>')),s+="</aside>",s},generateGlossary=e=>{var t="";return e.termList===0?"":(e.termList.forEach(r=>{var[s,n]=r,i=e.terms[s],a='<p class="glossary-item">';a+='<a class="glossary-indent" name="ref-'+s+'">'+n+"</a>",a+=i,a+="</p>",t+=a}),t)},generateResourceList=(e,t)=>{var r=e[t];if(!r||!Array.isArray(r)||r.length===0)return"";var s=[],n="<ul>";return r.forEach(i=>{var a=i[1];a=a.replace(/\%([\w \-]+?)\%/g,(l,f)=>{var p=ReversePreserveWords[f.toLowerCase()];return p||l}),!s.includes(a)&&(s.push(a),n+='<li><a href="'+a+'" target="_blank">'+a+"</a></li>")}),n+="</ul>",n},convertPreserves=e=>(e=e.replace(/(\\+)(.)/g,(t,r,s)=>{var n=Math.floor(r.length/2),i=n*2!==r.length,a="",l="%"+PreserveWords["\\"]+"%";for(let f=0;f<n;f++)a+=l;if(i){let f=PreserveWords[s];f?a=a+"%"+f+"%":a=a+s}else a=a+s;return a}),e),restorePreserves=(e,t,r=!0)=>{for(var s=!0;s;)s=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,i)=>{var a=t[i];return a?(s=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,i)=>{var a=t[i];return a?(s=!0,a):n});if(!r)return e;for(s=!0;s;)s=!1,e=e.replace(/\%([\w \-]+?)\%/g,(n,i)=>{var a=t[SymHidden][i.toLowerCase()];return a?(s=!0,a):n}),e=e.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(n,i)=>{var a=t[SymHidden][i.toLowerCase()];return a?(s=!0,a):n});return e=e.replace(/\n+/g,"<br>"),e=e.replace(/\/{2}/g,(n,i)=>{if(i===0)return"<br>";var a=e.substr(i-1,1);return a===":"?n:"<br>"}),e=e.replace(/^(<\/?br>)+|(<\/?br>)+$/gi,"<br>"),e},getKeywords=e=>{if(!e)return[];e=e.split(/[ ,，；;、　]+/).filter(r=>r.length>0);var t=[];return e.forEach(r=>{t.includes(r)||t.push(r)}),t},getMetas=(e,t)=>{for(var r={},s=!0;s;)s=!1,t=t.replace(/\n([A-Z\u0800-\uffff]+?) *[:：] *([\w\W]*?)\n/,(n,i,a)=>a.length===0||(i==="\u6807\u9898"?i="title":i==="\u4F5C\u8005"?i="author":i==="\u7B80\u4ECB"?i="description":i==="\u5173\u952E\u8BCD"?i="keyword":i==="\u66F4\u65B0"?i="date":i=i.toLowerCase(),!MetaWords.includes(i))?n:(s=!0,r[i]=a,`
`));if(!!r.showtitle&&["on","yes","true"].includes(r.showtitle.toLowerCase())?r.showtitle=!0:r.showtitle=void 0,!!r.glossary&&["on","yes","true"].includes(r.glossary.toLowerCase())?r.glossary=!0:r.glossary=void 0,!!r.links&&["on","yes","true"].includes(r.links.toLowerCase())?r.links=!0:r.links=void 0,!!r.refs&&["on","yes","true"].includes(r.refs.toLowerCase())?r.refs=!0:r.refs=void 0,!!r.terms&&["on","yes","true"].includes(r.terms.toLowerCase())?r.terms=!0:r.terms=void 0,!!r.resources&&["on","yes","true"].includes(r.resources.toLowerCase())?r.resources=!0:r.resources=void 0,!!r.toc&&["on","yes","true"].includes(r.toc.toLowerCase())?r.toc=!0:r.toc=void 0,e.metas=r,e.metas.keyword=getKeywords(e.metas.keyword),e.metas.date)try{e.metas.date=new Date(e.metas.date).getTime()}catch(n){delete e.metas.date}for(e.metas.god=e.metas.theone='<a href="mailto:lostabaddon@gmail.com">LostAbaddon</a>',e.metas.script?e.metas.script=e.metas.script.split(/[,; 　\t]+/):e.metas.script=[],e.metas.style?e.metas.style=e.metas.style.split(/[,; 　\t]+/).map(n=>n.replace(/\{[\w\W]*\}/,"")):e.metas.style=[],e.termList=e.termList||[],e.mainParser=!1,e.refs={},s=!0;s;)s=!1,t=t.replace(/\n\[([\w \-\.\+\=\\\/]+?)\] *[:：] *([\w\W]+?)\n([\n\[])/,(n,i,a,l,f)=>(i=i.trim(),a=a.trim(),i.length===0||a.length===0?n:(e.refs[i]=a,s=!0,`
`+l)));for(e.blocks={},s=!0;s;)s=!1,t=t.replace(/\[:([\w \-\.\+\=\\\/]+?):\]([\w\W]*?)\n*\[:\1:\]/g,(n,i,a)=>{if(i=i.trim(),!(i.length===0||a.length===0))return e.blocks[i]=a,s=!0,""});return e.anchors=[],e.terms={},e.notes={},t.replace(/\] *(\[[\^:]([\w ]+?)\]|\{([\w ]+?)\})/g,(n,i,a,l)=>{var f=a||l;e.refs[f]?i.substr(0,1)==="{"?e.terms[f]=f:e.notes[f]=f:i.substr(0,1)==="{"&&!e.anchors.includes(f)&&e.anchors.push(f)}),t=regularize(t),t};MarkUp.fullParse=(e,t)=>{var r={finals:{},toced:!1};t=t||{};var s=e.replace(/\n标题[:：][ 　\t]*/gi,`
`).replace(/\n作者[:：][ 　\t]*/gi,`
`).replace(/\n简介[:：][ 　\t]*/gi,`
`).replace(/\n关键词[:：][ 　\t]*/gi,`
`).replace(/\n更新[:：][ 　\t]*/gi,`
`);for(MetaWords.forEach(l=>{var f=new RegExp(`
`+l+"[:\uFF1A][ \u3000\\t]*","gi");s=s.replace(f,`
`)}),PreservedKeywords.forEach(l=>{var f=new RegExp("\\["+l+"\\]","gi");s=s.replace(f,"")});;){let l=s.replace(/\[(.*?)\][ 　\t]*\[.*?\]/g,(f,p)=>p).replace(/\[(.*?)\][ 　\t]*\{.*?\}/g,(f,p)=>p).replace(/\[(.*?)\][ 　\t]*\(.*?\)/g,(f,p)=>p).replace(/<\w.*?\w>|<\w>/g,"").replace(/\n[ 　\t]*(\-+|\++|#+|>|=+|\*+|~+|`+|\$+|\d+\.)[ 　\t]*/g,`
`);if(s===l)break;s=l}s=s.match(/[\u4e00-\u9fa5]|[a-zA-Z0-9]+/gi)||"",s=s.length||0,e=prepare(e),e=getMetas(r,e),r.parseLevel=0,r.mainParser=!0,r.metas.title=r.metas.title||"\u65E0\u540D\u6587";var n=Object.keys(r.metas);Object.keys(t).forEach(l=>{n.includes(l)||n.push(l)}),t.overwrite?n.forEach(l=>{r.metas[l]=t[l]===null||t[l]===void 0?r.metas[l]:t[l]}):n.forEach(l=>{r.metas[l]=r.metas[l]===null||r.metas[l]===void 0?t[l]:r.metas[l]}),n.forEach(l=>{(r.metas[l]===null||r.metas[l]===void 0)&&(r.metas[l]=!1)}),e=parseSection(e,r),Object.keys(r.refs).forEach(l=>{var f=r.refs[l];f=parseLine(f,r),f=f.replace(/\%([\w \-]+?)\%/g,(p,u)=>{var h=ReversePreserveWords[u.toLowerCase()];return h||p}),r.refs[l]=f}),Object.keys(r.blocks).forEach(l=>{var f=r.blocks[l],p=f.match(/^\n+/);f=f.trim();var u;r.parseLevel=0,p?u=parseSection(f,r,1):u=[parseLine(f,r)],r.blocks[l]=u.join("")});for(let l in r.terms)r.terms[l]=r.refs[l];for(let l in r.notes)r.notes[l]=r.refs[l];e=e.map(l=>(l=l.replace(/\%([\w \-]+?)\%/g,(f,p)=>{var u=ReversePreserveWords[p.toLowerCase()];return u||f}),l=l.replace(/\%<span class="english">([\w \-]+?)(<\/span>\%|\%<\/span>)/g,(f,p)=>{var u=ReversePreserveWords[p.toLowerCase()];return u||f}),l)),e=applyBlockReference(e,r),e=analyzeSections(e,r),e=applyMarkUpReference(e,r),r.metas.classname?e='<article class="'+r.metas.classname+'">'+e.join("")+"</article>":e="<article>"+e.join("")+"</article>",r.metas.fullexport&&(r.metas.style.forEach(l=>{e+='<link type="text/css" rel="stylesheet" href="'+l+'">'}),r.metas.script.forEach(l=>{e+='<script type="text/javascript" src="'+l+'"></script>'}));var i=FinalRender._indexes_||[];i.forEach(l=>{var f=FinalRender[l];!f||f.forEach(p=>{e=p.parse(e,r)})}),e=e.replace(/<p>(<br\/?>)+<\/p>/gi,"");var a={};return a.content=e,a.title=r.metas.title,a.lineCount=r.metas.totalLineCount,a.chapList=r.chapList,a.tables=r.tables,a.meta={},a.meta.author=r.metas.author,a.meta.email=r.metas.email,a.meta.description=r.metas.description,a.meta.update=r.metas.date,a.meta.keywords=r.metas.keyword.map(l=>l),r.metas.others&&(a.meta.others=r.metas.others),a.terminology={},r.termList.forEach(l=>{a.terminology[l[0]]=l[1]}),a.notes={},Object.keys(r.refs).forEach(l=>{a.notes[l]=r.refs[l]}),a.blocks={},Object.keys(r.refs).forEach(l=>{a.blocks[l]=r.blocks[l]}),a.wordCount=s,a},MarkUp.parse=(e,t)=>{var r;return r=MarkUp.fullParse(`
`+e+`
`,t),r?r.content:""};const reverseSection=(e,t)=>{t.__level++;var r=[],s="",n=!0;return e.childNodes.forEach(i=>{var a=i.tagName;if(!a){if(i.nodeName==="#comment")return;let f=i.textContent||"";f=f.trim(),f.length>0&&(s+=f);return}a=a.trim().toLowerCase();var l;if(ParagraphTags.includes(a)){if(n=!1,s.length>0&&(r.push(t.__prefix+s),s=""),a==="blockquote"){let f=t.__prefix;t.__prefix=t.__prefix+">	",l=reverseSection(i,t),l=l.flat(Infinity),l.push(`
`),t.__prefix=f}else if(a==="ol"){let f=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"1.	",l=reverseSection(i,t),l=l.flat(Infinity),l.push(""),t.__prefix=f}else if(a==="ul"){let f=t.__prefix;t.__prefix.indexOf("-	")>=0||t.__prefix.indexOf("1.	")>=0?t.__prefix="	"+t.__prefix:t.__prefix=t.__prefix+"-	",l=reverseSection(i,t),l=l.flat(Infinity),l.push(""),t.__prefix=f}else l=reverseSection(i,t),l=l.flat(Infinity),l.push("");!!l&&l.length>0&&r.push(...l)}else{let[f,p]=reverseMix(i,a,t);p?f.length>0&&(s+=f.join("")):(s.length>0&&(r.push(t.__prefix+s),s=""),f.forEach(u=>{r.push(t.__prefix+u)}))}}),s.length>0&&r.push(t.__prefix+s),t.__level--,r},reverseLine=(e,t)=>{var r="";return e.childNodes.forEach(s=>{var n=s.tagName;if(!n){if(s.nodeName==="#comment")return;let i=s.textContent||"";i=i.trim(),i.length>0&&(r+=i);return}if(n=n.trim().toLowerCase(),n==="a"){let i=s.href;i.indexOf("javascript:")===0&&(i="");let a=reverseLine(s,t);!i||i.substr(0,1)==="#"||(i.match(/^(ftp|https?):\/\//i)||(i=t.host+i),a="["+a+"]("+i+")"),r+=a;return}if(n==="span"||n==="font"){r+=reverseLine(s,t);return}if(n==="strong"||n==="b"){r+=reverseLine(s,t);return}if(n==="em"||n==="i"){r+=reverseLine(s,t);return}if(n==="sup"){r+=reverseLine(s,t);return}if(n==="sub"){r+=reverseLine(s,t);return}if(n==="del"){r+=reverseLine(s,t);return}r+=s.innerText}),r},reverseMix=(e,t,r)=>{if(t==="script")return[[""],!0];if(t==="style")return[[""],!0];if(t==="link")return[[""],!0];if(t==="hr")return[[`
---
`],!1];if(t==="br")return[[`
`],!0];if(t.match(/^h\d+$/)){let n=t.substring(1,t.length);n*=1;let i=`
`;for(let l=0;l<n;l++)i+="#";let a=reverseLine(e,r);return a=i+a+`
`,[[a],!1]}if(t==="a"){let n=e.href;n.indexOf("javascript:")===0&&(n="");let i=reverseLine(e,r);return!n||n.substr(0,1)==="#"?[[i],!0]:(n.match(/^(ftp|https?):\/\//i)||(n=r.host+n),i="["+i+"]("+n+")",[[i],!0])}if(t==="img")return e.src.length===0?[[""],!0]:[[`
![](`+e.src+`)
`],!1];if(t==="video")return e.src.length===0?[[""],!0]:[[`
@[](`+e.src+`)
`],!0];if(t==="audio")return e.src.length===0?[[""],!0]:[[`
#[](`+e.src+`)
`],!0];if(t==="span"||t==="font")return[[reverseLine(e,r)],!0];if(t==="strong"||t==="b"){let n=reverseLine(e,r);return[["**"+n+"**"],!0]}if(t==="em"||t==="i"){let n=reverseLine(e,r);return[["*"+n+"*"],!0]}if(t==="u"){let n=reverseLine(e,r);return[["__"+n+"__"],!0]}if(t==="sup"){let n=reverseLine(e,r);return[["^"+n+"^"],!0]}if(t==="sub"){let n=reverseLine(e,r);return[["_"+n+"_"],!0]}if(t==="del"){let n=reverseLine(e,r);return[["~~"+n+"~~"],!0]}var s=reverseLine(e,r);return[[s],!1]};MarkUp.plaintextReverse=e=>{for(e=e.replace(/\r/g,""),e=e.replace(/<!(.*?|\s*?)*?>/g,""),e=e.replace(/<xml(.*?|\s*?)*?>[\w\W]*?<\/xml>/gi,""),e=e.replace(/<style(.*?|\s*?)*?>[\w\W]*?<\/style>/gi,""),e=e.replace(/<(\/?\w+).*?>/g,(s,n)=>{if(n=n.toLowerCase(),n==="a"){let i=s.match(/href=('|")(.*?)\1/i);return!i||(i=i[2],!i)?"<a>":'<a src="'+i+'">'}else if(n==="img"){let i=s.match(/src=('|")(.*?)\1/i);return!i||(i=i[2],!i)?"<img>":'<img src="'+i+'">'}else return["div","article","section","aside","nav","footer","header","foot"].includes(n.replace("/",""))?n.indexOf("/")===0?"</p>":"<p>":"<"+n+">"}),e=e.replace(/<p([ \s](.*?))*?>/gi,"<p>"),e=e.replace(/<\/?(html|head|body|span|lable|nobr|link|meta|w:\w*?|w|xml|o|m|style)([ \s](.*?))*?>/gi,"");;){let s=e;if(s=s.replace(/<(.*?)( .*?)*>(<\1( .*?)*>)*/gi,(n,i)=>"<"+i+">"),s=s.replace(/<(.*?)( .*?)*>[ 　\s]*<\/\1>/gi,""),s=s.replace(/<(h\d|blockquote|li|pre)([ \s](.*?))*?>(<p([ \s](.*?))*?>)*/gi,(n,i)=>"<"+i+">"),s=s.replace(/(<\/p>)+(<\/(h\d|blockquote|li|pre)>)/gi,(n,i,a)=>a),s===e)break;e=s}e=e.replace(/<\/?(b|strong)>/gi,"**"),e=e.replace(/<\/?(i|em)>/gi,"*"),e=e.replace(/<\/?sup>/gi,"^"),e=e.replace(/<\/?sub>/gi,"_"),e=e.replace(/<\/?u>/gi,"__"),e=e.replace(/<\/?(del|strike)>/gi,"~~"),e=e.replace(/<\/?code>/gi,"`"),e=e.replace(/<a src=('|")(.*?)\1>(.*?)<\/a>/gi,(s,n,i,a)=>i?"["+a+"]("+i+")":a),e=e.replace(/<img src=('|")(.*?)\1>/gi,(s,n,i)=>i?`
![](`+i+`)
`:""),e=e.replace(/<h(\d)>/gi,(s,n)=>{var i=n.length,a="";for(let l=0;l<i;l++)a+="#";return a+"	"}),e=e.replace(/<p>/gi,"");var t=!1,r=1;return e=e.replace(/<(ul|li|ol)>/gi,(s,n)=>(n=n.toLowerCase(),n==="ol"?(t=!0,r=1,""):n==="ul"?(t=!1,r=1,""):t?(s=r+".	",r++,s):"-	")),t=!1,e=e.replace(/<(pre|\/pre|\/p)>/gi,(s,n)=>(n=n.toLowerCase(),n==="pre"?(t=!0,"``"):n==="/code"?(t=!1,"``"):t?`
`:`

`)),e=e.replace(/<\/(h\d)>/gi,`

`),e=e.replace(/<\/?br\/?>/gi,`
`),e=e.replace(/<\/(li|ul|ol)>/gi,`
`),e=e.replace(/<(blockquote)>/gi,">	"),e=e.replace(/<\/(blockquote)>/gi,`


`),e=e.replace(/<\/?hr\/?>/gi,`
----

`),e=e.replace(/<.*?>/gi,""),e=e.replace(/(^[\n\r]+|[\n\r]+$)/gi,""),e},MarkUp.reverse=(e,t,r=!0)=>{if(!e)return"";if(t==="plain"||t==="plaintext")return MarkUp.plaintextReverse(e);t=t||{},t.__level=0,t.__prefix="",t.host=t.host||"";var s=reverseSection(e,t);return s=s.flat(Infinity),s=s.join(`
`),s=s.replace(/\n{2,}/g,`

`),s},MarkUp.parseLine=parseLine,MarkUp.parseSection=parseSection,MarkUp.generateRandomKey=generateRandomKey,MarkUp.SymHidden=SymHidden,MarkUp.PreserveWords=PreserveWords,MarkUp.Char2Dig=Char2Dig,MarkUp.MathTools=MathTools;try{window.MarkUp=MarkUp}catch(e){try{global.MarkUp=MarkUp}catch(t){console.error(t)}}})();
